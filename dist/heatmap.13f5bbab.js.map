{"version":3,"sources":["heatmap.js"],"names":["console","log","container","document","getElementById","error","innerHTML","d3","select","selectAll","remove","genreData","surfaceData","months","allGenres","loadData","json","then","data","length","processData","init3DHeatmap","catch","err","warn","monthIdx","row","genreIdx","push","Math","random","chunk","Array","fill","genre","value","genre_distribution","rotationAngle","PI","isometricProjection","x","y","z","angle","scale","cosR","cos","sinR","sin","rotatedX","rotatedY","isoX","isoY","map","getContainerSize","actualWidth","clientWidth","offsetWidth","actualHeight","clientHeight","offsetHeight","width","height","containerSize","containerWidth","containerHeight","minValue","Infinity","maxValue","i","j","min","max","valueRange","morandiColors","r","g","b","getColor","normalized","color","t","concat","round","tooltip","append","attr","style","svg","isDragging","lastMouseX","cellWidth","cellDepth","maxHeight","numGenres","numMonths","totalWidth","totalDepth","corners","minX","d","maxX","minY","maxY","projectedWidth","projectedHeight","padding","viewBoxMinX","viewBoxMinY","viewBoxWidth","viewBoxHeight","interactiveElements","cellDataArray","lineDataArray","drawFace","svgGroup","points","fillColor","strokeColor","opacity","arguments","undefined","path","moveTo","lineTo","closePath","toString","darkenColor","rgb","factor","match","parseInt","cellThickness","baseColor","darkColor","darkerColor","zBottom","zTop","bottom1","bottom2","bottom3","bottom4","top1","top2","top3","top4","cellGroup","datum","month","topFace","forEach","element","on","event","parentGroup","parentNode","trackCount","transition","duration","html","toFixed","pageX","pageY","includes","brightness","minLineHeight","maxLineHeight","_iterator","_createForOfIteratorHelper","_step","s","n","done","val","e","f","lineHeightRange","maxLineZ","lineGenerator","line","curve","curveMonotoneX","projected","areaGenerator","area","y0","y1","_loop","_monthIdx2","monthY","lineData","normalizedValue","isNaN","genreX","avgValue","reduce","sum","lineColor","darkerLineColor","areaPath","areaElement","_d3$pointer","pointer","node","_d3$pointer2","_slicedToArray","mouseX","mouseY","minDistance","nearestPoint","nearestGenreIdx","point","idx","distance","sqrt","pow","linePath","lineElement","_d3$pointer3","_d3$pointer4","maxZ","maxPoint","maxProjected","axisOffset","drawAxisWithArrow","start","end","axisClass","dx","dy","atan2","arrowLength","arrowPath","origin","xAxisEnd","yAxisEnd","zAxisEnd","labelOffset","text","zLabelPos","updateProjection","cellData","empty","paths","faces","each","_ref","sortedLineData","_toConsumableArray","sort","a","projA","projB","lineGeneratorUpdate","newPath","areaGeneratorUpdate","xAxisAngle","xArrowLength","xArrowPath","yAxisAngle","yArrowLength","yArrowPath","zAxisAngle","zArrowLength","zArrowPath","clientX","preventDefault","deltaX","resizeTimer","handleResize","clearTimeout","setTimeout","window","addEventListener","readyState"],"mappings":"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","file":"heatmap.13f5bbab.js","sourceRoot":"..\\src","sourcesContent":["// ============================================\n// heatmap.js - D3ä¼ª3Dçƒ­åŠ›å›¾ï¼ˆç­‰è½´æµ‹æŠ•å½±ï¼‰\n// ============================================\n// Xè½´ï¼šé£æ ¼ï¼ˆgenresï¼‰ï¼ŒYè½´ï¼šæ—¶é—´ï¼ˆmonthsï¼‰ï¼ŒZè½´ï¼šä¹æ›²æ•°é‡\nconsole.log('ğŸ¨ D3ä¼ª3Dçƒ­åŠ›å›¾è„šæœ¬å¼€å§‹åŠ è½½...');\n(() => {\n  const container = document.getElementById(\"heatmap\");\n  if (!container) {\n    console.error('âŒ æ‰¾ä¸åˆ°heatmapå®¹å™¨');\n    return;\n  }\n  \n  container.innerHTML = '';\n  d3.select(\"body\").selectAll(\".heatmap-tooltip\").remove();\n\n  let genreData = null;\n  let surfaceData = null;\n\n  const months = [\n    '2023-12', '2024-01', '2024-02', '2024-03', '2024-04', '2024-05', '2024-06',\n    '2024-07', '2024-08', '2024-09', '2024-10', '2024-11', '2024-12',\n    '2025-01', '2025-02', '2025-03', '2025-04', '2025-05', '2025-06',\n    '2025-07', '2025-08', '2025-09', '2025-10', '2025-11', '2025-12'\n  ];\n\n  const allGenres = [\"ACG\", \"classical\", \"electronic\", \"folk\", \"jazz\", \"pop\", \"rap\", \"rock\"];\n\n  function loadData() {\n    console.log('âœ… å¼€å§‹åŠ è½½JSONæ•°æ®');\n    d3.json(\"src/assets/æ­Œå•_2314343014_genreåˆ†å¸ƒç»Ÿè®¡_å½’ç±»å.json\")\n      .then(data => {\n        console.log('âœ… JSONæ•°æ®åŠ è½½æˆåŠŸï¼Œå…±', data.length, 'æ¡è®°å½•');\n        genreData = data;\n        processData();\n        init3DHeatmap();\n      })\n      .catch(err => {\n        console.error(\"âŒ åŠ è½½JSONæ•°æ®å¤±è´¥:\", err);\n        console.log(\"ä½¿ç”¨é»˜è®¤æ•°æ®åˆå§‹åŒ–\");\n        processData();\n        init3DHeatmap();\n      });\n  }\n\n  function processData() {\n    surfaceData = [];\n    \n    if (!genreData || genreData.length === 0) {\n      console.warn('genreDataä¸ºç©ºï¼Œä½¿ç”¨é»˜è®¤æ•°æ®');\n      for (let monthIdx = 0; monthIdx < 25; monthIdx++) {\n        const row = [];\n        for (let genreIdx = 0; genreIdx < allGenres.length; genreIdx++) {\n          row.push(Math.random() * 50 + 20);\n        }\n        surfaceData.push(row);\n      }\n      return;\n    }\n\n    for (let monthIdx = 0; monthIdx < 25; monthIdx++) {\n      const chunk = genreData[monthIdx];\n      if (!chunk) {\n        surfaceData.push(Array(allGenres.length).fill(0));\n        continue;\n      }\n      const row = [];\n      for (let genreIdx = 0; genreIdx < allGenres.length; genreIdx++) {\n        const genre = allGenres[genreIdx];\n        const value = chunk.genre_distribution && chunk.genre_distribution[genre] ? chunk.genre_distribution[genre] : 0;\n        row.push(value);\n      }\n      surfaceData.push(row);\n    }\n    \n    console.log('âœ… æ•°æ®å¤„ç†å®Œæˆ');\n  }\n\n  // æ—‹è½¬è§’åº¦ï¼ˆå…¨å±€å˜é‡ï¼Œæ”¯æŒé¼ æ ‡æ‹–åŠ¨æ—‹è½¬ï¼‰\n  let rotationAngle = Math.PI / 6; // é»˜è®¤30åº¦\n\n  // ç­‰è½´æµ‹æŠ•å½±å‡½æ•°ï¼ˆæ”¯æŒæ—‹è½¬ï¼‰\n  function isometricProjection(x, y, z) {\n    // ç­‰è½´æµ‹æŠ•å½±ï¼šxè½´å‘å³ï¼Œyè½´å‘å‰ï¼ˆæ·±åº¦ï¼‰ï¼Œzè½´å‘ä¸Š\n    // æ”¯æŒæ°´å¹³æ—‹è½¬ï¼ˆç»•Zè½´ï¼‰\n    const angle = Math.PI / 6; // åŸºç¡€ç­‰è½´æµ‹è§’åº¦30åº¦\n    const scale = 1.2; // ç¨å¾®æ”¾å¤§ä¸€ç‚¹ï¼Œè®©3Dæ•ˆæœæ›´æ˜æ˜¾\n    \n    // åº”ç”¨æ°´å¹³æ—‹è½¬\n    const cosR = Math.cos(rotationAngle);\n    const sinR = Math.sin(rotationAngle);\n    const rotatedX = x * cosR - y * sinR;\n    const rotatedY = x * sinR + y * cosR;\n    \n    // ç­‰è½´æµ‹æŠ•å½±\n    const isoX = (rotatedX - rotatedY) * Math.cos(angle) * scale;\n    const isoY = (rotatedX + rotatedY) * Math.sin(angle) * scale - z * scale;\n    return { x: isoX, y: isoY };\n  }\n\n  function init3DHeatmap() {\n    if (!surfaceData || surfaceData.length === 0) {\n      console.warn('surfaceDataä¸ºç©ºï¼Œåˆ›å»ºé»˜è®¤æ•°æ®');\n      surfaceData = Array(25).fill(null).map(() => Array(allGenres.length).fill(10));\n    }\n\n    // è·å–å®¹å™¨å°ºå¯¸çš„å‡½æ•° - ä½¿ç”¨å®é™…å®¹å™¨å°ºå¯¸\n    const getContainerSize = () => {\n      // è·å–å®é™…å®¹å™¨å°ºå¯¸ï¼Œå¦‚æœä¸º0åˆ™ä½¿ç”¨é»˜è®¤å€¼\n      const actualWidth = container.clientWidth || container.offsetWidth || 1600;\n      const actualHeight = container.clientHeight || container.offsetHeight || 800;\n      return {\n        width: actualWidth > 0 ? actualWidth : 1600,\n        height: actualHeight > 0 ? actualHeight : 800\n      };\n    };\n\n    let containerSize = getContainerSize();\n    // ä½¿ç”¨å®é™…å®¹å™¨å°ºå¯¸ï¼Œä¸å¼ºåˆ¶æœ€å°å€¼\n    let containerWidth = containerSize.width;\n    let containerHeight = containerSize.height;\n\n    // è®¡ç®—æ•°æ®èŒƒå›´\n    let minValue = Infinity;\n    let maxValue = 0;\n    for (let i = 0; i < surfaceData.length; i++) {\n      for (let j = 0; j < surfaceData[i].length; j++) {\n        minValue = Math.min(minValue, surfaceData[i][j]);\n        maxValue = Math.max(maxValue, surfaceData[i][j]);\n      }\n    }\n    if (maxValue === 0) maxValue = 1;\n    const valueRange = maxValue - minValue || 1;\n\n    // Morandié¢œè‰²æ–¹æ¡ˆ\n    const morandiColors = [\n      {r: 110, g: 134, b: 166}, // #6E86A6\n      {r: 201, g: 214, b: 229}, // #C9D6E5\n      {r: 247, g: 244, b: 236}, // #F7F4EC\n      {r: 241, g: 197, b: 183}, // #F1C5B7\n      {r: 201, g: 122, b: 110}  // #C97A6E\n    ];\n\n    function getColor(value) {\n      const normalized = (value - minValue) / valueRange;\n      let color;\n      if (normalized < 0.25) {\n        const t = normalized * 4;\n        color = {\n          r: morandiColors[0].r + (morandiColors[1].r - morandiColors[0].r) * t,\n          g: morandiColors[0].g + (morandiColors[1].g - morandiColors[0].g) * t,\n          b: morandiColors[0].b + (morandiColors[1].b - morandiColors[0].b) * t\n        };\n      } else if (normalized < 0.5) {\n        const t = (normalized - 0.25) * 4;\n        color = {\n          r: morandiColors[1].r + (morandiColors[2].r - morandiColors[1].r) * t,\n          g: morandiColors[1].g + (morandiColors[2].g - morandiColors[1].g) * t,\n          b: morandiColors[1].b + (morandiColors[2].b - morandiColors[1].b) * t\n        };\n      } else if (normalized < 0.75) {\n        const t = (normalized - 0.5) * 4;\n        color = {\n          r: morandiColors[2].r + (morandiColors[3].r - morandiColors[2].r) * t,\n          g: morandiColors[2].g + (morandiColors[3].g - morandiColors[2].g) * t,\n          b: morandiColors[2].b + (morandiColors[3].b - morandiColors[2].b) * t\n        };\n      } else {\n        const t = (normalized - 0.75) * 4;\n        color = {\n          r: morandiColors[3].r + (morandiColors[4].r - morandiColors[3].r) * t,\n          g: morandiColors[3].g + (morandiColors[4].g - morandiColors[3].g) * t,\n          b: morandiColors[3].b + (morandiColors[4].b - morandiColors[3].b) * t\n        };\n      }\n      return `rgb(${Math.round(color.r)}, ${Math.round(color.g)}, ${Math.round(color.b)})`;\n    }\n\n    // åˆ›å»ºtooltip\n    const tooltip = d3.select(\"body\").append(\"div\")\n      .attr(\"class\", \"heatmap-tooltip\")\n      .style(\"position\", \"absolute\")\n      .style(\"pointer-events\", \"none\")\n      .style(\"opacity\", 0)\n      .style(\"padding\", \"10px 12px\")\n      .style(\"border-radius\", \"12px\")\n      .style(\"background\", \"rgba(30,41,59,0.92)\")\n      .style(\"color\", \"#fff\")\n      .style(\"font\", '13px/1.35 system-ui,-apple-system,\"Segoe UI\",\"Microsoft YaHei\",sans-serif')\n      .style(\"box-shadow\", \"0 10px 24px rgba(0,0,0,0.16)\")\n      .style(\"z-index\", 1000);\n\n    // åˆ›å»ºSVGï¼Œå…ˆä¸è®¾ç½®viewBoxï¼Œç­‰è®¡ç®—å®Œå†…å®¹å°ºå¯¸åå†è®¾ç½®\n    const svg = d3.select(container)\n      .append(\"svg\")\n      .attr(\"width\", \"100%\")\n      .attr(\"height\", \"100%\")\n      .style(\"cursor\", \"grab\");\n    \n    // é¼ æ ‡æ‹–åŠ¨æ—‹è½¬ç›¸å…³å˜é‡\n    let isDragging = false;\n    let lastMouseX = 0;\n\n    // 3Dç©ºé—´å‚æ•°ï¼ˆæ”¾å¤§ï¼‰\n    const cellWidth = 50;  // æ¯ä¸ªå•å…ƒæ ¼çš„å®½åº¦ï¼ˆXè½´ï¼šgenreæ–¹å‘ï¼‰\n    const cellDepth = 25;  // æ¯ä¸ªå•å…ƒæ ¼çš„æ·±åº¦ï¼ˆYè½´ï¼šmonthæ–¹å‘ï¼‰\n    const maxHeight = 120;  // æœ€å¤§é«˜åº¦ï¼ˆZè½´ï¼‰\n    const numGenres = allGenres.length;\n    const numMonths = months.length;\n\n    // è®¡ç®—3Dç©ºé—´çš„è¾¹ç•Œ\n    const totalWidth = numGenres * cellWidth;\n    const totalDepth = numMonths * cellDepth;\n\n    // è®¡ç®—æŠ•å½±åçš„è¾¹ç•Œï¼Œç”¨äºå±…ä¸­\n    const corners = [\n      isometricProjection(0, 0, 0),\n      isometricProjection(totalWidth, 0, 0),\n      isometricProjection(0, totalDepth, 0),\n      isometricProjection(totalWidth, totalDepth, 0),\n      isometricProjection(0, 0, maxHeight),\n      isometricProjection(totalWidth, 0, maxHeight)\n    ];\n\n    const minX = d3.min(corners, d => d.x);\n    const maxX = d3.max(corners, d => d.x);\n    const minY = d3.min(corners, d => d.y);\n    const maxY = d3.max(corners, d => d.y);\n\n    const projectedWidth = maxX - minX;\n    const projectedHeight = maxY - minY;\n\n    // æ·»åŠ è¾¹è·ï¼Œç¡®ä¿å†…å®¹ä¸ä¼šè¢«è£å‰ª\n    const padding = 50;\n    const viewBoxMinX = minX - padding;\n    const viewBoxMinY = minY - padding;\n    const viewBoxWidth = projectedWidth + padding * 2;\n    const viewBoxHeight = projectedHeight + padding * 2;\n    \n    // ä½¿ç”¨å†…å®¹å°ºå¯¸ä½œä¸º viewBoxï¼Œè®© SVG è‡ªåŠ¨ç¼©æ”¾é€‚åº”å®¹å™¨\n    // preserveAspectRatio=\"xMidYMid meet\" ä¼šè‡ªåŠ¨å±…ä¸­å†…å®¹\n    svg.attr(\"viewBox\", `${viewBoxMinX} ${viewBoxMinY} ${viewBoxWidth} ${viewBoxHeight}`)\n       .attr(\"preserveAspectRatio\", \"xMidYMid meet\");\n\n    // ä¸éœ€è¦ transformï¼Œå†…å®¹ä½¿ç”¨åŸå§‹åæ ‡\n    // viewBox å·²ç»åŒ…å«äº†æ‰€æœ‰å†…å®¹ï¼ŒpreserveAspectRatio ä¼šè‡ªåŠ¨å±…ä¸­\n    const g = svg.append(\"g\");\n\n    // å­˜å‚¨æ‰€æœ‰äº¤äº’å…ƒç´ \n    const interactiveElements = [];\n    \n    // å­˜å‚¨æ‰€æœ‰å•å…ƒæ ¼æ•°æ®ï¼Œç”¨äºæ—‹è½¬æ—¶é‡æ–°æ¸²æŸ“\n    const cellDataArray = [];\n    // å­˜å‚¨æ‰€æœ‰æŠ˜çº¿æ•°æ®\n    const lineDataArray = [];\n\n    // è¾…åŠ©å‡½æ•°ï¼šç»˜åˆ¶ç«‹æ–¹ä½“çš„ä¸€ä¸ªé¢\n    function drawFace(svgGroup, points, fillColor, strokeColor, opacity = 1) {\n      const path = d3.path();\n      path.moveTo(points[0].x, points[0].y);\n      for (let i = 1; i < points.length; i++) {\n        path.lineTo(points[i].x, points[i].y);\n      }\n      path.closePath();\n      \n      return svgGroup.append(\"path\")\n        .attr(\"d\", path.toString())\n        .attr(\"fill\", fillColor)\n        .attr(\"stroke\", strokeColor)\n        .attr(\"stroke-width\", 0.5)\n        .attr(\"opacity\", opacity);\n    }\n\n    // è¾…åŠ©å‡½æ•°ï¼šä½¿é¢œè‰²å˜æš—ï¼ˆç”¨äºä¾§é¢ï¼‰\n    function darkenColor(rgb, factor) {\n      const match = rgb.match(/\\d+/g);\n      if (!match) return rgb;\n      const r = Math.max(0, Math.round(parseInt(match[0]) * factor));\n      const g = Math.max(0, Math.round(parseInt(match[1]) * factor));\n      const b = Math.max(0, Math.round(parseInt(match[2]) * factor));\n      return `rgb(${r}, ${g}, ${b})`;\n    }\n\n    // ========== ç¬¬ä¸€æ­¥ï¼šç»˜åˆ¶3Dçƒ­åŠ›å›¾ï¼ˆå¸¦åšåº¦çš„ç«‹æ–¹ä½“ï¼‰ ==========\n    const cellThickness = 6; // æ¯ä¸ªå•å…ƒæ ¼çš„åšåº¦ï¼ˆZè½´é«˜åº¦ï¼‰ï¼Œå‚è€ƒå›¾çœ‹èµ·æ¥çº¦6åƒç´ \n    \n    for (let genreIdx = 0; genreIdx < numGenres; genreIdx++) {\n      for (let monthIdx = 0; monthIdx < numMonths; monthIdx++) {\n        const value = surfaceData[monthIdx][genreIdx];\n        const baseColor = getColor(value);\n        const darkColor = darkenColor(baseColor, 0.85); // ä¾§é¢é¢œè‰²ï¼ˆç¨å¾®æš—ä¸€ç‚¹ï¼Œä¸è¦å¤ªæ·±ï¼‰\n        const darkerColor = darkenColor(baseColor, 0.75); // èƒŒé¢é¢œè‰²ï¼ˆç¨å¾®æ›´æš—ä¸€ç‚¹ï¼‰\n\n        // 3Dåæ ‡ï¼ˆX=genre, Y=month, Z=0ä¸ºåº•éƒ¨ï¼ŒZ=thicknessä¸ºé¡¶éƒ¨ï¼‰\n        const x = genreIdx * cellWidth;\n        const y = monthIdx * cellDepth;\n        const zBottom = 0;\n        const zTop = cellThickness;\n\n        // è®¡ç®—ç«‹æ–¹ä½“çš„8ä¸ªé¡¶ç‚¹\n        // åº•éƒ¨å››ä¸ªè§’\n        const bottom1 = isometricProjection(x, y, zBottom);\n        const bottom2 = isometricProjection(x + cellWidth, y, zBottom);\n        const bottom3 = isometricProjection(x + cellWidth, y + cellDepth, zBottom);\n        const bottom4 = isometricProjection(x, y + cellDepth, zBottom);\n        \n        // é¡¶éƒ¨å››ä¸ªè§’\n        const top1 = isometricProjection(x, y, zTop);\n        const top2 = isometricProjection(x + cellWidth, y, zTop);\n        const top3 = isometricProjection(x + cellWidth, y + cellDepth, zTop);\n        const top4 = isometricProjection(x, y + cellDepth, zTop);\n\n        // åˆ›å»ºå•å…ƒæ ¼ç»„\n        const cellGroup = g.append(\"g\")\n          .attr(\"class\", `cell-group cell-${monthIdx}-${genreIdx}`)\n          .datum({\n            month: months[monthIdx],\n            genre: allGenres[genreIdx],\n            value: value,\n            monthIdx: monthIdx,\n            genreIdx: genreIdx,\n            x: x,\n            y: y,\n            z: zBottom\n          })\n          .style(\"cursor\", \"pointer\");\n        \n        // å­˜å‚¨å•å…ƒæ ¼æ•°æ®\n        cellDataArray.push({\n          monthIdx,\n          genreIdx,\n          x,\n          y,\n          zBottom,\n          zTop,\n          value,\n          baseColor,\n          darkColor,\n          darkerColor,\n          cellGroup\n        });\n\n        // ç»˜åˆ¶ç«‹æ–¹ä½“çš„å„ä¸ªé¢ï¼ˆä»åå¾€å‰ï¼Œç¡®ä¿æ­£ç¡®çš„é®æŒ¡ï¼‰\n        // 1. åº•é¢\n        drawFace(cellGroup, [bottom1, bottom2, bottom3, bottom4], baseColor, \"rgba(255,255,255,0.3)\", 0.9);\n        \n        // 2. å³ä¾§é¢\n        drawFace(cellGroup, [bottom2, top2, top3, bottom3], darkColor, \"rgba(255,255,255,0.2)\", 0.9);\n        \n        // 3. èƒŒé¢\n        drawFace(cellGroup, [bottom4, bottom3, top3, top4], darkerColor, \"rgba(255,255,255,0.2)\", 0.85);\n        \n        // 4. é¡¶é¢ï¼ˆæœ€åç»˜åˆ¶ï¼Œç¡®ä¿åœ¨æœ€ä¸Šå±‚ï¼‰\n        const topFace = drawFace(cellGroup, [top1, top2, top3, top4], baseColor, \"rgba(255,255,255,0.4)\", 1);\n        \n        // å°†é¡¶é¢æ·»åŠ åˆ°äº¤äº’å…ƒç´ ï¼ˆç”¨äºtooltipï¼‰\n        interactiveElements.push(topFace);\n      }\n    }\n\n\n    // ========== æ·»åŠ äº¤äº’äº‹ä»¶ ==========\n    interactiveElements.forEach(element => {\n      element\n        .on(\"mouseover\", function(event, d) {\n          // é«˜äº®æ•´ä¸ªç«‹æ–¹ä½“ç»„ï¼ˆæ‰¾åˆ°çˆ¶ç»„ï¼‰\n          const parentGroup = d3.select(this.parentNode);\n          parentGroup.selectAll(\"path\")\n            .attr(\"opacity\", 1)\n            .attr(\"stroke-width\", 1.5);\n          \n          // ä»JSONæ–‡ä»¶çš„genre_distributionè·å–æ›²ç›®æ•°é‡\n          let trackCount = 0;\n          if (genreData && genreData[d.monthIdx]) {\n            const chunk = genreData[d.monthIdx];\n            const genre = allGenres[d.genreIdx];\n            if (chunk.genre_distribution && chunk.genre_distribution[genre] !== undefined) {\n              trackCount = chunk.genre_distribution[genre];\n            }\n          } else {\n            // å¦‚æœgenreDataæœªåŠ è½½ï¼Œä½¿ç”¨d.valueä½œä¸ºåå¤‡\n            trackCount = Math.round(d.value);\n          }\n\n          tooltip.transition().duration(150).style(\"opacity\", 0.95);\n          tooltip\n            .html(`<b>${d.genre}</b><br/>${d.month}<br/>åˆ†å€¼: ${d.value.toFixed(2)}<br/>æ›²ç›®æ•°é‡: ${trackCount}`)\n            .style(\"left\", `${event.pageX + 12}px`)\n            .style(\"top\", `${event.pageY - 18}px`);\n        })\n        .on(\"mouseout\", function() {\n          // æ¢å¤æ•´ä¸ªç«‹æ–¹ä½“ç»„çš„åŸå§‹æ ·å¼\n          const parentGroup = d3.select(this.parentNode);\n          parentGroup.selectAll(\"path\")\n            .attr(\"opacity\", function() {\n              // æ ¹æ®é¢çš„ç±»å‹æ¢å¤ä¸åŒçš„é€æ˜åº¦\n              const fill = d3.select(this).attr(\"fill\");\n              if (fill && fill.includes(\"rgb\")) {\n                const match = fill.match(/\\d+/g);\n                if (match) {\n                  const r = parseInt(match[0]);\n                  const g = parseInt(match[1]);\n                  const b = parseInt(match[2]);\n                  // æ ¹æ®äº®åº¦åˆ¤æ–­æ˜¯é¡¶é¢ã€ä¾§é¢è¿˜æ˜¯åº•é¢\n                  const brightness = (r + g + b) / 3;\n                  if (brightness > 200) return 1; // é¡¶é¢\n                  if (brightness > 150) return 0.85; // ä¾§é¢\n                  return 0.8; // èƒŒé¢/åº•é¢\n                }\n              }\n              return 0.9;\n            })\n            .attr(\"stroke-width\", 0.5);\n          tooltip.transition().duration(200).style(\"opacity\", 0);\n        });\n    });\n\n    // ========== æ·»åŠ æŠ˜çº¿è¶‹åŠ¿å›¾ï¼ˆæ¯ä¸ªæœˆä»½ä¸€æ¡ï¼Œæ²¿Xè½´å»¶ä¼¸ï¼ŒZè½´è¡¨ç¤ºé«˜åº¦ï¼‰ ==========\n    // è®¡ç®—æŠ˜çº¿é«˜åº¦çš„èŒƒå›´\n    let minLineHeight = Infinity;\n    let maxLineHeight = 0;\n    if (genreData && genreData.length > 0) {\n      for (let i = 0; i < genreData.length; i++) {\n        const chunk = genreData[i];\n        if (chunk && chunk.genre_distribution) {\n          for (let genre of allGenres) {\n            const val = chunk.genre_distribution[genre] || 0;\n            minLineHeight = Math.min(minLineHeight, val);\n            maxLineHeight = Math.max(maxLineHeight, val);\n          }\n        }\n      }\n    }\n    \n    // å¦‚æœgenreDataä¸ºç©ºï¼Œä½¿ç”¨surfaceDataçš„æ•°æ®\n    if (!genreData || genreData.length === 0 || minLineHeight === Infinity) {\n      minLineHeight = Infinity;\n      maxLineHeight = 0;\n      for (let i = 0; i < surfaceData.length; i++) {\n        for (let j = 0; j < surfaceData[i].length; j++) {\n          const val = surfaceData[i][j] || 0;\n          minLineHeight = Math.min(minLineHeight, val);\n          maxLineHeight = Math.max(maxLineHeight, val);\n        }\n      }\n    }\n    \n    // ç¡®ä¿æœ‰æœ‰æ•ˆçš„æ•°æ®èŒƒå›´\n    if (minLineHeight === Infinity) minLineHeight = 0;\n    if (maxLineHeight === 0) maxLineHeight = 1;\n    const lineHeightRange = maxLineHeight - minLineHeight || 1;\n    const maxLineZ = maxHeight * 1.2; // æŠ˜çº¿æœ€å¤§é«˜åº¦ï¼Œé™ä½é«˜åº¦\n    \n    console.log('ğŸ“Š æŠ˜çº¿å›¾æ•°æ®èŒƒå›´:', { minLineHeight, maxLineHeight, lineHeightRange, maxLineZ });\n\n    // D3çš„å¹³æ»‘æ›²çº¿ç”Ÿæˆå™¨ï¼ˆæ²¿Xè½´å»¶ä¼¸ï¼Œæ‰€ä»¥ç”¨curveMonotoneXï¼‰\n    const lineGenerator = d3.line()\n      .curve(d3.curveMonotoneX) // å¹³æ»‘æ›²çº¿ï¼Œæ²¿Xè½´\n      .x((d) => {\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.x;\n      })\n      .y((d) => {\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.y;\n      });\n\n    // D3çš„é¢ç§¯ç”Ÿæˆå™¨ï¼ˆç”¨äºå¡«å……ï¼‰\n    const areaGenerator = d3.area()\n      .curve(d3.curveMonotoneX) // æ²¿Xè½´\n      .x((d) => {\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.x;\n      })\n      .y0((d) => {\n        // åº•éƒ¨ï¼ˆçƒ­åŠ›å›¾é¡¶éƒ¨ï¼‰\n        const projected = isometricProjection(d.x, d.y, cellThickness);\n        return projected.y;\n      })\n      .y1((d) => {\n        // é¡¶éƒ¨ï¼ˆæŠ˜çº¿é«˜åº¦ï¼‰\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.y;\n      });\n\n    // ä¸ºæ¯ä¸ªæœˆä»½ç»˜åˆ¶æŠ˜çº¿ï¼ˆæ²¿Xè½´ï¼šé£æ ¼æ–¹å‘ï¼‰\n    for (let monthIdx = 0; monthIdx < numMonths; monthIdx++) {\n      const month = months[monthIdx];\n      const monthY = monthIdx * cellDepth + cellDepth / 2; // æœˆä»½çš„ä¸­å¿ƒYåæ ‡\n      \n      // ç”ŸæˆæŠ˜çº¿çš„æ•°æ®ç‚¹ï¼ˆæ²¿Xè½´ï¼šä»genre 0åˆ°genre 7ï¼‰\n      const lineData = [];\n      for (let genreIdx = 0; genreIdx < numGenres; genreIdx++) {\n        let value = 0;\n        if (genreData && genreData[monthIdx] && genreData[monthIdx].genre_distribution) {\n          const genre = allGenres[genreIdx];\n          value = genreData[monthIdx].genre_distribution[genre] || 0;\n        } else if (surfaceData && surfaceData[monthIdx]) {\n          // å¦‚æœgenreDataä¸ºç©ºï¼Œä½¿ç”¨surfaceData\n          value = surfaceData[monthIdx][genreIdx] || 0;\n        }\n        \n        // å½’ä¸€åŒ–é«˜åº¦ï¼Œç¡®ä¿ä¸ä¼šå‡ºç°NaN\n        const normalizedValue = lineHeightRange > 0 ? (value - minLineHeight) / lineHeightRange : 0;\n        const z = cellThickness + (isNaN(normalizedValue) ? 0 : normalizedValue) * maxLineZ; // ä»çƒ­åŠ›å›¾é¡¶éƒ¨å¼€å§‹\n        \n        const genreX = genreIdx * cellWidth + cellWidth / 2; // genreçš„ä¸­å¿ƒXåæ ‡\n        \n        // éªŒè¯åæ ‡ä¸æ˜¯NaN\n        if (!isNaN(genreX) && !isNaN(monthY) && !isNaN(z)) {\n          lineData.push({\n            x: genreX,\n            y: monthY,\n            z: z,\n            value: value,\n            monthIdx: monthIdx,\n            genreIdx: genreIdx\n          });\n        }\n      }\n\n      // è·å–è¯¥æœˆä»½çš„å¹³å‡é¢œè‰²ï¼ˆä½¿ç”¨çƒ­åŠ›å›¾çš„é¢œè‰²æ–¹æ¡ˆï¼Œä½†åŠ æ·±é¢œè‰²ä½¿å…¶æ›´æ˜æ˜¾ï¼‰\n      const avgValue = lineData.reduce((sum, d) => sum + d.value, 0) / lineData.length;\n      let lineColor = getColor(avgValue);\n      // åŠ æ·±é¢œè‰²ï¼Œä½¿æŠ˜çº¿æ›´æ˜æ˜¾\n      const darkerLineColor = darkenColor(lineColor, 0.6);\n      \n      // å­˜å‚¨æŠ˜çº¿æ•°æ®ï¼ˆç”¨äºæ—‹è½¬æ—¶æ›´æ–°ï¼‰\n      if (lineData.length > 0) {\n        lineDataArray.push({\n          monthIdx,\n          month,\n          lineData: [...lineData], // å¤åˆ¶æ•°ç»„\n          darkerLineColor,\n          lineColor\n        });\n      }\n      \n      // åªæœ‰å½“æœ‰æœ‰æ•ˆæ•°æ®ç‚¹æ—¶æ‰ç»˜åˆ¶\n      if (lineData.length > 0) {\n        // åˆ›å»ºé¢ç§¯å¡«å……ï¼ˆåŠé€æ˜ï¼‰\n        const areaPath = areaGenerator(lineData);\n        if (areaPath && !areaPath.includes('NaN')) {\n          const areaElement = g.append(\"path\")\n            .attr(\"class\", `area-path area-${monthIdx}`)\n            .attr(\"d\", areaPath)\n            .attr(\"fill\", darkerLineColor)\n            .attr(\"fill-opacity\", 0.4)\n            .attr(\"stroke\", \"none\")\n            .datum({ lineData: lineData, month: month, monthIdx: monthIdx }) // å­˜å‚¨æ•°æ®\n            .style(\"cursor\", \"pointer\");\n          \n          // ä¸ºé¢ç§¯å¡«å……ä¹Ÿæ·»åŠ é¼ æ ‡äº‹ä»¶ï¼ˆç¡®ä¿tooltipèƒ½æ˜¾ç¤ºï¼‰\n          areaElement\n            .on(\"mousemove\", function(event) {\n              // è·å–é¼ æ ‡åœ¨SVGä¸­çš„åæ ‡\n              const [mouseX, mouseY] = d3.pointer(event, g.node());\n              \n              // æ‰¾åˆ°æœ€è¿‘çš„æ•°æ®ç‚¹\n              let minDistance = Infinity;\n              let nearestPoint = null;\n              let nearestGenreIdx = -1;\n              \n              lineData.forEach((point, idx) => {\n                const projected = isometricProjection(point.x, point.y, point.z);\n                const distance = Math.sqrt(\n                  Math.pow(mouseX - projected.x, 2) + \n                  Math.pow(mouseY - projected.y, 2)\n                );\n                if (distance < minDistance) {\n                  minDistance = distance;\n                  nearestPoint = point;\n                  nearestGenreIdx = idx;\n                }\n              });\n              \n              // å¢åŠ è·ç¦»é˜ˆå€¼ï¼Œç¡®ä¿tooltipèƒ½æ˜¾ç¤º\n              if (nearestPoint && minDistance < 100) {\n                // ä»JSONè·å–æ›²ç›®æ•°é‡\n                let trackCount = 0;\n                if (genreData && genreData[monthIdx]) {\n                  const chunk = genreData[monthIdx];\n                  const genre = allGenres[nearestGenreIdx];\n                  if (chunk.genre_distribution && chunk.genre_distribution[genre] !== undefined) {\n                    trackCount = chunk.genre_distribution[genre];\n                  }\n                } else {\n                  trackCount = Math.round(nearestPoint.value);\n                }\n                \n                tooltip.transition().duration(150).style(\"opacity\", 0.95);\n                tooltip\n                  .html(`<b>${allGenres[nearestGenreIdx]}</b><br/>${month}<br/>åˆ†å€¼: ${nearestPoint.value.toFixed(2)}<br/>æ›²ç›®æ•°é‡: ${trackCount}`)\n                  .style(\"left\", `${event.pageX + 12}px`)\n                  .style(\"top\", `${event.pageY - 18}px`);\n              }\n            })\n            .on(\"mouseout\", function() {\n              tooltip.transition().duration(200).style(\"opacity\", 0);\n            });\n        }\n\n        // åˆ›å»ºæŠ˜çº¿ï¼ˆç¡®ä¿åœ¨æœ€ä¸Šå±‚æ˜¾ç¤ºï¼Œä½¿ç”¨æ·±è‰²ä½¿å…¶æ›´æ˜æ˜¾ï¼‰\n        const linePath = lineGenerator(lineData);\n        if (linePath && !linePath.includes('NaN')) {\n          const lineElement = g.append(\"path\")\n            .attr(\"class\", `line-path line-${monthIdx}`)\n            .attr(\"d\", linePath)\n            .attr(\"fill\", \"none\")\n            .attr(\"stroke\", darkerLineColor)\n            .attr(\"stroke-width\", 3.5)\n            .attr(\"opacity\", 1)\n            .datum({ lineData: lineData, month: month, monthIdx: monthIdx }) // å­˜å‚¨æ•°æ®\n            .style(\"cursor\", \"pointer\");\n          \n          // ä¸ºæŠ˜çº¿å›¾æ·»åŠ é¼ æ ‡äº‹ä»¶\n          lineElement\n            .on(\"mousemove\", function(event) {\n              // è·å–é¼ æ ‡åœ¨SVGä¸­çš„åæ ‡\n              const [mouseX, mouseY] = d3.pointer(event, g.node());\n              \n              // æ‰¾åˆ°æœ€è¿‘çš„æ•°æ®ç‚¹\n              let minDistance = Infinity;\n              let nearestPoint = null;\n              let nearestGenreIdx = -1;\n              \n              lineData.forEach((point, idx) => {\n                const projected = isometricProjection(point.x, point.y, point.z);\n                const distance = Math.sqrt(\n                  Math.pow(mouseX - projected.x, 2) + \n                  Math.pow(mouseY - projected.y, 2)\n                );\n                if (distance < minDistance) {\n                  minDistance = distance;\n                  nearestPoint = point;\n                  nearestGenreIdx = idx;\n                }\n              });\n              \n              // å¢åŠ è·ç¦»é˜ˆå€¼ï¼Œç¡®ä¿tooltipèƒ½æ˜¾ç¤º\n              if (nearestPoint && minDistance < 100) { // 100åƒç´ èŒƒå›´å†…æ˜¾ç¤ºtooltip\n                // ä»JSONè·å–æ›²ç›®æ•°é‡\n                let trackCount = 0;\n                if (genreData && genreData[monthIdx]) {\n                  const chunk = genreData[monthIdx];\n                  const genre = allGenres[nearestGenreIdx];\n                  if (chunk.genre_distribution && chunk.genre_distribution[genre] !== undefined) {\n                    trackCount = chunk.genre_distribution[genre];\n                  }\n                } else {\n                  trackCount = Math.round(nearestPoint.value);\n                }\n                \n                tooltip.transition().duration(150).style(\"opacity\", 0.95);\n                tooltip\n                  .html(`<b>${allGenres[nearestGenreIdx]}</b><br/>${month}<br/>åˆ†å€¼: ${nearestPoint.value.toFixed(2)}<br/>æ›²ç›®æ•°é‡: ${trackCount}`)\n                  .style(\"left\", `${event.pageX + 12}px`)\n                  .style(\"top\", `${event.pageY - 18}px`);\n              }\n            })\n            .on(\"mouseout\", function() {\n              tooltip.transition().duration(200).style(\"opacity\", 0);\n            });\n          \n          // ========== æ·»åŠ æœ€é«˜ç‚¹æ ‡è®° ==========\n          // æ‰¾åˆ°æœ€é«˜ç‚¹ï¼ˆzå€¼æœ€å¤§çš„ç‚¹ï¼‰\n          let maxZ = -Infinity;\n          let maxPoint = null;\n          lineData.forEach(point => {\n            if (point.z > maxZ) {\n              maxZ = point.z;\n              maxPoint = point;\n            }\n          });\n          \n          if (maxPoint) {\n            const maxProjected = isometricProjection(maxPoint.x, maxPoint.y, maxPoint.z);\n            \n            // ç»˜åˆ¶å¤–åœˆï¼ˆç™½è‰²ï¼Œæ›´å¤§ï¼‰\n            g.append(\"circle\")\n              .attr(\"class\", `max-point-outer max-point-outer-${monthIdx}`)\n              .attr(\"cx\", maxProjected.x)\n              .attr(\"cy\", maxProjected.y)\n              .attr(\"r\", 6)\n              .attr(\"fill\", \"#ffffff\")\n              .attr(\"stroke\", darkerLineColor)\n              .attr(\"stroke-width\", 2)\n              .attr(\"opacity\", 1)\n              .style(\"pointer-events\", \"none\"); // å…è®¸é¼ æ ‡äº‹ä»¶ç©¿é€åˆ°æŠ˜çº¿\n            \n            // ç»˜åˆ¶å†…åœˆï¼ˆæŠ˜çº¿é¢œè‰²ï¼Œæ›´å°ï¼‰\n            g.append(\"circle\")\n              .attr(\"class\", `max-point-inner max-point-inner-${monthIdx}`)\n              .attr(\"cx\", maxProjected.x)\n              .attr(\"cy\", maxProjected.y)\n              .attr(\"r\", 3.5)\n              .attr(\"fill\", darkerLineColor)\n              .attr(\"stroke\", \"none\")\n              .attr(\"opacity\", 1)\n              .style(\"pointer-events\", \"none\"); // å…è®¸é¼ æ ‡äº‹ä»¶ç©¿é€åˆ°æŠ˜çº¿\n          }\n          \n          console.log(`âœ… å·²ç»˜åˆ¶${month}çš„æŠ˜çº¿å›¾ï¼Œé¢œè‰²: ${darkerLineColor}, æ•°æ®ç‚¹: ${lineData.length}`);\n        } else {\n          console.warn(`âš ï¸ ${month}çš„æŠ˜çº¿è·¯å¾„ç”Ÿæˆå¤±è´¥ï¼Œè·¯å¾„: ${linePath}`);\n        }\n      } else {\n        console.warn(`âš ï¸ ${month}æ²¡æœ‰æœ‰æ•ˆçš„æ•°æ®ç‚¹`);\n      }\n    }\n    console.log('ğŸ‰ æŠ˜çº¿è¶‹åŠ¿å›¾ç»˜åˆ¶å®Œæˆï¼');\n    // ========== æ·»åŠ åæ ‡è½´çº¿ï¼ˆåŸç‚¹ä¸ç¬¬ä¸€ä¸ªæ–¹æ ¼å·¦ä¸Šè§’å¯¹é½ï¼‰ ==========\n    const axisOffset = 8; // åæ ‡è½´å¾€å¤–åç§»çš„è·ç¦»ï¼ˆå¢åŠ ï¼Œæ›´å¾€å¤–ï¼‰\n    \n    // è¾…åŠ©å‡½æ•°ï¼šç»˜åˆ¶å¸¦ç®­å¤´çš„è½´çº¿\n    function drawAxisWithArrow(start, end, color = \"#555\", axisClass = \"\") {\n      const line = g.append(\"line\")\n        .attr(\"class\", `axis-line ${axisClass}`)\n        .attr(\"x1\", start.x)\n        .attr(\"y1\", start.y)\n        .attr(\"x2\", end.x)\n        .attr(\"y2\", end.y)\n        .attr(\"stroke\", color)\n        .attr(\"stroke-width\", 2)\n        .attr(\"opacity\", 0.7);\n      \n      // è®¡ç®—ç®­å¤´æ–¹å‘\n      const dx = end.x - start.x;\n      const dy = end.y - start.y;\n      const angle = Math.atan2(dy, dx);\n      const arrowLength = 8;\n      \n      // ç»˜åˆ¶ç®­å¤´\n      const arrowPath = d3.path();\n      arrowPath.moveTo(end.x, end.y);\n      arrowPath.lineTo(\n        end.x - arrowLength * Math.cos(angle - Math.PI / 6),\n        end.y - arrowLength * Math.sin(angle - Math.PI / 6)\n      );\n      arrowPath.lineTo(\n        end.x - arrowLength * Math.cos(angle + Math.PI / 6),\n        end.y - arrowLength * Math.sin(angle + Math.PI / 6)\n      );\n      arrowPath.closePath();\n      \n      g.append(\"path\")\n        .attr(\"class\", `axis-arrow ${axisClass}`)\n        .attr(\"d\", arrowPath.toString())\n        .attr(\"fill\", color)\n        .attr(\"opacity\", 0.7);\n      \n      return { line, start, end };\n    }\n\n    // åæ ‡åŸç‚¹åœ¨ (0, 0, 0)ï¼Œå³ç¬¬ä¸€ä¸ªæ–¹æ ¼çš„å·¦ä¸Šè§’\n    let origin = isometricProjection(-axisOffset, -axisOffset, 0);\n    \n    // Xè½´ï¼ˆgenresæ–¹å‘ï¼‰- ä»åŸç‚¹æ²¿Xè½´å»¶ä¼¸\n    let xAxisEnd = isometricProjection(totalWidth + axisOffset, -axisOffset, 0);\n    drawAxisWithArrow(origin, xAxisEnd, \"#555\", \"x-axis\");\n\n    // Yè½´ï¼ˆmonthsæ–¹å‘ï¼‰- ä»åŸç‚¹æ²¿Yè½´å»¶ä¼¸\n    let yAxisEnd = isometricProjection(-axisOffset, totalDepth + axisOffset, 0);\n    drawAxisWithArrow(origin, yAxisEnd, \"#555\", \"y-axis\");\n\n    // Zè½´ï¼ˆé«˜åº¦æ–¹å‘ï¼‰- ä»åŸç‚¹å‘ä¸Šå»¶ä¼¸\n    let zAxisEnd = isometricProjection(-axisOffset, -axisOffset, maxHeight + axisOffset);\n    drawAxisWithArrow(origin, zAxisEnd, \"#555\", \"z-axis\");\n\n    // ========== æ·»åŠ åæ ‡è½´æ ‡ç­¾ ==========\n    const labelOffset = 40; // Xè½´æ ‡ç­¾å¾€å¤–åç§»çš„è·ç¦»ï¼ˆå¢åŠ ï¼Œç¡®ä¿åœ¨æ–¹æ ¼å¤–é¢ï¼‰\n    \n    // Xè½´æ ‡ç­¾ï¼ˆgenresï¼‰- åœ¨åº•éƒ¨å‰æ–¹ï¼ˆy<0çš„éƒ¨åˆ†ï¼‰\n    allGenres.forEach((genre, idx) => {\n      const x = idx * cellWidth + cellWidth / 2;\n      const y = -labelOffset; // y<0ï¼Œåœ¨åº•éƒ¨å‰æ–¹\n      const projected = isometricProjection(x, y, 0); // åœ¨y<0çš„ä½ç½®\n      \n      g.append(\"text\")\n        .attr(\"class\", `axis-label x-label x-label-${idx}`)\n        .attr(\"x\", projected.x)\n        .attr(\"y\", projected.y)\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"fill\", \"#333\")\n        .attr(\"font-size\", \"11px\")\n        .attr(\"font-weight\", \"500\")\n        .style(\"font-family\", \"system-ui, -apple-system, sans-serif\")\n        .text(genre);\n    });\n\n    // Yè½´æ ‡ç­¾ï¼ˆmonthsï¼‰- åœ¨å·¦ä¾§\n    months.forEach((month, idx) => {\n      if (idx % 3 === 0) { // åªæ˜¾ç¤ºéƒ¨åˆ†æœˆä»½ï¼Œé¿å…å¤ªå¯†é›†\n        const x = 0;\n        const y = idx * cellDepth + cellDepth / 2;\n        const projected = isometricProjection(x - labelOffset, y, 0);\n        \n        g.append(\"text\")\n          .attr(\"class\", `axis-label y-label y-label-${idx}`)\n          .attr(\"x\", projected.x)\n          .attr(\"y\", projected.y)\n          .attr(\"text-anchor\", \"end\")\n          .attr(\"fill\", \"#333\")\n          .attr(\"font-size\", \"10px\")\n          .style(\"font-family\", \"system-ui, -apple-system, sans-serif\")\n          .text(month);\n      }\n    });\n\n    // Zè½´æ ‡ç­¾ï¼ˆä¹æ›²æ•°é‡ï¼‰- å†å¾€ä¸Šç§»\n    let zLabelPos = isometricProjection(-10, 0, maxHeight + 25); // å¢åŠ Zåæ ‡ï¼Œè®©æ ‡ç­¾æ›´å¾€ä¸Š\n    g.append(\"text\")\n      .attr(\"class\", \"axis-label z-label\")\n      .attr(\"x\", zLabelPos.x)\n      .attr(\"y\", zLabelPos.y)\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"fill\", \"#333\")\n      .attr(\"font-size\", \"10px\")\n      .attr(\"font-weight\", \"500\")\n      .style(\"font-family\", \"system-ui, -apple-system, sans-serif\")\n      .text(\"ä¹æ›²æ•°é‡\");\n\n    console.log('ğŸ‰ D3ä¼ª3Dçƒ­åŠ›å›¾åˆå§‹åŒ–å®Œæˆï¼');\n\n    // ========== æ›´æ–°å‡½æ•°ï¼šé‡æ–°æ¸²æŸ“æ‰€æœ‰å…ƒç´ ï¼ˆç”¨äºæ—‹è½¬ï¼‰ ==========\n    function updateProjection() {\n      // é‡æ–°è®¡ç®—è¾¹ç•Œ\n      const corners = [\n        isometricProjection(0, 0, 0),\n        isometricProjection(totalWidth, 0, 0),\n        isometricProjection(0, totalDepth, 0),\n        isometricProjection(totalWidth, totalDepth, 0),\n        isometricProjection(0, 0, maxHeight),\n        isometricProjection(totalWidth, 0, maxHeight)\n      ];\n      \n      const minX = d3.min(corners, d => d.x);\n      const maxX = d3.max(corners, d => d.x);\n      const minY = d3.min(corners, d => d.y);\n      const maxY = d3.max(corners, d => d.y);\n      \n      const projectedWidth = maxX - minX;\n      const projectedHeight = maxY - minY;\n      \n      // æ›´æ–° viewBox\n      const padding = 50;\n      const viewBoxMinX = minX - padding;\n      const viewBoxMinY = minY - padding;\n      const viewBoxWidth = projectedWidth + padding * 2;\n      const viewBoxHeight = projectedHeight + padding * 2;\n      \n      svg.attr(\"viewBox\", `${viewBoxMinX} ${viewBoxMinY} ${viewBoxWidth} ${viewBoxHeight}`);\n      \n      // æ›´æ–°æ‰€æœ‰å•å…ƒæ ¼\n      cellDataArray.forEach(cellData => {\n        const { x, y, zBottom, zTop, monthIdx, genreIdx, baseColor, darkColor, darkerColor } = cellData;\n        \n        // é‡æ–°è®¡ç®—8ä¸ªé¡¶ç‚¹\n        const bottom1 = isometricProjection(x, y, zBottom);\n        const bottom2 = isometricProjection(x + cellWidth, y, zBottom);\n        const bottom3 = isometricProjection(x + cellWidth, y + cellDepth, zBottom);\n        const bottom4 = isometricProjection(x, y + cellDepth, zBottom);\n        const top1 = isometricProjection(x, y, zTop);\n        const top2 = isometricProjection(x + cellWidth, y, zTop);\n        const top3 = isometricProjection(x + cellWidth, y + cellDepth, zTop);\n        const top4 = isometricProjection(x, y + cellDepth, zTop);\n        \n        // æ›´æ–°å•å…ƒæ ¼ç»„çš„æ‰€æœ‰é¢\n        const cellGroup = g.select(`.cell-${monthIdx}-${genreIdx}`);\n        if (!cellGroup.empty()) {\n          const paths = cellGroup.selectAll(\"path\");\n          const faces = [\n            [bottom1, bottom2, bottom3, bottom4], // åº•é¢\n            [bottom2, top2, top3, bottom3], // å³ä¾§é¢\n            [bottom4, bottom3, top3, top4], // èƒŒé¢\n            [top1, top2, top3, top4] // é¡¶é¢\n          ];\n          \n          paths.each(function(d, i) {\n            if (i < faces.length) {\n              const path = d3.path();\n              path.moveTo(faces[i][0].x, faces[i][0].y);\n              for (let j = 1; j < faces[i].length; j++) {\n                path.lineTo(faces[i][j].x, faces[i][j].y);\n              }\n              path.closePath();\n              d3.select(this).attr(\"d\", path.toString());\n            }\n          });\n        }\n      });\n      \n      // æ›´æ–°æ‰€æœ‰æŠ˜çº¿\n      lineDataArray.forEach(({ monthIdx, lineData, darkerLineColor }) => {\n        // é‡æ–°ç”ŸæˆæŠ˜çº¿è·¯å¾„ï¼ˆä½¿ç”¨ä¸åˆå§‹åŒ–æ—¶ç›¸åŒçš„lineGeneratoré€»è¾‘ï¼‰\n        // æ³¨æ„ï¼šéœ€è¦æŒ‰ç…§æŠ•å½±åçš„Xåæ ‡æ’åºï¼Œç¡®ä¿æ›²çº¿æ–¹å‘æ­£ç¡®\n        const sortedLineData = [...lineData].sort((a, b) => {\n          const projA = isometricProjection(a.x, a.y, a.z);\n          const projB = isometricProjection(b.x, b.y, b.z);\n          return projA.x - projB.x;\n        });\n        \n        const lineGeneratorUpdate = d3.line()\n          .curve(d3.curveMonotoneX)\n          .x((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.x;\n          })\n          .y((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.y;\n          });\n        \n        // æ›´æ–°æŠ˜çº¿ï¼ˆä½¿ç”¨æ­£ç¡®çš„é€‰æ‹©å™¨ï¼Œclassæ˜¯ \"line-path line-${monthIdx}\"ï¼‰\n        const lineElement = g.select(`.line-path.line-${monthIdx}`);\n        if (!lineElement.empty()) {\n          const newPath = lineGeneratorUpdate(sortedLineData);\n          if (newPath && !newPath.includes('NaN')) {\n            lineElement.attr(\"d\", newPath);\n          }\n        }\n        \n        // æ›´æ–°é¢ç§¯å¡«å……ï¼ˆé‡æ–°åˆ›å»ºareaGeneratorï¼Œå› ä¸ºæŠ•å½±å‡½æ•°å·²æ›´æ–°ï¼‰\n        // ä½¿ç”¨æ’åºåçš„æ•°æ®ï¼Œç¡®ä¿ä¸æŠ˜çº¿ä¸€è‡´\n        const areaGeneratorUpdate = d3.area()\n          .curve(d3.curveMonotoneX)\n          .x((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.x;\n          })\n          .y0((d) => {\n            const projected = isometricProjection(d.x, d.y, cellThickness);\n            return projected.y;\n          })\n          .y1((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.y;\n          });\n        \n        const areaElement = g.select(`.area-${monthIdx}`);\n        if (!areaElement.empty()) {\n          areaElement.attr(\"d\", areaGeneratorUpdate(sortedLineData));\n        }\n        \n        // æ›´æ–°æœ€é«˜ç‚¹æ ‡è®°\n        let maxZ = -Infinity;\n        let maxPoint = null;\n        lineData.forEach(point => {\n          if (point.z > maxZ) {\n            maxZ = point.z;\n            maxPoint = point;\n          }\n        });\n        \n        if (maxPoint) {\n          const maxProjected = isometricProjection(maxPoint.x, maxPoint.y, maxPoint.z);\n          g.select(`.max-point-outer-${monthIdx}`)\n            .attr(\"cx\", maxProjected.x)\n            .attr(\"cy\", maxProjected.y);\n          g.select(`.max-point-inner-${monthIdx}`)\n            .attr(\"cx\", maxProjected.x)\n            .attr(\"cy\", maxProjected.y);\n        }\n      });\n      \n      // æ›´æ–°åæ ‡è½´ï¼ˆä½¿ç”¨å¤–éƒ¨å®šä¹‰çš„axisOffsetå’ŒlabelOffsetï¼‰\n      \n      // æ›´æ–°åŸç‚¹\n      origin = isometricProjection(-axisOffset, -axisOffset, 0);\n      \n      // æ›´æ–°Xè½´\n      xAxisEnd = isometricProjection(totalWidth + axisOffset, -axisOffset, 0);\n      g.select(\".x-axis.axis-line\")\n        .attr(\"x1\", origin.x)\n        .attr(\"y1\", origin.y)\n        .attr(\"x2\", xAxisEnd.x)\n        .attr(\"y2\", xAxisEnd.y);\n      \n      const xAxisAngle = Math.atan2(xAxisEnd.y - origin.y, xAxisEnd.x - origin.x);\n      const xArrowLength = 8;\n      const xArrowPath = d3.path();\n      xArrowPath.moveTo(xAxisEnd.x, xAxisEnd.y);\n      xArrowPath.lineTo(\n        xAxisEnd.x - xArrowLength * Math.cos(xAxisAngle - Math.PI / 6),\n        xAxisEnd.y - xArrowLength * Math.sin(xAxisAngle - Math.PI / 6)\n      );\n      xArrowPath.lineTo(\n        xAxisEnd.x - xArrowLength * Math.cos(xAxisAngle + Math.PI / 6),\n        xAxisEnd.y - xArrowLength * Math.sin(xAxisAngle + Math.PI / 6)\n      );\n      xArrowPath.closePath();\n      g.select(\".x-axis.axis-arrow\").attr(\"d\", xArrowPath.toString());\n      \n      // æ›´æ–°Yè½´\n      yAxisEnd = isometricProjection(-axisOffset, totalDepth + axisOffset, 0);\n      g.select(\".y-axis.axis-line\")\n        .attr(\"x1\", origin.x)\n        .attr(\"y1\", origin.y)\n        .attr(\"x2\", yAxisEnd.x)\n        .attr(\"y2\", yAxisEnd.y);\n      \n      const yAxisAngle = Math.atan2(yAxisEnd.y - origin.y, yAxisEnd.x - origin.x);\n      const yArrowLength = 8;\n      const yArrowPath = d3.path();\n      yArrowPath.moveTo(yAxisEnd.x, yAxisEnd.y);\n      yArrowPath.lineTo(\n        yAxisEnd.x - yArrowLength * Math.cos(yAxisAngle - Math.PI / 6),\n        yAxisEnd.y - yArrowLength * Math.sin(yAxisAngle - Math.PI / 6)\n      );\n      yArrowPath.lineTo(\n        yAxisEnd.x - yArrowLength * Math.cos(yAxisAngle + Math.PI / 6),\n        yAxisEnd.y - yArrowLength * Math.sin(yAxisAngle + Math.PI / 6)\n      );\n      yArrowPath.closePath();\n      g.select(\".y-axis.axis-arrow\").attr(\"d\", yArrowPath.toString());\n      \n      // æ›´æ–°Zè½´\n      zAxisEnd = isometricProjection(-axisOffset, -axisOffset, maxHeight + axisOffset);\n      g.select(\".z-axis.axis-line\")\n        .attr(\"x1\", origin.x)\n        .attr(\"y1\", origin.y)\n        .attr(\"x2\", zAxisEnd.x)\n        .attr(\"y2\", zAxisEnd.y);\n      \n      const zAxisAngle = Math.atan2(zAxisEnd.y - origin.y, zAxisEnd.x - origin.x);\n      const zArrowLength = 8;\n      const zArrowPath = d3.path();\n      zArrowPath.moveTo(zAxisEnd.x, zAxisEnd.y);\n      zArrowPath.lineTo(\n        zAxisEnd.x - zArrowLength * Math.cos(zAxisAngle - Math.PI / 6),\n        zAxisEnd.y - zArrowLength * Math.sin(zAxisAngle - Math.PI / 6)\n      );\n      zArrowPath.lineTo(\n        zAxisEnd.x - zArrowLength * Math.cos(zAxisAngle + Math.PI / 6),\n        zAxisEnd.y - zArrowLength * Math.sin(zAxisAngle + Math.PI / 6)\n      );\n      zArrowPath.closePath();\n      g.select(\".z-axis.axis-arrow\").attr(\"d\", zArrowPath.toString());\n      \n      // æ›´æ–°Xè½´æ ‡ç­¾\n      allGenres.forEach((genre, idx) => {\n        const x = idx * cellWidth + cellWidth / 2;\n        const y = -labelOffset;\n        const projected = isometricProjection(x, y, 0);\n        g.select(`.x-label-${idx}`)\n          .attr(\"x\", projected.x)\n          .attr(\"y\", projected.y);\n      });\n      \n      // æ›´æ–°Yè½´æ ‡ç­¾\n      months.forEach((month, idx) => {\n        if (idx % 3 === 0) {\n          const x = 0;\n          const y = idx * cellDepth + cellDepth / 2;\n          const projected = isometricProjection(x - labelOffset, y, 0);\n          g.select(`.y-label-${idx}`)\n            .attr(\"x\", projected.x)\n            .attr(\"y\", projected.y);\n        }\n      });\n      \n      // æ›´æ–°Zè½´æ ‡ç­¾\n      zLabelPos = isometricProjection(-10, 0, maxHeight + 25);\n      g.select(\".z-label\")\n        .attr(\"x\", zLabelPos.x)\n        .attr(\"y\", zLabelPos.y);\n    }\n\n    // ========== é¼ æ ‡æ‹–åŠ¨æ—‹è½¬äº‹ä»¶ ==========\n    svg.on(\"mousedown\", function(event) {\n      isDragging = true;\n      lastMouseX = event.clientX;\n      svg.style(\"cursor\", \"grabbing\");\n      event.preventDefault();\n    });\n\n    svg.on(\"mousemove\", function(event) {\n      if (isDragging) {\n        const deltaX = event.clientX - lastMouseX;\n        rotationAngle += deltaX * 0.01; // æ—‹è½¬é€Ÿåº¦\n        \n        // æ›´æ–°æŠ•å½±\n        updateProjection();\n        \n        lastMouseX = event.clientX;\n        event.preventDefault();\n      }\n    });\n\n    svg.on(\"mouseup\", function() {\n      isDragging = false;\n      svg.style(\"cursor\", \"grab\");\n    });\n\n    svg.on(\"mouseleave\", function() {\n      isDragging = false;\n      svg.style(\"cursor\", \"grab\");\n    });\n\n    // ç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼ŒSVGçš„viewBoxä¼šè‡ªåŠ¨å¤„ç†ç¼©æ”¾\n    // ä¸éœ€è¦æ‰‹åŠ¨æ›´æ–°ï¼Œå› ä¸ºviewBoxåŸºäºå†…å®¹å°ºå¯¸ï¼ŒpreserveAspectRatioä¼šè‡ªåŠ¨é€‚åº”å®¹å™¨\n    let resizeTimer;\n    const handleResize = () => {\n      clearTimeout(resizeTimer);\n      resizeTimer = setTimeout(() => {\n        // viewBox åŸºäºå†…å®¹å°ºå¯¸ï¼Œä¸éœ€è¦æ›´æ–°\n        // preserveAspectRatio ä¼šè‡ªåŠ¨å¤„ç†ç¼©æ”¾\n        console.log('ğŸ“ å®¹å™¨å°ºå¯¸å˜åŒ–ï¼ŒSVGè‡ªåŠ¨é€‚åº”');\n      }, 150);\n    };\n\n    window.addEventListener('resize', handleResize);\n  }\n\n  // ç›´æ¥åŠ è½½æ•°æ®\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', loadData);\n  } else {\n    loadData();\n  }\n})();\nconsole.log('âœ… D3ä¼ª3Dçƒ­åŠ›å›¾è„šæœ¬åŠ è½½å®Œæˆ');\n"]}