{"version":3,"sources":["assets/歌单_2314343014_genre分布统计_归类后.json","heatmap.js"],"names":["module","exports","console","log","container","document","getElementById","error","innerHTML","cssVar","name","fallback","v","getComputedStyle","documentElement","getPropertyValue","trim","getCyberStops","ensureHeatmapOverlay","stage","closest","parentElement","style","position","styleId","createElement","id","textContent","head","appendChild","anno","querySelector","className","open","addEventListener","e","stopPropagation","borderRadius","overflow","background","border","boxShadow","genreData","surfaceData","lineGenreData","require","warn","message","months","allGenres","CSV_DATA_2D","buildFrom2DCsv","rows","d3","csvParse","map","m","row","find","r","month","dist","_i","_allGenres","length","g","genre_distribution","chunk","d","loadData","processData","init3DHeatmap","rotationAngle","Math","PI","isometricProjection","x","y","z","angle","scale","cosR","cos","sinR","sin","rotatedX","rotatedY","isoX","isoY","Array","fill","getContainerSize","actualWidth","clientWidth","offsetWidth","actualHeight","clientHeight","offsetHeight","width","height","containerSize","containerWidth","containerHeight","minValue","Infinity","maxValue","i","j","min","max","valueRange","cyberStops","cyberInterpolator","interpolateRgbBasis","colorScale","scaleSequential","domain","interpolator","getColor","value","updateLegend","legend","fmt","format","concat","join","tooltip","select","empty","append","attr","placeTooltip","evt","offsetX","arguments","undefined","offsetY","sourceEvent","cx","clientX","pageX","cy","clientY","pageY","node","w","h","pad","maxX","window","innerWidth","maxY","innerHeight","svg","defs","glow","merge","lineGlow","lineMerge","isDragging","lastMouseX","cellWidth","cellDepth","maxHeight","numGenres","numMonths","totalWidth","totalDepth","corners","minX","minY","projectedWidth","projectedHeight","padding","viewBoxMinX","viewBoxMinY","viewBoxWidth","viewBoxHeight","interactiveElements","cellDataArray","lineDataArray","drawFace","svgGroup","points","fillColor","strokeColor","opacity","path","moveTo","lineTo","closePath","toString","darkenColor","rgb","factor","match","round","parseInt","b","cellThickness","genreIdx","monthIdx","baseColor","darkColor","darkerColor","zBottom","zTop","bottom1","bottom2","bottom3","bottom4","top1","top2","top3","top4","cellGroup","datum","genre","push","topFace","lineSource","isArray","forEach","element","on","event","parentGroup","parentNode","selectAll","trackCount","genreKey","html","toFixed","includes","brightness","minLineHeight","maxLineHeight","_i4","_allGenres2","val","lineHeightRange","maxLineZ","lineGenerator","line","curve","curveMonotoneX","projected","areaGenerator","area","y0","y1","_loop","_monthIdx","monthY","lineData","normalizedValue","isNaN","genreX","avgValue","reduce","sum","lineColor","areaFillColor","areaPath","areaElement","_d3$pointer3","pointer","_d3$pointer4","_slicedToArray","mouseX","mouseY","minDistance","nearestPoint","nearestGenreIdx","point","idx","distance","sqrt","pow","linePath","lineElement","hitLine","onLineMove","_d3$pointer5","_d3$pointer6","maxZ","maxPoint","maxProjected","axisOffset","drawAxisWithArrow","start","end","color","axisClass","dx","dy","atan2","arrowLength","arrowPath","origin","AXIS_LINE","AXIS_TEXT","AXIS_STROKE","xAxisEnd","yAxisEnd","zAxisEnd","labelOffset","text","zLabelPos","updateProjection","cellData","paths","faces","each","_ref","sortedLineData","_toConsumableArray","sort","a","projA","projB","lineGeneratorUpdate","newPath","areaGeneratorUpdate","xAxisAngle","xArrowLength","xArrowPath","yAxisAngle","yArrowLength","yArrowPath","zAxisAngle","zArrowLength","zArrowPath","preventDefault","deltaX","t","target","_d3$pointer","_d3$pointer2","best","mi","series","gi","p","resizeTimer","handleResize","clearTimeout","setTimeout","waitForContainer","display","readyState"],"mappings":"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","file":"heatmap.ff7f9d1a.js","sourceRoot":"..\\src","sourcesContent":["module.exports = [\r\n  {\r\n    \"chunk\": 1,\r\n    \"start_index\": 1,\r\n    \"end_index\": 34,\r\n    \"song_count\": 34,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 1,\r\n    \"genre_distribution\": {\r\n      \"rap\": 65,\r\n      \"pop\": 7,\r\n      \"ACG\": 4\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 2,\r\n    \"start_index\": 35,\r\n    \"end_index\": 68,\r\n    \"song_count\": 34,\r\n    \"songs_with_genre\": 34,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"rap\": 66,\r\n      \"pop\": 9,\r\n      \"ACG\": 4,\r\n      \"folk\": 2\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 3,\r\n    \"start_index\": 69,\r\n    \"end_index\": 101,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"rap\": 53,\r\n      \"pop\": 10,\r\n      \"ACG\": 10,\r\n      \"folk\": 2\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 4,\r\n    \"start_index\": 102,\r\n    \"end_index\": 134,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"rap\": 55,\r\n      \"pop\": 26,\r\n      \"ACG\": 8,\r\n      \"folk\": 1,\r\n      \"electronic\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 5,\r\n    \"start_index\": 135,\r\n    \"end_index\": 167,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 32,\r\n    \"songs_without_genre\": 1,\r\n    \"genre_distribution\": {\r\n      \"pop\": 52,\r\n      \"rap\": 7,\r\n      \"electronic\": 6,\r\n      \"ACG\": 4,\r\n      \"rock\": 2,\r\n      \"jazz\": 2,\r\n      \"classical\": 2,\r\n      \"folk\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 6,\r\n    \"start_index\": 168,\r\n    \"end_index\": 200,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 47,\r\n      \"electronic\": 7,\r\n      \"rap\": 6,\r\n      \"ACG\": 4,\r\n      \"classical\": 2,\r\n      \"rock\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 7,\r\n    \"start_index\": 201,\r\n    \"end_index\": 233,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 46,\r\n      \"rap\": 12,\r\n      \"ACG\": 8,\r\n      \"rock\": 3,\r\n      \"electronic\": 2,\r\n      \"jazz\": 2,\r\n      \"classical\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 8,\r\n    \"start_index\": 234,\r\n    \"end_index\": 266,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 42,\r\n      \"electronic\": 11,\r\n      \"rap\": 9,\r\n      \"ACG\": 3,\r\n      \"jazz\": 1,\r\n      \"folk\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 9,\r\n    \"start_index\": 267,\r\n    \"end_index\": 299,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 45,\r\n      \"ACG\": 10,\r\n      \"folk\": 6,\r\n      \"rap\": 3,\r\n      \"rock\": 2,\r\n      \"electronic\": 1,\r\n      \"jazz\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 10,\r\n    \"start_index\": 300,\r\n    \"end_index\": 332,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 51,\r\n      \"ACG\": 8,\r\n      \"electronic\": 5,\r\n      \"rap\": 3,\r\n      \"rock\": 2,\r\n      \"classical\": 2\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 11,\r\n    \"start_index\": 333,\r\n    \"end_index\": 365,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 44,\r\n      \"electronic\": 15,\r\n      \"rap\": 12,\r\n      \"ACG\": 6,\r\n      \"rock\": 2\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 12,\r\n    \"start_index\": 366,\r\n    \"end_index\": 398,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 50,\r\n      \"electronic\": 9,\r\n      \"ACG\": 8,\r\n      \"rock\": 8,\r\n      \"rap\": 3\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 13,\r\n    \"start_index\": 399,\r\n    \"end_index\": 431,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 41,\r\n      \"ACG\": 15,\r\n      \"rap\": 8,\r\n      \"electronic\": 6,\r\n      \"rock\": 4,\r\n      \"classical\": 3\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 14,\r\n    \"start_index\": 432,\r\n    \"end_index\": 464,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 40,\r\n      \"ACG\": 10,\r\n      \"rock\": 10,\r\n      \"electronic\": 7,\r\n      \"rap\": 6\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 15,\r\n    \"start_index\": 465,\r\n    \"end_index\": 497,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 32,\r\n    \"songs_without_genre\": 1,\r\n    \"genre_distribution\": {\r\n      \"pop\": 36,\r\n      \"rock\": 14,\r\n      \"ACG\": 11,\r\n      \"electronic\": 10,\r\n      \"rap\": 2,\r\n      \"folk\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 16,\r\n    \"start_index\": 498,\r\n    \"end_index\": 530,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 32,\r\n    \"songs_without_genre\": 1,\r\n    \"genre_distribution\": {\r\n      \"pop\": 43,\r\n      \"ACG\": 10,\r\n      \"electronic\": 9,\r\n      \"rock\": 5,\r\n      \"rap\": 4,\r\n      \"jazz\": 1,\r\n      \"folk\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 17,\r\n    \"start_index\": 531,\r\n    \"end_index\": 563,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 37,\r\n      \"electronic\": 20,\r\n      \"ACG\": 8,\r\n      \"rock\": 7,\r\n      \"rap\": 5,\r\n      \"folk\": 5,\r\n      \"jazz\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 18,\r\n    \"start_index\": 564,\r\n    \"end_index\": 596,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 32,\r\n    \"songs_without_genre\": 1,\r\n    \"genre_distribution\": {\r\n      \"pop\": 36,\r\n      \"electronic\": 13,\r\n      \"ACG\": 11,\r\n      \"folk\": 6,\r\n      \"rock\": 4\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 19,\r\n    \"start_index\": 597,\r\n    \"end_index\": 629,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 44,\r\n      \"ACG\": 17,\r\n      \"electronic\": 8,\r\n      \"rap\": 6,\r\n      \"rock\": 5,\r\n      \"folk\": 2,\r\n      \"classical\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 20,\r\n    \"start_index\": 630,\r\n    \"end_index\": 662,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 47,\r\n      \"rock\": 12,\r\n      \"rap\": 6,\r\n      \"electronic\": 5,\r\n      \"ACG\": 2,\r\n      \"folk\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 21,\r\n    \"start_index\": 663,\r\n    \"end_index\": 695,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 35,\r\n      \"electronic\": 18,\r\n      \"rock\": 8,\r\n      \"ACG\": 8,\r\n      \"rap\": 3\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 22,\r\n    \"start_index\": 696,\r\n    \"end_index\": 728,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 50,\r\n      \"electronic\": 14,\r\n      \"rap\": 3,\r\n      \"ACG\": 2,\r\n      \"folk\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 23,\r\n    \"start_index\": 729,\r\n    \"end_index\": 761,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"electronic\": 40,\r\n      \"pop\": 22,\r\n      \"rap\": 8,\r\n      \"ACG\": 4,\r\n      \"rock\": 2\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 24,\r\n    \"start_index\": 762,\r\n    \"end_index\": 794,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 32,\r\n    \"songs_without_genre\": 1,\r\n    \"genre_distribution\": {\r\n      \"pop\": 47,\r\n      \"rock\": 13,\r\n      \"electronic\": 10,\r\n      \"rap\": 4,\r\n      \"folk\": 2,\r\n      \"ACG\": 2\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 25,\r\n    \"start_index\": 795,\r\n    \"end_index\": 827,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 56,\r\n      \"electronic\": 6,\r\n      \"rap\": 5,\r\n      \"rock\": 4,\r\n      \"jazz\": 1\r\n    }\r\n  }\r\n];","// ============================================\n// heatmap.js - D3伪3D热力图（等轴测投影）\n// ============================================\n// X轴：风格（genres），Y轴：时间（months），Z轴：乐曲数量\nconsole.log('🎨 D3伪3D热力图脚本开始加载...');\n(() => {\n  // 优先使用 heatmap-3d 容器\n  const container = document.getElementById(\"heatmap-3d\") || document.getElementById(\"heatmap\");\n  if (!container) {\n    console.error('❌ 找不到heatmap容器');\n    return;\n  }\n  \n  container.innerHTML = '';\n  // ⚠️ 不要在这里全局 remove tooltip：2D/3D 会互相删掉导致“tooltip 消失”\n\n  //#region Heatmap 3D｜主题/装饰层（只保留原图注释，不额外加 3D/2D 徽标）\n  function cssVar(name, fallback) {\n    const v = getComputedStyle(document.documentElement).getPropertyValue(name);\n    return (v || \"\").trim() || fallback;\n  }\n\n  /**\n   * ✅ 赛博霓虹渐变（按截图：深紫 → 紫 → 青 → 粉 → 近白高光）\n   * - 低值不落到纯黑\n   * - 高值略带近白“高光”，更像你截图里的发光质感\n   */\n  function getCyberStops() {\n    // ✅ 修正颜色：严格对齐截图的【单色系】紫白渐变\n    // 截图特征：低值是深紫，中值是正紫，高值是发光的亮紫/白\n    // 绝无粉色、青色杂质\n    return [\n      // ✅ 原图 legend：由浅入深（左浅→右深）\n      // 因此：min → 浅色，max → 深色\n      \"#ffffff\", // 1. 纯白（浅）\n      \"#e9d5ff\", // 2. 极亮紫\n      \"#a855f7\", // 3. 亮紫\n      \"#6b21a8\", // 4. 中紫\n      \"#2e1065\"  // 5. 深邃紫（深）\n    ];\n  }\n\n  function ensureHeatmapOverlay() {\n    const stage = container && (container.closest(\".heatmap-stage\") || container.parentElement);\n    if (!stage) return;\n    stage.style.position = stage.style.position || \"relative\";\n\n    // 主页面样式由 2D 脚本也会注入；这里兜底（避免只跑 3D 时缺样式）\n    const styleId = \"heatmap-overlay-style\";\n    if (!document.getElementById(styleId)) {\n      const style = document.createElement(\"style\");\n      style.id = styleId;\n      style.textContent = `\n        /* ✅ 左上角注释：样式微调，对齐截图 */\n        .hm-anno{\n          position:absolute; left:12px; top:12px;\n          width: min(340px, 50%);\n          border-radius: 12px;\n          background: rgba(10, 5, 20, 0.85); /* 更黑的背景 */\n          border: 1px solid rgba(124, 58, 237, 0.3); /* 紫色边框微光 */\n          box-shadow: 0 4px 16px rgba(0,0,0,0.4);\n          color: rgba(226,232,240,0.9);\n          backdrop-filter: blur(8px);\n          z-index: 6;\n          overflow:hidden;\n        }\n        .hm-anno > summary{\n          list-style:none;\n          cursor:pointer;\n          padding: 10px 12px;\n          font: 13px/1.1 system-ui,-apple-system,\"Segoe UI\",\"Microsoft YaHei\",sans-serif;\n          font-weight: 700; /* 加粗标题 */\n          letter-spacing: .5px;\n          user-select:none;\n          color: #fff;\n        }\n        .hm-anno > summary::-webkit-details-marker{ display:none; }\n        .hm-anno .hm-anno-body{\n          padding: 0 12px 12px 12px;\n          font: 12px/1.6 system-ui,-apple-system,\"Segoe UI\",\"Microsoft YaHei\",sans-serif;\n          color: rgba(226,232,240,0.85);\n        }\n        .hm-anno .hm-anno-body div {\n          margin-bottom: 2px;\n        }\n      `;\n      document.head.appendChild(style);\n    }\n\n    // ✅ 注释文案：严格对齐原图（不要额外加说明）\n    let anno = stage.querySelector(\".hm-anno\");\n    if (!anno) {\n      anno = document.createElement(\"details\");\n      anno.className = \"hm-anno\";\n      anno.open = true;\n      // 截图文案\n      anno.innerHTML = `\n        <summary>注释（点击隐藏）</summary>\n        <div class=\"hm-anno-body\">\n          <div>热力图：世界范围音乐热度变化</div>\n          <div>折线图：国内网友听音乐的曲目数量变化</div>\n        </div>\n      `;\n      stage.appendChild(anno);\n    }\n    // ✅ 关键：阻止点击注释框时冒泡到 `.chart-content`\n    try {\n      anno.addEventListener(\"click\", (e) => e.stopPropagation());\n      anno.addEventListener(\"pointerdown\", (e) => e.stopPropagation());\n    } catch (e) {}\n\n    // 容器“玻璃卡片”质感\n    try {\n      container.style.borderRadius = \"14px\";\n      container.style.overflow = \"hidden\";\n      container.style.background = \"rgba(7, 3, 18, 0.18)\";\n      container.style.border = \"1px solid rgba(50, 167, 255, 0.16)\";\n      container.style.boxShadow = \"inset 0 0 0 1px rgba(255,255,255,0.03), 0 0 18px rgba(255,59,212,0.10), 0 0 24px rgba(50,167,255,0.08)\";\n    } catch (e) {}\n  }\n\n  //#endregion\n\n  let genreData = null;\n  let surfaceData = null;\n  // ✅ 3D 折线/曲目数量：使用该 JSON 的 genre_distribution（你说“之前是对的”的那套映射）\n  let lineGenreData = null;\n  try {\n    lineGenreData = require('./assets/歌单_2314343014_genre分布统计_归类后.json');\n    console.log('✅ 3D折线：通过 require 成功导入 genre_distribution JSON');\n  } catch (e) {\n    console.warn('⚠️ 3D折线：require 导入 JSON 失败，将回退到 2D CSV 数据：', e && e.message ? e.message : e);\n    lineGenreData = null;\n  }\n\n  const months = [\n    '2023-12', '2024-01', '2024-02', '2024-03', '2024-04', '2024-05', '2024-06',\n    '2024-07', '2024-08', '2024-09', '2024-10', '2024-11', '2024-12',\n    '2025-01', '2025-02', '2025-03', '2025-04', '2025-05', '2025-06',\n    '2025-07', '2025-08', '2025-09', '2025-10', '2025-11', '2025-12'\n  ];\n\n  const allGenres = [\"ACG\", \"classical\", \"electronic\", \"folk\", \"jazz\", \"pop\", \"rap\", \"rock\"];\n\n  // ✅ 与 2D 热力图保持一致的数据源（避免 3D 使用 JSON 失败后随机数导致“XOY 平面数据不一致”）\n  const CSV_DATA_2D = `month,classical,electronic,folk,jazz,pop,rock,ACG,rap\n2023-12,35,34,64,47,24,32,37,37\n2024-01,35,33,58,46,23,31,32,36\n2024-02,34,32,62,48,26,33,34,39\n2024-03,35,34,59,48,23,34,37,38\n2024-04,31,34,55,47,21,34,31,36\n2024-05,32,48,57,46,24,34,32,38\n2024-06,32,49,62,48,23,36,31,40\n2024-07,31,38,64,49,25,32,31,38\n2024-08,30,39,62,46,23,32,32,37\n2024-09,32,35,60,45,23,36,33,45\n2024-10,31,32,60,49,23,33,31,46\n2024-11,35,33,58,45,22,32,32,39\n2024-12,35,35,63,48,23,33,37,39\n2025-01,32,34,54,47,22,32,32,38\n2025-02,33,33,58,48,22,31,29,42\n2025-03,33,32,56,48,22,31,31,36\n2025-04,31,33,59,45,22,31,30,36\n2025-05,30,37,58,46,23,32,30,39\n2025-06,29,33,57,46,21,32,31,36\n2025-07,29,36,60,48,21,39,31,38\n2025-08,31,35,59,46,22,34,31,34\n2025-09,30,32,61,46,22,33,30,32\n2025-10,33,33,59,44,21,34,31,36\n2025-11,31,32,57,46,21,33,30,33\n2025-12,33,32,60,45,23,32,33,39`;\n\n  function buildFrom2DCsv() {\n    const rows = d3.csvParse(CSV_DATA_2D.trim());\n    // 统一成 heatmap.js 原来的 genreData 结构：[{month, genre_distribution:{...}}]\n    genreData = months.map((m) => {\n      const row = rows.find(r => r.month === m);\n      const dist = {};\n      for (const g of allGenres) dist[g] = row ? (+row[g] || 0) : 0;\n      return { month: m, genre_distribution: dist };\n    });\n\n    // 同时生成 surfaceData（monthIdx x genreIdx）\n    surfaceData = months.map((m) => {\n      const chunk = genreData.find(d => d.month === m);\n      return allGenres.map(g => (chunk && chunk.genre_distribution ? (chunk.genre_distribution[g] || 0) : 0));\n    });\n  }\n\n  function loadData() {\n    // 直接使用与 2D 一致的 CSV 数据，保证 XOY 平面一致\n    console.log('✅ 3D热力图使用与2D一致的CSV数据源');\n    buildFrom2DCsv();\n    processData();\n    init3DHeatmap();\n  }\n\n  function processData() {\n    // surfaceData 已在 buildFrom2DCsv 中生成；这里兜底确保结构正确\n    if (!surfaceData || surfaceData.length !== months.length) {\n      buildFrom2DCsv();\n    }\n    \n    console.log('✅ 数据处理完成');\n  }\n\n  // 旋转角度（全局变量，支持鼠标拖动旋转）\n  let rotationAngle = Math.PI / 6; // 默认30度\n\n  // 等轴测投影函数（支持旋转）\n  function isometricProjection(x, y, z) {\n    // 等轴测投影：x轴向右，y轴向前（深度），z轴向上\n    // 支持水平旋转（绕Z轴）\n    const angle = Math.PI / 6; // 基础等轴测角度30度\n    const scale = 1.2; // 稍微放大一点，让3D效果更明显\n    \n    // 应用水平旋转\n    const cosR = Math.cos(rotationAngle);\n    const sinR = Math.sin(rotationAngle);\n    const rotatedX = x * cosR - y * sinR;\n    const rotatedY = x * sinR + y * cosR;\n    \n    // 等轴测投影\n    const isoX = (rotatedX - rotatedY) * Math.cos(angle) * scale;\n    const isoY = (rotatedX + rotatedY) * Math.sin(angle) * scale - z * scale;\n    return { x: isoX, y: isoY };\n  }\n\n  function init3DHeatmap() {\n    if (!surfaceData || surfaceData.length === 0) {\n      console.warn('surfaceData为空，创建默认数据');\n      surfaceData = Array(25).fill(null).map(() => Array(allGenres.length).fill(10));\n    }\n\n    // ✅ 装饰层：模式徽标 + 可折叠注释 + 容器质感\n    ensureHeatmapOverlay();\n\n    // 获取容器尺寸的函数 - 使用实际容器尺寸\n    const getContainerSize = () => {\n      // 获取实际容器尺寸，如果为0则使用默认值\n      const actualWidth = container.clientWidth || container.offsetWidth || 1600;\n      const actualHeight = container.clientHeight || container.offsetHeight || 800;\n      return {\n        width: actualWidth > 0 ? actualWidth : 1600,\n        height: actualHeight > 0 ? actualHeight : 800\n      };\n    };\n\n    let containerSize = getContainerSize();\n    // 使用实际容器尺寸，不强制最小值\n    let containerWidth = containerSize.width;\n    let containerHeight = containerSize.height;\n\n    // 计算数据范围\n    let minValue = Infinity;\n    let maxValue = 0;\n    for (let i = 0; i < surfaceData.length; i++) {\n      for (let j = 0; j < surfaceData[i].length; j++) {\n        minValue = Math.min(minValue, surfaceData[i][j]);\n        maxValue = Math.max(maxValue, surfaceData[i][j]);\n      }\n    }\n    if (maxValue === 0) maxValue = 1;\n    const valueRange = maxValue - minValue || 1;\n\n    // ✅ 赛博霓虹渐变（与 2D 使用同一套主题色），保证 2D/3D 颜色映射一致\n    function cssVar(name, fallback) {\n      const v = getComputedStyle(document.documentElement).getPropertyValue(name);\n      return (v || \"\").trim() || fallback;\n    }\n    // ✅ 赛博霓虹渐变：对齐 2D 与截图风格\n    const cyberStops = getCyberStops();\n    const cyberInterpolator = d3.interpolateRgbBasis(cyberStops);\n\n    const colorScale = d3.scaleSequential()\n      .domain([minValue, maxValue])\n      .interpolator(cyberInterpolator);\n\n    function getColor(value) {\n      return colorScale(value || 0);\n    }\n\n    // === 颜色映射图例（2D/3D 共用容器）===\n    (function updateLegend() {\n      const legend = document.getElementById(\"heatmap-color-legend\");\n      if (!legend) return;\n      const fmt = d3.format(\",d\");\n      legend.innerHTML = `\n        <div class=\"legend-title\">Score → Color</div>\n        <div class=\"legend-bar\" style=\"background: linear-gradient(90deg, ${cyberStops.join(\",\")});\"></div>\n        <div class=\"legend-labels\">\n          <span>${fmt(minValue ?? 0)}</span>\n          <span>${fmt(maxValue ?? 0)}</span>\n        </div>\n      `;\n    })();\n\n    // === Tooltip（2D/3D 复用同一个）===\n    let tooltip = d3.select(\"body\").select(\".heatmap-tooltip\");\n    if (tooltip.empty()) {\n      tooltip = d3.select(\"body\").append(\"div\").attr(\"class\", \"heatmap-tooltip\");\n    }\n    tooltip\n      // ⚠️ 统一用 fixed + clientX/clientY，避免页面缩放/滚动导致 tooltip “跑到屏幕外”\n      .style(\"position\", \"fixed\")\n      .style(\"pointer-events\", \"none\")\n      .style(\"opacity\", 0)\n      .style(\"padding\", \"10px 12px\")\n      .style(\"border-radius\", \"12px\")\n      .style(\"background\", \"rgba(30,41,59,0.92)\")\n      .style(\"color\", \"#fff\")\n      .style(\"font\", '13px/1.35 system-ui,-apple-system,\"Segoe UI\",\"Microsoft YaHei\",sans-serif')\n      .style(\"box-shadow\", \"0 10px 24px rgba(0,0,0,0.16)\")\n      .style(\"z-index\", 1000);\n\n    function placeTooltip(evt, offsetX = 12, offsetY = -18) {\n      const e = evt && evt.sourceEvent ? evt.sourceEvent : evt;\n      const cx = (e && typeof e.clientX === \"number\") ? e.clientX : (e && typeof e.pageX === \"number\" ? e.pageX : 0);\n      const cy = (e && typeof e.clientY === \"number\") ? e.clientY : (e && typeof e.pageY === \"number\" ? e.pageY : 0);\n\n      // 基于 tooltip 当前尺寸做边界夹紧\n      const node = tooltip.node();\n      const w = node ? (node.offsetWidth || 0) : 0;\n      const h = node ? (node.offsetHeight || 0) : 0;\n      const pad = 10;\n\n      let x = cx + offsetX;\n      let y = cy + offsetY;\n      const maxX = (window.innerWidth || 0) - w - pad;\n      const maxY = (window.innerHeight || 0) - h - pad;\n      x = Math.max(pad, Math.min(x, maxX));\n      y = Math.max(pad, Math.min(y, maxY));\n\n      tooltip.style(\"left\", `${x}px`).style(\"top\", `${y}px`);\n    }\n\n    // 创建SVG，先不设置viewBox，等计算完内容尺寸后再设置\n    const svg = d3.select(container)\n      .append(\"svg\")\n      .attr(\"width\", \"100%\")\n      .attr(\"height\", \"100%\")\n      .style(\"cursor\", \"grab\");\n\n    //#region Heatmap 3D｜SVG 滤镜（微弱霓虹光晕，贴近截图质感）\n    // 注意：滤镜对性能有一点影响，所以做“轻量版”（更像截图的柔光而非强发光）\n    const defs = svg.append(\"defs\");\n    const glow = defs.append(\"filter\")\n      .attr(\"id\", \"hm-glow\")\n      .attr(\"x\", \"-20%\")\n      .attr(\"y\", \"-20%\")\n      .attr(\"width\", \"140%\")\n      .attr(\"height\", \"140%\");\n\n    glow.append(\"feGaussianBlur\")\n      .attr(\"in\", \"SourceGraphic\")\n      .attr(\"stdDeviation\", \"1.6\")\n      .attr(\"result\", \"blur\");\n\n    const merge = glow.append(\"feMerge\");\n    merge.append(\"feMergeNode\").attr(\"in\", \"blur\");\n    merge.append(\"feMergeNode\").attr(\"in\", \"SourceGraphic\");\n\n    const lineGlow = defs.append(\"filter\")\n      .attr(\"id\", \"hm-line-glow\")\n      .attr(\"x\", \"-30%\")\n      .attr(\"y\", \"-30%\")\n      .attr(\"width\", \"160%\")\n      .attr(\"height\", \"160%\");\n\n    lineGlow.append(\"feGaussianBlur\")\n      .attr(\"in\", \"SourceGraphic\")\n      .attr(\"stdDeviation\", \"2.2\")\n      .attr(\"result\", \"lineBlur\");\n\n    const lineMerge = lineGlow.append(\"feMerge\");\n    lineMerge.append(\"feMergeNode\").attr(\"in\", \"lineBlur\");\n    lineMerge.append(\"feMergeNode\").attr(\"in\", \"SourceGraphic\");\n    //#endregion\n    \n    // 鼠标拖动旋转相关变量\n    let isDragging = false;\n    let lastMouseX = 0;\n\n    // 3D空间参数（放大）\n    const cellWidth = 50;  // 每个单元格的宽度（X轴：genre方向）\n    const cellDepth = 25;  // 每个单元格的深度（Y轴：month方向）\n    const maxHeight = 120;  // 最大高度（Z轴）\n    const numGenres = allGenres.length;\n    const numMonths = months.length;\n\n    // 计算3D空间的边界\n    const totalWidth = numGenres * cellWidth;\n    const totalDepth = numMonths * cellDepth;\n\n    // 计算投影后的边界，用于居中\n    const corners = [\n      isometricProjection(0, 0, 0),\n      isometricProjection(totalWidth, 0, 0),\n      isometricProjection(0, totalDepth, 0),\n      isometricProjection(totalWidth, totalDepth, 0),\n      isometricProjection(0, 0, maxHeight),\n      isometricProjection(totalWidth, 0, maxHeight)\n    ];\n\n    const minX = d3.min(corners, d => d.x);\n    const maxX = d3.max(corners, d => d.x);\n    const minY = d3.min(corners, d => d.y);\n    const maxY = d3.max(corners, d => d.y);\n\n    const projectedWidth = maxX - minX;\n    const projectedHeight = maxY - minY;\n\n    // 添加边距，确保内容不会被裁剪\n    const padding = 50;\n    const viewBoxMinX = minX - padding;\n    const viewBoxMinY = minY - padding;\n    const viewBoxWidth = projectedWidth + padding * 2;\n    const viewBoxHeight = projectedHeight + padding * 2;\n    \n    // 使用内容尺寸作为 viewBox，让 SVG 自动缩放适应容器\n    // preserveAspectRatio=\"xMidYMid meet\" 会自动居中内容\n    svg.attr(\"viewBox\", `${viewBoxMinX} ${viewBoxMinY} ${viewBoxWidth} ${viewBoxHeight}`)\n       .attr(\"preserveAspectRatio\", \"xMidYMid meet\");\n\n    // 不需要 transform，内容使用原始坐标\n    // viewBox 已经包含了所有内容，preserveAspectRatio 会自动居中\n    const g = svg.append(\"g\");\n\n    // 存储所有交互元素\n    const interactiveElements = [];\n    \n    // 存储所有单元格数据，用于旋转时重新渲染\n    const cellDataArray = [];\n    // 存储所有折线数据\n    const lineDataArray = [];\n\n    // 辅助函数：绘制立方体的一个面\n    function drawFace(svgGroup, points, fillColor, strokeColor, opacity = 1) {\n      const path = d3.path();\n      path.moveTo(points[0].x, points[0].y);\n      for (let i = 1; i < points.length; i++) {\n        path.lineTo(points[i].x, points[i].y);\n      }\n      path.closePath();\n      \n      return svgGroup.append(\"path\")\n        .attr(\"d\", path.toString())\n        .attr(\"fill\", fillColor)\n        .attr(\"stroke\", strokeColor)\n        .attr(\"stroke-width\", 0.5)\n        .attr(\"opacity\", opacity);\n    }\n\n    // 辅助函数：使颜色变暗（用于侧面）\n    function darkenColor(rgb, factor) {\n      const match = rgb.match(/\\d+/g);\n      if (!match) return rgb;\n      const r = Math.max(0, Math.round(parseInt(match[0]) * factor));\n      const g = Math.max(0, Math.round(parseInt(match[1]) * factor));\n      const b = Math.max(0, Math.round(parseInt(match[2]) * factor));\n      return `rgb(${r}, ${g}, ${b})`;\n    }\n\n    // ========== 第一步：绘制3D热力图（带厚度的立方体） ==========\n    const cellThickness = 6; // 每个单元格的厚度（Z轴高度），参考图看起来约6像素\n    \n    for (let genreIdx = 0; genreIdx < numGenres; genreIdx++) {\n      for (let monthIdx = 0; monthIdx < numMonths; monthIdx++) {\n        const value = surfaceData[monthIdx][genreIdx];\n        const baseColor = getColor(value);\n        const darkColor = darkenColor(baseColor, 0.85); // 侧面颜色（稍微暗一点，不要太深）\n        const darkerColor = darkenColor(baseColor, 0.75); // 背面颜色（稍微更暗一点）\n\n        // 3D坐标（X=genre, Y=month, Z=0为底部，Z=thickness为顶部）\n        const x = genreIdx * cellWidth;\n        const y = monthIdx * cellDepth;\n        const zBottom = 0;\n        const zTop = cellThickness;\n\n        // 计算立方体的8个顶点\n        // 底部四个角\n        const bottom1 = isometricProjection(x, y, zBottom);\n        const bottom2 = isometricProjection(x + cellWidth, y, zBottom);\n        const bottom3 = isometricProjection(x + cellWidth, y + cellDepth, zBottom);\n        const bottom4 = isometricProjection(x, y + cellDepth, zBottom);\n        \n        // 顶部四个角\n        const top1 = isometricProjection(x, y, zTop);\n        const top2 = isometricProjection(x + cellWidth, y, zTop);\n        const top3 = isometricProjection(x + cellWidth, y + cellDepth, zTop);\n        const top4 = isometricProjection(x, y + cellDepth, zTop);\n\n        // 创建单元格组\n        const cellGroup = g.append(\"g\")\n          .attr(\"class\", `cell-group cell-${monthIdx}-${genreIdx}`)\n          .datum({\n            month: months[monthIdx],\n            genre: allGenres[genreIdx],\n            value: value,\n            monthIdx: monthIdx,\n            genreIdx: genreIdx,\n            x: x,\n            y: y,\n            z: zBottom\n          })\n          .style(\"cursor\", \"pointer\");\n        \n        // 存储单元格数据\n        cellDataArray.push({\n          monthIdx,\n          genreIdx,\n          x,\n          y,\n          zBottom,\n          zTop,\n          value,\n          baseColor,\n          darkColor,\n          darkerColor,\n          cellGroup\n        });\n\n        // 绘制立方体的各个面（从后往前，确保正确的遮挡）\n        // 1. 底面\n        drawFace(cellGroup, [bottom1, bottom2, bottom3, bottom4], baseColor, \"rgba(50,167,255,0.14)\", 0.90);\n        \n        // 2. 右侧面\n        drawFace(cellGroup, [bottom2, top2, top3, bottom3], darkColor, \"rgba(50,167,255,0.10)\", 0.92);\n        \n        // 3. 背面\n        drawFace(cellGroup, [bottom4, bottom3, top3, top4], darkerColor, \"rgba(50,167,255,0.10)\", 0.88);\n        \n        // 4. 顶面（最后绘制，确保在最上层）\n        const topFace = drawFace(cellGroup, [top1, top2, top3, top4], baseColor, \"rgba(255,255,255,0.22)\", 1);\n        topFace.attr(\"filter\", \"url(#hm-glow)\");\n        \n        // 将顶面添加到交互元素（用于tooltip）\n        interactiveElements.push(topFace);\n      }\n    }\n\n\n    // ========== 添加交互事件 ==========\n    // 折线/曲目数量的数据源：优先 JSON（lineGenreData），否则回退到 CSV（genreData）\n    const lineSource = (lineGenreData && Array.isArray(lineGenreData) && lineGenreData.length) ? lineGenreData : genreData;\n\n    interactiveElements.forEach(element => {\n      element\n        .on(\"mouseover\", function(event) {\n          // ⚠️ 关键修复：面(path)本身没绑定 datum，数据在父级 cellGroup 上\n          const parentGroup = d3.select(this.parentNode);\n          const d = parentGroup.datum();\n          if (!d) return;\n\n          // 高亮整个立方体组\n          parentGroup.selectAll(\"path\")\n            .attr(\"opacity\", 1)\n            .attr(\"stroke-width\", 1.5);\n\n          // 从 JSON/CSV 的 genre_distribution 获取曲目数量\n          let trackCount = 0;\n          if (lineSource && lineSource[d.monthIdx]) {\n            const chunk = lineSource[d.monthIdx];\n            const genreKey = allGenres[d.genreIdx];\n            if (chunk && chunk.genre_distribution && chunk.genre_distribution[genreKey] !== undefined) {\n              trackCount = chunk.genre_distribution[genreKey];\n            }\n          } else {\n            trackCount = Math.round(d.value);\n          }\n\n          // 直接设置（不走 transition，避免在切换/重绘时被打断导致“tooltip 不显示”）\n          tooltip.style(\"opacity\", 0.95);\n          tooltip.html(`<b>${d.genre}</b><br/>${d.month}<br/>分值: ${(+d.value).toFixed(2)}<br/>曲目数量: ${trackCount}`);\n          placeTooltip(event);\n        })\n        .on(\"mousemove\", function(event) {\n          // tooltip 跟随鼠标（不重新算内容，减少抖动）\n          placeTooltip(event);\n        })\n        .on(\"mouseout\", function() {\n          // 恢复整个立方体组的原始样式\n          const parentGroup = d3.select(this.parentNode);\n          parentGroup.selectAll(\"path\")\n            .attr(\"opacity\", function() {\n              // 根据面的类型恢复不同的透明度\n              const fill = d3.select(this).attr(\"fill\");\n              if (fill && fill.includes(\"rgb\")) {\n                const match = fill.match(/\\d+/g);\n                if (match) {\n                  const r = parseInt(match[0]);\n                  const g = parseInt(match[1]);\n                  const b = parseInt(match[2]);\n                  // 根据亮度判断是顶面、侧面还是底面\n                  const brightness = (r + g + b) / 3;\n                  if (brightness > 200) return 1; // 顶面\n                  if (brightness > 150) return 0.85; // 侧面\n                  return 0.8; // 背面/底面\n                }\n              }\n              return 0.9;\n            })\n            .attr(\"stroke-width\", 0.5);\n          tooltip.style(\"opacity\", 0);\n        });\n    });\n\n    // ========== 添加折线趋势图（每个月份一条，沿X轴延伸，Z轴表示高度） ==========\n    // 计算折线高度的范围\n    let minLineHeight = Infinity;\n    let maxLineHeight = 0;\n    if (lineSource && lineSource.length > 0) {\n      for (let i = 0; i < lineSource.length; i++) {\n        const chunk = lineSource[i];\n        if (chunk && chunk.genre_distribution) {\n          for (let genre of allGenres) {\n            const val = chunk.genre_distribution[genre] || 0;\n            minLineHeight = Math.min(minLineHeight, val);\n            maxLineHeight = Math.max(maxLineHeight, val);\n          }\n        }\n      }\n    }\n    \n    // 如果genreData为空，使用surfaceData的数据\n    if (!lineSource || lineSource.length === 0 || minLineHeight === Infinity) {\n      minLineHeight = Infinity;\n      maxLineHeight = 0;\n      for (let i = 0; i < surfaceData.length; i++) {\n        for (let j = 0; j < surfaceData[i].length; j++) {\n          const val = surfaceData[i][j] || 0;\n          minLineHeight = Math.min(minLineHeight, val);\n          maxLineHeight = Math.max(maxLineHeight, val);\n        }\n      }\n    }\n    \n    // 确保有有效的数据范围\n    if (minLineHeight === Infinity) minLineHeight = 0;\n    if (maxLineHeight === 0) maxLineHeight = 1;\n    const lineHeightRange = maxLineHeight - minLineHeight || 1;\n    const maxLineZ = maxHeight * 1.2; // 折线最大高度，降低高度\n    \n    console.log('📊 折线图数据范围:', { minLineHeight, maxLineHeight, lineHeightRange, maxLineZ });\n\n    // D3的平滑曲线生成器（沿X轴延伸，所以用curveMonotoneX）\n    const lineGenerator = d3.line()\n      .curve(d3.curveMonotoneX) // 平滑曲线，沿X轴\n      .x((d) => {\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.x;\n      })\n      .y((d) => {\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.y;\n      });\n\n    // D3的面积生成器（用于填充）\n    const areaGenerator = d3.area()\n      .curve(d3.curveMonotoneX) // 沿X轴\n      .x((d) => {\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.x;\n      })\n      .y0((d) => {\n        // 底部（热力图顶部）\n        const projected = isometricProjection(d.x, d.y, cellThickness);\n        return projected.y;\n      })\n      .y1((d) => {\n        // 顶部（折线高度）\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.y;\n      });\n\n    // 为每个月份绘制折线（沿X轴：风格方向）\n    for (let monthIdx = 0; monthIdx < numMonths; monthIdx++) {\n      const month = months[monthIdx];\n      const monthY = monthIdx * cellDepth + cellDepth / 2; // 月份的中心Y坐标\n      \n      // 生成折线的数据点（沿X轴：从genre 0到genre 7）\n      const lineData = [];\n      for (let genreIdx = 0; genreIdx < numGenres; genreIdx++) {\n        let value = 0;\n        if (lineSource && lineSource[monthIdx] && lineSource[monthIdx].genre_distribution) {\n          const genre = allGenres[genreIdx];\n          value = lineSource[monthIdx].genre_distribution[genre] || 0;\n        } else if (surfaceData && surfaceData[monthIdx]) {\n          // 如果genreData为空，使用surfaceData\n          value = surfaceData[monthIdx][genreIdx] || 0;\n        }\n        \n        // 归一化高度，确保不会出现NaN\n        const normalizedValue = lineHeightRange > 0 ? (value - minLineHeight) / lineHeightRange : 0;\n        const z = cellThickness + (isNaN(normalizedValue) ? 0 : normalizedValue) * maxLineZ; // 从热力图顶部开始\n        \n        const genreX = genreIdx * cellWidth + cellWidth / 2; // genre的中心X坐标\n        \n        // 验证坐标不是NaN\n        if (!isNaN(genreX) && !isNaN(monthY) && !isNaN(z)) {\n          lineData.push({\n            x: genreX,\n            y: monthY,\n            z: z,\n            value: value,\n            monthIdx: monthIdx,\n            genreIdx: genreIdx\n          });\n        }\n      }\n\n      // 获取该月份的平均颜色（使用热力图的颜色方案，但加深颜色使其更明显）\n      const avgValue = lineData.reduce((sum, d) => sum + d.value, 0) / lineData.length;\n      // ✅ 修正折线颜色：截图里折线在亮色背景下是【纯黑色/极深色】，对比度极高\n      // 不再用彩色，直接用黑色，带一点点透明度让它不那么死板\n      const lineColor = \"rgba(10, 5, 20, 0.9)\"; // 极深紫黑，接近纯黑（原图折线观感）\n      // ✅ 恢复“折线下方半透明填充”：原图是浅紫色带状半透明\n      const areaFillColor = \"rgba(233, 213, 255, 0.55)\"; // #e9d5ff with alpha\n      \n      // 存储折线数据（用于旋转时更新）\n      if (lineData.length > 0) {\n        lineDataArray.push({\n          monthIdx,\n          month,\n          lineData: [...lineData], // 复制数组\n          areaFillColor,\n          lineColor\n        });\n      }\n      \n      // 只有当有有效数据点时才绘制\n      if (lineData.length > 0) {\n        // 创建面积填充（半透明）\n        const areaPath = areaGenerator(lineData);\n        if (areaPath && !areaPath.includes('NaN')) {\n          const areaElement = g.append(\"path\")\n            .attr(\"class\", `area-path area-${monthIdx}`)\n            .attr(\"d\", areaPath)\n            .attr(\"fill\", areaFillColor)\n            .attr(\"fill-opacity\", 0.42)\n            .attr(\"stroke\", \"none\")\n            .datum({ lineData: lineData, month: month, monthIdx: monthIdx }) // 存储数据\n            .style(\"cursor\", \"pointer\")\n            // ✅ 关键：确保面积能接收鼠标事件（避免被 SVG 默认/父层样式影响）\n            .style(\"pointer-events\", \"fill\");\n          \n          // 为面积填充也添加鼠标事件（确保tooltip能显示）\n          areaElement\n            .on(\"mousemove\", function(event) {\n              // 获取鼠标在SVG中的坐标\n              const [mouseX, mouseY] = d3.pointer(event, g.node());\n              \n              // 找到最近的数据点\n              let minDistance = Infinity;\n              let nearestPoint = null;\n              let nearestGenreIdx = -1;\n              \n              lineData.forEach((point, idx) => {\n                const projected = isometricProjection(point.x, point.y, point.z);\n                const distance = Math.sqrt(\n                  Math.pow(mouseX - projected.x, 2) + \n                  Math.pow(mouseY - projected.y, 2)\n                );\n                if (distance < minDistance) {\n                  minDistance = distance;\n                  nearestPoint = point;\n                  nearestGenreIdx = idx;\n                }\n              });\n              \n              // ✅ 放宽阈值：面积本身就很大，只要能算出最近点就显示\n              if (nearestPoint) {\n                // 曲目数量：优先 lineSource(JSON)，否则回退\n                let trackCount = 0;\n                const chunk = lineSource && lineSource[monthIdx] ? lineSource[monthIdx] : null;\n                const genre = allGenres[nearestGenreIdx];\n                if (chunk && chunk.genre_distribution && chunk.genre_distribution[genre] !== undefined) {\n                  trackCount = chunk.genre_distribution[genre];\n                } else {\n                  trackCount = Math.round(nearestPoint.value);\n                }\n\n                tooltip.style(\"opacity\", 0.95);\n                tooltip.html(`<b>${allGenres[nearestGenreIdx]}</b><br/>${month}<br/>分值: ${nearestPoint.value.toFixed(2)}<br/>曲目数量: ${trackCount}`);\n                placeTooltip(event);\n              }\n            })\n            .on(\"mouseout\", function() {\n              tooltip.style(\"opacity\", 0);\n            });\n        }\n\n        // 创建折线（确保在最上层显示，使用深色使其更明显）\n        const linePath = lineGenerator(lineData);\n        if (linePath && !linePath.includes('NaN')) {\n          const lineElement = g.append(\"path\")\n            .attr(\"class\", `line-path line-${monthIdx}`)\n            .attr(\"d\", linePath)\n            .attr(\"fill\", \"none\")\n            .attr(\"stroke\", lineColor)\n            .attr(\"stroke-width\", 2.8)\n            .attr(\"opacity\", 1)\n            .attr(\"filter\", \"url(#hm-line-glow)\")\n            .datum({ lineData: lineData, month: month, monthIdx: monthIdx }) // 存储数据\n            .style(\"cursor\", \"pointer\")\n            // ✅ 关键：折线只用 stroke 命中，更好点到线\n            .style(\"pointer-events\", \"stroke\");\n          \n          // ✅ 给折线加“隐形粗命中层”，解决“线太细很难 hover 到”\n          const hitLine = g.append(\"path\")\n            .attr(\"class\", `line-hit line-hit-${monthIdx}`)\n            .attr(\"d\", linePath)\n            .attr(\"fill\", \"none\")\n            // ⚠️ 不要用完全 transparent：部分浏览器下会导致 pointer hit 失效\n            .attr(\"stroke\", \"#ffffff\")\n            .attr(\"stroke-opacity\", 0.001)\n            .attr(\"stroke-width\", 14) // 命中更容易\n            .attr(\"opacity\", 1)\n            .datum({ lineData: lineData, month: month, monthIdx: monthIdx })\n            .style(\"cursor\", \"pointer\")\n            .style(\"pointer-events\", \"stroke\");\n\n          // 为折线图添加鼠标事件（绑定到 hitLine；视觉线保留原样）\n          const onLineMove = function(event) {\n              // 获取鼠标在SVG中的坐标\n              const [mouseX, mouseY] = d3.pointer(event, g.node());\n              \n              // 找到最近的数据点\n              let minDistance = Infinity;\n              let nearestPoint = null;\n              let nearestGenreIdx = -1;\n              \n              lineData.forEach((point, idx) => {\n                const projected = isometricProjection(point.x, point.y, point.z);\n                const distance = Math.sqrt(\n                  Math.pow(mouseX - projected.x, 2) + \n                  Math.pow(mouseY - projected.y, 2)\n                );\n                if (distance < minDistance) {\n                  minDistance = distance;\n                  nearestPoint = point;\n                  nearestGenreIdx = idx;\n                }\n              });\n              \n              // ✅ 放宽阈值：折线 hover 体验要“容易命中”，不做严格距离门槛\n              if (nearestPoint) {\n                // 曲目数量：优先 lineSource(JSON)，否则回退\n                let trackCount = 0;\n                const chunk = lineSource && lineSource[monthIdx] ? lineSource[monthIdx] : null;\n                const genre = allGenres[nearestGenreIdx];\n                if (chunk && chunk.genre_distribution && chunk.genre_distribution[genre] !== undefined) {\n                  trackCount = chunk.genre_distribution[genre];\n                } else {\n                  trackCount = Math.round(nearestPoint.value);\n                }\n\n                tooltip.style(\"opacity\", 0.95);\n                tooltip.html(`<b>${allGenres[nearestGenreIdx]}</b><br/>${month}<br/>分值: ${nearestPoint.value.toFixed(2)}<br/>曲目数量: ${trackCount}`);\n                placeTooltip(event);\n              }\n          };\n\n          hitLine\n            .on(\"mousemove\", onLineMove)\n            .on(\"mouseout\", function() { tooltip.style(\"opacity\", 0); });\n\n          // 视觉线也绑定同样逻辑（双保险）\n          lineElement\n            .on(\"mousemove\", onLineMove)\n            .on(\"mouseout\", function() { tooltip.style(\"opacity\", 0); });\n          \n          // ========== 添加最高点标记 ==========\n          // 找到最高点（z值最大的点）\n          let maxZ = -Infinity;\n          let maxPoint = null;\n          lineData.forEach(point => {\n            if (point.z > maxZ) {\n              maxZ = point.z;\n              maxPoint = point;\n            }\n          });\n          \n          if (maxPoint) {\n            const maxProjected = isometricProjection(maxPoint.x, maxPoint.y, maxPoint.z);\n            \n            // 绘制外圈（白色，更大）\n            g.append(\"circle\")\n              .attr(\"class\", `max-point-outer max-point-outer-${monthIdx}`)\n              .attr(\"cx\", maxProjected.x)\n              .attr(\"cy\", maxProjected.y)\n              .attr(\"r\", 6)\n              .attr(\"fill\", \"#ffffff\")\n              .attr(\"stroke\", lineColor)\n              .attr(\"stroke-width\", 2)\n              .attr(\"opacity\", 1)\n              .style(\"pointer-events\", \"none\"); // 允许鼠标事件穿透到折线\n            \n            // 绘制内圈（折线颜色，更小）\n            g.append(\"circle\")\n              .attr(\"class\", `max-point-inner max-point-inner-${monthIdx}`)\n              .attr(\"cx\", maxProjected.x)\n              .attr(\"cy\", maxProjected.y)\n              .attr(\"r\", 3.5)\n              .attr(\"fill\", lineColor)\n              .attr(\"stroke\", \"none\")\n              .attr(\"opacity\", 1)\n              .style(\"pointer-events\", \"none\"); // 允许鼠标事件穿透到折线\n          }\n          \n          console.log(`✅ 已绘制${month}的折线图，数据点: ${lineData.length}`);\n        } else {\n          console.warn(`⚠️ ${month}的折线路径生成失败，路径: ${linePath}`);\n        }\n      } else {\n        console.warn(`⚠️ ${month}没有有效的数据点`);\n      }\n    }\n    console.log('🎉 折线趋势图绘制完成！');\n    // ========== 添加坐标轴线（原点与第一个方格左上角对齐） ==========\n    const axisOffset = 8; // 坐标轴往外偏移的距离（增加，更往外）\n    \n    // 辅助函数：绘制带箭头的轴线\n    function drawAxisWithArrow(start, end, color = \"#555\", axisClass = \"\") {\n      const line = g.append(\"line\")\n        .attr(\"class\", `axis-line ${axisClass}`)\n        .attr(\"x1\", start.x)\n        .attr(\"y1\", start.y)\n        .attr(\"x2\", end.x)\n        .attr(\"y2\", end.y)\n        .attr(\"stroke\", color)\n        .attr(\"stroke-width\", 2)\n        .attr(\"opacity\", 0.7)\n        // ✅ 坐标轴只显示，不要拦截折线/方块 hover\n        .style(\"pointer-events\", \"none\");\n      \n      // 计算箭头方向\n      const dx = end.x - start.x;\n      const dy = end.y - start.y;\n      const angle = Math.atan2(dy, dx);\n      const arrowLength = 8;\n      \n      // 绘制箭头\n      const arrowPath = d3.path();\n      arrowPath.moveTo(end.x, end.y);\n      arrowPath.lineTo(\n        end.x - arrowLength * Math.cos(angle - Math.PI / 6),\n        end.y - arrowLength * Math.sin(angle - Math.PI / 6)\n      );\n      arrowPath.lineTo(\n        end.x - arrowLength * Math.cos(angle + Math.PI / 6),\n        end.y - arrowLength * Math.sin(angle + Math.PI / 6)\n      );\n      arrowPath.closePath();\n      \n      g.append(\"path\")\n        .attr(\"class\", `axis-arrow ${axisClass}`)\n        .attr(\"d\", arrowPath.toString())\n        .attr(\"fill\", color)\n        .attr(\"opacity\", 0.7)\n        .style(\"pointer-events\", \"none\");\n      \n      return { line, start, end };\n    }\n\n    // 坐标原点在 (0, 0, 0)，即第一个方格的左上角\n    let origin = isometricProjection(-axisOffset, -axisOffset, 0);\n    \n    // 赛博深色主题：轴线/箭头用浅色系，避免发灰看不清\n    const AXIS_LINE = \"rgba(50, 167, 255, 0.30)\";\n    const AXIS_TEXT = \"rgba(226, 232, 240, 0.88)\";\n    const AXIS_STROKE = \"rgba(7, 3, 18, 0.72)\";\n\n    // X轴（genres方向）- 从原点沿X轴延伸\n    let xAxisEnd = isometricProjection(totalWidth + axisOffset, -axisOffset, 0);\n    drawAxisWithArrow(origin, xAxisEnd, AXIS_LINE, \"x-axis\");\n\n    // Y轴（months方向）- 从原点沿Y轴延伸\n    let yAxisEnd = isometricProjection(-axisOffset, totalDepth + axisOffset, 0);\n    drawAxisWithArrow(origin, yAxisEnd, AXIS_LINE, \"y-axis\");\n\n    // Z轴（高度方向）- 从原点向上延伸\n    let zAxisEnd = isometricProjection(-axisOffset, -axisOffset, maxHeight + axisOffset);\n    drawAxisWithArrow(origin, zAxisEnd, AXIS_LINE, \"z-axis\");\n\n    // ========== 添加坐标轴标签 ==========\n    const labelOffset = 40; // X轴标签往外偏移的距离（增加，确保在方格外面）\n    \n    // X轴标签（genres）- 在底部前方（y<0的部分）\n    allGenres.forEach((genre, idx) => {\n      const x = idx * cellWidth + cellWidth / 2;\n      const y = -labelOffset; // y<0，在底部前方\n      const projected = isometricProjection(x, y, 0); // 在y<0的位置\n      \n      g.append(\"text\")\n        .attr(\"class\", `axis-label x-label x-label-${idx}`)\n        .attr(\"x\", projected.x)\n        .attr(\"y\", projected.y)\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"fill\", AXIS_TEXT)\n        .attr(\"font-size\", \"11px\")\n        .attr(\"font-weight\", \"500\")\n        .style(\"font-family\", \"system-ui, -apple-system, sans-serif\")\n        .style(\"paint-order\", \"stroke\")\n        .style(\"stroke\", AXIS_STROKE)\n        .style(\"stroke-width\", \"2.2px\")\n        .style(\"stroke-linejoin\", \"round\")\n        .style(\"pointer-events\", \"none\")\n        .text(genre);\n    });\n\n    // Y轴标签（months）- 在左侧\n    months.forEach((month, idx) => {\n      if (idx % 3 === 0) { // 只显示部分月份，避免太密集\n        const x = 0;\n        const y = idx * cellDepth + cellDepth / 2;\n        const projected = isometricProjection(x - labelOffset, y, 0);\n        \n        g.append(\"text\")\n          .attr(\"class\", `axis-label y-label y-label-${idx}`)\n          .attr(\"x\", projected.x)\n          .attr(\"y\", projected.y)\n          .attr(\"text-anchor\", \"end\")\n          .attr(\"fill\", AXIS_TEXT)\n          .attr(\"font-size\", \"10px\")\n          .style(\"font-family\", \"system-ui, -apple-system, sans-serif\")\n          .style(\"paint-order\", \"stroke\")\n          .style(\"stroke\", AXIS_STROKE)\n          .style(\"stroke-width\", \"2.2px\")\n          .style(\"stroke-linejoin\", \"round\")\n          .style(\"pointer-events\", \"none\")\n          .text(month);\n      }\n    });\n\n    // Z轴标签（乐曲数量）- 再往上移\n    let zLabelPos = isometricProjection(-10, 0, maxHeight + 25); // 增加Z坐标，让标签更往上\n    g.append(\"text\")\n      .attr(\"class\", \"axis-label z-label\")\n      .attr(\"x\", zLabelPos.x)\n      .attr(\"y\", zLabelPos.y)\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"fill\", AXIS_TEXT)\n      .attr(\"font-size\", \"10px\")\n      .attr(\"font-weight\", \"500\")\n      .style(\"font-family\", \"system-ui, -apple-system, sans-serif\")\n      .style(\"paint-order\", \"stroke\")\n      .style(\"stroke\", AXIS_STROKE)\n      .style(\"stroke-width\", \"2.2px\")\n      .style(\"stroke-linejoin\", \"round\")\n      .style(\"pointer-events\", \"none\")\n      .text(\"乐曲数量\");\n\n    console.log('🎉 D3伪3D热力图初始化完成！');\n\n    // ========== 更新函数：重新渲染所有元素（用于旋转） ==========\n    function updateProjection() {\n      // 重新计算边界\n      const corners = [\n        isometricProjection(0, 0, 0),\n        isometricProjection(totalWidth, 0, 0),\n        isometricProjection(0, totalDepth, 0),\n        isometricProjection(totalWidth, totalDepth, 0),\n        isometricProjection(0, 0, maxHeight),\n        isometricProjection(totalWidth, 0, maxHeight)\n      ];\n      \n      const minX = d3.min(corners, d => d.x);\n      const maxX = d3.max(corners, d => d.x);\n      const minY = d3.min(corners, d => d.y);\n      const maxY = d3.max(corners, d => d.y);\n      \n      const projectedWidth = maxX - minX;\n      const projectedHeight = maxY - minY;\n      \n      // 更新 viewBox\n      const padding = 50;\n      const viewBoxMinX = minX - padding;\n      const viewBoxMinY = minY - padding;\n      const viewBoxWidth = projectedWidth + padding * 2;\n      const viewBoxHeight = projectedHeight + padding * 2;\n      \n      svg.attr(\"viewBox\", `${viewBoxMinX} ${viewBoxMinY} ${viewBoxWidth} ${viewBoxHeight}`);\n      \n      // 更新所有单元格\n      cellDataArray.forEach(cellData => {\n        const { x, y, zBottom, zTop, monthIdx, genreIdx, baseColor, darkColor, darkerColor } = cellData;\n        \n        // 重新计算8个顶点\n        const bottom1 = isometricProjection(x, y, zBottom);\n        const bottom2 = isometricProjection(x + cellWidth, y, zBottom);\n        const bottom3 = isometricProjection(x + cellWidth, y + cellDepth, zBottom);\n        const bottom4 = isometricProjection(x, y + cellDepth, zBottom);\n        const top1 = isometricProjection(x, y, zTop);\n        const top2 = isometricProjection(x + cellWidth, y, zTop);\n        const top3 = isometricProjection(x + cellWidth, y + cellDepth, zTop);\n        const top4 = isometricProjection(x, y + cellDepth, zTop);\n        \n        // 更新单元格组的所有面\n        const cellGroup = g.select(`.cell-${monthIdx}-${genreIdx}`);\n        if (!cellGroup.empty()) {\n          const paths = cellGroup.selectAll(\"path\");\n          const faces = [\n            [bottom1, bottom2, bottom3, bottom4], // 底面\n            [bottom2, top2, top3, bottom3], // 右侧面\n            [bottom4, bottom3, top3, top4], // 背面\n            [top1, top2, top3, top4] // 顶面\n          ];\n          \n          paths.each(function(d, i) {\n            if (i < faces.length) {\n              const path = d3.path();\n              path.moveTo(faces[i][0].x, faces[i][0].y);\n              for (let j = 1; j < faces[i].length; j++) {\n                path.lineTo(faces[i][j].x, faces[i][j].y);\n              }\n              path.closePath();\n              d3.select(this).attr(\"d\", path.toString());\n            }\n          });\n        }\n      });\n      \n      // 更新所有折线\n      lineDataArray.forEach(({ monthIdx, lineData }) => {\n        // 重新生成折线路径（使用与初始化时相同的lineGenerator逻辑）\n        // 注意：需要按照投影后的X坐标排序，确保曲线方向正确\n        const sortedLineData = [...lineData].sort((a, b) => {\n          const projA = isometricProjection(a.x, a.y, a.z);\n          const projB = isometricProjection(b.x, b.y, b.z);\n          return projA.x - projB.x;\n        });\n        \n        const lineGeneratorUpdate = d3.line()\n          .curve(d3.curveMonotoneX)\n          .x((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.x;\n          })\n          .y((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.y;\n          });\n        \n        // 更新折线（使用正确的选择器，class是 \"line-path line-${monthIdx}\"）\n        const lineElement = g.select(`.line-path.line-${monthIdx}`);\n        if (!lineElement.empty()) {\n          const newPath = lineGeneratorUpdate(sortedLineData);\n          if (newPath && !newPath.includes('NaN')) {\n            lineElement.attr(\"d\", newPath);\n          }\n        }\n        \n        // 更新面积填充（重新创建areaGenerator，因为投影函数已更新）\n        // 使用排序后的数据，确保与折线一致\n        const areaGeneratorUpdate = d3.area()\n          .curve(d3.curveMonotoneX)\n          .x((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.x;\n          })\n          .y0((d) => {\n            const projected = isometricProjection(d.x, d.y, cellThickness);\n            return projected.y;\n          })\n          .y1((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.y;\n          });\n        \n        const areaElement = g.select(`.area-${monthIdx}`);\n        if (!areaElement.empty()) {\n          areaElement.attr(\"d\", areaGeneratorUpdate(sortedLineData));\n        }\n        \n        // 更新最高点标记\n        let maxZ = -Infinity;\n        let maxPoint = null;\n        lineData.forEach(point => {\n          if (point.z > maxZ) {\n            maxZ = point.z;\n            maxPoint = point;\n          }\n        });\n        \n        if (maxPoint) {\n          const maxProjected = isometricProjection(maxPoint.x, maxPoint.y, maxPoint.z);\n          g.select(`.max-point-outer-${monthIdx}`)\n            .attr(\"cx\", maxProjected.x)\n            .attr(\"cy\", maxProjected.y);\n          g.select(`.max-point-inner-${monthIdx}`)\n            .attr(\"cx\", maxProjected.x)\n            .attr(\"cy\", maxProjected.y);\n        }\n      });\n      \n      // 更新坐标轴（使用外部定义的axisOffset和labelOffset）\n      \n      // 更新原点\n      origin = isometricProjection(-axisOffset, -axisOffset, 0);\n      \n      // 更新X轴\n      xAxisEnd = isometricProjection(totalWidth + axisOffset, -axisOffset, 0);\n      g.select(\".x-axis.axis-line\")\n        .attr(\"x1\", origin.x)\n        .attr(\"y1\", origin.y)\n        .attr(\"x2\", xAxisEnd.x)\n        .attr(\"y2\", xAxisEnd.y);\n      \n      const xAxisAngle = Math.atan2(xAxisEnd.y - origin.y, xAxisEnd.x - origin.x);\n      const xArrowLength = 8;\n      const xArrowPath = d3.path();\n      xArrowPath.moveTo(xAxisEnd.x, xAxisEnd.y);\n      xArrowPath.lineTo(\n        xAxisEnd.x - xArrowLength * Math.cos(xAxisAngle - Math.PI / 6),\n        xAxisEnd.y - xArrowLength * Math.sin(xAxisAngle - Math.PI / 6)\n      );\n      xArrowPath.lineTo(\n        xAxisEnd.x - xArrowLength * Math.cos(xAxisAngle + Math.PI / 6),\n        xAxisEnd.y - xArrowLength * Math.sin(xAxisAngle + Math.PI / 6)\n      );\n      xArrowPath.closePath();\n      g.select(\".x-axis.axis-arrow\").attr(\"d\", xArrowPath.toString());\n      \n      // 更新Y轴\n      yAxisEnd = isometricProjection(-axisOffset, totalDepth + axisOffset, 0);\n      g.select(\".y-axis.axis-line\")\n        .attr(\"x1\", origin.x)\n        .attr(\"y1\", origin.y)\n        .attr(\"x2\", yAxisEnd.x)\n        .attr(\"y2\", yAxisEnd.y);\n      \n      const yAxisAngle = Math.atan2(yAxisEnd.y - origin.y, yAxisEnd.x - origin.x);\n      const yArrowLength = 8;\n      const yArrowPath = d3.path();\n      yArrowPath.moveTo(yAxisEnd.x, yAxisEnd.y);\n      yArrowPath.lineTo(\n        yAxisEnd.x - yArrowLength * Math.cos(yAxisAngle - Math.PI / 6),\n        yAxisEnd.y - yArrowLength * Math.sin(yAxisAngle - Math.PI / 6)\n      );\n      yArrowPath.lineTo(\n        yAxisEnd.x - yArrowLength * Math.cos(yAxisAngle + Math.PI / 6),\n        yAxisEnd.y - yArrowLength * Math.sin(yAxisAngle + Math.PI / 6)\n      );\n      yArrowPath.closePath();\n      g.select(\".y-axis.axis-arrow\").attr(\"d\", yArrowPath.toString());\n      \n      // 更新Z轴\n      zAxisEnd = isometricProjection(-axisOffset, -axisOffset, maxHeight + axisOffset);\n      g.select(\".z-axis.axis-line\")\n        .attr(\"x1\", origin.x)\n        .attr(\"y1\", origin.y)\n        .attr(\"x2\", zAxisEnd.x)\n        .attr(\"y2\", zAxisEnd.y);\n      \n      const zAxisAngle = Math.atan2(zAxisEnd.y - origin.y, zAxisEnd.x - origin.x);\n      const zArrowLength = 8;\n      const zArrowPath = d3.path();\n      zArrowPath.moveTo(zAxisEnd.x, zAxisEnd.y);\n      zArrowPath.lineTo(\n        zAxisEnd.x - zArrowLength * Math.cos(zAxisAngle - Math.PI / 6),\n        zAxisEnd.y - zArrowLength * Math.sin(zAxisAngle - Math.PI / 6)\n      );\n      zArrowPath.lineTo(\n        zAxisEnd.x - zArrowLength * Math.cos(zAxisAngle + Math.PI / 6),\n        zAxisEnd.y - zArrowLength * Math.sin(zAxisAngle + Math.PI / 6)\n      );\n      zArrowPath.closePath();\n      g.select(\".z-axis.axis-arrow\").attr(\"d\", zArrowPath.toString());\n      \n      // 更新X轴标签\n      allGenres.forEach((genre, idx) => {\n        const x = idx * cellWidth + cellWidth / 2;\n        const y = -labelOffset;\n        const projected = isometricProjection(x, y, 0);\n        g.select(`.x-label-${idx}`)\n          .attr(\"x\", projected.x)\n          .attr(\"y\", projected.y);\n      });\n      \n      // 更新Y轴标签\n      months.forEach((month, idx) => {\n        if (idx % 3 === 0) {\n          const x = 0;\n          const y = idx * cellDepth + cellDepth / 2;\n          const projected = isometricProjection(x - labelOffset, y, 0);\n          g.select(`.y-label-${idx}`)\n            .attr(\"x\", projected.x)\n            .attr(\"y\", projected.y);\n        }\n      });\n      \n      // 更新Z轴标签\n      zLabelPos = isometricProjection(-10, 0, maxHeight + 25);\n      g.select(\".z-label\")\n        .attr(\"x\", zLabelPos.x)\n        .attr(\"y\", zLabelPos.y);\n    }\n\n    // ========== 鼠标拖动旋转事件 ==========\n    svg.on(\"mousedown\", function(event) {\n      isDragging = true;\n      lastMouseX = event.clientX;\n      svg.style(\"cursor\", \"grabbing\");\n      event.preventDefault();\n    });\n\n    svg.on(\"mousemove\", function(event) {\n      if (isDragging) {\n        const deltaX = event.clientX - lastMouseX;\n        rotationAngle += deltaX * 0.01; // 旋转速度\n        \n        // 更新投影\n        updateProjection();\n        \n        lastMouseX = event.clientX;\n        event.preventDefault();\n      } else {\n        // ✅ 折线 tooltip 的“兜底”逻辑：不依赖命中折线本体\n        // 原因：不同浏览器对透明 stroke 的命中行为不一致，导致“挪到折线也不触发”\n        // 策略：鼠标移动时，计算离鼠标最近的折线点；只要靠近折线就显示 tooltip。\n        try {\n          // 如果鼠标在热力图方块上（cell-group），优先让方块 tooltip 生效\n          const t = event && event.target ? event.target : null;\n          if (t && t.closest && t.closest(\".cell-group\")) return;\n\n          // 鼠标在 g 内部坐标\n          const [mouseX, mouseY] = d3.pointer(event, g.node());\n\n          let best = null; // {monthIdx, genreIdx, month, genre, value, dist}\n          for (let mi = 0; mi < lineDataArray.length; mi++) {\n            const series = lineDataArray[mi];\n            if (!series || !series.lineData) continue;\n            for (let gi = 0; gi < series.lineData.length; gi++) {\n              const p = series.lineData[gi];\n              const projected = isometricProjection(p.x, p.y, p.z);\n              const dx = mouseX - projected.x;\n              const dy = mouseY - projected.y;\n              const dist = Math.sqrt(dx * dx + dy * dy);\n              if (!best || dist < best.dist) {\n                best = {\n                  monthIdx: p.monthIdx,\n                  genreIdx: p.genreIdx,\n                  month: series.month,\n                  genre: allGenres[p.genreIdx],\n                  value: p.value,\n                  dist\n                };\n              }\n            }\n          }\n\n          // 命中阈值：比折线/点更宽松，确保“靠近就弹”\n          if (best && best.dist < 22) {\n            let trackCount = 0;\n            const chunk = lineSource && lineSource[best.monthIdx] ? lineSource[best.monthIdx] : null;\n            if (chunk && chunk.genre_distribution && chunk.genre_distribution[best.genre] !== undefined) {\n              trackCount = chunk.genre_distribution[best.genre];\n            } else {\n              trackCount = Math.round(best.value);\n            }\n\n            tooltip.style(\"opacity\", 0.95);\n            tooltip.html(`<b>${best.genre}</b><br/>${best.month}<br/>曲目数量: ${trackCount}`);\n            placeTooltip(event);\n          } else {\n            // 远离折线时隐藏（避免一直黏着）\n            tooltip.style(\"opacity\", 0);\n          }\n        } catch (e) {\n          // 不影响拖拽/绘制\n        }\n      }\n    });\n\n    svg.on(\"mouseup\", function() {\n      isDragging = false;\n      svg.style(\"cursor\", \"grab\");\n    });\n\n    svg.on(\"mouseleave\", function() {\n      isDragging = false;\n      svg.style(\"cursor\", \"grab\");\n    });\n\n    // 监听窗口大小变化，SVG的viewBox会自动处理缩放\n    // 不需要手动更新，因为viewBox基于内容尺寸，preserveAspectRatio会自动适应容器\n    let resizeTimer;\n    const handleResize = () => {\n      clearTimeout(resizeTimer);\n      resizeTimer = setTimeout(() => {\n        // viewBox 基于内容尺寸，不需要更新\n        // preserveAspectRatio 会自动处理缩放\n        console.log('📐 容器尺寸变化，SVG自动适应');\n      }, 150);\n    };\n\n    window.addEventListener('resize', handleResize);\n  }\n\n  // 等待容器有尺寸后再加载数据\n  // 简化：如果容器被隐藏，使用默认尺寸继续\n  const waitForContainer = () => {\n    const width = container.offsetWidth || container.clientWidth;\n    const height = container.offsetHeight || container.clientHeight;\n    \n    // 如果容器有尺寸，或者容器被隐藏（使用默认尺寸）\n    if (width > 0 && height > 0) {\n      console.log('✅ 容器已准备好，开始加载数据');\n      loadData();\n    } else if (container.style.display === 'none') {\n      // 如果容器被隐藏，使用默认尺寸继续\n      console.log('⚠️ 容器被隐藏，使用默认尺寸继续');\n      loadData();\n    } else {\n      console.log('⏳ 等待容器尺寸...', width, height);\n      setTimeout(waitForContainer, 100);\n    }\n  };\n  \n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n      setTimeout(waitForContainer, 100);\n    });\n  } else {\n    setTimeout(waitForContainer, 100);\n  }\n})();\nconsole.log('✅ D3伪3D热力图脚本加载完成');\n"]}