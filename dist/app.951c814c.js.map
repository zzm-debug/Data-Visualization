{"version":3,"sources":["app.js"],"names":["e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","m","defineProperty","_regeneratorDefine","_invoke","enumerable","configurable","writable","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableSpread","_arrayLikeToArray","toString","slice","constructor","name","Array","from","test","isArray","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","data","influenceByGenre","Map","BG","palette","ACG","Pop","Rock","Classical","Electronic","Folk","Jazz","Rap","svgSel","d3","select","svgNode","node","tooltip","empty","append","attr","style","scrollBound","clamp","b","Math","max","min","formatBig","format","pct","x","concat","toFixed","asNumber","fallback","undefined","NaN","Number","isFinite","loadInfluenceMap","_loadInfluenceMap","_callee2","candidates","bundledUrl","_loop","_ret","_i","_candidates","_context3","require","push","url","rows","_t","_context2","csv","forEach","genre","trim","influence","set","size","console","log","_regeneratorValues","warn","render","selectAll","remove","container","closest","parentElement","cw","clientWidth","ch","clientHeight","width","floor","height","margin","top","right","bottom","left","innerW","innerH","g","genres","keys","colorOf","k","playsExtent","extent","total_plays","commentsExtent","total_comments","xMin","xMax","xScale","scaleLog","domain","range","nice","yScale","scaleLinear","influenceVals","map","get","filter","hasInfluence","maxR","rScale","_ext$","_ext$2","ext","minV","maxV","scaleSqrt","rates","maxRate","xGrid","axisBottom","tickSize","tickFormat","yGrid","axisLeft","xAxis","ticks","yAxis","gx","gy","nodes","_influenceByGenre$get","s","rate","progress","id","active","layer","bubbles","enter","ringGap","ringWidth","ringBase","ringProg","updateRings","each","rr","PI","filled","ringRotate","on","event","html","pageX","pageY","pad","extra","clampNode","bound","resolveCollisions","maxIter","it","moved","j","ra","rb","need","dx","dy","dist","hypot","jitter","random","nx","ny","text","note","legend","legendItem","find","op","transition","duration","window","addEventListener","passive","rerender","clearTimeout","setTimeout","_callee","_context"],"mappings":"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","file":"app.951c814c.js","sourceRoot":"..\\src","sourcesContent":["// app.js — 柔和气泡 + 互动率环（进度）+ 字更大 + 图更大（去掉力导向）\n(() => {\n  const data = {\n    \"ACG\": { \"total_plays\": 89843048, \"total_comments\": 95537, \"song_count\": 50 },\n    \"Pop\": { \"total_plays\": 3393742080, \"total_comments\": 12806829, \"song_count\": 50 },\n    \"Rock\": { \"total_plays\": 186807824, \"total_comments\": 5122030, \"song_count\": 50 },\n    \"Classical\": { \"total_plays\": 74785024, \"total_comments\": 383731, \"song_count\": 50 },\n    \"Electronic\": { \"total_plays\": 405760640, \"total_comments\": 185764, \"song_count\": 50 },\n    \"Folk\": { \"total_plays\": 44580532, \"total_comments\": 112595, \"song_count\": 50 },\n    \"Jazz\": { \"total_plays\": 28298645, \"total_comments\": 98685, \"song_count\": 50 },\n    \"Rap\": { \"total_plays\": 519658432, \"total_comments\": 267719, \"song_count\": 50 }\n  };\n\n  // influence（来自 assets/influence_html.csv）：用于“气泡半径”映射\n  // CSV 示例：\n  // genre,influence\n  // Pop,1.0\n  let influenceByGenre = new Map();\n\n  // 图表背景：保持透明（背景由独立视觉层 + 面板承载）\n  const BG = \"transparent\";\n\n  const palette = {\n    ACG: \"#7c3aed\",        // 霓虹紫\n    Pop: \"#ff3bd4\",        // 霓虹粉\n    Rock: \"#00fff0\",       // 电青\n    Classical: \"#F59E0B\",  // 琥珀金\n    Electronic: \"#32a7ff\", // 电蓝\n    Folk: \"#a78bfa\",       // 低饱和紫\n    Jazz: \"#f472b6\",       // 柔粉\n    Rap: \"#94A3B8\"         // 冷灰蓝\n  };\n\n  const svgSel = d3.select(\"#bubble-svg\");\n  const svgNode = svgSel.node();\n  if (!svgNode) return;\n\n  // tooltip（复用避免重复）\n  let tooltip = d3.select(\"body\").select(\".bubble-tooltip\");\n  if (tooltip.empty()) {\n    tooltip = d3.select(\"body\").append(\"div\")\n      .attr(\"class\", \"bubble-tooltip\")\n      .style(\"position\", \"absolute\")\n      .style(\"pointer-events\", \"none\")\n      .style(\"padding\", \"12px 14px\")\n      .style(\"border-radius\", \"12px\")\n      .style(\"background\", \"rgba(30, 41, 59, 0.90)\")\n      .style(\"color\", \"#fff\")\n      .style(\"font\", \"13px/1.4 system-ui, -apple-system, Segoe UI, Microsoft YaHei, sans-serif\")\n      .style(\"opacity\", 0)\n      .style(\"backdrop-filter\", \"blur(6px)\");\n  }\n\n  // 避免每次 resize rerender 都重复绑定 scroll listener\n  let scrollBound = false;\n\n  function clamp(v, a, b) { return Math.max(a, Math.min(b, v)); }\n  function formatBig(n) { return d3.format(\",\")(n); }\n  function pct(x) { return `${(x * 100).toFixed(2)}%`; }\n\n  function asNumber(v, fallback = NaN) {\n    const n = Number(v);\n    return Number.isFinite(n) ? n : fallback;\n  }\n\n  async function loadInfluenceMap() {\n    // ✅ Parcel 1.x：用 require 引入静态资源，才能在 build 后把文件打包/复制进 dist\n    // require('./assets/influence_html.csv') 返回的是最终可访问的 URL\n    const candidates = [];\n\n    try {\n      // eslint-disable-next-line no-undef\n      if (typeof require !== \"undefined\") {\n        // eslint-disable-next-line no-undef\n        const bundledUrl = require(\"./assets/influence_html.csv\");\n        if (bundledUrl) candidates.push(bundledUrl);\n      }\n    } catch (e) {\n      // ignore\n    }\n\n    // 兼容不同部署/打开方式（例如 src/ 下直接打开，或通过本地 server）\n    candidates.push(\n      \"assets/influence_html.csv\",\n      \"./assets/influence_html.csv\",\n      \"/assets/influence_html.csv\",\n      \"/src/assets/influence_html.csv\"\n    );\n\n    for (const url of candidates) {\n      try {\n        const rows = await d3.csv(url);\n        if (!rows || rows.length === 0) continue;\n\n        const m = new Map();\n        rows.forEach(r => {\n          const genre = (r.genre || \"\").trim();\n          const influence = asNumber(r.influence, NaN);\n          if (genre && Number.isFinite(influence)) m.set(genre, influence);\n        });\n\n        if (m.size > 0) {\n          console.log(`✅ influence CSV 加载成功：${url}（${m.size} 条）`);\n          return m;\n        }\n      } catch (e) {\n        // 尝试下一个候选路径\n      }\n    }\n\n    console.warn(\"⚠️ influence CSV 加载失败：将回退为“气泡=评论数”映射（请确认 src/assets/influence_html.csv 已被打包或可通过 URL 访问）\");\n    return new Map();\n  }\n\n  function render() {\n    svgSel.selectAll(\"*\").remove();\n\n    const container = svgNode.closest(\".panel-body\") || svgNode.parentElement;\n    const cw = container?.clientWidth || 1100;\n    const ch = container?.clientHeight || 720;\n\n    // ✅ 图更大：上限更高\n    const width = Math.max(1100, Math.min(1700, Math.floor(cw * 1.25)));\n    const height = Math.max(720, Math.min(1100, Math.floor(ch * 1.18)));\n\n    // ✅ 字更大后，给轴/图例更多空间\n    const margin = { top: 72, right: 260, bottom: 110, left: 120 };\n    const innerW = Math.max(300, width - margin.left - margin.right);\n    const innerH = Math.max(260, height - margin.top - margin.bottom);\n\n    svgSel\n      .attr(\"width\", \"100%\")\n      .attr(\"height\", \"100%\")\n      .attr(\"viewBox\", `0 0 ${width} ${height}`)\n      .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n      .style(\"background\", BG);\n\n    const g = svgSel.append(\"g\");\n\n    const genres = Object.keys(data);\n    const colorOf = (k) => palette[k] || \"#94A3B8\";\n\n    const playsExtent = d3.extent(genres, k => data[k].total_plays);\n    const commentsExtent = d3.extent(genres, k => data[k].total_comments);\n\n    const xMin = Math.max(1, (playsExtent[0] || 1) * 0.75);\n    const xMax = (playsExtent[1] || 1) * 1.25;\n\n    const xScale = d3.scaleLog()\n      .domain([xMin, xMax])\n      .range([margin.left, width - margin.right])\n      .nice();\n\n    const yScale = d3.scaleLinear()\n      .domain([0, (commentsExtent[1] || 0) * 1.12])\n      .range([height - margin.bottom, margin.top])\n      .nice();\n\n    // ✅ 气泡半径：优先用 CSV 的 influence；若加载失败/缺失则回退到评论数\n    const influenceVals = genres\n      .map(g => influenceByGenre.get(g))\n      .filter(v => Number.isFinite(v));\n    const hasInfluence = influenceVals.length > 0;\n\n    const maxR = Math.max(78, Math.floor(Math.min(innerW, innerH) * 0.16));\n\n    const rScale = hasInfluence\n      ? (() => {\n          const ext = d3.extent(influenceVals);\n          const minV = Math.max(0, ext[0] ?? 0);\n          const maxV = Math.max(minV + 1e-9, ext[1] ?? 1);\n          return d3.scaleSqrt().domain([minV, maxV]).range([18, maxR]).clamp(true);\n        })()\n      : d3.scaleSqrt()\n          .domain([Math.max(1, commentsExtent[0] || 1), Math.max(2, commentsExtent[1] || 2)])\n          .range([18, maxR]);\n\n    // ✅ 互动率：comments/plays -> 相对进度\n    const rates = genres.map(k => (data[k].total_comments || 0) / Math.max(1, data[k].total_plays || 1));\n    const maxRate = Math.max(...rates, 1e-9);\n\n    // 网格线（更淡，更干净）\n    const xGrid = d3.axisBottom(xScale).tickSize(-innerH).tickFormat(\"\");\n    const yGrid = d3.axisLeft(yScale).tickSize(-innerW).tickFormat(\"\");\n\n    g.append(\"g\")\n      .attr(\"class\", \"grid x-grid\")\n      .attr(\"transform\", `translate(0,${height - margin.bottom})`)\n      .call(xGrid);\n\n    g.append(\"g\")\n      .attr(\"class\", \"grid y-grid\")\n      .attr(\"transform\", `translate(${margin.left},0)`)\n      .call(yGrid);\n\n    // 深色赛博背景下：网格线不能太“深灰/低透明”，否则新窗口里几乎看不见\n    svgSel.selectAll(\".grid line\")\n      .attr(\"stroke\", \"rgba(50, 167, 255, 0.14)\")\n      .attr(\"stroke-width\", 1.2);\n\n    svgSel.selectAll(\".grid path\").attr(\"stroke\", \"none\");\n\n    // 坐标轴（字号更大）\n    const xAxis = d3.axisBottom(xScale).ticks(10, \"~s\");\n    const yAxis = d3.axisLeft(yScale).ticks(6).tickFormat(d3.format(\".2s\"));\n\n    const gx = g.append(\"g\")\n      .attr(\"transform\", `translate(0,${height - margin.bottom})`)\n      .attr(\"class\", \"x-axis\")\n      .call(xAxis);\n\n    const gy = g.append(\"g\")\n      .attr(\"transform\", `translate(${margin.left},0)`)\n      .attr(\"class\", \"y-axis\")\n      .call(yAxis);\n\n    // 深色赛博背景下：轴文字需要更高对比度\n    g.selectAll(\".x-axis text, .y-axis text\")\n      .style(\"font-size\", \"15px\")\n      .style(\"fill\", \"rgba(226, 232, 240, 0.88)\")\n      .style(\"paint-order\", \"stroke\")\n      .style(\"stroke\", \"rgba(7, 3, 18, 0.72)\")\n      .style(\"stroke-width\", \"2.2px\")\n      .style(\"stroke-linejoin\", \"round\");\n\n    g.selectAll(\".x-axis path, .y-axis path, .x-axis line, .y-axis line\")\n      .attr(\"stroke\", \"rgba(50, 167, 255, 0.28)\");\n\n    // 节点\n    const nodes = genres.map(genre => {\n      const s = data[genre];\n      const influence = hasInfluence ? (influenceByGenre.get(genre) ?? 0) : null;\n      const r = hasInfluence ? rScale(influence) : rScale(s.total_comments);\n      const rate = (s.total_comments || 0) / Math.max(1, s.total_plays || 1);\n      const progress = clamp(rate / maxRate, 0, 1);\n\n      return {\n        id: genre,\n        total_plays: s.total_plays,\n        total_comments: s.total_comments,\n        influence,\n        x: xScale(s.total_plays),\n        y: yScale(s.total_comments),\n        r,\n        rate,\n        progress,\n        active: true\n      };\n    });\n\n    const layer = g.append(\"g\").attr(\"class\", \"bubble-layer\");\n\n    // ✅ 只保留“柔和气泡”本体\n    const bubbles = layer.selectAll(\".bubble\")\n      .data(nodes, d => d.id)\n      .enter().append(\"circle\")\n      .attr(\"class\", \"bubble\")\n      .attr(\"r\", d => d.r)\n      .attr(\"fill\", d => colorOf(d.id))\n      .attr(\"fill-opacity\", 0.28)                // 轻盈一点\n      .attr(\"stroke\", \"rgba(255,255,255,0.95)\")  // 干净的描边\n      .attr(\"stroke-width\", 2);\n\n    // ✅ 互动率环（保留）：底环 + 进度环\n    const ringGap = 10;     // 离气泡更远一点，看起来更优雅\n    const ringWidth = 7;    // 更清晰\n\n    const ringBase = layer.selectAll(\".ring-base\")\n      .data(nodes, d => d.id)\n      .enter().append(\"circle\")\n      .attr(\"class\", \"ring-base\")\n      .attr(\"fill\", \"none\")\n      .attr(\"r\", d => d.r + ringGap)\n      .attr(\"stroke\", \"rgba(30,41,59,0.10)\")\n      .attr(\"stroke-width\", ringWidth);\n\n    const ringProg = layer.selectAll(\".ring-prog\")\n      .data(nodes, d => d.id)\n      .enter().append(\"circle\")\n      .attr(\"class\", \"ring-prog\")\n      .attr(\"fill\", \"none\")\n      .attr(\"r\", d => d.r + ringGap)\n      .attr(\"stroke\", d => colorOf(d.id))\n      .attr(\"stroke-opacity\", 0.78)\n      .attr(\"stroke-linecap\", \"round\")\n      .attr(\"stroke-width\", ringWidth);\n\n    function updateRings() {\n      ringProg.each(function (d) {\n        const rr = d.r + ringGap;\n        const c = 2 * Math.PI * rr;\n        const filled = c * d.progress;\n\n        d3.select(this)\n          .attr(\"stroke-dasharray\", `${filled} ${c}`)\n          .attr(\"stroke-dashoffset\", 0);\n      });\n    }\n\n    // 让进度从顶部开始（旋转 -90°）\n    function ringRotate(d) {\n      return `rotate(-90 ${d.x} ${d.y})`;\n    }\n\n    // 交互（绑定到气泡）\n    bubbles\n      .on(\"mouseenter\", (event, d) => {\n        tooltip\n          .style(\"opacity\", 1)\n          .html(`\n            <div style=\"font-weight:800;margin-bottom:6px;letter-spacing:.3px\">${d.id}</div>\n            <div style=\"opacity:.92\">Plays：${formatBig(d.total_plays)}</div>\n            <div style=\"opacity:.92\">Comments：${formatBig(d.total_comments)}</div>\n            <div style=\"opacity:.92;margin-top:6px\">Influence：${d.influence === null ? \"N/A\" : d3.format(\".4f\")(d.influence)}</div>\n            <div style=\"opacity:.92;margin-top:6px\">互动率：${pct(d.rate)}</div>\n            <div style=\"opacity:.70;margin-top:6px\">气泡=影响力(influence)｜外环=互动率（相对进度）</div>\n          `);\n      })\n      .on(\"mousemove\", (event) => {\n        tooltip\n          .style(\"left\", (event.pageX + 14) + \"px\")\n          .style(\"top\", (event.pageY + 14) + \"px\");\n      })\n      .on(\"mouseleave\", () => tooltip.style(\"opacity\", 0));\n\n    // —— 轻量级碰撞分离（无力导向）——\n\n// 每个气泡的“有效半径”需要包含外环：r + ringGap + ringWidth\nconst pad = 6;                   // 额外留白，避免贴边\nconst extra = ringGap + ringWidth + 3;\n\nfunction clampNode(d) {\n  const bound = d.r + extra;\n  d.x = clamp(d.x, margin.left + bound, width - margin.right - bound);\n  d.y = clamp(d.y, margin.top + bound,  height - margin.bottom - bound);\n}\n\n// 先做一次边界裁剪\nnodes.forEach(clampNode);\n\n// 迭代式分离：两两检查，若重叠就沿中心连线各退一半\nfunction resolveCollisions(nodes, maxIter = 80) {\n  for (let it = 0; it < maxIter; it++) {\n    let moved = 0;\n\n    for (let i = 0; i < nodes.length; i++) {\n      for (let j = i + 1; j < nodes.length; j++) {\n        const a = nodes[i], b = nodes[j];\n\n        const ra = a.r + extra;\n        const rb = b.r + extra;\n        const need = ra + rb + pad;\n\n        let dx = b.x - a.x;\n        let dy = b.y - a.y;\n        let dist = Math.hypot(dx, dy);\n\n        if (dist < 1e-6) {\n          const jitter = 0.5 + Math.random();\n          dx = jitter;\n          dy = jitter * 0.7;\n          dist = Math.hypot(dx, dy);\n        }\n\n        if (dist < need) {\n          const push = (need - dist) / 2;\n          const nx = dx / dist;\n          const ny = dy / dist;\n\n          a.x -= nx * push;\n          a.y -= ny * push;\n          b.x += nx * push;\n          b.y += ny * push;\n\n          moved++;\n        }\n      }\n    }\n\n    nodes.forEach(clampNode);\n\n    if (moved === 0) break;\n  }\n}\n\n// 执行分离\nresolveCollisions(nodes);\n\n// 放置到最终位置\nbubbles.attr(\"cx\", d => d.x).attr(\"cy\", d => d.y);\nringBase.attr(\"cx\", d => d.x).attr(\"cy\", d => d.y);\nringProg\n  .attr(\"cx\", d => d.x).attr(\"cy\", d => d.y)\n  .attr(\"transform\", d => `rotate(-90 ${d.x} ${d.y})`);\n\n// 重新计算一次进度环\nupdateRings();\n\n\n    // ✅ 轴标题更大\n    svgSel.append(\"text\")\n      .attr(\"x\", margin.left + innerW / 2)\n      .attr(\"y\", height - 42)\n      .attr(\"text-anchor\", \"middle\")\n      .style(\"font\", \"16px/1 system-ui, -apple-system, Segoe UI, Microsoft YaHei, sans-serif\")\n      .style(\"fill\", \"rgba(226, 232, 240, 0.88)\")\n      .style(\"paint-order\", \"stroke\")\n      .style(\"stroke\", \"rgba(7, 3, 18, 0.72)\")\n      .style(\"stroke-width\", \"2.2px\")\n      .style(\"stroke-linejoin\", \"round\")\n      .text(\"Total Plays (log)\");\n\n    svgSel.append(\"text\")\n      .attr(\"transform\", \"rotate(-90)\")\n      .attr(\"x\", -(margin.top + innerH / 2))\n      .attr(\"y\", 34)\n      .attr(\"text-anchor\", \"middle\")\n      .style(\"font\", \"16px/1 system-ui, -apple-system, Segoe UI, Microsoft YaHei, sans-serif\")\n      .style(\"fill\", \"rgba(226, 232, 240, 0.88)\")\n      .style(\"paint-order\", \"stroke\")\n      .style(\"stroke\", \"rgba(7, 3, 18, 0.72)\")\n      .style(\"stroke-width\", \"2.2px\")\n      .style(\"stroke-linejoin\", \"round\")\n      .text(\"Total Comments\");\n\n    // ✅ 注释：右上角加一个“说明”小标签（设计感更强）\n    const note = svgSel.append(\"g\")\n      .attr(\"transform\", `translate(${margin.left + 10}, ${margin.top - 36})`);\n\n    note.append(\"rect\")\n      .attr(\"width\", 320)\n      .attr(\"height\", 28)\n      .attr(\"rx\", 10)\n      .attr(\"fill\", \"rgba(18, 8, 42, 0.86)\")\n      .attr(\"stroke\", \"rgba(50, 167, 255, 0.28)\");\n\n    note.append(\"text\")\n      .attr(\"x\", 14)\n      .attr(\"y\", 19)\n      .style(\"font\", \"14px system-ui, -apple-system, Segoe UI, Microsoft YaHei, sans-serif\")\n      .style(\"fill\", \"rgba(226, 232, 240, 0.86)\")\n      .text(\"气泡=影响力(influence)  ｜  外环=互动率（相对进度）\");\n\n    // ✅ 图例：更大更清晰（不漏）\n    const legend = svgSel.append(\"g\").attr(\"class\", \"legend-group\");\n\n    const legendItem = legend.selectAll(\".legend\")\n      .data(genres)\n      .enter().append(\"g\")\n      .attr(\"class\", \"legend\")\n      .attr(\"transform\", (d, i) => `translate(${width - margin.right + 20}, ${margin.top + i * 32})`)\n      .style(\"cursor\", \"pointer\")\n      .on(\"click\", (event, genre) => {\n        const node = nodes.find(n => n.id === genre);\n        node.active = !node.active;\n\n        const op = node.active ? 1 : 0.12;\n\n        bubbles.filter(d => d.id === genre).transition().duration(220).attr(\"opacity\", op);\n        ringBase.filter(d => d.id === genre).transition().duration(220).attr(\"opacity\", op);\n        ringProg.filter(d => d.id === genre).transition().duration(220).attr(\"opacity\", op);\n\n        legendItem.filter(d => d === genre).selectAll(\"text, rect\")\n          .transition().duration(180)\n          .style(\"opacity\", node.active ? 1 : 0.35);\n      });\n\n    legendItem.append(\"rect\")\n      .attr(\"width\", 16)\n      .attr(\"height\", 16)\n      .attr(\"rx\", 5)\n      .attr(\"ry\", 5)\n      .attr(\"y\", -12)\n      .style(\"fill\", d => colorOf(d))\n      .style(\"opacity\", 0.75);\n\n    legendItem.append(\"text\")\n      .attr(\"x\", 26)\n      .attr(\"y\", 2)\n      .text(d => d)\n      .style(\"font-size\", \"16px\")\n      .style(\"fill\", \"rgba(226, 232, 240, 0.86)\")\n      .style(\"paint-order\", \"stroke\")\n      .style(\"stroke\", \"rgba(7, 3, 18, 0.72)\")\n      .style(\"stroke-width\", \"2.0px\")\n      .style(\"stroke-linejoin\", \"round\")\n      .style(\"font-family\", \"system-ui, -apple-system, Segoe UI, Microsoft YaHei, sans-serif\");\n\n    if (!scrollBound) {\n      window.addEventListener(\"scroll\", () => tooltip.style(\"opacity\", 0), { passive: true });\n      scrollBound = true;\n    }\n  }\n\n  // resize 防抖\n  let t = null;\n  function rerender() {\n    clearTimeout(t);\n    t = setTimeout(render, 90);\n  }\n\n  // 先加载 influence，再渲染（避免第一次渲染仍用评论数）\n  (async () => {\n    influenceByGenre = await loadInfluenceMap();\n    render();\n    window.addEventListener(\"resize\", rerender);\n  })();\n})();\n"]}