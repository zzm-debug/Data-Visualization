{"version":3,"sources":["heatmap-2D.js"],"names":["cssVar","name","fallback","v","getComputedStyle","document","documentElement","getPropertyValue","trim","getCyberStops","accentViolet","accentCyan","accentPink","ensureHeatmapOverlay","container","modeText","stage","closest","parentElement","style","position","styleId","getElementById","createElement","id","textContent","head","appendChild","badge","querySelector","className","anno","open","innerHTML","addEventListener","e","stopPropagation","borderRadius","overflow","background","border","boxShadow","init2DHeatmap","_document$querySelect","console","error","currentModeText","containerId","d3","select","concat","selectAll","remove","csvData","data","csvParse","genres","months","map","d","heatmapData","flatMap","row","genre","month","value","heatmapContainer","containerWidth","clientWidth","containerHeight","clientHeight","margin","top","Math","max","right","bottom","left","width","height","root","append","attr","svg","x","scaleBand","range","domain","padding","y","css","axisColor","gridColor","xAxis","call","axisBottom","tickSizeOuter","length","yAxis","axisLeft","vMin","min","vMax","cyberStops","cyberInterpolator","interpolateRgbBasis","colorScale","scaleSequential","interpolator","updateLegend","legend","fmt","format","join","tooltip","empty","enter","bandwidth","on","event","html","cx","clientX","pageX","cy","clientY","pageY","node","w","offsetWidth","h","offsetHeight","pad","tx","ty","window","innerWidth","innerHeight","log","waitForContainer","display","setTimeout","readyState"],"mappings":"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","file":"heatmap-2D.0382c844.js","sourceRoot":"..\\src","sourcesContent":["// heatmap-2D.js - 2D热力图（已去除折线趋势图）\n// ✅ Inline CSV data (for heatmap)\n(() => {\n  //#region Heatmap 2D｜主题/装饰层（UI注释、模式徽标、容器质感）\n  /**\n   * 说明：\n   * - 你的截图里热力图面板有“赛博霓虹渐变 + 玻璃质感卡片 + 左下角可折叠说明 + 右上角 3D/2D 徽标”。\n   * - 这里不改整体页面布局（`index.html`），而是通过 JS 运行时注入“装饰层”和样式，\n   *   保证 2D/3D 切换时两套图一致，且点击打开的新窗口大图也能复用同一套文案/风格。\n   */\n\n  function cssVar(name, fallback) {\n    const v = getComputedStyle(document.documentElement).getPropertyValue(name);\n    return (v || \"\").trim() || fallback;\n  }\n\n  /**\n   * ✅ 赛博霓虹渐变（按截图：低值深紫 → 紫 → 青 → 粉 → 近白高光）\n   * - 低值不落到纯黑，避免面板“发闷”\n   * - 高值给一点“近白”顶端，提高对比和高级感\n   */\n  function getCyberStops() {\n    const accentViolet = cssVar(\"--accent-violet\", \"#7c3aed\");\n    const accentCyan = cssVar(\"--accent-cyan\", \"#00fff0\");\n    const accentPink = cssVar(\"--accent-pink\", \"#ff3bd4\");\n    return [\n      \"#1b1240\",     // 深紫底（但不是黑）\n      accentViolet,  // 紫\n      accentCyan,    // 青\n      accentPink,    // 粉\n      \"#f6f2ff\"      // 近白高光\n    ];\n  }\n\n  function ensureHeatmapOverlay(container, modeText) {\n    const stage = container && (container.closest(\".heatmap-stage\") || container.parentElement);\n    if (!stage) return;\n    stage.style.position = stage.style.position || \"relative\";\n\n    // 注入一次样式（主页面）\n    const styleId = \"heatmap-overlay-style\";\n    if (!document.getElementById(styleId)) {\n      const style = document.createElement(\"style\");\n      style.id = styleId;\n      style.textContent = `\n        .hm-badge{\n          position:absolute; right:10px; top:10px;\n          padding:4px 10px;\n          border-radius:999px;\n          background: rgba(18, 8, 42, 0.72);\n          border: 1px solid rgba(50,167,255,0.26);\n          color: rgba(226,232,240,0.90);\n          font: 12px/1.1 system-ui,-apple-system,\"Segoe UI\",\"Microsoft YaHei\",sans-serif;\n          letter-spacing: .6px;\n          text-transform: uppercase;\n          box-shadow: 0 0 14px rgba(255,59,212,0.10), 0 0 18px rgba(50,167,255,0.08);\n          backdrop-filter: blur(10px);\n          pointer-events:none;\n          z-index: 6;\n        }\n        .hm-anno{\n          position:absolute; left:12px; bottom:12px;\n          width: min(320px, 46%);\n          border-radius: 12px;\n          background: rgba(18, 8, 42, 0.62);\n          border: 1px solid rgba(50,167,255,0.22);\n          box-shadow: 0 0 16px rgba(255,59,212,0.10), 0 0 22px rgba(50,167,255,0.08);\n          color: rgba(226,232,240,0.88);\n          backdrop-filter: blur(10px);\n          z-index: 6;\n          overflow:hidden;\n        }\n        .hm-anno > summary{\n          list-style:none;\n          cursor:pointer;\n          padding: 10px 12px;\n          font: 12px/1.1 system-ui,-apple-system,\"Segoe UI\",\"Microsoft YaHei\",sans-serif;\n          letter-spacing: .2px;\n          user-select:none;\n        }\n        .hm-anno > summary::-webkit-details-marker{ display:none; }\n        .hm-anno .hm-anno-body{\n          padding: 0 12px 10px 12px;\n          font: 12px/1.45 system-ui,-apple-system,\"Segoe UI\",\"Microsoft YaHei\",sans-serif;\n          color: rgba(226,232,240,0.82);\n        }\n        .hm-anno .hm-anno-body b{\n          color: rgba(226,232,240,0.92);\n          font-weight: 700;\n        }\n      `;\n      document.head.appendChild(style);\n    }\n\n    // 右上角模式徽标（2D/3D）\n    let badge = stage.querySelector(\".hm-badge\");\n    if (!badge) {\n      badge = document.createElement(\"div\");\n      badge.className = \"hm-badge\";\n      stage.appendChild(badge);\n    }\n    badge.textContent = modeText || \"2D\";\n\n    // 左下角可折叠说明（用 <details> 贴合截图“注释（点击隐藏）”）\n    let anno = stage.querySelector(\".hm-anno\");\n    if (!anno) {\n      anno = document.createElement(\"details\");\n      anno.className = \"hm-anno\";\n      anno.open = true;\n      anno.innerHTML = `\n        <summary>注释（点击隐藏）</summary>\n        <div class=\"hm-anno-body\">\n          <div><b>颜色</b>：分值越高越偏粉/近白，越低越偏深紫。</div>\n          <div><b>交互</b>：悬停显示「月份 / 风格 / 分值」。</div>\n          <div><b>视图</b>：右上按钮切换 2D / 3D。</div>\n        </div>\n      `;\n      stage.appendChild(anno);\n    }\n    // ✅ 关键：阻止点击注释框时冒泡到 `.chart-content`（否则会触发 svg-interaction 的“点击打开大图”）\n    try {\n      anno.addEventListener(\"click\", (e) => e.stopPropagation());\n      anno.addEventListener(\"pointerdown\", (e) => e.stopPropagation());\n    } catch (e) {}\n\n    // 容器“卡片内衬”质感（截图是玻璃/霓虹边框）\n    try {\n      container.style.borderRadius = \"14px\";\n      container.style.overflow = \"hidden\";\n      container.style.background = \"rgba(7, 3, 18, 0.18)\";\n      container.style.border = \"1px solid rgba(50, 167, 255, 0.16)\";\n      container.style.boxShadow = \"inset 0 0 0 1px rgba(255,255,255,0.03), 0 0 18px rgba(255,59,212,0.10), 0 0 24px rgba(50,167,255,0.08)\";\n    } catch (e) {\n      // 不影响图表渲染\n    }\n  }\n  //#endregion\n\n  // 等待DOM加载完成\n  const init2DHeatmap = () => {\n    // 使用 heatmap-2d 容器\n    const container = document.getElementById(\"heatmap-2d\") || document.getElementById(\"heatmap\");\n    if (!container) {\n      console.error('❌ 找不到heatmap容器');\n      return;\n    }\n\n    // ✅ 装饰层：模式徽标 + 可折叠注释 + 容器质感\n    // 说明：2D/3D 两个脚本都会注入徽标；这里读取 toggle 当前状态，避免“加载顺序”导致初始徽标显示错。\n    const currentModeText = (document.querySelector('#heatmap-toggle .toggle-text')?.textContent || '2D').trim();\n    ensureHeatmapOverlay(container, currentModeText);\n    \n    // 使用容器的ID进行选择\n    const containerId = container.id;\n    d3.select(`#${containerId}`).selectAll(\"*\").remove();\n    // ⚠️ 不要全局 remove：3D/2D 共享 tooltip，否则会互相删掉导致“tooltip 没了”\n\n    const csvData = `month,classical,electronic,folk,jazz,pop,rock,ACG,rap\n2023-12,35,34,64,47,24,32,37,37\n2024-01,35,33,58,46,23,31,32,36\n2024-02,34,32,62,48,26,33,34,39\n2024-03,35,34,59,48,23,34,37,38\n2024-04,31,34,55,47,21,34,31,36\n2024-05,32,48,57,46,24,34,32,38\n2024-06,32,49,62,48,23,36,31,40\n2024-07,31,38,64,49,25,32,31,38\n2024-08,30,39,62,46,23,32,32,37\n2024-09,32,35,60,45,23,36,33,45\n2024-10,31,32,60,49,23,33,31,46\n2024-11,35,33,58,45,22,32,32,39\n2024-12,35,35,63,48,23,33,37,39\n2025-01,32,34,54,47,22,32,32,38\n2025-02,33,33,58,48,22,31,29,42\n2025-03,33,32,56,48,22,31,31,36\n2025-04,31,33,59,45,22,31,30,36\n2025-05,30,37,58,46,23,32,30,39\n2025-06,29,33,57,46,21,32,31,36\n2025-07,29,36,60,48,21,39,31,38\n2025-08,31,35,59,46,22,34,31,34\n2025-09,30,32,61,46,22,33,30,32\n2025-10,33,33,59,44,21,34,31,36\n2025-11,31,32,57,46,21,33,30,33\n2025-12,33,32,60,45,23,32,33,39\n`;\n\n    const data = d3.csvParse(csvData.trim());\n\n    // ✅ Genre keys（与你原逻辑一致）\n    const genres = [\"ACG\", \"classical\", \"electronic\", \"folk\", \"jazz\", \"pop\", \"rap\", \"rock\"];\n    const months = data.map(d => d[\"month\"]);\n\n    const heatmapData = data.flatMap(row =>\n      genres.map(genre => ({\n        month: row[\"month\"],\n        genre,\n        value: +row[genre]\n      }))\n    );\n\n    // === 自适应尺寸计算 ===\n    const heatmapContainer = container;\n    const containerWidth = heatmapContainer.clientWidth || 900;\n    const containerHeight = heatmapContainer.clientHeight || 320;\n\n    const margin = {\n      top: Math.max(22, containerHeight * 0.10),\n      right: Math.max(18, containerWidth * 0.03),\n      bottom: Math.max(46, containerHeight * 0.18),\n      left: Math.max(64, containerWidth * 0.10)\n    };\n\n    const width = containerWidth - margin.left - margin.right;\n    const height = containerHeight - margin.top - margin.bottom;\n\n    const root = d3.select(`#${containerId}`)\n      .append(\"svg\")\n      .attr(\"width\", \"100%\")\n      .attr(\"height\", \"100%\")\n      .attr(\"viewBox\", `0 0 ${containerWidth} ${containerHeight}`)\n      .attr(\"preserveAspectRatio\", \"xMidYMid meet\");\n\n    // ✅ 背景“卡片内衬”\n    root.append(\"rect\")\n      .attr(\"x\", 10)\n      .attr(\"y\", 10)\n      .attr(\"width\", containerWidth - 20)\n      .attr(\"height\", containerHeight - 20)\n      .attr(\"rx\", 14)\n      .attr(\"ry\", 14)\n      .attr(\"fill\", \"rgba(7, 3, 18, 0.18)\")\n      .attr(\"stroke\", \"rgba(50, 167, 255, 0.16)\");\n\n    const svg = root.append(\"g\")\n      .attr(\"transform\", `translate(${margin.left},${margin.top})`);\n\n    // === Axes ===\n    const x = d3.scaleBand().range([0, width]).domain(months).padding(0.08);\n    const y = d3.scaleBand().range([height, 0]).domain(genres).padding(0.10);\n\n    //#region Heatmap 2D｜坐标轴主题色（与整体赛博主题一致）\n    const css = getComputedStyle(document.documentElement);\n    const axisColor = (css.getPropertyValue(\"--axis-text-strong\") || \"\").trim() || \"rgba(226, 232, 240, 0.88)\";\n    const gridColor = (css.getPropertyValue(\"--axis-grid\") || \"\").trim() || \"rgba(50, 167, 255, 0.12)\";\n\n    //#endregion\n\n    const xAxis = svg.append(\"g\")\n      .attr(\"transform\", `translate(0, ${height})`)\n      .call(d3.axisBottom(x).tickSizeOuter(0));\n\n    if (months.length > 12 || containerWidth < 560) {\n      xAxis.selectAll(\"text\")\n        .attr(\"transform\", \"rotate(-45)\")\n        .style(\"text-anchor\", \"end\")\n        .attr(\"dx\", \"-0.45em\")\n        .attr(\"dy\", \"0.55em\");\n    }\n\n    xAxis.selectAll(\"path, line\").attr(\"stroke\", \"rgba(50, 167, 255, 0.26)\");\n    xAxis.selectAll(\"text\")\n      .attr(\"fill\", axisColor)\n      .style(\"font-size\", \"12px\")\n      .style(\"paint-order\", \"stroke\")\n      .style(\"stroke\", \"rgba(7, 3, 18, 0.72)\")\n      .style(\"stroke-width\", \"2.0px\")\n      .style(\"stroke-linejoin\", \"round\");\n\n    const yAxis = svg.append(\"g\")\n      .call(d3.axisLeft(y).tickSizeOuter(0));\n\n    yAxis.selectAll(\"path, line\").attr(\"stroke\", \"rgba(50, 167, 255, 0.26)\");\n    yAxis.selectAll(\"text\")\n      .attr(\"fill\", axisColor)\n      .style(\"font-size\", \"12px\")\n      .style(\"paint-order\", \"stroke\")\n      .style(\"stroke\", \"rgba(7, 3, 18, 0.72)\")\n      .style(\"stroke-width\", \"2.0px\")\n      .style(\"stroke-linejoin\", \"round\");\n\n    // === ✅ 颜色：赛博霓虹渐变（与 3D 一致） ===\n    const vMin = d3.min(heatmapData, d => d.value);\n    const vMax = d3.max(heatmapData, d => d.value);\n\n    // ✅ 颜色：按截图的霓虹渐变（深紫 → 紫 → 青 → 粉 → 近白）\n    const cyberStops = getCyberStops();\n    const cyberInterpolator = d3.interpolateRgbBasis(cyberStops);\n\n    const colorScale = d3.scaleSequential()\n      .domain([vMin, vMax])\n      .interpolator(cyberInterpolator);\n\n    // === 颜色映射图例（2D/3D 共用容器）===\n    (function updateLegend() {\n      const legend = document.getElementById(\"heatmap-color-legend\");\n      if (!legend) return;\n      const fmt = d3.format(\",d\");\n      legend.innerHTML = `\n        <div class=\"legend-title\">Score → Color</div>\n        <div class=\"legend-bar\" style=\"background: linear-gradient(90deg, ${cyberStops.join(\",\")});\"></div>\n        <div class=\"legend-labels\">\n          <span>${fmt(vMin ?? 0)}</span>\n          <span>${fmt(vMax ?? 0)}</span>\n        </div>\n      `;\n    })();\n\n    // === Tooltip（2D/3D 复用同一个）===\n    let tooltip = d3.select(\"body\").select(\".heatmap-tooltip\");\n    if (tooltip.empty()) {\n      tooltip = d3.select(\"body\").append(\"div\").attr(\"class\", \"heatmap-tooltip\");\n    }\n    tooltip\n      .style(\"position\", \"fixed\")\n      .style(\"pointer-events\", \"none\")\n      .style(\"opacity\", 0)\n      .style(\"padding\", \"10px 12px\")\n      .style(\"border-radius\", \"12px\")\n      .style(\"background\", \"rgba(30,41,59,0.92)\")\n      .style(\"color\", \"#fff\")\n      .style(\"font\", '13px/1.35 system-ui,-apple-system,\"Segoe UI\",\"Microsoft YaHei\",sans-serif')\n      .style(\"box-shadow\", \"0 10px 24px rgba(0,0,0,0.16)\")\n      .style(\"z-index\", 1000);\n\n    // === Heatmap cells（仅保留方块，无任何折线/点/光晕）===\n    svg.selectAll(\"rect.cell\")\n      .data(heatmapData)\n      .enter()\n      .append(\"rect\")\n      .attr(\"class\", \"cell\")\n      // ✅ 重要：把数据写进 DOM 属性，便于 `svg-interaction.js` 复制到新窗口大图后继续可交互\n      .attr(\"data-genre\", d => d.genre)\n      .attr(\"data-month\", d => d.month)\n      .attr(\"data-value\", d => d.value)\n      .attr(\"x\", d => x(d.month))\n      .attr(\"y\", d => y(d.genre))\n      .attr(\"width\", x.bandwidth())\n      .attr(\"height\", y.bandwidth())\n      .attr(\"rx\", 8)\n      .attr(\"ry\", 8)\n      .attr(\"fill\", d => colorScale(d.value))\n      .attr(\"stroke\", gridColor)\n      .attr(\"stroke-width\", 1)\n      .on(\"mousemove\", (event, d) => {\n        tooltip.style(\"opacity\", 1).html(`<b>${d.genre}</b><br/>${d.month}<br/>Value: ${d.value}`);\n        const cx = (event && typeof event.clientX === \"number\") ? event.clientX : (event && typeof event.pageX === \"number\" ? event.pageX : 0);\n        const cy = (event && typeof event.clientY === \"number\") ? event.clientY : (event && typeof event.pageY === \"number\" ? event.pageY : 0);\n        const node = tooltip.node();\n        const w = node ? (node.offsetWidth || 0) : 0;\n        const h = node ? (node.offsetHeight || 0) : 0;\n        const pad = 10;\n        let tx = cx + 12;\n        let ty = cy - 18;\n        tx = Math.max(pad, Math.min(tx, (window.innerWidth || 0) - w - pad));\n        ty = Math.max(pad, Math.min(ty, (window.innerHeight || 0) - h - pad));\n        tooltip.style(\"left\", `${tx}px`).style(\"top\", `${ty}px`);\n      })\n      .on(\"mouseout\", () => tooltip.style(\"opacity\", 0));\n\n    console.log(\"✅ 2D Heatmap rendered (pure heatmap, trend lines removed)\");\n  };\n  \n  // 导出初始化函数，允许外部调用\n  window.init2DHeatmap = init2DHeatmap;\n  \n  // 等待容器有尺寸后再执行（若容器隐藏则使用默认尺寸继续）\n  const waitForContainer = () => {\n    const container = document.getElementById(\"heatmap-2d\") || document.getElementById(\"heatmap\");\n    if (!container) {\n      console.error('❌ 找不到heatmap容器');\n      return;\n    }\n    const width = container.offsetWidth || container.clientWidth;\n    const height = container.offsetHeight || container.clientHeight;\n    if (width > 0 && height > 0) {\n      init2DHeatmap();\n    } else if (container.style.display === 'none') {\n      console.log('⚠️ 容器被隐藏，使用默认尺寸继续');\n      init2DHeatmap();\n    } else {\n      setTimeout(waitForContainer, 100);\n    }\n  };\n  \n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n      setTimeout(waitForContainer, 100);\n    });\n  } else {\n    setTimeout(waitForContainer, 100);\n  }\n})();\n"]}