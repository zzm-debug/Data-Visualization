{"version":3,"sources":["script.js"],"names":["document","getElementById","d3","select","size","console","log","selectAll","remove","mapContainer","error","width","clientWidth","height","clientHeight","concat","svg","append","attr","scale","Math","min","projection","geoNaturalEarth1","translate","path","geoPath","colorScale","scaleOrdinal","domain","range","tooltip","empty","style","ALIASES","Map","normalize","name","trimmed","trim","get","loadTopoJSON","topojson","Promise","resolve","cdnUrls","tryLoad","index","length","reject","Error","url","script","createElement","src","async","onload","warn","head","removeChild","then","catch","onerror","appendChild","loadCSV","csvText","data","csvParse","all","json","_ref","_ref2","_slicedToArray","world","html","Object","keys","cleanFieldName","replace","countries","feature","objects","features","genreByCountry","validRowCount","forEach","d","countryKey","find","key","toLowerCase","genreKey","valueKey","countryValue","genreValue","valueValue","normalizedCountry","String","genre","value","enter","properties","on","event","pageX","pageY","legend","err"],"mappings":"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","file":"script.b2fdc3bd.js","sourceRoot":"..\\src","sourcesContent":["// ========== D3 åœ°å›¾ç»˜åˆ¶è„šæœ¬ï¼ˆè‡ªé€‚åº”ç‰ˆæœ¬ï¼‰ ==========\n// ä½¿ç”¨ç«‹å³æ‰§è¡Œå‡½æ•°é˜²æ­¢é‡å¤æ‰§è¡Œ\n(() => {\n  // é˜²æ­¢é‡å¤æ‰§è¡Œï¼šå¦‚æœå·²ç»åˆ›å»ºè¿‡åœ°å›¾ï¼Œç›´æ¥è¿”å›\n  if (document.getElementById('map') && d3.select(\"#map svg\").size() > 0) {\n    console.log(\"âš ï¸ åœ°å›¾å·²å­˜åœ¨ï¼Œè·³è¿‡é‡å¤åˆ›å»º\");\n    return;\n  }\n\n  // æ¸…ç©ºå®¹å™¨ï¼Œé˜²æ­¢é‡å¤åˆ›å»º\n  d3.select(\"#map\").selectAll(\"*\").remove();\n\n  // è·å–å®¹å™¨å®é™…å°ºå¯¸\n  const mapContainer = document.getElementById('map');\n  if (!mapContainer) {\n    console.error('âŒ æ‰¾ä¸åˆ°åœ°å›¾å®¹å™¨');\n    return;\n  }\n\n  const width = mapContainer.clientWidth || 400;\n  const height = mapContainer.clientHeight || 300;\n\n  console.log(`ğŸ“ åœ°å›¾å®¹å™¨å°ºå¯¸: ${width} x ${height}`);\n\n  const svg = d3\n    .select(\"#map\")\n    .append(\"svg\")\n    .attr(\"width\", \"100%\")\n    .attr(\"height\", \"100%\")\n    .attr(\"viewBox\", `0 0 ${width} ${height}`)\n    .attr(\"preserveAspectRatio\", \"xMidYMid meet\");\n\n  // æ ¹æ®å®¹å™¨å°ºå¯¸åŠ¨æ€è®¡ç®—æŠ•å½±å‚æ•°\n  const scale = Math.min(width / 5.5, height / 2.8);\n\nconst projection = d3.geoNaturalEarth1()\n  .scale(scale)\n  .translate([width / 2, height / 2]);\n\nconst path = d3.geoPath().projection(projection);\n\n// ğŸ¨ é¢œè‰²æ˜ å°„è¡¨ï¼ˆæ ¹æ®éŸ³ä¹ç±»å‹ï¼‰\n// ğŸ¨ é¢œè‰²æ˜ å°„è¡¨ï¼ˆæ›´æŸ”å’Œçš„è«å…°è¿ªé…è‰²ï¼Œé€‚é…å¥¶æ²¹ç™½èƒŒæ™¯ï¼‰\nconst colorScale = d3.scaleOrdinal()\n  .domain([\n    \"ACG\", \"pop music\", \"rock music\", \"classical music\",\n    \"electronic music\", \"folk music\", \"jazz music\", \"rap music\"\n  ])\n  .range([\n    \"#A79AD9\", // ACGï½œæ›´æ˜äº®çš„æŸ”ç´«\n    \"#E1C3A1\", // popï½œæµ…æå¥¶æ²¹ï¼ˆæ›´æ´»æ³¼ï¼‰\n    \"#9FBEA9\", // rockï½œæ¸…æ–°é¼ å°¾è‰ç»¿\n    \"#C9B1DE\", // classicalï½œæµ…è–°è¡£è‰\n    \"#A7B8E2\", // electronicï½œæ™´ç©ºé›¾è“\n    \"#B5A08C\", // folkï½œæš–ç ‚è‰²\n    \"#E0A9B8\", // jazzï½œæŸ”å’Œç«ç‘°ç²‰\n    \"#AEB4BE\"  // rapï½œæµ…ä¸­æ€§ç°è“\n  ]);\n\n\n\n\n// ğŸ§­ æç¤ºæ¡†ï¼ˆä¸æ°”æ³¡å›¾tooltipä¿æŒä¸€è‡´ï¼‰\nlet tooltip = d3.select(\"body\").select(\".map-tooltip\");\nif (tooltip.empty()) {\n  tooltip = d3.select(\"body\").append(\"div\")\n    .attr(\"class\", \"map-tooltip\")\n    .style(\"position\", \"absolute\")\n    .style(\"pointer-events\", \"none\")\n    .style(\"padding\", \"12px 14px\")\n    .style(\"border-radius\", \"12px\")\n    .style(\"background\", \"rgba(30, 41, 59, 0.90)\")\n    .style(\"color\", \"#fff\")\n    .style(\"font\", \"13px/1.4 system-ui, -apple-system, Segoe UI, Microsoft YaHei, sans-serif\")\n    .style(\"opacity\", 0)\n    .style(\"backdrop-filter\", \"blur(6px)\")\n    .style(\"z-index\", 1000);\n}\n\n// â€”â€” å›½å®¶åç§°å½’ä¸€åŒ–ï¼ˆä¸¤ä¾§åŒæ—¶å½’ä¸€åŒ–ï¼Œæå‡åŒ¹é…ç‡ï¼‰\nconst ALIASES = new Map([\n  [\"United States of America\", \"United States\"],\n  [\"Russian Federation\", \"Russia\"],\n  [\"Czech Republic\", \"Czechia\"],\n  [\"CÃ´te d'Ivoire\", \"CÃ´te d'Ivoire\"],\n  [\"Congo, Democratic Republic of the\", \"Congo - Kinshasa\"],\n  [\"Democratic Republic of the Congo\", \"Congo - Kinshasa\"],\n  [\"Congo, Republic of the\", \"Congo - Brazzaville\"],\n  [\"Republic of the Congo\", \"Congo - Brazzaville\"],\n  [\"Korea, Republic of\", \"South Korea\"],\n  [\"Korea, Democratic People's Republic of\", \"North Korea\"],\n  [\"Syrian Arab Republic\", \"Syria\"],\n  [\"Lao People's Democratic Republic\", \"Laos\"],\n  [\"Viet Nam\", \"Vietnam\"],\n  [\"Eswatini\", \"Eswatini\"],\n  [\"Swaziland\", \"Eswatini\"],\n  [\"Cabo Verde\", \"Cape Verde\"],\n  [\"Myanmar\", \"Myanmar (Burma)\"],\n  [\"Macedonia\", \"North Macedonia\"],\n  [\"Taiwan, Province of China\", \"Taiwan\"]\n]);\n\nconst normalize = (name) => {\n  if (!name) return name;\n  const trimmed = name.trim();\n  return ALIASES.get(trimmed) || trimmed;\n};\n\n// ğŸ“¦ åŠ¨æ€åŠ è½½ TopoJSON åº“ï¼ˆæ”¯æŒå¤šä¸ªå¤‡é€‰ CDNï¼‰\nfunction loadTopoJSON() {\n  if (typeof topojson !== \"undefined\") {\n    return Promise.resolve();\n  }\n\n  console.log(\"ğŸ”„ å¼€å§‹åŠ è½½ TopoJSON åº“...\");\n  \n  const cdnUrls = [\n    \"https://unpkg.com/topojson@3\",\n    \"https://cdn.jsdelivr.net/npm/topojson@3\",\n    \"https://cdnjs.cloudflare.com/ajax/libs/topojson/3.0.2/topojson.min.js\",\n    \"https://fastly.jsdelivr.net/npm/topojson@3\"\n  ];\n\n  function tryLoad(index) {\n    if (index >= cdnUrls.length) {\n      return Promise.reject(new Error(\"æ‰€æœ‰ CDN éƒ½åŠ è½½å¤±è´¥\"));\n    }\n\n    const url = cdnUrls[index];\n    console.log(`ğŸ“¡ å°è¯•ä» CDN ${index + 1}/${cdnUrls.length} åŠ è½½: ${url}`);\n\n    return new Promise((resolve, reject) => {\n      const script = document.createElement(\"script\");\n      script.src = url;\n      script.async = true;\n      \n      script.onload = () => {\n        if (typeof topojson !== \"undefined\") {\n          console.log(`âœ… TopoJSON åŠ è½½æˆåŠŸï¼ˆæ¥æº: ${url}ï¼‰`);\n          resolve();\n        } else {\n          console.warn(`âš ï¸ è„šæœ¬åŠ è½½ä½† topojson æœªå®šä¹‰ï¼Œå°è¯•ä¸‹ä¸€ä¸ª CDN...`);\n          document.head.removeChild(script);\n          tryLoad(index + 1).then(resolve).catch(reject);\n        }\n      };\n      \n      script.onerror = () => {\n        console.warn(`âš ï¸ CDN ${index + 1} åŠ è½½å¤±è´¥ï¼Œå°è¯•ä¸‹ä¸€ä¸ª...`);\n        document.head.removeChild(script);\n        tryLoad(index + 1).then(resolve).catch(reject);\n      };\n      \n      document.head.appendChild(script);\n    });\n  }\n\n  return tryLoad(0);\n}\n\n// ğŸ“¥ åŠ è½½ CSV æ–‡ä»¶ï¼ˆä½¿ç”¨å†…è”æ•°æ®ï¼‰\nfunction loadCSV() {\n  console.log(\"ğŸ“‚ å¼€å§‹åŠ è½½ CSV æ•°æ®...\");\n  \n  const csvText = `country,top_genre,top_value\nAfghanistan,pop music,94\nAlbania,pop music,40\nAlgeria,pop music,43\nAmerican Samoa,ACG,0\nAndorra,ACG,100\nAngola,rap music,51\nAnguilla,ACG,0\nAntarctica,electronic music,100\nAntigua & Barbuda,rock music,100\nArgentina,rock music,51\nArmenia,rock music,47\nAruba,rock music,100\nAustralia,rock music,47\nAustria,rock music,49\nAzerbaijan,rock music,40\nBahamas,rock music,53\nBahrain,rock music,43\nBangladesh,folk music,57\nBarbados,classical music,100\nBelarus,ACG,63\nBelgium,rock music,48\nBelize,rock music,100\nBenin,jazz music,100\nBermuda,ACG,0\nBhutan,ACG,0\nBolivia,rock music,45\nBosnia & Herzegovina,rock music,52\nBotswana,jazz music,63\nBouvet Island,ACG,0\nBrazil,rock music,54\nBritish Indian Ocean Territory,ACG,0\nBritish Virgin Islands,ACG,0\nBrunei,rock music,55\nBulgaria,rock music,47\nBurkina Faso,rap music,100\nBurundi,ACG,0\nCambodia,pop music,47\nCameroon,rap music,48\nCanada,rock music,48\nCape Verde,ACG,0\nCaribbean Netherlands,ACG,0\nCayman Islands,ACG,100\nCentral African Republic,pop music,100\nChad,ACG,0\nChile,ACG,57\nChina,ACG,81\nChristmas Island,ACG,0\nCocos (Keeling) Islands,ACG,0\nColombia,rock music,46\nComoros,ACG,0\nCongo - Brazzaville,rap music,53\nCongo - Kinshasa,jazz music,97\nCook Islands,ACG,0\nCosta Rica,rock music,52\nCroatia,rock music,50\nCuba,jazz music,94\nCuraÃ§ao,ACG,0\nCyprus,pop music,54\nCzechia,rock music,52\nCÃ´te d'Ivoire,rap music,71\nDenmark,rock music,44\nDjibouti,ACG,0\nDominica,ACG,0\nDominican Republic,rock music,44\nEcuador,rock music,44\nEgypt,pop music,44\nEl Salvador,electronic music,41\nEquatorial Guinea,ACG,0\nEritrea,ACG,0\nEstonia,rock music,43\nEswatini,jazz music,54\nEthiopia,classical music,90\nFalkland Islands (Islas Malvinas),ACG,0\nFaroe Islands,ACG,0\nFiji,classical music,100\nFinland,rock music,44\nFrance,ACG,47\nFrench Guiana,ACG,0\nFrench Polynesia,ACG,0\nFrench Southern Territories,ACG,0\nGabon,classical music,100\nGambia,ACG,0\nGeorgia,rock music,47\nGermany,rock music,46\nGhana,pop music,57\nGibraltar,ACG,0\nGreece,ACG,64\nGreenland,electronic music,100\nGrenada,ACG,0\nGuadeloupe,ACG,0\nGuam,classical music,100\nGuatemala,pop music,40\nGuernsey,pop music,100\nGuinea,rap music,100\nGuinea-Bissau,ACG,0\nGuyana,classical music,100\nHaiti,jazz music,100\nHeard & McDonald Islands,ACG,0\nHonduras,rock music,49\nHong Kong,ACG,72\nHungary,rock music,54\nIceland,rock music,59\nIndia,classical music,45\nIndonesia,ACG,60\nIran,rock music,38\nIraq,pop music,42\nIreland,pop music,45\nIsle of Man,classical music,100\nIsrael,ACG,52\nItaly,rock music,50\nJamaica,rock music,43\nJapan,ACG,76\nJersey,classical music,68\nJordan,rock music,44\nKazakhstan,ACG,49\nKenya,pop music,47\nKiribati,ACG,0\nKosovo,rock music,50\nKuwait,rock music,38\nKyrgyzstan,pop music,66\nLaos,pop music,73\nLatvia,rock music,49\nLebanon,pop music,46\nLesotho,jazz music,100\nLiberia,rap music,100\nLibya,rap music,95\nLiechtenstein,ACG,0\nLithuania,rock music,48\nLuxembourg,rock music,48\nMacao,ACG,80\nMadagascar,jazz music,65\nMalawi,pop music,62\nMalaysia,ACG,47\nMaldives,pop music,54\nMali,ACG,100\nMalta,rock music,64\nMarshall Islands,ACG,0\nMartinique,ACG,0\nMauritania,ACG,0\nMauritius,rock music,50\nMayotte,ACG,0\nMexico,rock music,46\nMicronesia,ACG,0\nMoldova,rock music,49\nMonaco,ACG,0\nMongolia,rock music,45\nMontenegro,classical music,54\nMontserrat,ACG,0\nMorocco,rap music,42\nMozambique,jazz music,100\nMyanmar (Burma),pop music,44\nNamibia,classical music,59\nNauru,ACG,0\nNepal,classical music,37\nNetherlands,rock music,44\nNew Caledonia,rock music,100\nNew Zealand,ACG,56\nNicaragua,rock music,56\nNiger,jazz music,100\nNigeria,pop music,44\nNiue,ACG,0\nNorfolk Island,ACG,0\nNorth Korea,ACG,0\nNorth Macedonia,rock music,46\nNorthern Mariana Islands,ACG,0\nNorway,rock music,48\nOman,rock music,52\nPakistan,pop music,49\nPalau,ACG,0\nPalestine,rock music,64\nPanama,rock music,59\nPapua New Guinea,rock music,47\nParaguay,rock music,57\nPeru,rock music,46\nPhilippines,pop music,47\nPitcairn Islands,ACG,0\nPoland,rock music,49\nPortugal,rock music,48\nPuerto Rico,rock music,48\nQatar,rock music,40\nRomania,rock music,47\nRussia,ACG,57\nRwanda,pop music,45\nRÃ©union,classical music,100\nSamoa,ACG,0\nSan Marino,ACG,0\nSaudi Arabia,rock music,39\nSenegal,rap music,54\nSerbia,rock music,50\nSeychelles,ACG,0\nSierra Leone,rock music,54\nSingapore,pop music,53\nSint Maarten,ACG,0\nSlovakia,rock music,47\nSlovenia,rock music,47\nSolomon Islands,ACG,0\nSomalia,ACG,0\nSouth Africa,pop music,42\nSouth Georgia & South Sandwich Islands,ACG,0\nSouth Korea,ACG,56\nSouth Sudan,classical music,100\nSpain,rock music,48\nSri Lanka,rap music,41\nSt. BarthÃ©lemy,ACG,0\nSt. Helena,rock music,44\nSt. Kitts & Nevis,ACG,0\nSt. Lucia,folk music,100\nSt. Martin,ACG,0\nSt. Pierre & Miquelon,ACG,0\nSt. Vincent & Grenadines,ACG,0\nSudan,ACG,0\nSuriname,jazz music,100\nSvalbard & Jan Mayen,ACG,0\nSweden,rock music,49\nSwitzerland,rock music,43\nSyria,pop music,61\nSÃ£o TomÃ© & PrÃ­ncipe,ACG,0\nTaiwan,ACG,78\nTajikistan,pop music,100\nTanzania,pop music,48\nThailand,pop music,45\nTimor-Leste,ACG,0\nTogo,rap music,100\nTokelau,ACG,0\nTonga,ACG,0\nTrinidad & Tobago,rock music,46\nTunisia,rap music,41\nTurkmenistan,pop music,59\nTurks & Caicos Islands,ACG,0\nTuvalu,ACG,0\nTÃ¼rkiye,rock music,41\nU.S. Outlying Islands,ACG,0\nU.S. Virgin Islands,ACG,0\nUganda,pop music,49\nUkraine,ACG,72\nUnited Arab Emirates,rock music,42\nUnited Kingdom,rock music,47\nUnited States,rock music,49\nUruguay,ACG,74\nUzbekistan,pop music,51\nVanuatu,ACG,0\nVatican City,ACG,0\nVenezuela,pop music,44\nVietnam,pop music,48\nWallis & Futuna,ACG,0\nWestern Sahara,electronic music,100\nYemen,ACG,0\nZambia,pop music,57\nZimbabwe,pop music,43\nÃ…land Islands,rock music,100`;\n\n  const data = d3.csvParse(csvText);\n  console.log(`âœ… CSV æ•°æ®åŠ è½½æˆåŠŸï¼è§£æäº† ${data.length} è¡Œæ•°æ®`);\n  return Promise.resolve(data);\n}\n\n// ğŸ—ºï¸ åŠ è½½åœ°å›¾ä¸æ•°æ®\nconsole.log(\"ğŸ”„ å¼€å§‹åŠ è½½åœ°å›¾æ•°æ®...\");\n\nloadTopoJSON().then(() => {\n  return Promise.all([\n    d3.json(\"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json\"),\n    loadCSV()\n  ]);\n}).then(([world, data]) => {\n  if (typeof topojson === \"undefined\") {\n    console.error(\"âŒ TopoJSON åŠ è½½å¤±è´¥ï¼Œæ— æ³•ç»§ç»­ç»˜åˆ¶åœ°å›¾\");\n    const mapContainer = d3.select(\"#map\");\n    if (!mapContainer.empty()) {\n      mapContainer.append(\"div\")\n        .style(\"padding\", \"20px\")\n        .style(\"text-align\", \"center\")\n        .style(\"color\", \"#d62728\")\n        .html(\"<h3>âŒ TopoJSON åº“åŠ è½½å¤±è´¥</h3><p>è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ä½¿ç”¨æœ¬åœ° TopoJSON æ–‡ä»¶</p>\");\n    }\n    return;\n  }\n\n  console.log(\"âœ… ä¸–ç•Œåœ°å›¾æ•°æ®åŠ è½½æˆåŠŸ\");\n  console.log(\"âœ… CSV æ•°æ®åŠ è½½æˆåŠŸï¼ŒåŸå§‹è¡Œæ•°ï¼š\", data.length);\n\n  if (data.length === 0) {\n    console.error(\"âŒ CSV æ–‡ä»¶ä¸ºç©ºæˆ–æ ¼å¼ä¸æ­£ç¡®\");\n    return;\n  }\n\n  console.log(\"ğŸ” CSV æ•°æ®è°ƒè¯•ä¿¡æ¯ï¼š\");\n  if (data.length > 0) {\n    console.log(\"   ç¬¬ä¸€è¡Œæ•°æ®ï¼š\", data[0]);\n    console.log(\"   ç¬¬ä¸€è¡Œçš„æ‰€æœ‰é”®åï¼š\", Object.keys(data[0]));\n  }\n\n  const cleanFieldName = (name) => {\n    if (!name) return name;\n    return name.replace(/^\\uFEFF/, '').trim();\n  };\n\n  const countries = topojson.feature(world, world.objects.countries).features;\n  console.log(\"âœ… å›½å®¶æ•°é‡ï¼ˆåœ°å›¾ï¼‰ï¼š\", countries.length);\n\n  const genreByCountry = {};\n  let validRowCount = 0;\n  \n  data.forEach((d, index) => {\n    const countryKey = Object.keys(d).find(key => \n      cleanFieldName(key).toLowerCase() === 'country'\n    ) || 'country';\n    \n    const genreKey = Object.keys(d).find(key => \n      cleanFieldName(key).toLowerCase() === 'top_genre'\n    ) || 'top_genre';\n\n    const valueKey = Object.keys(d).find(key => \n      cleanFieldName(key).toLowerCase() === 'top_value'\n    ) || 'top_value';\n\n    const countryValue = d[countryKey];\n    const genreValue = d[genreKey];\n    const valueValue = d[valueKey];\n\n    if (countryValue && genreValue) {\n      const normalizedCountry = normalize(String(countryValue).trim());\n      const genre = String(genreValue).trim();\n      const value = valueValue ? String(valueValue).trim() : \"0\";\n      if (normalizedCountry && genre) {\n        genreByCountry[normalizedCountry] = {\n          genre: genre,\n          value: value\n        };\n        validRowCount++;\n      }\n    }\n  });\n\n  console.log(\"âœ… æœ‰æ•ˆæ•°æ®è¡Œæ•°ï¼š\", validRowCount);\n  console.log(\"âœ… ä» CSV å»ºç«‹çš„å›½å®¶æ˜ å°„æ•°é‡ï¼š\", Object.keys(genreByCountry).length);\n\n  // ç»˜åˆ¶åœ°å›¾\n  svg.selectAll(\"path\")\n    .data(countries)\n    .enter()\n    .append(\"path\")\n    .attr(\"d\", path)\n    .attr(\"class\", \"country\")\n    .attr(\"fill\", d => {\n      const name = normalize(d.properties.name);\n      const data = genreByCountry[name];\n      return data ? colorScale(data.genre) : \"#ccc\";\n    })\n    .on(\"mouseenter\", (event, d) => {\n      const name = normalize(d.properties.name);\n      const data = genreByCountry[name];\n      if (data) {\n        tooltip\n          .style(\"opacity\", 1)\n          .html(`\n            <div style=\"font-weight:800;margin-bottom:6px;letter-spacing:.3px\">${name}</div>\n            <div style=\"opacity:.92\">ğŸµ ${data.genre}</div>\n            <div style=\"opacity:.92;margin-top:6px\">ğŸ“Š åˆ†æ•°: ${data.value}</div>\n          `);\n      } else {\n        tooltip\n          .style(\"opacity\", 1)\n          .html(`\n            <div style=\"font-weight:800;margin-bottom:6px;letter-spacing:.3px\">${name}</div>\n            <div style=\"opacity:.92\">æš‚æ— æ•°æ®</div>\n          `);\n      }\n    })\n    .on(\"mousemove\", (event) => {\n      tooltip\n        .style(\"left\", (event.pageX + 14) + \"px\")\n        .style(\"top\", (event.pageY + 14) + \"px\");\n    })\n    .on(\"mouseleave\", () => {\n      tooltip.style(\"opacity\", 0);\n    });\n\n  console.log(\"âœ… åœ°å›¾ç»˜åˆ¶å®Œæˆ\");\n\n  // å›¾ä¾‹\n  const legend = d3.select(\"#legend\");\n  if (!legend.empty()) {\n    colorScale.domain().forEach(genre => {\n      legend.append(\"div\")\n        .attr(\"class\", \"legend-item\")\n        .html(`<span class=\"legend-color\" style=\"background:${colorScale(genre)}\"></span>${genre}`);\n    });\n    console.log(\"âœ… å›¾ä¾‹åˆ›å»ºå®Œæˆ\");\n  }\n}).catch(err => {\n    console.error(\"âŒ èµ„æºåŠ è½½å¤±è´¥ï¼š\", err);\n    const mapContainer = d3.select(\"#map\");\n    if (!mapContainer.empty()) {\n      mapContainer.selectAll(\"*\").remove();\n      mapContainer.append(\"div\")\n        .style(\"padding\", \"20px\")\n        .style(\"text-align\", \"center\")\n        .style(\"color\", \"#d62728\")\n        .html(\"<h3>âŒ æ•°æ®åŠ è½½å¤±è´¥</h3><p>è¯·æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯</p>\");\n    }\n  });\n})(); // ç«‹å³æ‰§è¡Œå‡½æ•°ç»“æŸ"]}