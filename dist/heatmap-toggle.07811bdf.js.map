{"version":3,"sources":["heatmap-toggle.js"],"names":["e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","return","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","m","defineProperty","_regeneratorDefine","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","currentMode","heatmap2DScript","heatmap3DScript","toggleBtn","document","getElementById","console","error","updateButtonText","toggleText","querySelector","textContent","clearHeatmap","container","innerHTML","d3","select","selectAll","remove","removeDynamicScripts","dynamic2D","parentNode","removeChild","dynamic3D","original3D","load2DHeatmap","reject","Error","basePath","existingScript","src","scriptPath","lastSlash","lastIndexOf","substring","log","toggleScript","timestamp","Date","getTime","script","createElement","concat","id","async","resolved","timeout","setTimeout","onload","window","init2DHeatmap","checkCount","maxChecks","checkRender","svg","children","clearTimeout","warn","onerror","head","appendChild","load3DHeatmap","toggleMode","_toggleMode","_callee","originalText","targetMode","_t","_t2","_context","disabled","style","opacity","alert","addEventListener","existing3DScript"],"mappings":"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","file":"heatmap-toggle.07811bdf.js","sourceRoot":"..\\src","sourcesContent":["// ============================================\r\n// heatmap-toggle.js - 2D/3Dçƒ­åŠ›å›¾åˆ‡æ¢æ§åˆ¶å™¨\r\n// ============================================\r\n\r\n(() => {\r\n  let currentMode = '3D'; // é»˜è®¤3Dæ¨¡å¼\r\n  let heatmap2DScript = null;\r\n  let heatmap3DScript = null;\r\n  \r\n  // åˆ‡æ¢æŒ‰é’®\r\n  const toggleBtn = document.getElementById('heatmap-toggle');\r\n  if (!toggleBtn) {\r\n    console.error('âŒ æ‰¾ä¸åˆ°åˆ‡æ¢æŒ‰é’®');\r\n    return;\r\n  }\r\n  \r\n  // æ›´æ–°æŒ‰é’®æ–‡æœ¬\r\n  function updateButtonText() {\r\n    const toggleText = toggleBtn.querySelector('.toggle-text');\r\n    if (toggleText) {\r\n      toggleText.textContent = currentMode;\r\n    }\r\n  }\r\n  \r\n  // æ¸…é™¤çƒ­åŠ›å›¾å®¹å™¨\r\n  function clearHeatmap() {\r\n    const container = document.getElementById('heatmap');\r\n    if (container) {\r\n      container.innerHTML = '';\r\n    }\r\n    // æ¸…é™¤tooltip\r\n    d3.select(\"body\").selectAll(\".heatmap-tooltip\").remove();\r\n  }\r\n  \r\n  // ç§»é™¤åŠ¨æ€åŠ è½½çš„è„šæœ¬\r\n  function removeDynamicScripts() {\r\n    const dynamic2D = document.getElementById('heatmap-2d-script');\r\n    if (dynamic2D && dynamic2D.parentNode) {\r\n      dynamic2D.parentNode.removeChild(dynamic2D);\r\n      heatmap2DScript = null;\r\n    }\r\n    const dynamic3D = document.getElementById('heatmap-3d-script');\r\n    // åªæœ‰å½“3Dè„šæœ¬æ˜¯åŠ¨æ€åŠ è½½çš„æ—¶æ‰ç§»é™¤ï¼ˆä¸æ˜¯HTMLä¸­åŸå§‹åŠ è½½çš„ï¼‰\r\n    if (dynamic3D && dynamic3D.parentNode) {\r\n      const original3D = document.querySelector('script[src*=\"heatmap.js\"]:not([src*=\"heatmap-2D\"]):not([id])');\r\n      if (dynamic3D !== original3D) {\r\n        dynamic3D.parentNode.removeChild(dynamic3D);\r\n        heatmap3DScript = null;\r\n      }\r\n    }\r\n  }\r\n  \r\n  // åŠ è½½2Dçƒ­åŠ›å›¾\r\n  function load2DHeatmap() {\r\n    return new Promise((resolve, reject) => {\r\n      // æ£€æŸ¥å®¹å™¨æ˜¯å¦å­˜åœ¨\r\n      const container = document.getElementById('heatmap');\r\n      if (!container) {\r\n        console.error('âŒ æ‰¾ä¸åˆ°heatmapå®¹å™¨');\r\n        reject(new Error('æ‰¾ä¸åˆ°heatmapå®¹å™¨'));\r\n        return;\r\n      }\r\n      \r\n      // å…ˆæ¸…é™¤å†…å®¹\r\n      clearHeatmap();\r\n      removeDynamicScripts();\r\n      \r\n      // ä»å·²åŠ è½½çš„heatmap.jsè„šæœ¬è·å–æ­£ç¡®è·¯å¾„\r\n      let basePath = '';\r\n      const existingScript = document.querySelector('script[src*=\"heatmap.js\"]:not([src*=\"heatmap-2D\"]):not([id*=\"heatmap-3d\"])');\r\n      if (existingScript && existingScript.src) {\r\n        const scriptPath = existingScript.src;\r\n        const lastSlash = scriptPath.lastIndexOf('/');\r\n        basePath = scriptPath.substring(0, lastSlash + 1);\r\n        console.log('ğŸ“‚ ä»å·²åŠ è½½è„šæœ¬è·å–è·¯å¾„:', basePath, 'æ¥æº:', scriptPath);\r\n      } else {\r\n        // å¦‚æœæ‰¾ä¸åˆ°ï¼Œä»toggleè„šæœ¬è·å–\r\n        const toggleScript = document.querySelector('script[src*=\"heatmap-toggle\"]');\r\n        if (toggleScript && toggleScript.src) {\r\n          const scriptPath = toggleScript.src;\r\n          const lastSlash = scriptPath.lastIndexOf('/');\r\n          basePath = scriptPath.substring(0, lastSlash + 1);\r\n          console.log('ğŸ“‚ ä»toggleè„šæœ¬è·å–è·¯å¾„:', basePath);\r\n        } else {\r\n          basePath = '';\r\n          console.log('ğŸ“‚ ä½¿ç”¨ç›¸å¯¹è·¯å¾„');\r\n        }\r\n      }\r\n      \r\n      const timestamp = new Date().getTime();\r\n      const script = document.createElement('script');\r\n      script.src = `${basePath}heatmap-2D.js?t=${timestamp}`;\r\n      script.id = 'heatmap-2d-script';\r\n      script.async = false; // ç¡®ä¿é¡ºåºæ‰§è¡Œ\r\n      \r\n      console.log('ğŸ“‚ åŠ è½½2Dçƒ­åŠ›å›¾è„šæœ¬ï¼Œå®Œæ•´è·¯å¾„:', script.src);\r\n      \r\n      let resolved = false;\r\n      const timeout = setTimeout(() => {\r\n        if (!resolved) {\r\n          resolved = true;\r\n          console.error('âŒ 2Dçƒ­åŠ›å›¾åŠ è½½è¶…æ—¶');\r\n          if (script.parentNode) {\r\n            script.parentNode.removeChild(script);\r\n          }\r\n          reject(new Error('2Dçƒ­åŠ›å›¾åŠ è½½è¶…æ—¶'));\r\n        }\r\n      }, 10000); // 10ç§’è¶…æ—¶\r\n      \r\n      script.onload = () => {\r\n        if (resolved) return;\r\n        console.log('âœ… 2Dçƒ­åŠ›å›¾è„šæœ¬åŠ è½½æˆåŠŸ');\r\n        heatmap2DScript = script;\r\n        \r\n        // ç­‰å¾…ä¸€å°æ®µæ—¶é—´è®©è„šæœ¬æ‰§è¡Œ\r\n        setTimeout(() => {\r\n          // å¦‚æœè„šæœ¬å¯¼å‡ºäº†åˆå§‹åŒ–å‡½æ•°ï¼Œç›´æ¥è°ƒç”¨\r\n          if (typeof window.init2DHeatmap === 'function') {\r\n            console.log('ğŸ”„ è°ƒç”¨2Dçƒ­åŠ›å›¾åˆå§‹åŒ–å‡½æ•°');\r\n            try {\r\n              window.init2DHeatmap();\r\n            } catch (error) {\r\n              console.error('âŒ è°ƒç”¨2Dçƒ­åŠ›å›¾åˆå§‹åŒ–å‡½æ•°å¤±è´¥:', error);\r\n            }\r\n          }\r\n          \r\n          // ç­‰å¾…æ¸²æŸ“å®Œæˆ\r\n          let checkCount = 0;\r\n          const maxChecks = 30; // æœ€å¤šæ£€æŸ¥30æ¬¡ï¼Œæ¯æ¬¡200msï¼Œæ€»å…±6ç§’\r\n          \r\n          const checkRender = () => {\r\n            const svg = container.querySelector('svg');\r\n            if (svg && svg.children.length > 0) {\r\n              if (!resolved) {\r\n                resolved = true;\r\n                clearTimeout(timeout);\r\n                console.log('âœ… 2Dçƒ­åŠ›å›¾æ¸²æŸ“æˆåŠŸ');\r\n                resolve();\r\n              }\r\n            } else if (checkCount < maxChecks) {\r\n              checkCount++;\r\n              setTimeout(checkRender, 200);\r\n            } else {\r\n              if (!resolved) {\r\n                resolved = true;\r\n                clearTimeout(timeout);\r\n                console.warn('âš ï¸ 2Dçƒ­åŠ›å›¾æ¸²æŸ“è¶…æ—¶ï¼Œä½†è„šæœ¬å·²åŠ è½½');\r\n                // å³ä½¿æ²¡æœ‰SVGï¼Œä¹Ÿresolveï¼Œå¯èƒ½æ¸²æŸ“éœ€è¦æ›´å¤šæ—¶é—´\r\n                resolve();\r\n              }\r\n            }\r\n          };\r\n          \r\n          setTimeout(checkRender, 100);\r\n        }, 100);\r\n      };\r\n      \r\n      script.onerror = (error) => {\r\n        if (resolved) return;\r\n        resolved = true;\r\n        clearTimeout(timeout);\r\n        console.error('âŒ 2Dçƒ­åŠ›å›¾è„šæœ¬åŠ è½½å¤±è´¥:', error);\r\n        console.error('è„šæœ¬è·¯å¾„:', script.src);\r\n        if (script.parentNode) {\r\n          script.parentNode.removeChild(script);\r\n        }\r\n        reject(new Error(`2Dçƒ­åŠ›å›¾è„šæœ¬åŠ è½½å¤±è´¥: ${script.src}`));\r\n      };\r\n      \r\n      document.head.appendChild(script);\r\n    });\r\n  }\r\n  \r\n  // åŠ è½½3Dçƒ­åŠ›å›¾\r\n  function load3DHeatmap() {\r\n    return new Promise((resolve, reject) => {\r\n      const container = document.getElementById('heatmap');\r\n      if (!container) {\r\n        console.error('âŒ æ‰¾ä¸åˆ°heatmapå®¹å™¨');\r\n        reject(new Error('æ‰¾ä¸åˆ°heatmapå®¹å™¨'));\r\n        return;\r\n      }\r\n      \r\n      // å…ˆæ¸…é™¤å†…å®¹\r\n      clearHeatmap();\r\n      removeDynamicScripts();\r\n      \r\n      // ä»å·²åŠ è½½çš„heatmap.jsè„šæœ¬è·å–æ­£ç¡®è·¯å¾„\r\n      let basePath = '';\r\n      const existingScript = document.querySelector('script[src*=\"heatmap.js\"]:not([src*=\"heatmap-2D\"]):not([id*=\"heatmap-3d\"])');\r\n      if (existingScript && existingScript.src) {\r\n        const scriptPath = existingScript.src;\r\n        const lastSlash = scriptPath.lastIndexOf('/');\r\n        basePath = scriptPath.substring(0, lastSlash + 1);\r\n        console.log('ğŸ“‚ ä»å·²åŠ è½½è„šæœ¬è·å–è·¯å¾„:', basePath, 'æ¥æº:', scriptPath);\r\n      } else {\r\n        // å¦‚æœæ‰¾ä¸åˆ°ï¼Œä»toggleè„šæœ¬è·å–\r\n        const toggleScript = document.querySelector('script[src*=\"heatmap-toggle\"]');\r\n        if (toggleScript && toggleScript.src) {\r\n          const scriptPath = toggleScript.src;\r\n          const lastSlash = scriptPath.lastIndexOf('/');\r\n          basePath = scriptPath.substring(0, lastSlash + 1);\r\n          console.log('ğŸ“‚ ä»toggleè„šæœ¬è·å–è·¯å¾„:', basePath);\r\n        } else {\r\n          basePath = '';\r\n          console.log('ğŸ“‚ ä½¿ç”¨ç›¸å¯¹è·¯å¾„');\r\n        }\r\n      }\r\n      \r\n      const timestamp = new Date().getTime();\r\n      const script = document.createElement('script');\r\n      script.src = `${basePath}heatmap.js?t=${timestamp}`;\r\n      script.id = 'heatmap-3d-script';\r\n      script.async = false; // ç¡®ä¿é¡ºåºæ‰§è¡Œ\r\n      \r\n      console.log('ğŸ“‚ åŠ è½½3Dçƒ­åŠ›å›¾è„šæœ¬ï¼Œå®Œæ•´è·¯å¾„:', script.src);\r\n      \r\n      let resolved = false;\r\n      const timeout = setTimeout(() => {\r\n        if (!resolved) {\r\n          resolved = true;\r\n          console.error('âŒ 3Dçƒ­åŠ›å›¾åŠ è½½è¶…æ—¶');\r\n          if (script.parentNode) {\r\n            script.parentNode.removeChild(script);\r\n          }\r\n          reject(new Error('3Dçƒ­åŠ›å›¾åŠ è½½è¶…æ—¶'));\r\n        }\r\n      }, 15000); // 15ç§’è¶…æ—¶ï¼ˆ3Déœ€è¦åŠ è½½æ•°æ®ï¼‰\r\n      \r\n      script.onload = () => {\r\n        if (resolved) return;\r\n        console.log('âœ… 3Dçƒ­åŠ›å›¾è„šæœ¬åŠ è½½æˆåŠŸ');\r\n        heatmap3DScript = script;\r\n        \r\n        // ç­‰å¾…æ¸²æŸ“å®Œæˆï¼ˆ3Dçƒ­åŠ›å›¾æœ‰å¼‚æ­¥æ•°æ®åŠ è½½ï¼Œéœ€è¦æ›´é•¿æ—¶é—´ï¼‰\r\n        let checkCount = 0;\r\n        const maxChecks = 50; // æœ€å¤šæ£€æŸ¥50æ¬¡ï¼Œæ¯æ¬¡300msï¼Œæ€»å…±15ç§’\r\n        \r\n        const checkRender = () => {\r\n          const svg = container.querySelector('svg');\r\n          if (svg && svg.children.length > 0) {\r\n            if (!resolved) {\r\n              resolved = true;\r\n              clearTimeout(timeout);\r\n              console.log('âœ… 3Dçƒ­åŠ›å›¾æ¸²æŸ“æˆåŠŸ');\r\n              resolve();\r\n            }\r\n          } else if (checkCount < maxChecks) {\r\n            checkCount++;\r\n            setTimeout(checkRender, 300);\r\n          } else {\r\n            if (!resolved) {\r\n              resolved = true;\r\n              clearTimeout(timeout);\r\n              console.warn('âš ï¸ 3Dçƒ­åŠ›å›¾æ¸²æŸ“è¶…æ—¶ï¼Œä½†è„šæœ¬å·²åŠ è½½');\r\n              // å³ä½¿æ²¡æœ‰SVGï¼Œä¹Ÿresolveï¼Œå¯èƒ½æ¸²æŸ“éœ€è¦æ›´å¤šæ—¶é—´\r\n              resolve();\r\n            }\r\n          }\r\n        };\r\n        \r\n        setTimeout(checkRender, 500);\r\n      };\r\n      \r\n      script.onerror = (error) => {\r\n        if (resolved) return;\r\n        resolved = true;\r\n        clearTimeout(timeout);\r\n        console.error('âŒ 3Dçƒ­åŠ›å›¾è„šæœ¬åŠ è½½å¤±è´¥:', error);\r\n        if (script.parentNode) {\r\n          script.parentNode.removeChild(script);\r\n        }\r\n        reject(new Error('3Dçƒ­åŠ›å›¾è„šæœ¬åŠ è½½å¤±è´¥'));\r\n      };\r\n      \r\n      document.head.appendChild(script);\r\n    });\r\n  }\r\n  \r\n  // åˆ‡æ¢æ¨¡å¼\r\n  async function toggleMode() {\r\n    // é˜²æ­¢é‡å¤ç‚¹å‡»\r\n    if (toggleBtn.disabled) {\r\n      return;\r\n    }\r\n    \r\n    toggleBtn.disabled = true;\r\n    toggleBtn.style.opacity = '0.6';\r\n    const originalText = toggleBtn.querySelector('.toggle-text').textContent;\r\n    toggleBtn.querySelector('.toggle-text').textContent = 'åˆ‡æ¢ä¸­...';\r\n    \r\n    try {\r\n      // å…ˆæ›´æ–°æ¨¡å¼ï¼Œå†åŠ è½½\r\n      const targetMode = currentMode === '3D' ? '2D' : '3D';\r\n      currentMode = targetMode;\r\n      \r\n      if (targetMode === '2D') {\r\n        await load2DHeatmap();\r\n      } else {\r\n        await load3DHeatmap();\r\n      }\r\n      \r\n      updateButtonText();\r\n      console.log(`âœ… æˆåŠŸåˆ‡æ¢åˆ°${currentMode}æ¨¡å¼`);\r\n    } catch (error) {\r\n      console.error('åˆ‡æ¢çƒ­åŠ›å›¾æ¨¡å¼å¤±è´¥:', error);\r\n      // æ¢å¤åŸçŠ¶æ€\r\n      currentMode = currentMode === '2D' ? '3D' : '2D';\r\n      toggleBtn.querySelector('.toggle-text').textContent = originalText;\r\n      \r\n      // å°è¯•é‡æ–°åŠ è½½å½“å‰æ¨¡å¼\r\n      try {\r\n        if (currentMode === '3D') {\r\n          await load3DHeatmap();\r\n        } else {\r\n          await load2DHeatmap();\r\n        }\r\n        updateButtonText();\r\n      } catch (retryError) {\r\n        console.error('é‡æ–°åŠ è½½å¤±è´¥:', retryError);\r\n        alert('åˆ‡æ¢å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');\r\n      }\r\n    } finally {\r\n      toggleBtn.disabled = false;\r\n      toggleBtn.style.opacity = '1';\r\n    }\r\n  }\r\n  \r\n  // ç»‘å®šç‚¹å‡»äº‹ä»¶\r\n  toggleBtn.addEventListener('click', toggleMode);\r\n  \r\n  // åˆå§‹åŒ–æŒ‰é’®æ–‡æœ¬\r\n  updateButtonText();\r\n  \r\n  // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰çƒ­åŠ›å›¾è„šæœ¬åŠ è½½ï¼ˆé»˜è®¤3Dï¼Œä»HTMLä¸­åŠ è½½ï¼‰\r\n  const existing3DScript = document.querySelector('script[src*=\"heatmap.js\"]:not([src*=\"heatmap-2D\"])');\r\n  if (existing3DScript && !existing3DScript.id) {\r\n    existing3DScript.id = 'heatmap-3d-script-original';\r\n    heatmap3DScript = existing3DScript;\r\n    currentMode = '3D';\r\n    console.log('âœ… æ£€æµ‹åˆ°å·²åŠ è½½çš„3Dçƒ­åŠ›å›¾è„šæœ¬');\r\n  }\r\n  \r\n  console.log('âœ… çƒ­åŠ›å›¾åˆ‡æ¢æ§åˆ¶å™¨åˆå§‹åŒ–å®Œæˆï¼Œå½“å‰æ¨¡å¼:', currentMode);\r\n})();\r\n"]}