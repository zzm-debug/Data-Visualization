{"version":3,"sources":["assets/歌单_2314343014_genre分布统计_归类后.json","heatmap.js"],"names":["module","exports","console","log","container","document","getElementById","error","innerHTML","d3","select","selectAll","remove","genreData","surfaceData","lineGenreData","require","e","warn","message","months","allGenres","CSV_DATA_2D","buildFrom2DCsv","rows","csvParse","trim","map","m","row","find","r","month","dist","_i","_allGenres","length","g","genre_distribution","chunk","d","loadData","processData","init3DHeatmap","rotationAngle","Math","PI","isometricProjection","x","y","z","angle","scale","cosR","cos","sinR","sin","rotatedX","rotatedY","isoX","isoY","Array","fill","getContainerSize","actualWidth","clientWidth","offsetWidth","actualHeight","clientHeight","offsetHeight","width","height","containerSize","containerWidth","containerHeight","minValue","Infinity","maxValue","i","j","min","max","valueRange","cssVar","name","fallback","v","getComputedStyle","documentElement","getPropertyValue","accentBlue","accentViolet","accentPink","accentCyan","cyberStops","cyberInterpolator","interpolateRgbBasis","colorScale","scaleSequential","domain","interpolator","getColor","value","updateLegend","legend","fmt","format","concat","join","tooltip","append","attr","style","svg","isDragging","lastMouseX","cellWidth","cellDepth","maxHeight","numGenres","numMonths","totalWidth","totalDepth","corners","minX","maxX","minY","maxY","projectedWidth","projectedHeight","padding","viewBoxMinX","viewBoxMinY","viewBoxWidth","viewBoxHeight","interactiveElements","cellDataArray","lineDataArray","drawFace","svgGroup","points","fillColor","strokeColor","opacity","arguments","undefined","path","moveTo","lineTo","closePath","toString","darkenColor","rgb","factor","match","round","parseInt","b","cellThickness","genreIdx","monthIdx","baseColor","darkColor","darkerColor","zBottom","zTop","bottom1","bottom2","bottom3","bottom4","top1","top2","top3","top4","cellGroup","datum","genre","push","topFace","lineSource","isArray","forEach","element","on","event","parentGroup","parentNode","trackCount","transition","duration","html","toFixed","pageX","pageY","includes","brightness","minLineHeight","maxLineHeight","_i4","_allGenres2","val","lineHeightRange","maxLineZ","lineGenerator","line","curve","curveMonotoneX","projected","areaGenerator","area","y0","y1","_loop","_monthIdx","monthY","lineData","normalizedValue","isNaN","genreX","avgValue","reduce","sum","lineColor","darkerLineColor","areaPath","areaElement","_d3$pointer","pointer","node","_d3$pointer2","_slicedToArray","mouseX","mouseY","minDistance","nearestPoint","nearestGenreIdx","point","idx","distance","sqrt","pow","linePath","lineElement","_d3$pointer3","_d3$pointer4","maxZ","maxPoint","maxProjected","axisOffset","drawAxisWithArrow","start","end","color","axisClass","dx","dy","atan2","arrowLength","arrowPath","origin","AXIS_LINE","AXIS_TEXT","AXIS_STROKE","xAxisEnd","yAxisEnd","zAxisEnd","labelOffset","text","zLabelPos","updateProjection","cellData","empty","paths","faces","each","_ref","sortedLineData","_toConsumableArray","sort","a","projA","projB","lineGeneratorUpdate","newPath","areaGeneratorUpdate","xAxisAngle","xArrowLength","xArrowPath","yAxisAngle","yArrowLength","yArrowPath","zAxisAngle","zArrowLength","zArrowPath","clientX","preventDefault","deltaX","resizeTimer","handleResize","clearTimeout","setTimeout","window","addEventListener","waitForContainer","display","readyState"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAAA,MAAM,CAACC,OAAO,GAAG,CACf;EACE,OAAO,EAAE,CAAC;EACV,aAAa,EAAE,CAAC;EAChB,WAAW,EAAE,EAAE;EACf,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,CAAC;IACR,KAAK,EAAE;EACT;AACF,CAAC,EACD;EACE,OAAO,EAAE,CAAC;EACV,aAAa,EAAE,EAAE;EACjB,WAAW,EAAE,EAAE;EACf,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,CAAC;IACR,KAAK,EAAE,CAAC;IACR,MAAM,EAAE;EACV;AACF,CAAC,EACD;EACE,OAAO,EAAE,CAAC;EACV,aAAa,EAAE,EAAE;EACjB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,EAAE;IACT,MAAM,EAAE;EACV;AACF,CAAC,EACD;EACE,OAAO,EAAE,CAAC;EACV,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,CAAC;IACR,MAAM,EAAE,CAAC;IACT,YAAY,EAAE;EAChB;AACF,CAAC,EACD;EACE,OAAO,EAAE,CAAC;EACV,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,CAAC;IACR,YAAY,EAAE,CAAC;IACf,KAAK,EAAE,CAAC;IACR,MAAM,EAAE,CAAC;IACT,MAAM,EAAE,CAAC;IACT,WAAW,EAAE,CAAC;IACd,MAAM,EAAE;EACV;AACF,CAAC,EACD;EACE,OAAO,EAAE,CAAC;EACV,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,YAAY,EAAE,CAAC;IACf,KAAK,EAAE,CAAC;IACR,KAAK,EAAE,CAAC;IACR,WAAW,EAAE,CAAC;IACd,MAAM,EAAE;EACV;AACF,CAAC,EACD;EACE,OAAO,EAAE,CAAC;EACV,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,CAAC;IACR,MAAM,EAAE,CAAC;IACT,YAAY,EAAE,CAAC;IACf,MAAM,EAAE,CAAC;IACT,WAAW,EAAE;EACf;AACF,CAAC,EACD;EACE,OAAO,EAAE,CAAC;EACV,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,YAAY,EAAE,EAAE;IAChB,KAAK,EAAE,CAAC;IACR,KAAK,EAAE,CAAC;IACR,MAAM,EAAE,CAAC;IACT,MAAM,EAAE;EACV;AACF,CAAC,EACD;EACE,OAAO,EAAE,CAAC;EACV,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,EAAE;IACT,MAAM,EAAE,CAAC;IACT,KAAK,EAAE,CAAC;IACR,MAAM,EAAE,CAAC;IACT,YAAY,EAAE,CAAC;IACf,MAAM,EAAE;EACV;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,CAAC;IACR,YAAY,EAAE,CAAC;IACf,KAAK,EAAE,CAAC;IACR,MAAM,EAAE,CAAC;IACT,WAAW,EAAE;EACf;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,YAAY,EAAE,EAAE;IAChB,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,CAAC;IACR,MAAM,EAAE;EACV;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,YAAY,EAAE,CAAC;IACf,KAAK,EAAE,CAAC;IACR,MAAM,EAAE,CAAC;IACT,KAAK,EAAE;EACT;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,CAAC;IACR,YAAY,EAAE,CAAC;IACf,MAAM,EAAE,CAAC;IACT,WAAW,EAAE;EACf;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,EAAE;IACT,MAAM,EAAE,EAAE;IACV,YAAY,EAAE,CAAC;IACf,KAAK,EAAE;EACT;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,MAAM,EAAE,EAAE;IACV,KAAK,EAAE,EAAE;IACT,YAAY,EAAE,EAAE;IAChB,KAAK,EAAE,CAAC;IACR,MAAM,EAAE;EACV;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,EAAE;IACT,YAAY,EAAE,CAAC;IACf,MAAM,EAAE,CAAC;IACT,KAAK,EAAE,CAAC;IACR,MAAM,EAAE,CAAC;IACT,MAAM,EAAE;EACV;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,YAAY,EAAE,EAAE;IAChB,KAAK,EAAE,CAAC;IACR,MAAM,EAAE,CAAC;IACT,KAAK,EAAE,CAAC;IACR,MAAM,EAAE,CAAC;IACT,MAAM,EAAE;EACV;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,YAAY,EAAE,EAAE;IAChB,KAAK,EAAE,EAAE;IACT,MAAM,EAAE,CAAC;IACT,MAAM,EAAE;EACV;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,EAAE;IACT,YAAY,EAAE,CAAC;IACf,KAAK,EAAE,CAAC;IACR,MAAM,EAAE,CAAC;IACT,MAAM,EAAE,CAAC;IACT,WAAW,EAAE;EACf;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,MAAM,EAAE,EAAE;IACV,KAAK,EAAE,CAAC;IACR,YAAY,EAAE,CAAC;IACf,KAAK,EAAE,CAAC;IACR,MAAM,EAAE;EACV;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,YAAY,EAAE,EAAE;IAChB,MAAM,EAAE,CAAC;IACT,KAAK,EAAE,CAAC;IACR,KAAK,EAAE;EACT;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,YAAY,EAAE,EAAE;IAChB,KAAK,EAAE,CAAC;IACR,KAAK,EAAE,CAAC;IACR,MAAM,EAAE;EACV;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,YAAY,EAAE,EAAE;IAChB,KAAK,EAAE,EAAE;IACT,KAAK,EAAE,CAAC;IACR,KAAK,EAAE,CAAC;IACR,MAAM,EAAE;EACV;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,MAAM,EAAE,EAAE;IACV,YAAY,EAAE,EAAE;IAChB,KAAK,EAAE,CAAC;IACR,MAAM,EAAE,CAAC;IACT,KAAK,EAAE;EACT;AACF,CAAC,EACD;EACE,OAAO,EAAE,EAAE;EACX,aAAa,EAAE,GAAG;EAClB,WAAW,EAAE,GAAG;EAChB,YAAY,EAAE,EAAE;EAChB,kBAAkB,EAAE,EAAE;EACtB,qBAAqB,EAAE,CAAC;EACxB,oBAAoB,EAAE;IACpB,KAAK,EAAE,EAAE;IACT,YAAY,EAAE,CAAC;IACf,KAAK,EAAE,CAAC;IACR,MAAM,EAAE,CAAC;IACT,MAAM,EAAE;EACV;AACF,CAAC,CACF;;;;;;;;;;;;ACxYD;AACA;AACA;AACA;AACAC,OAAO,CAACC,GAAG,CAAC,sBAAsB,CAAC;AACnC,CAAC,YAAM;EACL;EACA,IAAMC,SAAS,GAAGC,QAAQ,CAACC,cAAc,CAAC,YAAY,CAAC,IAAID,QAAQ,CAACC,cAAc,CAAC,SAAS,CAAC;EAC7F,IAAI,CAACF,SAAS,EAAE;IACdF,OAAO,CAACK,KAAK,CAAC,gBAAgB,CAAC;IAC/B;EACF;EAEAH,SAAS,CAACI,SAAS,GAAG,EAAE;EACxBC,EAAE,CAACC,MAAM,CAAC,MAAM,CAAC,CAACC,SAAS,CAAC,kBAAkB,CAAC,CAACC,MAAM,CAAC,CAAC;EAExD,IAAIC,SAAS,GAAG,IAAI;EACpB,IAAIC,WAAW,GAAG,IAAI;EACtB;EACA,IAAIC,aAAa,GAAG,IAAI;EACxB,IAAI;IACFA,aAAa,GAAGC,OAAO,CAAC,2CAA2C,CAAC;IACpEd,OAAO,CAACC,GAAG,CAAC,gDAAgD,CAAC;EAC/D,CAAC,CAAC,OAAOc,CAAC,EAAE;IACVf,OAAO,CAACgB,IAAI,CAAC,4CAA4C,EAAED,CAAC,IAAIA,CAAC,CAACE,OAAO,GAAGF,CAAC,CAACE,OAAO,GAAGF,CAAC,CAAC;IAC1FF,aAAa,GAAG,IAAI;EACtB;EAEA,IAAMK,MAAM,GAAG,CACb,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAC3E,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAChE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAChE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,EAAE,SAAS,CACjE;EAED,IAAMC,SAAS,GAAG,CAAC,KAAK,EAAE,WAAW,EAAE,YAAY,EAAE,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,KAAK,EAAE,MAAM,CAAC;;EAE1F;EACA,IAAMC,WAAW,m3BAyBa;EAE9B,SAASC,cAAcA,CAAA,EAAG;IACxB,IAAMC,IAAI,GAAGf,EAAE,CAACgB,QAAQ,CAACH,WAAW,CAACI,IAAI,CAAC,CAAC,CAAC;IAC5C;IACAb,SAAS,GAAGO,MAAM,CAACO,GAAG,CAAC,UAACC,CAAC,EAAK;MAC5B,IAAMC,GAAG,GAAGL,IAAI,CAACM,IAAI,CAAC,UAAAC,CAAC;QAAA,OAAIA,CAAC,CAACC,KAAK,KAAKJ,CAAC;MAAA,EAAC;MACzC,IAAMK,IAAI,GAAG,CAAC,CAAC;MACf,SAAAC,EAAA,MAAAC,UAAA,GAAgBd,SAAS,EAAAa,EAAA,GAAAC,UAAA,CAAAC,MAAA,EAAAF,EAAA;QAApB,IAAMG,CAAC,GAAAF,UAAA,CAAAD,EAAA;QAAeD,IAAI,CAACI,CAAC,CAAC,GAAGR,GAAG,GAAI,CAACA,GAAG,CAACQ,CAAC,CAAC,IAAI,CAAC,GAAI,CAAC;MAAC;MAC9D,OAAO;QAAEL,KAAK,EAAEJ,CAAC;QAAEU,kBAAkB,EAAEL;MAAK,CAAC;IAC/C,CAAC,CAAC;;IAEF;IACAnB,WAAW,GAAGM,MAAM,CAACO,GAAG,CAAC,UAACC,CAAC,EAAK;MAC9B,IAAMW,KAAK,GAAG1B,SAAS,CAACiB,IAAI,CAAC,UAAAU,CAAC;QAAA,OAAIA,CAAC,CAACR,KAAK,KAAKJ,CAAC;MAAA,EAAC;MAChD,OAAOP,SAAS,CAACM,GAAG,CAAC,UAAAU,CAAC;QAAA,OAAKE,KAAK,IAAIA,KAAK,CAACD,kBAAkB,GAAIC,KAAK,CAACD,kBAAkB,CAACD,CAAC,CAAC,IAAI,CAAC,GAAI,CAAC;MAAA,CAAC,CAAC;IACzG,CAAC,CAAC;EACJ;EAEA,SAASI,QAAQA,CAAA,EAAG;IAClB;IACAvC,OAAO,CAACC,GAAG,CAAC,uBAAuB,CAAC;IACpCoB,cAAc,CAAC,CAAC;IAChBmB,WAAW,CAAC,CAAC;IACbC,aAAa,CAAC,CAAC;EACjB;EAEA,SAASD,WAAWA,CAAA,EAAG;IACrB;IACA,IAAI,CAAC5B,WAAW,IAAIA,WAAW,CAACsB,MAAM,KAAKhB,MAAM,CAACgB,MAAM,EAAE;MACxDb,cAAc,CAAC,CAAC;IAClB;IAEArB,OAAO,CAACC,GAAG,CAAC,UAAU,CAAC;EACzB;;EAEA;EACA,IAAIyC,aAAa,GAAGC,IAAI,CAACC,EAAE,GAAG,CAAC,CAAC,CAAC;;EAEjC;EACA,SAASC,mBAAmBA,CAACC,CAAC,EAAEC,CAAC,EAAEC,CAAC,EAAE;IACpC;IACA;IACA,IAAMC,KAAK,GAAGN,IAAI,CAACC,EAAE,GAAG,CAAC,CAAC,CAAC;IAC3B,IAAMM,KAAK,GAAG,GAAG,CAAC,CAAC;;IAEnB;IACA,IAAMC,IAAI,GAAGR,IAAI,CAACS,GAAG,CAACV,aAAa,CAAC;IACpC,IAAMW,IAAI,GAAGV,IAAI,CAACW,GAAG,CAACZ,aAAa,CAAC;IACpC,IAAMa,QAAQ,GAAGT,CAAC,GAAGK,IAAI,GAAGJ,CAAC,GAAGM,IAAI;IACpC,IAAMG,QAAQ,GAAGV,CAAC,GAAGO,IAAI,GAAGN,CAAC,GAAGI,IAAI;;IAEpC;IACA,IAAMM,IAAI,GAAG,CAACF,QAAQ,GAAGC,QAAQ,IAAIb,IAAI,CAACS,GAAG,CAACH,KAAK,CAAC,GAAGC,KAAK;IAC5D,IAAMQ,IAAI,GAAG,CAACH,QAAQ,GAAGC,QAAQ,IAAIb,IAAI,CAACW,GAAG,CAACL,KAAK,CAAC,GAAGC,KAAK,GAAGF,CAAC,GAAGE,KAAK;IACxE,OAAO;MAAEJ,CAAC,EAAEW,IAAI;MAAEV,CAAC,EAAEW;IAAK,CAAC;EAC7B;EAEA,SAASjB,aAAaA,CAAA,EAAG;IACvB,IAAI,CAAC7B,WAAW,IAAIA,WAAW,CAACsB,MAAM,KAAK,CAAC,EAAE;MAC5ClC,OAAO,CAACgB,IAAI,CAAC,sBAAsB,CAAC;MACpCJ,WAAW,GAAG+C,KAAK,CAAC,EAAE,CAAC,CAACC,IAAI,CAAC,IAAI,CAAC,CAACnC,GAAG,CAAC;QAAA,OAAMkC,KAAK,CAACxC,SAAS,CAACe,MAAM,CAAC,CAAC0B,IAAI,CAAC,EAAE,CAAC;MAAA,EAAC;IAChF;;IAEA;IACA,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAAA,EAAS;MAC7B;MACA,IAAMC,WAAW,GAAG5D,SAAS,CAAC6D,WAAW,IAAI7D,SAAS,CAAC8D,WAAW,IAAI,IAAI;MAC1E,IAAMC,YAAY,GAAG/D,SAAS,CAACgE,YAAY,IAAIhE,SAAS,CAACiE,YAAY,IAAI,GAAG;MAC5E,OAAO;QACLC,KAAK,EAAEN,WAAW,GAAG,CAAC,GAAGA,WAAW,GAAG,IAAI;QAC3CO,MAAM,EAAEJ,YAAY,GAAG,CAAC,GAAGA,YAAY,GAAG;MAC5C,CAAC;IACH,CAAC;IAED,IAAIK,aAAa,GAAGT,gBAAgB,CAAC,CAAC;IACtC;IACA,IAAIU,cAAc,GAAGD,aAAa,CAACF,KAAK;IACxC,IAAII,eAAe,GAAGF,aAAa,CAACD,MAAM;;IAE1C;IACA,IAAII,QAAQ,GAAGC,QAAQ;IACvB,IAAIC,QAAQ,GAAG,CAAC;IAChB,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGhE,WAAW,CAACsB,MAAM,EAAE0C,CAAC,EAAE,EAAE;MAC3C,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGjE,WAAW,CAACgE,CAAC,CAAC,CAAC1C,MAAM,EAAE2C,CAAC,EAAE,EAAE;QAC9CJ,QAAQ,GAAG9B,IAAI,CAACmC,GAAG,CAACL,QAAQ,EAAE7D,WAAW,CAACgE,CAAC,CAAC,CAACC,CAAC,CAAC,CAAC;QAChDF,QAAQ,GAAGhC,IAAI,CAACoC,GAAG,CAACJ,QAAQ,EAAE/D,WAAW,CAACgE,CAAC,CAAC,CAACC,CAAC,CAAC,CAAC;MAClD;IACF;IACA,IAAIF,QAAQ,KAAK,CAAC,EAAEA,QAAQ,GAAG,CAAC;IAChC,IAAMK,UAAU,GAAGL,QAAQ,GAAGF,QAAQ,IAAI,CAAC;;IAE3C;IACA,SAASQ,MAAMA,CAACC,IAAI,EAAEC,QAAQ,EAAE;MAC9B,IAAMC,CAAC,GAAGC,gBAAgB,CAAClF,QAAQ,CAACmF,eAAe,CAAC,CAACC,gBAAgB,CAACL,IAAI,CAAC;MAC3E,OAAO,CAACE,CAAC,IAAI,EAAE,EAAE5D,IAAI,CAAC,CAAC,IAAI2D,QAAQ;IACrC;IACA,IAAMK,UAAU,GAAGP,MAAM,CAAC,eAAe,EAAE,SAAS,CAAC;IACrD,IAAMQ,YAAY,GAAGR,MAAM,CAAC,iBAAiB,EAAE,SAAS,CAAC;IACzD,IAAMS,UAAU,GAAGT,MAAM,CAAC,eAAe,EAAE,SAAS,CAAC;IACrD,IAAMU,UAAU,GAAGV,MAAM,CAAC,eAAe,EAAE,SAAS,CAAC;;IAErD;IACA;IACA,IAAMW,UAAU,GAAG,CACjB,SAAS,EACTJ,UAAU,EACVG,UAAU,EACV,SAAS,CACV;IACD,IAAME,iBAAiB,GAAGtF,EAAE,CAACuF,mBAAmB,CAACF,UAAU,CAAC;IAE5D,IAAMG,UAAU,GAAGxF,EAAE,CAACyF,eAAe,CAAC,CAAC,CACpCC,MAAM,CAAC,CAACxB,QAAQ,EAAEE,QAAQ,CAAC,CAAC,CAC5BuB,YAAY,CAACL,iBAAiB,CAAC;IAElC,SAASM,QAAQA,CAACC,KAAK,EAAE;MACvB,OAAOL,UAAU,CAACK,KAAK,IAAI,CAAC,CAAC;IAC/B;;IAEA;IACA,CAAC,SAASC,YAAYA,CAAA,EAAG;MACvB,IAAMC,MAAM,GAAGnG,QAAQ,CAACC,cAAc,CAAC,sBAAsB,CAAC;MAC9D,IAAI,CAACkG,MAAM,EAAE;MACb,IAAMC,GAAG,GAAGhG,EAAE,CAACiG,MAAM,CAAC,IAAI,CAAC;MAC3BF,MAAM,CAAChG,SAAS,mJAAAmG,MAAA,CAEsDb,UAAU,CAACc,IAAI,CAAC,GAAG,CAAC,0EAAAD,MAAA,CAE9EF,GAAG,CAAC9B,QAAQ,aAARA,QAAQ,cAARA,QAAQ,GAAI,CAAC,CAAC,+BAAAgC,MAAA,CAClBF,GAAG,CAAC5B,QAAQ,aAARA,QAAQ,cAARA,QAAQ,GAAI,CAAC,CAAC,oCAE7B;IACH,CAAC,EAAE,CAAC;;IAEJ;IACA,IAAMgC,OAAO,GAAGpG,EAAE,CAACC,MAAM,CAAC,MAAM,CAAC,CAACoG,MAAM,CAAC,KAAK,CAAC,CAC5CC,IAAI,CAAC,OAAO,EAAE,iBAAiB,CAAC,CAChCC,KAAK,CAAC,UAAU,EAAE,UAAU,CAAC,CAC7BA,KAAK,CAAC,gBAAgB,EAAE,MAAM,CAAC,CAC/BA,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC,CACnBA,KAAK,CAAC,SAAS,EAAE,WAAW,CAAC,CAC7BA,KAAK,CAAC,eAAe,EAAE,MAAM,CAAC,CAC9BA,KAAK,CAAC,YAAY,EAAE,qBAAqB,CAAC,CAC1CA,KAAK,CAAC,OAAO,EAAE,MAAM,CAAC,CACtBA,KAAK,CAAC,MAAM,EAAE,2EAA2E,CAAC,CAC1FA,KAAK,CAAC,YAAY,EAAE,8BAA8B,CAAC,CACnDA,KAAK,CAAC,SAAS,EAAE,IAAI,CAAC;;IAEzB;IACA,IAAMC,GAAG,GAAGxG,EAAE,CAACC,MAAM,CAACN,SAAS,CAAC,CAC7B0G,MAAM,CAAC,KAAK,CAAC,CACbC,IAAI,CAAC,OAAO,EAAE,MAAM,CAAC,CACrBA,IAAI,CAAC,QAAQ,EAAE,MAAM,CAAC,CACtBC,KAAK,CAAC,QAAQ,EAAE,MAAM,CAAC;;IAE1B;IACA,IAAIE,UAAU,GAAG,KAAK;IACtB,IAAIC,UAAU,GAAG,CAAC;;IAElB;IACA,IAAMC,SAAS,GAAG,EAAE,CAAC,CAAE;IACvB,IAAMC,SAAS,GAAG,EAAE,CAAC,CAAE;IACvB,IAAMC,SAAS,GAAG,GAAG,CAAC,CAAE;IACxB,IAAMC,SAAS,GAAGlG,SAAS,CAACe,MAAM;IAClC,IAAMoF,SAAS,GAAGpG,MAAM,CAACgB,MAAM;;IAE/B;IACA,IAAMqF,UAAU,GAAGF,SAAS,GAAGH,SAAS;IACxC,IAAMM,UAAU,GAAGF,SAAS,GAAGH,SAAS;;IAExC;IACA,IAAMM,OAAO,GAAG,CACd5E,mBAAmB,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAC5BA,mBAAmB,CAAC0E,UAAU,EAAE,CAAC,EAAE,CAAC,CAAC,EACrC1E,mBAAmB,CAAC,CAAC,EAAE2E,UAAU,EAAE,CAAC,CAAC,EACrC3E,mBAAmB,CAAC0E,UAAU,EAAEC,UAAU,EAAE,CAAC,CAAC,EAC9C3E,mBAAmB,CAAC,CAAC,EAAE,CAAC,EAAEuE,SAAS,CAAC,EACpCvE,mBAAmB,CAAC0E,UAAU,EAAE,CAAC,EAAEH,SAAS,CAAC,CAC9C;IAED,IAAMM,IAAI,GAAGnH,EAAE,CAACuE,GAAG,CAAC2C,OAAO,EAAE,UAAAnF,CAAC;MAAA,OAAIA,CAAC,CAACQ,CAAC;IAAA,EAAC;IACtC,IAAM6E,IAAI,GAAGpH,EAAE,CAACwE,GAAG,CAAC0C,OAAO,EAAE,UAAAnF,CAAC;MAAA,OAAIA,CAAC,CAACQ,CAAC;IAAA,EAAC;IACtC,IAAM8E,IAAI,GAAGrH,EAAE,CAACuE,GAAG,CAAC2C,OAAO,EAAE,UAAAnF,CAAC;MAAA,OAAIA,CAAC,CAACS,CAAC;IAAA,EAAC;IACtC,IAAM8E,IAAI,GAAGtH,EAAE,CAACwE,GAAG,CAAC0C,OAAO,EAAE,UAAAnF,CAAC;MAAA,OAAIA,CAAC,CAACS,CAAC;IAAA,EAAC;IAEtC,IAAM+E,cAAc,GAAGH,IAAI,GAAGD,IAAI;IAClC,IAAMK,eAAe,GAAGF,IAAI,GAAGD,IAAI;;IAEnC;IACA,IAAMI,OAAO,GAAG,EAAE;IAClB,IAAMC,WAAW,GAAGP,IAAI,GAAGM,OAAO;IAClC,IAAME,WAAW,GAAGN,IAAI,GAAGI,OAAO;IAClC,IAAMG,YAAY,GAAGL,cAAc,GAAGE,OAAO,GAAG,CAAC;IACjD,IAAMI,aAAa,GAAGL,eAAe,GAAGC,OAAO,GAAG,CAAC;;IAEnD;IACA;IACAjB,GAAG,CAACF,IAAI,CAAC,SAAS,KAAAJ,MAAA,CAAKwB,WAAW,OAAAxB,MAAA,CAAIyB,WAAW,OAAAzB,MAAA,CAAI0B,YAAY,OAAA1B,MAAA,CAAI2B,aAAa,CAAE,CAAC,CACjFvB,IAAI,CAAC,qBAAqB,EAAE,eAAe,CAAC;;IAEhD;IACA;IACA,IAAM1E,CAAC,GAAG4E,GAAG,CAACH,MAAM,CAAC,GAAG,CAAC;;IAEzB;IACA,IAAMyB,mBAAmB,GAAG,EAAE;;IAE9B;IACA,IAAMC,aAAa,GAAG,EAAE;IACxB;IACA,IAAMC,aAAa,GAAG,EAAE;;IAExB;IACA,SAASC,QAAQA,CAACC,QAAQ,EAAEC,MAAM,EAAEC,SAAS,EAAEC,WAAW,EAAe;MAAA,IAAbC,OAAO,GAAAC,SAAA,CAAA5G,MAAA,QAAA4G,SAAA,QAAAC,SAAA,GAAAD,SAAA,MAAG,CAAC;MACrE,IAAME,IAAI,GAAGzI,EAAE,CAACyI,IAAI,CAAC,CAAC;MACtBA,IAAI,CAACC,MAAM,CAACP,MAAM,CAAC,CAAC,CAAC,CAAC5F,CAAC,EAAE4F,MAAM,CAAC,CAAC,CAAC,CAAC3F,CAAC,CAAC;MACrC,KAAK,IAAI6B,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAG8D,MAAM,CAACxG,MAAM,EAAE0C,GAAC,EAAE,EAAE;QACtCoE,IAAI,CAACE,MAAM,CAACR,MAAM,CAAC9D,GAAC,CAAC,CAAC9B,CAAC,EAAE4F,MAAM,CAAC9D,GAAC,CAAC,CAAC7B,CAAC,CAAC;MACvC;MACAiG,IAAI,CAACG,SAAS,CAAC,CAAC;MAEhB,OAAOV,QAAQ,CAAC7B,MAAM,CAAC,MAAM,CAAC,CAC3BC,IAAI,CAAC,GAAG,EAAEmC,IAAI,CAACI,QAAQ,CAAC,CAAC,CAAC,CAC1BvC,IAAI,CAAC,MAAM,EAAE8B,SAAS,CAAC,CACvB9B,IAAI,CAAC,QAAQ,EAAE+B,WAAW,CAAC,CAC3B/B,IAAI,CAAC,cAAc,EAAE,GAAG,CAAC,CACzBA,IAAI,CAAC,SAAS,EAAEgC,OAAO,CAAC;IAC7B;;IAEA;IACA,SAASQ,WAAWA,CAACC,GAAG,EAAEC,MAAM,EAAE;MAChC,IAAMC,KAAK,GAAGF,GAAG,CAACE,KAAK,CAAC,MAAM,CAAC;MAC/B,IAAI,CAACA,KAAK,EAAE,OAAOF,GAAG;MACtB,IAAMzH,CAAC,GAAGc,IAAI,CAACoC,GAAG,CAAC,CAAC,EAAEpC,IAAI,CAAC8G,KAAK,CAACC,QAAQ,CAACF,KAAK,CAAC,CAAC,CAAC,CAAC,GAAGD,MAAM,CAAC,CAAC;MAC9D,IAAMpH,CAAC,GAAGQ,IAAI,CAACoC,GAAG,CAAC,CAAC,EAAEpC,IAAI,CAAC8G,KAAK,CAACC,QAAQ,CAACF,KAAK,CAAC,CAAC,CAAC,CAAC,GAAGD,MAAM,CAAC,CAAC;MAC9D,IAAMI,CAAC,GAAGhH,IAAI,CAACoC,GAAG,CAAC,CAAC,EAAEpC,IAAI,CAAC8G,KAAK,CAACC,QAAQ,CAACF,KAAK,CAAC,CAAC,CAAC,CAAC,GAAGD,MAAM,CAAC,CAAC;MAC9D,cAAA9C,MAAA,CAAc5E,CAAC,QAAA4E,MAAA,CAAKtE,CAAC,QAAAsE,MAAA,CAAKkD,CAAC;IAC7B;;IAEA;IACA,IAAMC,aAAa,GAAG,CAAC,CAAC,CAAC;;IAEzB,KAAK,IAAIC,QAAQ,GAAG,CAAC,EAAEA,QAAQ,GAAGxC,SAAS,EAAEwC,QAAQ,EAAE,EAAE;MACvD,KAAK,IAAIC,QAAQ,GAAG,CAAC,EAAEA,QAAQ,GAAGxC,SAAS,EAAEwC,QAAQ,EAAE,EAAE;QACvD,IAAM1D,KAAK,GAAGxF,WAAW,CAACkJ,QAAQ,CAAC,CAACD,QAAQ,CAAC;QAC7C,IAAME,SAAS,GAAG5D,QAAQ,CAACC,KAAK,CAAC;QACjC,IAAM4D,SAAS,GAAGX,WAAW,CAACU,SAAS,EAAE,IAAI,CAAC,CAAC,CAAC;QAChD,IAAME,WAAW,GAAGZ,WAAW,CAACU,SAAS,EAAE,IAAI,CAAC,CAAC,CAAC;;QAElD;QACA,IAAMjH,CAAC,GAAG+G,QAAQ,GAAG3C,SAAS;QAC9B,IAAMnE,CAAC,GAAG+G,QAAQ,GAAG3C,SAAS;QAC9B,IAAM+C,OAAO,GAAG,CAAC;QACjB,IAAMC,IAAI,GAAGP,aAAa;;QAE1B;QACA;QACA,IAAMQ,OAAO,GAAGvH,mBAAmB,CAACC,CAAC,EAAEC,CAAC,EAAEmH,OAAO,CAAC;QAClD,IAAMG,OAAO,GAAGxH,mBAAmB,CAACC,CAAC,GAAGoE,SAAS,EAAEnE,CAAC,EAAEmH,OAAO,CAAC;QAC9D,IAAMI,OAAO,GAAGzH,mBAAmB,CAACC,CAAC,GAAGoE,SAAS,EAAEnE,CAAC,GAAGoE,SAAS,EAAE+C,OAAO,CAAC;QAC1E,IAAMK,OAAO,GAAG1H,mBAAmB,CAACC,CAAC,EAAEC,CAAC,GAAGoE,SAAS,EAAE+C,OAAO,CAAC;;QAE9D;QACA,IAAMM,IAAI,GAAG3H,mBAAmB,CAACC,CAAC,EAAEC,CAAC,EAAEoH,IAAI,CAAC;QAC5C,IAAMM,IAAI,GAAG5H,mBAAmB,CAACC,CAAC,GAAGoE,SAAS,EAAEnE,CAAC,EAAEoH,IAAI,CAAC;QACxD,IAAMO,IAAI,GAAG7H,mBAAmB,CAACC,CAAC,GAAGoE,SAAS,EAAEnE,CAAC,GAAGoE,SAAS,EAAEgD,IAAI,CAAC;QACpE,IAAMQ,IAAI,GAAG9H,mBAAmB,CAACC,CAAC,EAAEC,CAAC,GAAGoE,SAAS,EAAEgD,IAAI,CAAC;;QAExD;QACA,IAAMS,SAAS,GAAGzI,CAAC,CAACyE,MAAM,CAAC,GAAG,CAAC,CAC5BC,IAAI,CAAC,OAAO,qBAAAJ,MAAA,CAAqBqD,QAAQ,OAAArD,MAAA,CAAIoD,QAAQ,CAAE,CAAC,CACxDgB,KAAK,CAAC;UACL/I,KAAK,EAAEZ,MAAM,CAAC4I,QAAQ,CAAC;UACvBgB,KAAK,EAAE3J,SAAS,CAAC0I,QAAQ,CAAC;UAC1BzD,KAAK,EAAEA,KAAK;UACZ0D,QAAQ,EAAEA,QAAQ;UAClBD,QAAQ,EAAEA,QAAQ;UAClB/G,CAAC,EAAEA,CAAC;UACJC,CAAC,EAAEA,CAAC;UACJC,CAAC,EAAEkH;QACL,CAAC,CAAC,CACDpD,KAAK,CAAC,QAAQ,EAAE,SAAS,CAAC;;QAE7B;QACAwB,aAAa,CAACyC,IAAI,CAAC;UACjBjB,QAAQ,EAARA,QAAQ;UACRD,QAAQ,EAARA,QAAQ;UACR/G,CAAC,EAADA,CAAC;UACDC,CAAC,EAADA,CAAC;UACDmH,OAAO,EAAPA,OAAO;UACPC,IAAI,EAAJA,IAAI;UACJ/D,KAAK,EAALA,KAAK;UACL2D,SAAS,EAATA,SAAS;UACTC,SAAS,EAATA,SAAS;UACTC,WAAW,EAAXA,WAAW;UACXW,SAAS,EAATA;QACF,CAAC,CAAC;;QAEF;QACA;QACApC,QAAQ,CAACoC,SAAS,EAAE,CAACR,OAAO,EAAEC,OAAO,EAAEC,OAAO,EAAEC,OAAO,CAAC,EAAER,SAAS,EAAE,uBAAuB,EAAE,GAAG,CAAC;;QAElG;QACAvB,QAAQ,CAACoC,SAAS,EAAE,CAACP,OAAO,EAAEI,IAAI,EAAEC,IAAI,EAAEJ,OAAO,CAAC,EAAEN,SAAS,EAAE,uBAAuB,EAAE,GAAG,CAAC;;QAE5F;QACAxB,QAAQ,CAACoC,SAAS,EAAE,CAACL,OAAO,EAAED,OAAO,EAAEI,IAAI,EAAEC,IAAI,CAAC,EAAEV,WAAW,EAAE,uBAAuB,EAAE,IAAI,CAAC;;QAE/F;QACA,IAAMe,OAAO,GAAGxC,QAAQ,CAACoC,SAAS,EAAE,CAACJ,IAAI,EAAEC,IAAI,EAAEC,IAAI,EAAEC,IAAI,CAAC,EAAEZ,SAAS,EAAE,uBAAuB,EAAE,CAAC,CAAC;;QAEpG;QACA1B,mBAAmB,CAAC0C,IAAI,CAACC,OAAO,CAAC;MACnC;IACF;;IAGA;IACA;IACA,IAAMC,UAAU,GAAIpK,aAAa,IAAI8C,KAAK,CAACuH,OAAO,CAACrK,aAAa,CAAC,IAAIA,aAAa,CAACqB,MAAM,GAAIrB,aAAa,GAAGF,SAAS;IAEtH0H,mBAAmB,CAAC8C,OAAO,CAAC,UAAAC,OAAO,EAAI;MACrCA,OAAO,CACJC,EAAE,CAAC,WAAW,EAAE,UAASC,KAAK,EAAEhJ,CAAC,EAAE;QAClC;QACA,IAAMiJ,WAAW,GAAGhL,EAAE,CAACC,MAAM,CAAC,IAAI,CAACgL,UAAU,CAAC;QAC9CD,WAAW,CAAC9K,SAAS,CAAC,MAAM,CAAC,CAC1BoG,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAClBA,IAAI,CAAC,cAAc,EAAE,GAAG,CAAC;;QAE5B;QACA,IAAI4E,UAAU,GAAG,CAAC;QAClB,IAAIR,UAAU,IAAIA,UAAU,CAAC3I,CAAC,CAACwH,QAAQ,CAAC,EAAE;UACxC,IAAMzH,KAAK,GAAG4I,UAAU,CAAC3I,CAAC,CAACwH,QAAQ,CAAC;UACpC,IAAMgB,KAAK,GAAG3J,SAAS,CAACmB,CAAC,CAACuH,QAAQ,CAAC;UACnC,IAAIxH,KAAK,CAACD,kBAAkB,IAAIC,KAAK,CAACD,kBAAkB,CAAC0I,KAAK,CAAC,KAAK/B,SAAS,EAAE;YAC7E0C,UAAU,GAAGpJ,KAAK,CAACD,kBAAkB,CAAC0I,KAAK,CAAC;UAC9C;QACF,CAAC,MAAM;UACL;UACAW,UAAU,GAAG9I,IAAI,CAAC8G,KAAK,CAACnH,CAAC,CAAC8D,KAAK,CAAC;QAClC;QAEAO,OAAO,CAAC+E,UAAU,CAAC,CAAC,CAACC,QAAQ,CAAC,GAAG,CAAC,CAAC7E,KAAK,CAAC,SAAS,EAAE,IAAI,CAAC;QACzDH,OAAO,CACJiF,IAAI,OAAAnF,MAAA,CAAOnE,CAAC,CAACwI,KAAK,eAAArE,MAAA,CAAYnE,CAAC,CAACR,KAAK,yBAAA2E,MAAA,CAAYnE,CAAC,CAAC8D,KAAK,CAACyF,OAAO,CAAC,CAAC,CAAC,qCAAApF,MAAA,CAAcgF,UAAU,CAAE,CAAC,CAC9F3E,KAAK,CAAC,MAAM,KAAAL,MAAA,CAAK6E,KAAK,CAACQ,KAAK,GAAG,EAAE,OAAI,CAAC,CACtChF,KAAK,CAAC,KAAK,KAAAL,MAAA,CAAK6E,KAAK,CAACS,KAAK,GAAG,EAAE,OAAI,CAAC;MAC1C,CAAC,CAAC,CACDV,EAAE,CAAC,UAAU,EAAE,YAAW;QACzB;QACA,IAAME,WAAW,GAAGhL,EAAE,CAACC,MAAM,CAAC,IAAI,CAACgL,UAAU,CAAC;QAC9CD,WAAW,CAAC9K,SAAS,CAAC,MAAM,CAAC,CAC1BoG,IAAI,CAAC,SAAS,EAAE,YAAW;UAC1B;UACA,IAAMjD,IAAI,GAAGrD,EAAE,CAACC,MAAM,CAAC,IAAI,CAAC,CAACqG,IAAI,CAAC,MAAM,CAAC;UACzC,IAAIjD,IAAI,IAAIA,IAAI,CAACoI,QAAQ,CAAC,KAAK,CAAC,EAAE;YAChC,IAAMxC,KAAK,GAAG5F,IAAI,CAAC4F,KAAK,CAAC,MAAM,CAAC;YAChC,IAAIA,KAAK,EAAE;cACT,IAAM3H,CAAC,GAAG6H,QAAQ,CAACF,KAAK,CAAC,CAAC,CAAC,CAAC;cAC5B,IAAMrH,EAAC,GAAGuH,QAAQ,CAACF,KAAK,CAAC,CAAC,CAAC,CAAC;cAC5B,IAAMG,CAAC,GAAGD,QAAQ,CAACF,KAAK,CAAC,CAAC,CAAC,CAAC;cAC5B;cACA,IAAMyC,UAAU,GAAG,CAACpK,CAAC,GAAGM,EAAC,GAAGwH,CAAC,IAAI,CAAC;cAClC,IAAIsC,UAAU,GAAG,GAAG,EAAE,OAAO,CAAC,CAAC,CAAC;cAChC,IAAIA,UAAU,GAAG,GAAG,EAAE,OAAO,IAAI,CAAC,CAAC;cACnC,OAAO,GAAG,CAAC,CAAC;YACd;UACF;UACA,OAAO,GAAG;QACZ,CAAC,CAAC,CACDpF,IAAI,CAAC,cAAc,EAAE,GAAG,CAAC;QAC5BF,OAAO,CAAC+E,UAAU,CAAC,CAAC,CAACC,QAAQ,CAAC,GAAG,CAAC,CAAC7E,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC;MACxD,CAAC,CAAC;IACN,CAAC,CAAC;;IAEF;IACA;IACA,IAAIoF,aAAa,GAAGxH,QAAQ;IAC5B,IAAIyH,aAAa,GAAG,CAAC;IACrB,IAAIlB,UAAU,IAAIA,UAAU,CAAC/I,MAAM,GAAG,CAAC,EAAE;MACvC,KAAK,IAAI0C,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGqG,UAAU,CAAC/I,MAAM,EAAE0C,GAAC,EAAE,EAAE;QAC1C,IAAMvC,KAAK,GAAG4I,UAAU,CAACrG,GAAC,CAAC;QAC3B,IAAIvC,KAAK,IAAIA,KAAK,CAACD,kBAAkB,EAAE;UACrC,SAAAgK,GAAA,MAAAC,WAAA,GAAkBlL,SAAS,EAAAiL,GAAA,GAAAC,WAAA,CAAAnK,MAAA,EAAAkK,GAAA,IAAE;YAAxB,IAAItB,KAAK,GAAAuB,WAAA,CAAAD,GAAA;YACZ,IAAME,GAAG,GAAGjK,KAAK,CAACD,kBAAkB,CAAC0I,KAAK,CAAC,IAAI,CAAC;YAChDoB,aAAa,GAAGvJ,IAAI,CAACmC,GAAG,CAACoH,aAAa,EAAEI,GAAG,CAAC;YAC5CH,aAAa,GAAGxJ,IAAI,CAACoC,GAAG,CAACoH,aAAa,EAAEG,GAAG,CAAC;UAC9C;QACF;MACF;IACF;;IAEA;IACA,IAAI,CAACrB,UAAU,IAAIA,UAAU,CAAC/I,MAAM,KAAK,CAAC,IAAIgK,aAAa,KAAKxH,QAAQ,EAAE;MACxEwH,aAAa,GAAGxH,QAAQ;MACxByH,aAAa,GAAG,CAAC;MACjB,KAAK,IAAIvH,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGhE,WAAW,CAACsB,MAAM,EAAE0C,GAAC,EAAE,EAAE;QAC3C,KAAK,IAAIC,EAAC,GAAG,CAAC,EAAEA,EAAC,GAAGjE,WAAW,CAACgE,GAAC,CAAC,CAAC1C,MAAM,EAAE2C,EAAC,EAAE,EAAE;UAC9C,IAAMyH,IAAG,GAAG1L,WAAW,CAACgE,GAAC,CAAC,CAACC,EAAC,CAAC,IAAI,CAAC;UAClCqH,aAAa,GAAGvJ,IAAI,CAACmC,GAAG,CAACoH,aAAa,EAAEI,IAAG,CAAC;UAC5CH,aAAa,GAAGxJ,IAAI,CAACoC,GAAG,CAACoH,aAAa,EAAEG,IAAG,CAAC;QAC9C;MACF;IACF;;IAEA;IACA,IAAIJ,aAAa,KAAKxH,QAAQ,EAAEwH,aAAa,GAAG,CAAC;IACjD,IAAIC,aAAa,KAAK,CAAC,EAAEA,aAAa,GAAG,CAAC;IAC1C,IAAMI,eAAe,GAAGJ,aAAa,GAAGD,aAAa,IAAI,CAAC;IAC1D,IAAMM,QAAQ,GAAGpF,SAAS,GAAG,GAAG,CAAC,CAAC;;IAElCpH,OAAO,CAACC,GAAG,CAAC,aAAa,EAAE;MAAEiM,aAAa,EAAbA,aAAa;MAAEC,aAAa,EAAbA,aAAa;MAAEI,eAAe,EAAfA,eAAe;MAAEC,QAAQ,EAARA;IAAS,CAAC,CAAC;;IAEvF;IACA,IAAMC,aAAa,GAAGlM,EAAE,CAACmM,IAAI,CAAC,CAAC,CAC5BC,KAAK,CAACpM,EAAE,CAACqM,cAAc,CAAC,CAAC;IAAA,CACzB9J,CAAC,CAAC,UAACR,CAAC,EAAK;MACR,IAAMuK,SAAS,GAAGhK,mBAAmB,CAACP,CAAC,CAACQ,CAAC,EAAER,CAAC,CAACS,CAAC,EAAET,CAAC,CAACU,CAAC,CAAC;MACpD,OAAO6J,SAAS,CAAC/J,CAAC;IACpB,CAAC,CAAC,CACDC,CAAC,CAAC,UAACT,CAAC,EAAK;MACR,IAAMuK,SAAS,GAAGhK,mBAAmB,CAACP,CAAC,CAACQ,CAAC,EAAER,CAAC,CAACS,CAAC,EAAET,CAAC,CAACU,CAAC,CAAC;MACpD,OAAO6J,SAAS,CAAC9J,CAAC;IACpB,CAAC,CAAC;;IAEJ;IACA,IAAM+J,aAAa,GAAGvM,EAAE,CAACwM,IAAI,CAAC,CAAC,CAC5BJ,KAAK,CAACpM,EAAE,CAACqM,cAAc,CAAC,CAAC;IAAA,CACzB9J,CAAC,CAAC,UAACR,CAAC,EAAK;MACR,IAAMuK,SAAS,GAAGhK,mBAAmB,CAACP,CAAC,CAACQ,CAAC,EAAER,CAAC,CAACS,CAAC,EAAET,CAAC,CAACU,CAAC,CAAC;MACpD,OAAO6J,SAAS,CAAC/J,CAAC;IACpB,CAAC,CAAC,CACDkK,EAAE,CAAC,UAAC1K,CAAC,EAAK;MACT;MACA,IAAMuK,SAAS,GAAGhK,mBAAmB,CAACP,CAAC,CAACQ,CAAC,EAAER,CAAC,CAACS,CAAC,EAAE6G,aAAa,CAAC;MAC9D,OAAOiD,SAAS,CAAC9J,CAAC;IACpB,CAAC,CAAC,CACDkK,EAAE,CAAC,UAAC3K,CAAC,EAAK;MACT;MACA,IAAMuK,SAAS,GAAGhK,mBAAmB,CAACP,CAAC,CAACQ,CAAC,EAAER,CAAC,CAACS,CAAC,EAAET,CAAC,CAACU,CAAC,CAAC;MACpD,OAAO6J,SAAS,CAAC9J,CAAC;IACpB,CAAC,CAAC;;IAEJ;IAAA,IAAAmK,KAAA,YAAAA,MAAAC,SAAA,EACyD;MACvD,IAAMrL,KAAK,GAAGZ,MAAM,CAAC4I,SAAQ,CAAC;MAC9B,IAAMsD,MAAM,GAAGtD,SAAQ,GAAG3C,SAAS,GAAGA,SAAS,GAAG,CAAC,CAAC,CAAC;;MAErD;MACA,IAAMkG,QAAQ,GAAG,EAAE;MACnB,KAAK,IAAIxD,SAAQ,GAAG,CAAC,EAAEA,SAAQ,GAAGxC,SAAS,EAAEwC,SAAQ,EAAE,EAAE;QACvD,IAAIzD,MAAK,GAAG,CAAC;QACb,IAAI6E,UAAU,IAAIA,UAAU,CAACnB,SAAQ,CAAC,IAAImB,UAAU,CAACnB,SAAQ,CAAC,CAAC1H,kBAAkB,EAAE;UACjF,IAAM0I,MAAK,GAAG3J,SAAS,CAAC0I,SAAQ,CAAC;UACjCzD,MAAK,GAAG6E,UAAU,CAACnB,SAAQ,CAAC,CAAC1H,kBAAkB,CAAC0I,MAAK,CAAC,IAAI,CAAC;QAC7D,CAAC,MAAM,IAAIlK,WAAW,IAAIA,WAAW,CAACkJ,SAAQ,CAAC,EAAE;UAC/C;UACA1D,MAAK,GAAGxF,WAAW,CAACkJ,SAAQ,CAAC,CAACD,SAAQ,CAAC,IAAI,CAAC;QAC9C;;QAEA;QACA,IAAMyD,eAAe,GAAGf,eAAe,GAAG,CAAC,GAAG,CAACnG,MAAK,GAAG8F,aAAa,IAAIK,eAAe,GAAG,CAAC;QAC3F,IAAMvJ,CAAC,GAAG4G,aAAa,GAAG,CAAC2D,KAAK,CAACD,eAAe,CAAC,GAAG,CAAC,GAAGA,eAAe,IAAId,QAAQ,CAAC,CAAC;;QAErF,IAAMgB,MAAM,GAAG3D,SAAQ,GAAG3C,SAAS,GAAGA,SAAS,GAAG,CAAC,CAAC,CAAC;;QAErD;QACA,IAAI,CAACqG,KAAK,CAACC,MAAM,CAAC,IAAI,CAACD,KAAK,CAACH,MAAM,CAAC,IAAI,CAACG,KAAK,CAACvK,CAAC,CAAC,EAAE;UACjDqK,QAAQ,CAACtC,IAAI,CAAC;YACZjI,CAAC,EAAE0K,MAAM;YACTzK,CAAC,EAAEqK,MAAM;YACTpK,CAAC,EAAEA,CAAC;YACJoD,KAAK,EAAEA,MAAK;YACZ0D,QAAQ,EAAEA,SAAQ;YAClBD,QAAQ,EAAEA;UACZ,CAAC,CAAC;QACJ;MACF;;MAEA;MACA,IAAM4D,QAAQ,GAAGJ,QAAQ,CAACK,MAAM,CAAC,UAACC,GAAG,EAAErL,CAAC;QAAA,OAAKqL,GAAG,GAAGrL,CAAC,CAAC8D,KAAK;MAAA,GAAE,CAAC,CAAC,GAAGiH,QAAQ,CAACnL,MAAM;MAChF,IAAI0L,SAAS,GAAGzH,QAAQ,CAACsH,QAAQ,CAAC;MAClC;MACA,IAAMI,eAAe,GAAGxE,WAAW,CAACuE,SAAS,EAAE,IAAI,CAAC;;MAEpD;MACA,IAAIP,QAAQ,CAACnL,MAAM,GAAG,CAAC,EAAE;QACvBqG,aAAa,CAACwC,IAAI,CAAC;UACjBjB,QAAQ,EAARA,SAAQ;UACRhI,KAAK,EAALA,KAAK;UACLuL,QAAQ,KAAA5G,MAAA,CAAM4G,QAAQ,CAAC;UAAE;UACzBQ,eAAe,EAAfA,eAAe;UACfD,SAAS,EAATA;QACF,CAAC,CAAC;MACJ;;MAEA;MACA,IAAIP,QAAQ,CAACnL,MAAM,GAAG,CAAC,EAAE;QACvB;QACA,IAAM4L,QAAQ,GAAGhB,aAAa,CAACO,QAAQ,CAAC;QACxC,IAAIS,QAAQ,IAAI,CAACA,QAAQ,CAAC9B,QAAQ,CAAC,KAAK,CAAC,EAAE;UACzC,IAAM+B,WAAW,GAAG5L,CAAC,CAACyE,MAAM,CAAC,MAAM,CAAC,CACjCC,IAAI,CAAC,OAAO,oBAAAJ,MAAA,CAAoBqD,SAAQ,CAAE,CAAC,CAC3CjD,IAAI,CAAC,GAAG,EAAEiH,QAAQ,CAAC,CACnBjH,IAAI,CAAC,MAAM,EAAEgH,eAAe,CAAC,CAC7BhH,IAAI,CAAC,cAAc,EAAE,IAAI,CAAC,CAC1BA,IAAI,CAAC,QAAQ,EAAE,MAAM,CAAC,CACtBgE,KAAK,CAAC;YAAEwC,QAAQ,EAAEA,QAAQ;YAAEvL,KAAK,EAAEA,KAAK;YAAEgI,QAAQ,EAAEA;UAAS,CAAC,CAAC,CAAC;UAAA,CAChEhD,KAAK,CAAC,QAAQ,EAAE,SAAS,CAAC;;UAE7B;UACAiH,WAAW,CACR1C,EAAE,CAAC,WAAW,EAAE,UAASC,KAAK,EAAE;YAC/B;YACA,IAAA0C,WAAA,GAAyBzN,EAAE,CAAC0N,OAAO,CAAC3C,KAAK,EAAEnJ,CAAC,CAAC+L,IAAI,CAAC,CAAC,CAAC;cAAAC,YAAA,GAAAC,cAAA,CAAAJ,WAAA;cAA7CK,MAAM,GAAAF,YAAA;cAAEG,MAAM,GAAAH,YAAA;;YAErB;YACA,IAAII,WAAW,GAAG7J,QAAQ;YAC1B,IAAI8J,YAAY,GAAG,IAAI;YACvB,IAAIC,eAAe,GAAG,CAAC,CAAC;YAExBpB,QAAQ,CAAClC,OAAO,CAAC,UAACuD,KAAK,EAAEC,GAAG,EAAK;cAC/B,IAAM9B,SAAS,GAAGhK,mBAAmB,CAAC6L,KAAK,CAAC5L,CAAC,EAAE4L,KAAK,CAAC3L,CAAC,EAAE2L,KAAK,CAAC1L,CAAC,CAAC;cAChE,IAAM4L,QAAQ,GAAGjM,IAAI,CAACkM,IAAI,CACxBlM,IAAI,CAACmM,GAAG,CAACT,MAAM,GAAGxB,SAAS,CAAC/J,CAAC,EAAE,CAAC,CAAC,GACjCH,IAAI,CAACmM,GAAG,CAACR,MAAM,GAAGzB,SAAS,CAAC9J,CAAC,EAAE,CAAC,CAClC,CAAC;cACD,IAAI6L,QAAQ,GAAGL,WAAW,EAAE;gBAC1BA,WAAW,GAAGK,QAAQ;gBACtBJ,YAAY,GAAGE,KAAK;gBACpBD,eAAe,GAAGE,GAAG;cACvB;YACF,CAAC,CAAC;;YAEF;YACA,IAAIH,YAAY,IAAID,WAAW,GAAG,GAAG,EAAE;cACrC;cACA,IAAI9C,UAAU,GAAG,CAAC;cAClB,IAAI9K,SAAS,IAAIA,SAAS,CAACmJ,SAAQ,CAAC,EAAE;gBACpC,IAAMzH,MAAK,GAAG1B,SAAS,CAACmJ,SAAQ,CAAC;gBACjC,IAAMgB,OAAK,GAAG3J,SAAS,CAACsN,eAAe,CAAC;gBACxC,IAAIpM,MAAK,CAACD,kBAAkB,IAAIC,MAAK,CAACD,kBAAkB,CAAC0I,OAAK,CAAC,KAAK/B,SAAS,EAAE;kBAC7E0C,UAAU,GAAGpJ,MAAK,CAACD,kBAAkB,CAAC0I,OAAK,CAAC;gBAC9C;cACF,CAAC,MAAM;gBACLW,UAAU,GAAG9I,IAAI,CAAC8G,KAAK,CAAC+E,YAAY,CAACpI,KAAK,CAAC;cAC7C;cAEAO,OAAO,CAAC+E,UAAU,CAAC,CAAC,CAACC,QAAQ,CAAC,GAAG,CAAC,CAAC7E,KAAK,CAAC,SAAS,EAAE,IAAI,CAAC;cACzDH,OAAO,CACJiF,IAAI,OAAAnF,MAAA,CAAOtF,SAAS,CAACsN,eAAe,CAAC,eAAAhI,MAAA,CAAY3E,KAAK,yBAAA2E,MAAA,CAAY+H,YAAY,CAACpI,KAAK,CAACyF,OAAO,CAAC,CAAC,CAAC,qCAAApF,MAAA,CAAcgF,UAAU,CAAE,CAAC,CAC1H3E,KAAK,CAAC,MAAM,KAAAL,MAAA,CAAK6E,KAAK,CAACQ,KAAK,GAAG,EAAE,OAAI,CAAC,CACtChF,KAAK,CAAC,KAAK,KAAAL,MAAA,CAAK6E,KAAK,CAACS,KAAK,GAAG,EAAE,OAAI,CAAC;YAC1C;UACF,CAAC,CAAC,CACDV,EAAE,CAAC,UAAU,EAAE,YAAW;YACzB1E,OAAO,CAAC+E,UAAU,CAAC,CAAC,CAACC,QAAQ,CAAC,GAAG,CAAC,CAAC7E,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC;UACxD,CAAC,CAAC;QACN;;QAEA;QACA,IAAMiI,QAAQ,GAAGtC,aAAa,CAACY,QAAQ,CAAC;QACxC,IAAI0B,QAAQ,IAAI,CAACA,QAAQ,CAAC/C,QAAQ,CAAC,KAAK,CAAC,EAAE;UACzC,IAAMgD,WAAW,GAAG7M,CAAC,CAACyE,MAAM,CAAC,MAAM,CAAC,CACjCC,IAAI,CAAC,OAAO,oBAAAJ,MAAA,CAAoBqD,SAAQ,CAAE,CAAC,CAC3CjD,IAAI,CAAC,GAAG,EAAEkI,QAAQ,CAAC,CACnBlI,IAAI,CAAC,MAAM,EAAE,MAAM,CAAC,CACpBA,IAAI,CAAC,QAAQ,EAAEgH,eAAe,CAAC,CAC/BhH,IAAI,CAAC,cAAc,EAAE,GAAG,CAAC,CACzBA,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAClBgE,KAAK,CAAC;YAAEwC,QAAQ,EAAEA,QAAQ;YAAEvL,KAAK,EAAEA,KAAK;YAAEgI,QAAQ,EAAEA;UAAS,CAAC,CAAC,CAAC;UAAA,CAChEhD,KAAK,CAAC,QAAQ,EAAE,SAAS,CAAC;;UAE7B;UACAkI,WAAW,CACR3D,EAAE,CAAC,WAAW,EAAE,UAASC,KAAK,EAAE;YAC/B;YACA,IAAA2D,YAAA,GAAyB1O,EAAE,CAAC0N,OAAO,CAAC3C,KAAK,EAAEnJ,CAAC,CAAC+L,IAAI,CAAC,CAAC,CAAC;cAAAgB,YAAA,GAAAd,cAAA,CAAAa,YAAA;cAA7CZ,MAAM,GAAAa,YAAA;cAAEZ,MAAM,GAAAY,YAAA;;YAErB;YACA,IAAIX,WAAW,GAAG7J,QAAQ;YAC1B,IAAI8J,YAAY,GAAG,IAAI;YACvB,IAAIC,eAAe,GAAG,CAAC,CAAC;YAExBpB,QAAQ,CAAClC,OAAO,CAAC,UAACuD,KAAK,EAAEC,GAAG,EAAK;cAC/B,IAAM9B,SAAS,GAAGhK,mBAAmB,CAAC6L,KAAK,CAAC5L,CAAC,EAAE4L,KAAK,CAAC3L,CAAC,EAAE2L,KAAK,CAAC1L,CAAC,CAAC;cAChE,IAAM4L,QAAQ,GAAGjM,IAAI,CAACkM,IAAI,CACxBlM,IAAI,CAACmM,GAAG,CAACT,MAAM,GAAGxB,SAAS,CAAC/J,CAAC,EAAE,CAAC,CAAC,GACjCH,IAAI,CAACmM,GAAG,CAACR,MAAM,GAAGzB,SAAS,CAAC9J,CAAC,EAAE,CAAC,CAClC,CAAC;cACD,IAAI6L,QAAQ,GAAGL,WAAW,EAAE;gBAC1BA,WAAW,GAAGK,QAAQ;gBACtBJ,YAAY,GAAGE,KAAK;gBACpBD,eAAe,GAAGE,GAAG;cACvB;YACF,CAAC,CAAC;;YAEF;YACA,IAAIH,YAAY,IAAID,WAAW,GAAG,GAAG,EAAE;cAAE;cACvC;cACA,IAAI9C,UAAU,GAAG,CAAC;cAClB,IAAI9K,SAAS,IAAIA,SAAS,CAACmJ,SAAQ,CAAC,EAAE;gBACpC,IAAMzH,OAAK,GAAG1B,SAAS,CAACmJ,SAAQ,CAAC;gBACjC,IAAMgB,OAAK,GAAG3J,SAAS,CAACsN,eAAe,CAAC;gBACxC,IAAIpM,OAAK,CAACD,kBAAkB,IAAIC,OAAK,CAACD,kBAAkB,CAAC0I,OAAK,CAAC,KAAK/B,SAAS,EAAE;kBAC7E0C,UAAU,GAAGpJ,OAAK,CAACD,kBAAkB,CAAC0I,OAAK,CAAC;gBAC9C;cACF,CAAC,MAAM;gBACLW,UAAU,GAAG9I,IAAI,CAAC8G,KAAK,CAAC+E,YAAY,CAACpI,KAAK,CAAC;cAC7C;cAEAO,OAAO,CAAC+E,UAAU,CAAC,CAAC,CAACC,QAAQ,CAAC,GAAG,CAAC,CAAC7E,KAAK,CAAC,SAAS,EAAE,IAAI,CAAC;cACzDH,OAAO,CACJiF,IAAI,OAAAnF,MAAA,CAAOtF,SAAS,CAACsN,eAAe,CAAC,eAAAhI,MAAA,CAAY3E,KAAK,yBAAA2E,MAAA,CAAY+H,YAAY,CAACpI,KAAK,CAACyF,OAAO,CAAC,CAAC,CAAC,qCAAApF,MAAA,CAAcgF,UAAU,CAAE,CAAC,CAC1H3E,KAAK,CAAC,MAAM,KAAAL,MAAA,CAAK6E,KAAK,CAACQ,KAAK,GAAG,EAAE,OAAI,CAAC,CACtChF,KAAK,CAAC,KAAK,KAAAL,MAAA,CAAK6E,KAAK,CAACS,KAAK,GAAG,EAAE,OAAI,CAAC;YAC1C;UACF,CAAC,CAAC,CACDV,EAAE,CAAC,UAAU,EAAE,YAAW;YACzB1E,OAAO,CAAC+E,UAAU,CAAC,CAAC,CAACC,QAAQ,CAAC,GAAG,CAAC,CAAC7E,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC;UACxD,CAAC,CAAC;;UAEJ;UACA;UACA,IAAIqI,IAAI,GAAG,CAACzK,QAAQ;UACpB,IAAI0K,QAAQ,GAAG,IAAI;UACnB/B,QAAQ,CAAClC,OAAO,CAAC,UAAAuD,KAAK,EAAI;YACxB,IAAIA,KAAK,CAAC1L,CAAC,GAAGmM,IAAI,EAAE;cAClBA,IAAI,GAAGT,KAAK,CAAC1L,CAAC;cACdoM,QAAQ,GAAGV,KAAK;YAClB;UACF,CAAC,CAAC;UAEF,IAAIU,QAAQ,EAAE;YACZ,IAAMC,YAAY,GAAGxM,mBAAmB,CAACuM,QAAQ,CAACtM,CAAC,EAAEsM,QAAQ,CAACrM,CAAC,EAAEqM,QAAQ,CAACpM,CAAC,CAAC;;YAE5E;YACAb,CAAC,CAACyE,MAAM,CAAC,QAAQ,CAAC,CACfC,IAAI,CAAC,OAAO,qCAAAJ,MAAA,CAAqCqD,SAAQ,CAAE,CAAC,CAC5DjD,IAAI,CAAC,IAAI,EAAEwI,YAAY,CAACvM,CAAC,CAAC,CAC1B+D,IAAI,CAAC,IAAI,EAAEwI,YAAY,CAACtM,CAAC,CAAC,CAC1B8D,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC,CACZA,IAAI,CAAC,MAAM,EAAE,SAAS,CAAC,CACvBA,IAAI,CAAC,QAAQ,EAAEgH,eAAe,CAAC,CAC/BhH,IAAI,CAAC,cAAc,EAAE,CAAC,CAAC,CACvBA,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAClBC,KAAK,CAAC,gBAAgB,EAAE,MAAM,CAAC,CAAC,CAAC;;YAEpC;YACA3E,CAAC,CAACyE,MAAM,CAAC,QAAQ,CAAC,CACfC,IAAI,CAAC,OAAO,qCAAAJ,MAAA,CAAqCqD,SAAQ,CAAE,CAAC,CAC5DjD,IAAI,CAAC,IAAI,EAAEwI,YAAY,CAACvM,CAAC,CAAC,CAC1B+D,IAAI,CAAC,IAAI,EAAEwI,YAAY,CAACtM,CAAC,CAAC,CAC1B8D,IAAI,CAAC,GAAG,EAAE,GAAG,CAAC,CACdA,IAAI,CAAC,MAAM,EAAEgH,eAAe,CAAC,CAC7BhH,IAAI,CAAC,QAAQ,EAAE,MAAM,CAAC,CACtBA,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC,CAClBC,KAAK,CAAC,gBAAgB,EAAE,MAAM,CAAC,CAAC,CAAC;UACtC;UAEA9G,OAAO,CAACC,GAAG,6BAAAwG,MAAA,CAAS3E,KAAK,kDAAA2E,MAAA,CAAYoH,eAAe,4BAAApH,MAAA,CAAU4G,QAAQ,CAACnL,MAAM,CAAE,CAAC;QAClF,CAAC,MAAM;UACLlC,OAAO,CAACgB,IAAI,iBAAAyF,MAAA,CAAO3E,KAAK,gFAAA2E,MAAA,CAAiBsI,QAAQ,CAAE,CAAC;QACtD;MACF,CAAC,MAAM;QACL/O,OAAO,CAACgB,IAAI,iBAAAyF,MAAA,CAAO3E,KAAK,qDAAU,CAAC;MACrC;IACF,CAAC;IA/ND,KAAK,IAAIgI,SAAQ,GAAG,CAAC,EAAEA,SAAQ,GAAGxC,SAAS,EAAEwC,SAAQ,EAAE;MAAAoD,KAAA,CAAAC,SAAA;IAAA;IAgOvDnN,OAAO,CAACC,GAAG,CAAC,eAAe,CAAC;IAC5B;IACA,IAAMqP,UAAU,GAAG,CAAC,CAAC,CAAC;;IAEtB;IACA,SAASC,iBAAiBA,CAACC,KAAK,EAAEC,GAAG,EAAkC;MAAA,IAAhCC,KAAK,GAAA5G,SAAA,CAAA5G,MAAA,QAAA4G,SAAA,QAAAC,SAAA,GAAAD,SAAA,MAAG,MAAM;MAAA,IAAE6G,SAAS,GAAA7G,SAAA,CAAA5G,MAAA,QAAA4G,SAAA,QAAAC,SAAA,GAAAD,SAAA,MAAG,EAAE;MACnE,IAAM4D,IAAI,GAAGvK,CAAC,CAACyE,MAAM,CAAC,MAAM,CAAC,CAC1BC,IAAI,CAAC,OAAO,eAAAJ,MAAA,CAAekJ,SAAS,CAAE,CAAC,CACvC9I,IAAI,CAAC,IAAI,EAAE2I,KAAK,CAAC1M,CAAC,CAAC,CACnB+D,IAAI,CAAC,IAAI,EAAE2I,KAAK,CAACzM,CAAC,CAAC,CACnB8D,IAAI,CAAC,IAAI,EAAE4I,GAAG,CAAC3M,CAAC,CAAC,CACjB+D,IAAI,CAAC,IAAI,EAAE4I,GAAG,CAAC1M,CAAC,CAAC,CACjB8D,IAAI,CAAC,QAAQ,EAAE6I,KAAK,CAAC,CACrB7I,IAAI,CAAC,cAAc,EAAE,CAAC,CAAC,CACvBA,IAAI,CAAC,SAAS,EAAE,GAAG,CAAC;;MAEvB;MACA,IAAM+I,EAAE,GAAGH,GAAG,CAAC3M,CAAC,GAAG0M,KAAK,CAAC1M,CAAC;MAC1B,IAAM+M,EAAE,GAAGJ,GAAG,CAAC1M,CAAC,GAAGyM,KAAK,CAACzM,CAAC;MAC1B,IAAME,KAAK,GAAGN,IAAI,CAACmN,KAAK,CAACD,EAAE,EAAED,EAAE,CAAC;MAChC,IAAMG,WAAW,GAAG,CAAC;;MAErB;MACA,IAAMC,SAAS,GAAGzP,EAAE,CAACyI,IAAI,CAAC,CAAC;MAC3BgH,SAAS,CAAC/G,MAAM,CAACwG,GAAG,CAAC3M,CAAC,EAAE2M,GAAG,CAAC1M,CAAC,CAAC;MAC9BiN,SAAS,CAAC9G,MAAM,CACduG,GAAG,CAAC3M,CAAC,GAAGiN,WAAW,GAAGpN,IAAI,CAACS,GAAG,CAACH,KAAK,GAAGN,IAAI,CAACC,EAAE,GAAG,CAAC,CAAC,EACnD6M,GAAG,CAAC1M,CAAC,GAAGgN,WAAW,GAAGpN,IAAI,CAACW,GAAG,CAACL,KAAK,GAAGN,IAAI,CAACC,EAAE,GAAG,CAAC,CACpD,CAAC;MACDoN,SAAS,CAAC9G,MAAM,CACduG,GAAG,CAAC3M,CAAC,GAAGiN,WAAW,GAAGpN,IAAI,CAACS,GAAG,CAACH,KAAK,GAAGN,IAAI,CAACC,EAAE,GAAG,CAAC,CAAC,EACnD6M,GAAG,CAAC1M,CAAC,GAAGgN,WAAW,GAAGpN,IAAI,CAACW,GAAG,CAACL,KAAK,GAAGN,IAAI,CAACC,EAAE,GAAG,CAAC,CACpD,CAAC;MACDoN,SAAS,CAAC7G,SAAS,CAAC,CAAC;MAErBhH,CAAC,CAACyE,MAAM,CAAC,MAAM,CAAC,CACbC,IAAI,CAAC,OAAO,gBAAAJ,MAAA,CAAgBkJ,SAAS,CAAE,CAAC,CACxC9I,IAAI,CAAC,GAAG,EAAEmJ,SAAS,CAAC5G,QAAQ,CAAC,CAAC,CAAC,CAC/BvC,IAAI,CAAC,MAAM,EAAE6I,KAAK,CAAC,CACnB7I,IAAI,CAAC,SAAS,EAAE,GAAG,CAAC;MAEvB,OAAO;QAAE6F,IAAI,EAAJA,IAAI;QAAE8C,KAAK,EAALA,KAAK;QAAEC,GAAG,EAAHA;MAAI,CAAC;IAC7B;;IAEA;IACA,IAAIQ,MAAM,GAAGpN,mBAAmB,CAAC,CAACyM,UAAU,EAAE,CAACA,UAAU,EAAE,CAAC,CAAC;;IAE7D;IACA,IAAMY,SAAS,GAAG,0BAA0B;IAC5C,IAAMC,SAAS,GAAG,2BAA2B;IAC7C,IAAMC,WAAW,GAAG,sBAAsB;;IAE1C;IACA,IAAIC,QAAQ,GAAGxN,mBAAmB,CAAC0E,UAAU,GAAG+H,UAAU,EAAE,CAACA,UAAU,EAAE,CAAC,CAAC;IAC3EC,iBAAiB,CAACU,MAAM,EAAEI,QAAQ,EAAEH,SAAS,EAAE,QAAQ,CAAC;;IAExD;IACA,IAAII,QAAQ,GAAGzN,mBAAmB,CAAC,CAACyM,UAAU,EAAE9H,UAAU,GAAG8H,UAAU,EAAE,CAAC,CAAC;IAC3EC,iBAAiB,CAACU,MAAM,EAAEK,QAAQ,EAAEJ,SAAS,EAAE,QAAQ,CAAC;;IAExD;IACA,IAAIK,QAAQ,GAAG1N,mBAAmB,CAAC,CAACyM,UAAU,EAAE,CAACA,UAAU,EAAElI,SAAS,GAAGkI,UAAU,CAAC;IACpFC,iBAAiB,CAACU,MAAM,EAAEM,QAAQ,EAAEL,SAAS,EAAE,QAAQ,CAAC;;IAExD;IACA,IAAMM,WAAW,GAAG,EAAE,CAAC,CAAC;;IAExB;IACArP,SAAS,CAACgK,OAAO,CAAC,UAACL,KAAK,EAAE6D,GAAG,EAAK;MAChC,IAAM7L,CAAC,GAAG6L,GAAG,GAAGzH,SAAS,GAAGA,SAAS,GAAG,CAAC;MACzC,IAAMnE,CAAC,GAAG,CAACyN,WAAW,CAAC,CAAC;MACxB,IAAM3D,SAAS,GAAGhK,mBAAmB,CAACC,CAAC,EAAEC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;;MAEhDZ,CAAC,CAACyE,MAAM,CAAC,MAAM,CAAC,CACbC,IAAI,CAAC,OAAO,gCAAAJ,MAAA,CAAgCkI,GAAG,CAAE,CAAC,CAClD9H,IAAI,CAAC,GAAG,EAAEgG,SAAS,CAAC/J,CAAC,CAAC,CACtB+D,IAAI,CAAC,GAAG,EAAEgG,SAAS,CAAC9J,CAAC,CAAC,CACtB8D,IAAI,CAAC,aAAa,EAAE,QAAQ,CAAC,CAC7BA,IAAI,CAAC,MAAM,EAAEsJ,SAAS,CAAC,CACvBtJ,IAAI,CAAC,WAAW,EAAE,MAAM,CAAC,CACzBA,IAAI,CAAC,aAAa,EAAE,KAAK,CAAC,CAC1BC,KAAK,CAAC,aAAa,EAAE,sCAAsC,CAAC,CAC5DA,KAAK,CAAC,aAAa,EAAE,QAAQ,CAAC,CAC9BA,KAAK,CAAC,QAAQ,EAAEsJ,WAAW,CAAC,CAC5BtJ,KAAK,CAAC,cAAc,EAAE,OAAO,CAAC,CAC9BA,KAAK,CAAC,iBAAiB,EAAE,OAAO,CAAC,CACjC2J,IAAI,CAAC3F,KAAK,CAAC;IAChB,CAAC,CAAC;;IAEF;IACA5J,MAAM,CAACiK,OAAO,CAAC,UAACrJ,KAAK,EAAE6M,GAAG,EAAK;MAC7B,IAAIA,GAAG,GAAG,CAAC,KAAK,CAAC,EAAE;QAAE;QACnB,IAAM7L,EAAC,GAAG,CAAC;QACX,IAAMC,EAAC,GAAG4L,GAAG,GAAGxH,SAAS,GAAGA,SAAS,GAAG,CAAC;QACzC,IAAM0F,SAAS,GAAGhK,mBAAmB,CAACC,EAAC,GAAG0N,WAAW,EAAEzN,EAAC,EAAE,CAAC,CAAC;QAE5DZ,CAAC,CAACyE,MAAM,CAAC,MAAM,CAAC,CACbC,IAAI,CAAC,OAAO,gCAAAJ,MAAA,CAAgCkI,GAAG,CAAE,CAAC,CAClD9H,IAAI,CAAC,GAAG,EAAEgG,SAAS,CAAC/J,CAAC,CAAC,CACtB+D,IAAI,CAAC,GAAG,EAAEgG,SAAS,CAAC9J,CAAC,CAAC,CACtB8D,IAAI,CAAC,aAAa,EAAE,KAAK,CAAC,CAC1BA,IAAI,CAAC,MAAM,EAAEsJ,SAAS,CAAC,CACvBtJ,IAAI,CAAC,WAAW,EAAE,MAAM,CAAC,CACzBC,KAAK,CAAC,aAAa,EAAE,sCAAsC,CAAC,CAC5DA,KAAK,CAAC,aAAa,EAAE,QAAQ,CAAC,CAC9BA,KAAK,CAAC,QAAQ,EAAEsJ,WAAW,CAAC,CAC5BtJ,KAAK,CAAC,cAAc,EAAE,OAAO,CAAC,CAC9BA,KAAK,CAAC,iBAAiB,EAAE,OAAO,CAAC,CACjC2J,IAAI,CAAC3O,KAAK,CAAC;MAChB;IACF,CAAC,CAAC;;IAEF;IACA,IAAI4O,SAAS,GAAG7N,mBAAmB,CAAC,CAAC,EAAE,EAAE,CAAC,EAAEuE,SAAS,GAAG,EAAE,CAAC,CAAC,CAAC;IAC7DjF,CAAC,CAACyE,MAAM,CAAC,MAAM,CAAC,CACbC,IAAI,CAAC,OAAO,EAAE,oBAAoB,CAAC,CACnCA,IAAI,CAAC,GAAG,EAAE6J,SAAS,CAAC5N,CAAC,CAAC,CACtB+D,IAAI,CAAC,GAAG,EAAE6J,SAAS,CAAC3N,CAAC,CAAC,CACtB8D,IAAI,CAAC,aAAa,EAAE,QAAQ,CAAC,CAC7BA,IAAI,CAAC,MAAM,EAAEsJ,SAAS,CAAC,CACvBtJ,IAAI,CAAC,WAAW,EAAE,MAAM,CAAC,CACzBA,IAAI,CAAC,aAAa,EAAE,KAAK,CAAC,CAC1BC,KAAK,CAAC,aAAa,EAAE,sCAAsC,CAAC,CAC5DA,KAAK,CAAC,aAAa,EAAE,QAAQ,CAAC,CAC9BA,KAAK,CAAC,QAAQ,EAAEsJ,WAAW,CAAC,CAC5BtJ,KAAK,CAAC,cAAc,EAAE,OAAO,CAAC,CAC9BA,KAAK,CAAC,iBAAiB,EAAE,OAAO,CAAC,CACjC2J,IAAI,CAAC,MAAM,CAAC;IAEfzQ,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAC;;IAEhC;IACA,SAAS0Q,gBAAgBA,CAAA,EAAG;MAC1B;MACA,IAAMlJ,OAAO,GAAG,CACd5E,mBAAmB,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAC5BA,mBAAmB,CAAC0E,UAAU,EAAE,CAAC,EAAE,CAAC,CAAC,EACrC1E,mBAAmB,CAAC,CAAC,EAAE2E,UAAU,EAAE,CAAC,CAAC,EACrC3E,mBAAmB,CAAC0E,UAAU,EAAEC,UAAU,EAAE,CAAC,CAAC,EAC9C3E,mBAAmB,CAAC,CAAC,EAAE,CAAC,EAAEuE,SAAS,CAAC,EACpCvE,mBAAmB,CAAC0E,UAAU,EAAE,CAAC,EAAEH,SAAS,CAAC,CAC9C;MAED,IAAMM,IAAI,GAAGnH,EAAE,CAACuE,GAAG,CAAC2C,OAAO,EAAE,UAAAnF,CAAC;QAAA,OAAIA,CAAC,CAACQ,CAAC;MAAA,EAAC;MACtC,IAAM6E,IAAI,GAAGpH,EAAE,CAACwE,GAAG,CAAC0C,OAAO,EAAE,UAAAnF,CAAC;QAAA,OAAIA,CAAC,CAACQ,CAAC;MAAA,EAAC;MACtC,IAAM8E,IAAI,GAAGrH,EAAE,CAACuE,GAAG,CAAC2C,OAAO,EAAE,UAAAnF,CAAC;QAAA,OAAIA,CAAC,CAACS,CAAC;MAAA,EAAC;MACtC,IAAM8E,IAAI,GAAGtH,EAAE,CAACwE,GAAG,CAAC0C,OAAO,EAAE,UAAAnF,CAAC;QAAA,OAAIA,CAAC,CAACS,CAAC;MAAA,EAAC;MAEtC,IAAM+E,cAAc,GAAGH,IAAI,GAAGD,IAAI;MAClC,IAAMK,eAAe,GAAGF,IAAI,GAAGD,IAAI;;MAEnC;MACA,IAAMI,OAAO,GAAG,EAAE;MAClB,IAAMC,WAAW,GAAGP,IAAI,GAAGM,OAAO;MAClC,IAAME,WAAW,GAAGN,IAAI,GAAGI,OAAO;MAClC,IAAMG,YAAY,GAAGL,cAAc,GAAGE,OAAO,GAAG,CAAC;MACjD,IAAMI,aAAa,GAAGL,eAAe,GAAGC,OAAO,GAAG,CAAC;MAEnDjB,GAAG,CAACF,IAAI,CAAC,SAAS,KAAAJ,MAAA,CAAKwB,WAAW,OAAAxB,MAAA,CAAIyB,WAAW,OAAAzB,MAAA,CAAI0B,YAAY,OAAA1B,MAAA,CAAI2B,aAAa,CAAE,CAAC;;MAErF;MACAE,aAAa,CAAC6C,OAAO,CAAC,UAAAyF,QAAQ,EAAI;QAChC,IAAQ9N,CAAC,GAA8E8N,QAAQ,CAAvF9N,CAAC;UAAEC,CAAC,GAA2E6N,QAAQ,CAApF7N,CAAC;UAAEmH,OAAO,GAAkE0G,QAAQ,CAAjF1G,OAAO;UAAEC,IAAI,GAA4DyG,QAAQ,CAAxEzG,IAAI;UAAEL,QAAQ,GAAkD8G,QAAQ,CAAlE9G,QAAQ;UAAED,QAAQ,GAAwC+G,QAAQ,CAAxD/G,QAAQ;UAAEE,SAAS,GAA6B6G,QAAQ,CAA9C7G,SAAS;UAAEC,SAAS,GAAkB4G,QAAQ,CAAnC5G,SAAS;UAAEC,WAAW,GAAK2G,QAAQ,CAAxB3G,WAAW;;QAElF;QACA,IAAMG,OAAO,GAAGvH,mBAAmB,CAACC,CAAC,EAAEC,CAAC,EAAEmH,OAAO,CAAC;QAClD,IAAMG,OAAO,GAAGxH,mBAAmB,CAACC,CAAC,GAAGoE,SAAS,EAAEnE,CAAC,EAAEmH,OAAO,CAAC;QAC9D,IAAMI,OAAO,GAAGzH,mBAAmB,CAACC,CAAC,GAAGoE,SAAS,EAAEnE,CAAC,GAAGoE,SAAS,EAAE+C,OAAO,CAAC;QAC1E,IAAMK,OAAO,GAAG1H,mBAAmB,CAACC,CAAC,EAAEC,CAAC,GAAGoE,SAAS,EAAE+C,OAAO,CAAC;QAC9D,IAAMM,IAAI,GAAG3H,mBAAmB,CAACC,CAAC,EAAEC,CAAC,EAAEoH,IAAI,CAAC;QAC5C,IAAMM,IAAI,GAAG5H,mBAAmB,CAACC,CAAC,GAAGoE,SAAS,EAAEnE,CAAC,EAAEoH,IAAI,CAAC;QACxD,IAAMO,IAAI,GAAG7H,mBAAmB,CAACC,CAAC,GAAGoE,SAAS,EAAEnE,CAAC,GAAGoE,SAAS,EAAEgD,IAAI,CAAC;QACpE,IAAMQ,IAAI,GAAG9H,mBAAmB,CAACC,CAAC,EAAEC,CAAC,GAAGoE,SAAS,EAAEgD,IAAI,CAAC;;QAExD;QACA,IAAMS,SAAS,GAAGzI,CAAC,CAAC3B,MAAM,UAAAiG,MAAA,CAAUqD,QAAQ,OAAArD,MAAA,CAAIoD,QAAQ,CAAE,CAAC;QAC3D,IAAI,CAACe,SAAS,CAACiG,KAAK,CAAC,CAAC,EAAE;UACtB,IAAMC,KAAK,GAAGlG,SAAS,CAACnK,SAAS,CAAC,MAAM,CAAC;UACzC,IAAMsQ,KAAK,GAAG,CACZ,CAAC3G,OAAO,EAAEC,OAAO,EAAEC,OAAO,EAAEC,OAAO,CAAC;UAAE;UACtC,CAACF,OAAO,EAAEI,IAAI,EAAEC,IAAI,EAAEJ,OAAO,CAAC;UAAE;UAChC,CAACC,OAAO,EAAED,OAAO,EAAEI,IAAI,EAAEC,IAAI,CAAC;UAAE;UAChC,CAACH,IAAI,EAAEC,IAAI,EAAEC,IAAI,EAAEC,IAAI,CAAC,CAAC;UAAA,CAC1B;UAEDmG,KAAK,CAACE,IAAI,CAAC,UAAS1O,CAAC,EAAEsC,CAAC,EAAE;YACxB,IAAIA,CAAC,GAAGmM,KAAK,CAAC7O,MAAM,EAAE;cACpB,IAAM8G,IAAI,GAAGzI,EAAE,CAACyI,IAAI,CAAC,CAAC;cACtBA,IAAI,CAACC,MAAM,CAAC8H,KAAK,CAACnM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC9B,CAAC,EAAEiO,KAAK,CAACnM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC7B,CAAC,CAAC;cACzC,KAAK,IAAI8B,GAAC,GAAG,CAAC,EAAEA,GAAC,GAAGkM,KAAK,CAACnM,CAAC,CAAC,CAAC1C,MAAM,EAAE2C,GAAC,EAAE,EAAE;gBACxCmE,IAAI,CAACE,MAAM,CAAC6H,KAAK,CAACnM,CAAC,CAAC,CAACC,GAAC,CAAC,CAAC/B,CAAC,EAAEiO,KAAK,CAACnM,CAAC,CAAC,CAACC,GAAC,CAAC,CAAC9B,CAAC,CAAC;cAC3C;cACAiG,IAAI,CAACG,SAAS,CAAC,CAAC;cAChB5I,EAAE,CAACC,MAAM,CAAC,IAAI,CAAC,CAACqG,IAAI,CAAC,GAAG,EAAEmC,IAAI,CAACI,QAAQ,CAAC,CAAC,CAAC;YAC5C;UACF,CAAC,CAAC;QACJ;MACF,CAAC,CAAC;;MAEF;MACAb,aAAa,CAAC4C,OAAO,CAAC,UAAA8F,IAAA,EAA6C;QAAA,IAA1CnH,QAAQ,GAAAmH,IAAA,CAARnH,QAAQ;UAAEuD,QAAQ,GAAA4D,IAAA,CAAR5D,QAAQ;UAAEQ,eAAe,GAAAoD,IAAA,CAAfpD,eAAe;QAC1D;QACA;QACA,IAAMqD,cAAc,GAAGC,kBAAA,CAAI9D,QAAQ,EAAE+D,IAAI,CAAC,UAACC,CAAC,EAAE1H,CAAC,EAAK;UAClD,IAAM2H,KAAK,GAAGzO,mBAAmB,CAACwO,CAAC,CAACvO,CAAC,EAAEuO,CAAC,CAACtO,CAAC,EAAEsO,CAAC,CAACrO,CAAC,CAAC;UAChD,IAAMuO,KAAK,GAAG1O,mBAAmB,CAAC8G,CAAC,CAAC7G,CAAC,EAAE6G,CAAC,CAAC5G,CAAC,EAAE4G,CAAC,CAAC3G,CAAC,CAAC;UAChD,OAAOsO,KAAK,CAACxO,CAAC,GAAGyO,KAAK,CAACzO,CAAC;QAC1B,CAAC,CAAC;QAEF,IAAM0O,mBAAmB,GAAGjR,EAAE,CAACmM,IAAI,CAAC,CAAC,CAClCC,KAAK,CAACpM,EAAE,CAACqM,cAAc,CAAC,CACxB9J,CAAC,CAAC,UAACR,CAAC,EAAK;UACR,IAAMuK,SAAS,GAAGhK,mBAAmB,CAACP,CAAC,CAACQ,CAAC,EAAER,CAAC,CAACS,CAAC,EAAET,CAAC,CAACU,CAAC,CAAC;UACpD,OAAO6J,SAAS,CAAC/J,CAAC;QACpB,CAAC,CAAC,CACDC,CAAC,CAAC,UAACT,CAAC,EAAK;UACR,IAAMuK,SAAS,GAAGhK,mBAAmB,CAACP,CAAC,CAACQ,CAAC,EAAER,CAAC,CAACS,CAAC,EAAET,CAAC,CAACU,CAAC,CAAC;UACpD,OAAO6J,SAAS,CAAC9J,CAAC;QACpB,CAAC,CAAC;;QAEJ;QACA,IAAMiM,WAAW,GAAG7M,CAAC,CAAC3B,MAAM,oBAAAiG,MAAA,CAAoBqD,QAAQ,CAAE,CAAC;QAC3D,IAAI,CAACkF,WAAW,CAAC6B,KAAK,CAAC,CAAC,EAAE;UACxB,IAAMY,OAAO,GAAGD,mBAAmB,CAACN,cAAc,CAAC;UACnD,IAAIO,OAAO,IAAI,CAACA,OAAO,CAACzF,QAAQ,CAAC,KAAK,CAAC,EAAE;YACvCgD,WAAW,CAACnI,IAAI,CAAC,GAAG,EAAE4K,OAAO,CAAC;UAChC;QACF;;QAEA;QACA;QACA,IAAMC,mBAAmB,GAAGnR,EAAE,CAACwM,IAAI,CAAC,CAAC,CAClCJ,KAAK,CAACpM,EAAE,CAACqM,cAAc,CAAC,CACxB9J,CAAC,CAAC,UAACR,CAAC,EAAK;UACR,IAAMuK,SAAS,GAAGhK,mBAAmB,CAACP,CAAC,CAACQ,CAAC,EAAER,CAAC,CAACS,CAAC,EAAET,CAAC,CAACU,CAAC,CAAC;UACpD,OAAO6J,SAAS,CAAC/J,CAAC;QACpB,CAAC,CAAC,CACDkK,EAAE,CAAC,UAAC1K,CAAC,EAAK;UACT,IAAMuK,SAAS,GAAGhK,mBAAmB,CAACP,CAAC,CAACQ,CAAC,EAAER,CAAC,CAACS,CAAC,EAAE6G,aAAa,CAAC;UAC9D,OAAOiD,SAAS,CAAC9J,CAAC;QACpB,CAAC,CAAC,CACDkK,EAAE,CAAC,UAAC3K,CAAC,EAAK;UACT,IAAMuK,SAAS,GAAGhK,mBAAmB,CAACP,CAAC,CAACQ,CAAC,EAAER,CAAC,CAACS,CAAC,EAAET,CAAC,CAACU,CAAC,CAAC;UACpD,OAAO6J,SAAS,CAAC9J,CAAC;QACpB,CAAC,CAAC;QAEJ,IAAMgL,WAAW,GAAG5L,CAAC,CAAC3B,MAAM,UAAAiG,MAAA,CAAUqD,QAAQ,CAAE,CAAC;QACjD,IAAI,CAACiE,WAAW,CAAC8C,KAAK,CAAC,CAAC,EAAE;UACxB9C,WAAW,CAAClH,IAAI,CAAC,GAAG,EAAE6K,mBAAmB,CAACR,cAAc,CAAC,CAAC;QAC5D;;QAEA;QACA,IAAI/B,IAAI,GAAG,CAACzK,QAAQ;QACpB,IAAI0K,QAAQ,GAAG,IAAI;QACnB/B,QAAQ,CAAClC,OAAO,CAAC,UAAAuD,KAAK,EAAI;UACxB,IAAIA,KAAK,CAAC1L,CAAC,GAAGmM,IAAI,EAAE;YAClBA,IAAI,GAAGT,KAAK,CAAC1L,CAAC;YACdoM,QAAQ,GAAGV,KAAK;UAClB;QACF,CAAC,CAAC;QAEF,IAAIU,QAAQ,EAAE;UACZ,IAAMC,YAAY,GAAGxM,mBAAmB,CAACuM,QAAQ,CAACtM,CAAC,EAAEsM,QAAQ,CAACrM,CAAC,EAAEqM,QAAQ,CAACpM,CAAC,CAAC;UAC5Eb,CAAC,CAAC3B,MAAM,qBAAAiG,MAAA,CAAqBqD,QAAQ,CAAE,CAAC,CACrCjD,IAAI,CAAC,IAAI,EAAEwI,YAAY,CAACvM,CAAC,CAAC,CAC1B+D,IAAI,CAAC,IAAI,EAAEwI,YAAY,CAACtM,CAAC,CAAC;UAC7BZ,CAAC,CAAC3B,MAAM,qBAAAiG,MAAA,CAAqBqD,QAAQ,CAAE,CAAC,CACrCjD,IAAI,CAAC,IAAI,EAAEwI,YAAY,CAACvM,CAAC,CAAC,CAC1B+D,IAAI,CAAC,IAAI,EAAEwI,YAAY,CAACtM,CAAC,CAAC;QAC/B;MACF,CAAC,CAAC;;MAEF;;MAEA;MACAkN,MAAM,GAAGpN,mBAAmB,CAAC,CAACyM,UAAU,EAAE,CAACA,UAAU,EAAE,CAAC,CAAC;;MAEzD;MACAe,QAAQ,GAAGxN,mBAAmB,CAAC0E,UAAU,GAAG+H,UAAU,EAAE,CAACA,UAAU,EAAE,CAAC,CAAC;MACvEnN,CAAC,CAAC3B,MAAM,CAAC,mBAAmB,CAAC,CAC1BqG,IAAI,CAAC,IAAI,EAAEoJ,MAAM,CAACnN,CAAC,CAAC,CACpB+D,IAAI,CAAC,IAAI,EAAEoJ,MAAM,CAAClN,CAAC,CAAC,CACpB8D,IAAI,CAAC,IAAI,EAAEwJ,QAAQ,CAACvN,CAAC,CAAC,CACtB+D,IAAI,CAAC,IAAI,EAAEwJ,QAAQ,CAACtN,CAAC,CAAC;MAEzB,IAAM4O,UAAU,GAAGhP,IAAI,CAACmN,KAAK,CAACO,QAAQ,CAACtN,CAAC,GAAGkN,MAAM,CAAClN,CAAC,EAAEsN,QAAQ,CAACvN,CAAC,GAAGmN,MAAM,CAACnN,CAAC,CAAC;MAC3E,IAAM8O,YAAY,GAAG,CAAC;MACtB,IAAMC,UAAU,GAAGtR,EAAE,CAACyI,IAAI,CAAC,CAAC;MAC5B6I,UAAU,CAAC5I,MAAM,CAACoH,QAAQ,CAACvN,CAAC,EAAEuN,QAAQ,CAACtN,CAAC,CAAC;MACzC8O,UAAU,CAAC3I,MAAM,CACfmH,QAAQ,CAACvN,CAAC,GAAG8O,YAAY,GAAGjP,IAAI,CAACS,GAAG,CAACuO,UAAU,GAAGhP,IAAI,CAACC,EAAE,GAAG,CAAC,CAAC,EAC9DyN,QAAQ,CAACtN,CAAC,GAAG6O,YAAY,GAAGjP,IAAI,CAACW,GAAG,CAACqO,UAAU,GAAGhP,IAAI,CAACC,EAAE,GAAG,CAAC,CAC/D,CAAC;MACDiP,UAAU,CAAC3I,MAAM,CACfmH,QAAQ,CAACvN,CAAC,GAAG8O,YAAY,GAAGjP,IAAI,CAACS,GAAG,CAACuO,UAAU,GAAGhP,IAAI,CAACC,EAAE,GAAG,CAAC,CAAC,EAC9DyN,QAAQ,CAACtN,CAAC,GAAG6O,YAAY,GAAGjP,IAAI,CAACW,GAAG,CAACqO,UAAU,GAAGhP,IAAI,CAACC,EAAE,GAAG,CAAC,CAC/D,CAAC;MACDiP,UAAU,CAAC1I,SAAS,CAAC,CAAC;MACtBhH,CAAC,CAAC3B,MAAM,CAAC,oBAAoB,CAAC,CAACqG,IAAI,CAAC,GAAG,EAAEgL,UAAU,CAACzI,QAAQ,CAAC,CAAC,CAAC;;MAE/D;MACAkH,QAAQ,GAAGzN,mBAAmB,CAAC,CAACyM,UAAU,EAAE9H,UAAU,GAAG8H,UAAU,EAAE,CAAC,CAAC;MACvEnN,CAAC,CAAC3B,MAAM,CAAC,mBAAmB,CAAC,CAC1BqG,IAAI,CAAC,IAAI,EAAEoJ,MAAM,CAACnN,CAAC,CAAC,CACpB+D,IAAI,CAAC,IAAI,EAAEoJ,MAAM,CAAClN,CAAC,CAAC,CACpB8D,IAAI,CAAC,IAAI,EAAEyJ,QAAQ,CAACxN,CAAC,CAAC,CACtB+D,IAAI,CAAC,IAAI,EAAEyJ,QAAQ,CAACvN,CAAC,CAAC;MAEzB,IAAM+O,UAAU,GAAGnP,IAAI,CAACmN,KAAK,CAACQ,QAAQ,CAACvN,CAAC,GAAGkN,MAAM,CAAClN,CAAC,EAAEuN,QAAQ,CAACxN,CAAC,GAAGmN,MAAM,CAACnN,CAAC,CAAC;MAC3E,IAAMiP,YAAY,GAAG,CAAC;MACtB,IAAMC,UAAU,GAAGzR,EAAE,CAACyI,IAAI,CAAC,CAAC;MAC5BgJ,UAAU,CAAC/I,MAAM,CAACqH,QAAQ,CAACxN,CAAC,EAAEwN,QAAQ,CAACvN,CAAC,CAAC;MACzCiP,UAAU,CAAC9I,MAAM,CACfoH,QAAQ,CAACxN,CAAC,GAAGiP,YAAY,GAAGpP,IAAI,CAACS,GAAG,CAAC0O,UAAU,GAAGnP,IAAI,CAACC,EAAE,GAAG,CAAC,CAAC,EAC9D0N,QAAQ,CAACvN,CAAC,GAAGgP,YAAY,GAAGpP,IAAI,CAACW,GAAG,CAACwO,UAAU,GAAGnP,IAAI,CAACC,EAAE,GAAG,CAAC,CAC/D,CAAC;MACDoP,UAAU,CAAC9I,MAAM,CACfoH,QAAQ,CAACxN,CAAC,GAAGiP,YAAY,GAAGpP,IAAI,CAACS,GAAG,CAAC0O,UAAU,GAAGnP,IAAI,CAACC,EAAE,GAAG,CAAC,CAAC,EAC9D0N,QAAQ,CAACvN,CAAC,GAAGgP,YAAY,GAAGpP,IAAI,CAACW,GAAG,CAACwO,UAAU,GAAGnP,IAAI,CAACC,EAAE,GAAG,CAAC,CAC/D,CAAC;MACDoP,UAAU,CAAC7I,SAAS,CAAC,CAAC;MACtBhH,CAAC,CAAC3B,MAAM,CAAC,oBAAoB,CAAC,CAACqG,IAAI,CAAC,GAAG,EAAEmL,UAAU,CAAC5I,QAAQ,CAAC,CAAC,CAAC;;MAE/D;MACAmH,QAAQ,GAAG1N,mBAAmB,CAAC,CAACyM,UAAU,EAAE,CAACA,UAAU,EAAElI,SAAS,GAAGkI,UAAU,CAAC;MAChFnN,CAAC,CAAC3B,MAAM,CAAC,mBAAmB,CAAC,CAC1BqG,IAAI,CAAC,IAAI,EAAEoJ,MAAM,CAACnN,CAAC,CAAC,CACpB+D,IAAI,CAAC,IAAI,EAAEoJ,MAAM,CAAClN,CAAC,CAAC,CACpB8D,IAAI,CAAC,IAAI,EAAE0J,QAAQ,CAACzN,CAAC,CAAC,CACtB+D,IAAI,CAAC,IAAI,EAAE0J,QAAQ,CAACxN,CAAC,CAAC;MAEzB,IAAMkP,UAAU,GAAGtP,IAAI,CAACmN,KAAK,CAACS,QAAQ,CAACxN,CAAC,GAAGkN,MAAM,CAAClN,CAAC,EAAEwN,QAAQ,CAACzN,CAAC,GAAGmN,MAAM,CAACnN,CAAC,CAAC;MAC3E,IAAMoP,YAAY,GAAG,CAAC;MACtB,IAAMC,UAAU,GAAG5R,EAAE,CAACyI,IAAI,CAAC,CAAC;MAC5BmJ,UAAU,CAAClJ,MAAM,CAACsH,QAAQ,CAACzN,CAAC,EAAEyN,QAAQ,CAACxN,CAAC,CAAC;MACzCoP,UAAU,CAACjJ,MAAM,CACfqH,QAAQ,CAACzN,CAAC,GAAGoP,YAAY,GAAGvP,IAAI,CAACS,GAAG,CAAC6O,UAAU,GAAGtP,IAAI,CAACC,EAAE,GAAG,CAAC,CAAC,EAC9D2N,QAAQ,CAACxN,CAAC,GAAGmP,YAAY,GAAGvP,IAAI,CAACW,GAAG,CAAC2O,UAAU,GAAGtP,IAAI,CAACC,EAAE,GAAG,CAAC,CAC/D,CAAC;MACDuP,UAAU,CAACjJ,MAAM,CACfqH,QAAQ,CAACzN,CAAC,GAAGoP,YAAY,GAAGvP,IAAI,CAACS,GAAG,CAAC6O,UAAU,GAAGtP,IAAI,CAACC,EAAE,GAAG,CAAC,CAAC,EAC9D2N,QAAQ,CAACxN,CAAC,GAAGmP,YAAY,GAAGvP,IAAI,CAACW,GAAG,CAAC2O,UAAU,GAAGtP,IAAI,CAACC,EAAE,GAAG,CAAC,CAC/D,CAAC;MACDuP,UAAU,CAAChJ,SAAS,CAAC,CAAC;MACtBhH,CAAC,CAAC3B,MAAM,CAAC,oBAAoB,CAAC,CAACqG,IAAI,CAAC,GAAG,EAAEsL,UAAU,CAAC/I,QAAQ,CAAC,CAAC,CAAC;;MAE/D;MACAjI,SAAS,CAACgK,OAAO,CAAC,UAACL,KAAK,EAAE6D,GAAG,EAAK;QAChC,IAAM7L,CAAC,GAAG6L,GAAG,GAAGzH,SAAS,GAAGA,SAAS,GAAG,CAAC;QACzC,IAAMnE,CAAC,GAAG,CAACyN,WAAW;QACtB,IAAM3D,SAAS,GAAGhK,mBAAmB,CAACC,CAAC,EAAEC,CAAC,EAAE,CAAC,CAAC;QAC9CZ,CAAC,CAAC3B,MAAM,aAAAiG,MAAA,CAAakI,GAAG,CAAE,CAAC,CACxB9H,IAAI,CAAC,GAAG,EAAEgG,SAAS,CAAC/J,CAAC,CAAC,CACtB+D,IAAI,CAAC,GAAG,EAAEgG,SAAS,CAAC9J,CAAC,CAAC;MAC3B,CAAC,CAAC;;MAEF;MACA7B,MAAM,CAACiK,OAAO,CAAC,UAACrJ,KAAK,EAAE6M,GAAG,EAAK;QAC7B,IAAIA,GAAG,GAAG,CAAC,KAAK,CAAC,EAAE;UACjB,IAAM7L,GAAC,GAAG,CAAC;UACX,IAAMC,GAAC,GAAG4L,GAAG,GAAGxH,SAAS,GAAGA,SAAS,GAAG,CAAC;UACzC,IAAM0F,SAAS,GAAGhK,mBAAmB,CAACC,GAAC,GAAG0N,WAAW,EAAEzN,GAAC,EAAE,CAAC,CAAC;UAC5DZ,CAAC,CAAC3B,MAAM,aAAAiG,MAAA,CAAakI,GAAG,CAAE,CAAC,CACxB9H,IAAI,CAAC,GAAG,EAAEgG,SAAS,CAAC/J,CAAC,CAAC,CACtB+D,IAAI,CAAC,GAAG,EAAEgG,SAAS,CAAC9J,CAAC,CAAC;QAC3B;MACF,CAAC,CAAC;;MAEF;MACA2N,SAAS,GAAG7N,mBAAmB,CAAC,CAAC,EAAE,EAAE,CAAC,EAAEuE,SAAS,GAAG,EAAE,CAAC;MACvDjF,CAAC,CAAC3B,MAAM,CAAC,UAAU,CAAC,CACjBqG,IAAI,CAAC,GAAG,EAAE6J,SAAS,CAAC5N,CAAC,CAAC,CACtB+D,IAAI,CAAC,GAAG,EAAE6J,SAAS,CAAC3N,CAAC,CAAC;IAC3B;;IAEA;IACAgE,GAAG,CAACsE,EAAE,CAAC,WAAW,EAAE,UAASC,KAAK,EAAE;MAClCtE,UAAU,GAAG,IAAI;MACjBC,UAAU,GAAGqE,KAAK,CAAC8G,OAAO;MAC1BrL,GAAG,CAACD,KAAK,CAAC,QAAQ,EAAE,UAAU,CAAC;MAC/BwE,KAAK,CAAC+G,cAAc,CAAC,CAAC;IACxB,CAAC,CAAC;IAEFtL,GAAG,CAACsE,EAAE,CAAC,WAAW,EAAE,UAASC,KAAK,EAAE;MAClC,IAAItE,UAAU,EAAE;QACd,IAAMsL,MAAM,GAAGhH,KAAK,CAAC8G,OAAO,GAAGnL,UAAU;QACzCvE,aAAa,IAAI4P,MAAM,GAAG,IAAI,CAAC,CAAC;;QAEhC;QACA3B,gBAAgB,CAAC,CAAC;QAElB1J,UAAU,GAAGqE,KAAK,CAAC8G,OAAO;QAC1B9G,KAAK,CAAC+G,cAAc,CAAC,CAAC;MACxB;IACF,CAAC,CAAC;IAEFtL,GAAG,CAACsE,EAAE,CAAC,SAAS,EAAE,YAAW;MAC3BrE,UAAU,GAAG,KAAK;MAClBD,GAAG,CAACD,KAAK,CAAC,QAAQ,EAAE,MAAM,CAAC;IAC7B,CAAC,CAAC;IAEFC,GAAG,CAACsE,EAAE,CAAC,YAAY,EAAE,YAAW;MAC9BrE,UAAU,GAAG,KAAK;MAClBD,GAAG,CAACD,KAAK,CAAC,QAAQ,EAAE,MAAM,CAAC;IAC7B,CAAC,CAAC;;IAEF;IACA;IACA,IAAIyL,WAAW;IACf,IAAMC,YAAY,GAAG,SAAfA,YAAYA,CAAA,EAAS;MACzBC,YAAY,CAACF,WAAW,CAAC;MACzBA,WAAW,GAAGG,UAAU,CAAC,YAAM;QAC7B;QACA;QACA1S,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAC;MAClC,CAAC,EAAE,GAAG,CAAC;IACT,CAAC;IAED0S,MAAM,CAACC,gBAAgB,CAAC,QAAQ,EAAEJ,YAAY,CAAC;EACjD;;EAEA;EACA;EACA,IAAMK,iBAAgB,GAAG,SAAnBA,gBAAgBA,CAAA,EAAS;IAC7B,IAAMzO,KAAK,GAAGlE,SAAS,CAAC8D,WAAW,IAAI9D,SAAS,CAAC6D,WAAW;IAC5D,IAAMM,MAAM,GAAGnE,SAAS,CAACiE,YAAY,IAAIjE,SAAS,CAACgE,YAAY;;IAE/D;IACA,IAAIE,KAAK,GAAG,CAAC,IAAIC,MAAM,GAAG,CAAC,EAAE;MAC3BrE,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAC;MAC9BsC,QAAQ,CAAC,CAAC;IACZ,CAAC,MAAM,IAAIrC,SAAS,CAAC4G,KAAK,CAACgM,OAAO,KAAK,MAAM,EAAE;MAC7C;MACA9S,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAC;MAChCsC,QAAQ,CAAC,CAAC;IACZ,CAAC,MAAM;MACLvC,OAAO,CAACC,GAAG,CAAC,aAAa,EAAEmE,KAAK,EAAEC,MAAM,CAAC;MACzCqO,UAAU,CAACG,iBAAgB,EAAE,GAAG,CAAC;IACnC;EACF,CAAC;EAED,IAAI1S,QAAQ,CAAC4S,UAAU,KAAK,SAAS,EAAE;IACrC5S,QAAQ,CAACyS,gBAAgB,CAAC,kBAAkB,EAAE,YAAM;MAClDF,UAAU,CAACG,iBAAgB,EAAE,GAAG,CAAC;IACnC,CAAC,CAAC;EACJ,CAAC,MAAM;IACLH,UAAU,CAACG,iBAAgB,EAAE,GAAG,CAAC;EACnC;AACF,CAAC,EAAE,CAAC;AACJ7S,OAAO,CAACC,GAAG,CAAC,kBAAkB,CAAC","file":"heatmap.8a423f4b.js","sourceRoot":"..\\src","sourcesContent":["module.exports = [\r\n  {\r\n    \"chunk\": 1,\r\n    \"start_index\": 1,\r\n    \"end_index\": 34,\r\n    \"song_count\": 34,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 1,\r\n    \"genre_distribution\": {\r\n      \"rap\": 65,\r\n      \"pop\": 7,\r\n      \"ACG\": 4\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 2,\r\n    \"start_index\": 35,\r\n    \"end_index\": 68,\r\n    \"song_count\": 34,\r\n    \"songs_with_genre\": 34,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"rap\": 66,\r\n      \"pop\": 9,\r\n      \"ACG\": 4,\r\n      \"folk\": 2\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 3,\r\n    \"start_index\": 69,\r\n    \"end_index\": 101,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"rap\": 53,\r\n      \"pop\": 10,\r\n      \"ACG\": 10,\r\n      \"folk\": 2\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 4,\r\n    \"start_index\": 102,\r\n    \"end_index\": 134,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"rap\": 55,\r\n      \"pop\": 26,\r\n      \"ACG\": 8,\r\n      \"folk\": 1,\r\n      \"electronic\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 5,\r\n    \"start_index\": 135,\r\n    \"end_index\": 167,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 32,\r\n    \"songs_without_genre\": 1,\r\n    \"genre_distribution\": {\r\n      \"pop\": 52,\r\n      \"rap\": 7,\r\n      \"electronic\": 6,\r\n      \"ACG\": 4,\r\n      \"rock\": 2,\r\n      \"jazz\": 2,\r\n      \"classical\": 2,\r\n      \"folk\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 6,\r\n    \"start_index\": 168,\r\n    \"end_index\": 200,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 47,\r\n      \"electronic\": 7,\r\n      \"rap\": 6,\r\n      \"ACG\": 4,\r\n      \"classical\": 2,\r\n      \"rock\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 7,\r\n    \"start_index\": 201,\r\n    \"end_index\": 233,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 46,\r\n      \"rap\": 12,\r\n      \"ACG\": 8,\r\n      \"rock\": 3,\r\n      \"electronic\": 2,\r\n      \"jazz\": 2,\r\n      \"classical\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 8,\r\n    \"start_index\": 234,\r\n    \"end_index\": 266,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 42,\r\n      \"electronic\": 11,\r\n      \"rap\": 9,\r\n      \"ACG\": 3,\r\n      \"jazz\": 1,\r\n      \"folk\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 9,\r\n    \"start_index\": 267,\r\n    \"end_index\": 299,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 45,\r\n      \"ACG\": 10,\r\n      \"folk\": 6,\r\n      \"rap\": 3,\r\n      \"rock\": 2,\r\n      \"electronic\": 1,\r\n      \"jazz\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 10,\r\n    \"start_index\": 300,\r\n    \"end_index\": 332,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 51,\r\n      \"ACG\": 8,\r\n      \"electronic\": 5,\r\n      \"rap\": 3,\r\n      \"rock\": 2,\r\n      \"classical\": 2\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 11,\r\n    \"start_index\": 333,\r\n    \"end_index\": 365,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 44,\r\n      \"electronic\": 15,\r\n      \"rap\": 12,\r\n      \"ACG\": 6,\r\n      \"rock\": 2\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 12,\r\n    \"start_index\": 366,\r\n    \"end_index\": 398,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 50,\r\n      \"electronic\": 9,\r\n      \"ACG\": 8,\r\n      \"rock\": 8,\r\n      \"rap\": 3\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 13,\r\n    \"start_index\": 399,\r\n    \"end_index\": 431,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 41,\r\n      \"ACG\": 15,\r\n      \"rap\": 8,\r\n      \"electronic\": 6,\r\n      \"rock\": 4,\r\n      \"classical\": 3\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 14,\r\n    \"start_index\": 432,\r\n    \"end_index\": 464,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 40,\r\n      \"ACG\": 10,\r\n      \"rock\": 10,\r\n      \"electronic\": 7,\r\n      \"rap\": 6\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 15,\r\n    \"start_index\": 465,\r\n    \"end_index\": 497,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 32,\r\n    \"songs_without_genre\": 1,\r\n    \"genre_distribution\": {\r\n      \"pop\": 36,\r\n      \"rock\": 14,\r\n      \"ACG\": 11,\r\n      \"electronic\": 10,\r\n      \"rap\": 2,\r\n      \"folk\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 16,\r\n    \"start_index\": 498,\r\n    \"end_index\": 530,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 32,\r\n    \"songs_without_genre\": 1,\r\n    \"genre_distribution\": {\r\n      \"pop\": 43,\r\n      \"ACG\": 10,\r\n      \"electronic\": 9,\r\n      \"rock\": 5,\r\n      \"rap\": 4,\r\n      \"jazz\": 1,\r\n      \"folk\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 17,\r\n    \"start_index\": 531,\r\n    \"end_index\": 563,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 37,\r\n      \"electronic\": 20,\r\n      \"ACG\": 8,\r\n      \"rock\": 7,\r\n      \"rap\": 5,\r\n      \"folk\": 5,\r\n      \"jazz\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 18,\r\n    \"start_index\": 564,\r\n    \"end_index\": 596,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 32,\r\n    \"songs_without_genre\": 1,\r\n    \"genre_distribution\": {\r\n      \"pop\": 36,\r\n      \"electronic\": 13,\r\n      \"ACG\": 11,\r\n      \"folk\": 6,\r\n      \"rock\": 4\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 19,\r\n    \"start_index\": 597,\r\n    \"end_index\": 629,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 44,\r\n      \"ACG\": 17,\r\n      \"electronic\": 8,\r\n      \"rap\": 6,\r\n      \"rock\": 5,\r\n      \"folk\": 2,\r\n      \"classical\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 20,\r\n    \"start_index\": 630,\r\n    \"end_index\": 662,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 47,\r\n      \"rock\": 12,\r\n      \"rap\": 6,\r\n      \"electronic\": 5,\r\n      \"ACG\": 2,\r\n      \"folk\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 21,\r\n    \"start_index\": 663,\r\n    \"end_index\": 695,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 35,\r\n      \"electronic\": 18,\r\n      \"rock\": 8,\r\n      \"ACG\": 8,\r\n      \"rap\": 3\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 22,\r\n    \"start_index\": 696,\r\n    \"end_index\": 728,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 50,\r\n      \"electronic\": 14,\r\n      \"rap\": 3,\r\n      \"ACG\": 2,\r\n      \"folk\": 1\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 23,\r\n    \"start_index\": 729,\r\n    \"end_index\": 761,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"electronic\": 40,\r\n      \"pop\": 22,\r\n      \"rap\": 8,\r\n      \"ACG\": 4,\r\n      \"rock\": 2\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 24,\r\n    \"start_index\": 762,\r\n    \"end_index\": 794,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 32,\r\n    \"songs_without_genre\": 1,\r\n    \"genre_distribution\": {\r\n      \"pop\": 47,\r\n      \"rock\": 13,\r\n      \"electronic\": 10,\r\n      \"rap\": 4,\r\n      \"folk\": 2,\r\n      \"ACG\": 2\r\n    }\r\n  },\r\n  {\r\n    \"chunk\": 25,\r\n    \"start_index\": 795,\r\n    \"end_index\": 827,\r\n    \"song_count\": 33,\r\n    \"songs_with_genre\": 33,\r\n    \"songs_without_genre\": 0,\r\n    \"genre_distribution\": {\r\n      \"pop\": 56,\r\n      \"electronic\": 6,\r\n      \"rap\": 5,\r\n      \"rock\": 4,\r\n      \"jazz\": 1\r\n    }\r\n  }\r\n];","// ============================================\n// heatmap.js - D3伪3D热力图（等轴测投影）\n// ============================================\n// X轴：风格（genres），Y轴：时间（months），Z轴：乐曲数量\nconsole.log('🎨 D3伪3D热力图脚本开始加载...');\n(() => {\n  // 优先使用 heatmap-3d 容器\n  const container = document.getElementById(\"heatmap-3d\") || document.getElementById(\"heatmap\");\n  if (!container) {\n    console.error('❌ 找不到heatmap容器');\n    return;\n  }\n  \n  container.innerHTML = '';\n  d3.select(\"body\").selectAll(\".heatmap-tooltip\").remove();\n\n  let genreData = null;\n  let surfaceData = null;\n  // ✅ 3D 折线/曲目数量：使用该 JSON 的 genre_distribution（你说“之前是对的”的那套映射）\n  let lineGenreData = null;\n  try {\n    lineGenreData = require('./assets/歌单_2314343014_genre分布统计_归类后.json');\n    console.log('✅ 3D折线：通过 require 成功导入 genre_distribution JSON');\n  } catch (e) {\n    console.warn('⚠️ 3D折线：require 导入 JSON 失败，将回退到 2D CSV 数据：', e && e.message ? e.message : e);\n    lineGenreData = null;\n  }\n\n  const months = [\n    '2023-12', '2024-01', '2024-02', '2024-03', '2024-04', '2024-05', '2024-06',\n    '2024-07', '2024-08', '2024-09', '2024-10', '2024-11', '2024-12',\n    '2025-01', '2025-02', '2025-03', '2025-04', '2025-05', '2025-06',\n    '2025-07', '2025-08', '2025-09', '2025-10', '2025-11', '2025-12'\n  ];\n\n  const allGenres = [\"ACG\", \"classical\", \"electronic\", \"folk\", \"jazz\", \"pop\", \"rap\", \"rock\"];\n\n  // ✅ 与 2D 热力图保持一致的数据源（避免 3D 使用 JSON 失败后随机数导致“XOY 平面数据不一致”）\n  const CSV_DATA_2D = `month,classical,electronic,folk,jazz,pop,rock,ACG,rap\n2023-12,35,34,64,47,24,32,37,37\n2024-01,35,33,58,46,23,31,32,36\n2024-02,34,32,62,48,26,33,34,39\n2024-03,35,34,59,48,23,34,37,38\n2024-04,31,34,55,47,21,34,31,36\n2024-05,32,48,57,46,24,34,32,38\n2024-06,32,49,62,48,23,36,31,40\n2024-07,31,38,64,49,25,32,31,38\n2024-08,30,39,62,46,23,32,32,37\n2024-09,32,35,60,45,23,36,33,45\n2024-10,31,32,60,49,23,33,31,46\n2024-11,35,33,58,45,22,32,32,39\n2024-12,35,35,63,48,23,33,37,39\n2025-01,32,34,54,47,22,32,32,38\n2025-02,33,33,58,48,22,31,29,42\n2025-03,33,32,56,48,22,31,31,36\n2025-04,31,33,59,45,22,31,30,36\n2025-05,30,37,58,46,23,32,30,39\n2025-06,29,33,57,46,21,32,31,36\n2025-07,29,36,60,48,21,39,31,38\n2025-08,31,35,59,46,22,34,31,34\n2025-09,30,32,61,46,22,33,30,32\n2025-10,33,33,59,44,21,34,31,36\n2025-11,31,32,57,46,21,33,30,33\n2025-12,33,32,60,45,23,32,33,39`;\n\n  function buildFrom2DCsv() {\n    const rows = d3.csvParse(CSV_DATA_2D.trim());\n    // 统一成 heatmap.js 原来的 genreData 结构：[{month, genre_distribution:{...}}]\n    genreData = months.map((m) => {\n      const row = rows.find(r => r.month === m);\n      const dist = {};\n      for (const g of allGenres) dist[g] = row ? (+row[g] || 0) : 0;\n      return { month: m, genre_distribution: dist };\n    });\n\n    // 同时生成 surfaceData（monthIdx x genreIdx）\n    surfaceData = months.map((m) => {\n      const chunk = genreData.find(d => d.month === m);\n      return allGenres.map(g => (chunk && chunk.genre_distribution ? (chunk.genre_distribution[g] || 0) : 0));\n    });\n  }\n\n  function loadData() {\n    // 直接使用与 2D 一致的 CSV 数据，保证 XOY 平面一致\n    console.log('✅ 3D热力图使用与2D一致的CSV数据源');\n    buildFrom2DCsv();\n    processData();\n    init3DHeatmap();\n  }\n\n  function processData() {\n    // surfaceData 已在 buildFrom2DCsv 中生成；这里兜底确保结构正确\n    if (!surfaceData || surfaceData.length !== months.length) {\n      buildFrom2DCsv();\n    }\n    \n    console.log('✅ 数据处理完成');\n  }\n\n  // 旋转角度（全局变量，支持鼠标拖动旋转）\n  let rotationAngle = Math.PI / 6; // 默认30度\n\n  // 等轴测投影函数（支持旋转）\n  function isometricProjection(x, y, z) {\n    // 等轴测投影：x轴向右，y轴向前（深度），z轴向上\n    // 支持水平旋转（绕Z轴）\n    const angle = Math.PI / 6; // 基础等轴测角度30度\n    const scale = 1.2; // 稍微放大一点，让3D效果更明显\n    \n    // 应用水平旋转\n    const cosR = Math.cos(rotationAngle);\n    const sinR = Math.sin(rotationAngle);\n    const rotatedX = x * cosR - y * sinR;\n    const rotatedY = x * sinR + y * cosR;\n    \n    // 等轴测投影\n    const isoX = (rotatedX - rotatedY) * Math.cos(angle) * scale;\n    const isoY = (rotatedX + rotatedY) * Math.sin(angle) * scale - z * scale;\n    return { x: isoX, y: isoY };\n  }\n\n  function init3DHeatmap() {\n    if (!surfaceData || surfaceData.length === 0) {\n      console.warn('surfaceData为空，创建默认数据');\n      surfaceData = Array(25).fill(null).map(() => Array(allGenres.length).fill(10));\n    }\n\n    // 获取容器尺寸的函数 - 使用实际容器尺寸\n    const getContainerSize = () => {\n      // 获取实际容器尺寸，如果为0则使用默认值\n      const actualWidth = container.clientWidth || container.offsetWidth || 1600;\n      const actualHeight = container.clientHeight || container.offsetHeight || 800;\n      return {\n        width: actualWidth > 0 ? actualWidth : 1600,\n        height: actualHeight > 0 ? actualHeight : 800\n      };\n    };\n\n    let containerSize = getContainerSize();\n    // 使用实际容器尺寸，不强制最小值\n    let containerWidth = containerSize.width;\n    let containerHeight = containerSize.height;\n\n    // 计算数据范围\n    let minValue = Infinity;\n    let maxValue = 0;\n    for (let i = 0; i < surfaceData.length; i++) {\n      for (let j = 0; j < surfaceData[i].length; j++) {\n        minValue = Math.min(minValue, surfaceData[i][j]);\n        maxValue = Math.max(maxValue, surfaceData[i][j]);\n      }\n    }\n    if (maxValue === 0) maxValue = 1;\n    const valueRange = maxValue - minValue || 1;\n\n    // ✅ 赛博霓虹渐变（与 2D 使用同一套主题色），保证 2D/3D 颜色映射一致\n    function cssVar(name, fallback) {\n      const v = getComputedStyle(document.documentElement).getPropertyValue(name);\n      return (v || \"\").trim() || fallback;\n    }\n    const accentBlue = cssVar(\"--accent-blue\", \"#32a7ff\");\n    const accentViolet = cssVar(\"--accent-violet\", \"#7c3aed\");\n    const accentPink = cssVar(\"--accent-pink\", \"#ff3bd4\");\n    const accentCyan = cssVar(\"--accent-cyan\", \"#00fff0\");\n\n    // 赛博渐变：进一步提亮下界，并降低粉色段强度（避免 pop 行过于突出）\n    // 渐变段数收敛到 4 段：整体更“连续”，同时保持低值不黑、高值端带一点粉\n    const cyberStops = [\n      \"#3a2a6d\",\n      accentBlue,\n      accentCyan,\n      \"#ff5adf\"\n    ];\n    const cyberInterpolator = d3.interpolateRgbBasis(cyberStops);\n\n    const colorScale = d3.scaleSequential()\n      .domain([minValue, maxValue])\n      .interpolator(cyberInterpolator);\n\n    function getColor(value) {\n      return colorScale(value || 0);\n    }\n\n    // === 颜色映射图例（2D/3D 共用容器）===\n    (function updateLegend() {\n      const legend = document.getElementById(\"heatmap-color-legend\");\n      if (!legend) return;\n      const fmt = d3.format(\",d\");\n      legend.innerHTML = `\n        <div class=\"legend-title\">Score → Color</div>\n        <div class=\"legend-bar\" style=\"background: linear-gradient(90deg, ${cyberStops.join(\",\")});\"></div>\n        <div class=\"legend-labels\">\n          <span>${fmt(minValue ?? 0)}</span>\n          <span>${fmt(maxValue ?? 0)}</span>\n        </div>\n      `;\n    })();\n\n    // 创建tooltip\n    const tooltip = d3.select(\"body\").append(\"div\")\n      .attr(\"class\", \"heatmap-tooltip\")\n      .style(\"position\", \"absolute\")\n      .style(\"pointer-events\", \"none\")\n      .style(\"opacity\", 0)\n      .style(\"padding\", \"10px 12px\")\n      .style(\"border-radius\", \"12px\")\n      .style(\"background\", \"rgba(30,41,59,0.92)\")\n      .style(\"color\", \"#fff\")\n      .style(\"font\", '13px/1.35 system-ui,-apple-system,\"Segoe UI\",\"Microsoft YaHei\",sans-serif')\n      .style(\"box-shadow\", \"0 10px 24px rgba(0,0,0,0.16)\")\n      .style(\"z-index\", 1000);\n\n    // 创建SVG，先不设置viewBox，等计算完内容尺寸后再设置\n    const svg = d3.select(container)\n      .append(\"svg\")\n      .attr(\"width\", \"100%\")\n      .attr(\"height\", \"100%\")\n      .style(\"cursor\", \"grab\");\n    \n    // 鼠标拖动旋转相关变量\n    let isDragging = false;\n    let lastMouseX = 0;\n\n    // 3D空间参数（放大）\n    const cellWidth = 50;  // 每个单元格的宽度（X轴：genre方向）\n    const cellDepth = 25;  // 每个单元格的深度（Y轴：month方向）\n    const maxHeight = 120;  // 最大高度（Z轴）\n    const numGenres = allGenres.length;\n    const numMonths = months.length;\n\n    // 计算3D空间的边界\n    const totalWidth = numGenres * cellWidth;\n    const totalDepth = numMonths * cellDepth;\n\n    // 计算投影后的边界，用于居中\n    const corners = [\n      isometricProjection(0, 0, 0),\n      isometricProjection(totalWidth, 0, 0),\n      isometricProjection(0, totalDepth, 0),\n      isometricProjection(totalWidth, totalDepth, 0),\n      isometricProjection(0, 0, maxHeight),\n      isometricProjection(totalWidth, 0, maxHeight)\n    ];\n\n    const minX = d3.min(corners, d => d.x);\n    const maxX = d3.max(corners, d => d.x);\n    const minY = d3.min(corners, d => d.y);\n    const maxY = d3.max(corners, d => d.y);\n\n    const projectedWidth = maxX - minX;\n    const projectedHeight = maxY - minY;\n\n    // 添加边距，确保内容不会被裁剪\n    const padding = 50;\n    const viewBoxMinX = minX - padding;\n    const viewBoxMinY = minY - padding;\n    const viewBoxWidth = projectedWidth + padding * 2;\n    const viewBoxHeight = projectedHeight + padding * 2;\n    \n    // 使用内容尺寸作为 viewBox，让 SVG 自动缩放适应容器\n    // preserveAspectRatio=\"xMidYMid meet\" 会自动居中内容\n    svg.attr(\"viewBox\", `${viewBoxMinX} ${viewBoxMinY} ${viewBoxWidth} ${viewBoxHeight}`)\n       .attr(\"preserveAspectRatio\", \"xMidYMid meet\");\n\n    // 不需要 transform，内容使用原始坐标\n    // viewBox 已经包含了所有内容，preserveAspectRatio 会自动居中\n    const g = svg.append(\"g\");\n\n    // 存储所有交互元素\n    const interactiveElements = [];\n    \n    // 存储所有单元格数据，用于旋转时重新渲染\n    const cellDataArray = [];\n    // 存储所有折线数据\n    const lineDataArray = [];\n\n    // 辅助函数：绘制立方体的一个面\n    function drawFace(svgGroup, points, fillColor, strokeColor, opacity = 1) {\n      const path = d3.path();\n      path.moveTo(points[0].x, points[0].y);\n      for (let i = 1; i < points.length; i++) {\n        path.lineTo(points[i].x, points[i].y);\n      }\n      path.closePath();\n      \n      return svgGroup.append(\"path\")\n        .attr(\"d\", path.toString())\n        .attr(\"fill\", fillColor)\n        .attr(\"stroke\", strokeColor)\n        .attr(\"stroke-width\", 0.5)\n        .attr(\"opacity\", opacity);\n    }\n\n    // 辅助函数：使颜色变暗（用于侧面）\n    function darkenColor(rgb, factor) {\n      const match = rgb.match(/\\d+/g);\n      if (!match) return rgb;\n      const r = Math.max(0, Math.round(parseInt(match[0]) * factor));\n      const g = Math.max(0, Math.round(parseInt(match[1]) * factor));\n      const b = Math.max(0, Math.round(parseInt(match[2]) * factor));\n      return `rgb(${r}, ${g}, ${b})`;\n    }\n\n    // ========== 第一步：绘制3D热力图（带厚度的立方体） ==========\n    const cellThickness = 6; // 每个单元格的厚度（Z轴高度），参考图看起来约6像素\n    \n    for (let genreIdx = 0; genreIdx < numGenres; genreIdx++) {\n      for (let monthIdx = 0; monthIdx < numMonths; monthIdx++) {\n        const value = surfaceData[monthIdx][genreIdx];\n        const baseColor = getColor(value);\n        const darkColor = darkenColor(baseColor, 0.85); // 侧面颜色（稍微暗一点，不要太深）\n        const darkerColor = darkenColor(baseColor, 0.75); // 背面颜色（稍微更暗一点）\n\n        // 3D坐标（X=genre, Y=month, Z=0为底部，Z=thickness为顶部）\n        const x = genreIdx * cellWidth;\n        const y = monthIdx * cellDepth;\n        const zBottom = 0;\n        const zTop = cellThickness;\n\n        // 计算立方体的8个顶点\n        // 底部四个角\n        const bottom1 = isometricProjection(x, y, zBottom);\n        const bottom2 = isometricProjection(x + cellWidth, y, zBottom);\n        const bottom3 = isometricProjection(x + cellWidth, y + cellDepth, zBottom);\n        const bottom4 = isometricProjection(x, y + cellDepth, zBottom);\n        \n        // 顶部四个角\n        const top1 = isometricProjection(x, y, zTop);\n        const top2 = isometricProjection(x + cellWidth, y, zTop);\n        const top3 = isometricProjection(x + cellWidth, y + cellDepth, zTop);\n        const top4 = isometricProjection(x, y + cellDepth, zTop);\n\n        // 创建单元格组\n        const cellGroup = g.append(\"g\")\n          .attr(\"class\", `cell-group cell-${monthIdx}-${genreIdx}`)\n          .datum({\n            month: months[monthIdx],\n            genre: allGenres[genreIdx],\n            value: value,\n            monthIdx: monthIdx,\n            genreIdx: genreIdx,\n            x: x,\n            y: y,\n            z: zBottom\n          })\n          .style(\"cursor\", \"pointer\");\n        \n        // 存储单元格数据\n        cellDataArray.push({\n          monthIdx,\n          genreIdx,\n          x,\n          y,\n          zBottom,\n          zTop,\n          value,\n          baseColor,\n          darkColor,\n          darkerColor,\n          cellGroup\n        });\n\n        // 绘制立方体的各个面（从后往前，确保正确的遮挡）\n        // 1. 底面\n        drawFace(cellGroup, [bottom1, bottom2, bottom3, bottom4], baseColor, \"rgba(255,255,255,0.3)\", 0.9);\n        \n        // 2. 右侧面\n        drawFace(cellGroup, [bottom2, top2, top3, bottom3], darkColor, \"rgba(255,255,255,0.2)\", 0.9);\n        \n        // 3. 背面\n        drawFace(cellGroup, [bottom4, bottom3, top3, top4], darkerColor, \"rgba(255,255,255,0.2)\", 0.85);\n        \n        // 4. 顶面（最后绘制，确保在最上层）\n        const topFace = drawFace(cellGroup, [top1, top2, top3, top4], baseColor, \"rgba(255,255,255,0.4)\", 1);\n        \n        // 将顶面添加到交互元素（用于tooltip）\n        interactiveElements.push(topFace);\n      }\n    }\n\n\n    // ========== 添加交互事件 ==========\n    // 折线/曲目数量的数据源：优先 JSON（lineGenreData），否则回退到 CSV（genreData）\n    const lineSource = (lineGenreData && Array.isArray(lineGenreData) && lineGenreData.length) ? lineGenreData : genreData;\n\n    interactiveElements.forEach(element => {\n      element\n        .on(\"mouseover\", function(event, d) {\n          // 高亮整个立方体组（找到父组）\n          const parentGroup = d3.select(this.parentNode);\n          parentGroup.selectAll(\"path\")\n            .attr(\"opacity\", 1)\n            .attr(\"stroke-width\", 1.5);\n          \n          // 从JSON文件的genre_distribution获取曲目数量\n          let trackCount = 0;\n          if (lineSource && lineSource[d.monthIdx]) {\n            const chunk = lineSource[d.monthIdx];\n            const genre = allGenres[d.genreIdx];\n            if (chunk.genre_distribution && chunk.genre_distribution[genre] !== undefined) {\n              trackCount = chunk.genre_distribution[genre];\n            }\n          } else {\n            // 如果genreData未加载，使用d.value作为后备\n            trackCount = Math.round(d.value);\n          }\n\n          tooltip.transition().duration(150).style(\"opacity\", 0.95);\n          tooltip\n            .html(`<b>${d.genre}</b><br/>${d.month}<br/>分值: ${d.value.toFixed(2)}<br/>曲目数量: ${trackCount}`)\n            .style(\"left\", `${event.pageX + 12}px`)\n            .style(\"top\", `${event.pageY - 18}px`);\n        })\n        .on(\"mouseout\", function() {\n          // 恢复整个立方体组的原始样式\n          const parentGroup = d3.select(this.parentNode);\n          parentGroup.selectAll(\"path\")\n            .attr(\"opacity\", function() {\n              // 根据面的类型恢复不同的透明度\n              const fill = d3.select(this).attr(\"fill\");\n              if (fill && fill.includes(\"rgb\")) {\n                const match = fill.match(/\\d+/g);\n                if (match) {\n                  const r = parseInt(match[0]);\n                  const g = parseInt(match[1]);\n                  const b = parseInt(match[2]);\n                  // 根据亮度判断是顶面、侧面还是底面\n                  const brightness = (r + g + b) / 3;\n                  if (brightness > 200) return 1; // 顶面\n                  if (brightness > 150) return 0.85; // 侧面\n                  return 0.8; // 背面/底面\n                }\n              }\n              return 0.9;\n            })\n            .attr(\"stroke-width\", 0.5);\n          tooltip.transition().duration(200).style(\"opacity\", 0);\n        });\n    });\n\n    // ========== 添加折线趋势图（每个月份一条，沿X轴延伸，Z轴表示高度） ==========\n    // 计算折线高度的范围\n    let minLineHeight = Infinity;\n    let maxLineHeight = 0;\n    if (lineSource && lineSource.length > 0) {\n      for (let i = 0; i < lineSource.length; i++) {\n        const chunk = lineSource[i];\n        if (chunk && chunk.genre_distribution) {\n          for (let genre of allGenres) {\n            const val = chunk.genre_distribution[genre] || 0;\n            minLineHeight = Math.min(minLineHeight, val);\n            maxLineHeight = Math.max(maxLineHeight, val);\n          }\n        }\n      }\n    }\n    \n    // 如果genreData为空，使用surfaceData的数据\n    if (!lineSource || lineSource.length === 0 || minLineHeight === Infinity) {\n      minLineHeight = Infinity;\n      maxLineHeight = 0;\n      for (let i = 0; i < surfaceData.length; i++) {\n        for (let j = 0; j < surfaceData[i].length; j++) {\n          const val = surfaceData[i][j] || 0;\n          minLineHeight = Math.min(minLineHeight, val);\n          maxLineHeight = Math.max(maxLineHeight, val);\n        }\n      }\n    }\n    \n    // 确保有有效的数据范围\n    if (minLineHeight === Infinity) minLineHeight = 0;\n    if (maxLineHeight === 0) maxLineHeight = 1;\n    const lineHeightRange = maxLineHeight - minLineHeight || 1;\n    const maxLineZ = maxHeight * 1.2; // 折线最大高度，降低高度\n    \n    console.log('📊 折线图数据范围:', { minLineHeight, maxLineHeight, lineHeightRange, maxLineZ });\n\n    // D3的平滑曲线生成器（沿X轴延伸，所以用curveMonotoneX）\n    const lineGenerator = d3.line()\n      .curve(d3.curveMonotoneX) // 平滑曲线，沿X轴\n      .x((d) => {\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.x;\n      })\n      .y((d) => {\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.y;\n      });\n\n    // D3的面积生成器（用于填充）\n    const areaGenerator = d3.area()\n      .curve(d3.curveMonotoneX) // 沿X轴\n      .x((d) => {\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.x;\n      })\n      .y0((d) => {\n        // 底部（热力图顶部）\n        const projected = isometricProjection(d.x, d.y, cellThickness);\n        return projected.y;\n      })\n      .y1((d) => {\n        // 顶部（折线高度）\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.y;\n      });\n\n    // 为每个月份绘制折线（沿X轴：风格方向）\n    for (let monthIdx = 0; monthIdx < numMonths; monthIdx++) {\n      const month = months[monthIdx];\n      const monthY = monthIdx * cellDepth + cellDepth / 2; // 月份的中心Y坐标\n      \n      // 生成折线的数据点（沿X轴：从genre 0到genre 7）\n      const lineData = [];\n      for (let genreIdx = 0; genreIdx < numGenres; genreIdx++) {\n        let value = 0;\n        if (lineSource && lineSource[monthIdx] && lineSource[monthIdx].genre_distribution) {\n          const genre = allGenres[genreIdx];\n          value = lineSource[monthIdx].genre_distribution[genre] || 0;\n        } else if (surfaceData && surfaceData[monthIdx]) {\n          // 如果genreData为空，使用surfaceData\n          value = surfaceData[monthIdx][genreIdx] || 0;\n        }\n        \n        // 归一化高度，确保不会出现NaN\n        const normalizedValue = lineHeightRange > 0 ? (value - minLineHeight) / lineHeightRange : 0;\n        const z = cellThickness + (isNaN(normalizedValue) ? 0 : normalizedValue) * maxLineZ; // 从热力图顶部开始\n        \n        const genreX = genreIdx * cellWidth + cellWidth / 2; // genre的中心X坐标\n        \n        // 验证坐标不是NaN\n        if (!isNaN(genreX) && !isNaN(monthY) && !isNaN(z)) {\n          lineData.push({\n            x: genreX,\n            y: monthY,\n            z: z,\n            value: value,\n            monthIdx: monthIdx,\n            genreIdx: genreIdx\n          });\n        }\n      }\n\n      // 获取该月份的平均颜色（使用热力图的颜色方案，但加深颜色使其更明显）\n      const avgValue = lineData.reduce((sum, d) => sum + d.value, 0) / lineData.length;\n      let lineColor = getColor(avgValue);\n      // 折线颜色：不要太暗（更贴合赛博背景、提升可读性）\n      const darkerLineColor = darkenColor(lineColor, 0.86);\n      \n      // 存储折线数据（用于旋转时更新）\n      if (lineData.length > 0) {\n        lineDataArray.push({\n          monthIdx,\n          month,\n          lineData: [...lineData], // 复制数组\n          darkerLineColor,\n          lineColor\n        });\n      }\n      \n      // 只有当有有效数据点时才绘制\n      if (lineData.length > 0) {\n        // 创建面积填充（半透明）\n        const areaPath = areaGenerator(lineData);\n        if (areaPath && !areaPath.includes('NaN')) {\n          const areaElement = g.append(\"path\")\n            .attr(\"class\", `area-path area-${monthIdx}`)\n            .attr(\"d\", areaPath)\n            .attr(\"fill\", darkerLineColor)\n            .attr(\"fill-opacity\", 0.28)\n            .attr(\"stroke\", \"none\")\n            .datum({ lineData: lineData, month: month, monthIdx: monthIdx }) // 存储数据\n            .style(\"cursor\", \"pointer\");\n          \n          // 为面积填充也添加鼠标事件（确保tooltip能显示）\n          areaElement\n            .on(\"mousemove\", function(event) {\n              // 获取鼠标在SVG中的坐标\n              const [mouseX, mouseY] = d3.pointer(event, g.node());\n              \n              // 找到最近的数据点\n              let minDistance = Infinity;\n              let nearestPoint = null;\n              let nearestGenreIdx = -1;\n              \n              lineData.forEach((point, idx) => {\n                const projected = isometricProjection(point.x, point.y, point.z);\n                const distance = Math.sqrt(\n                  Math.pow(mouseX - projected.x, 2) + \n                  Math.pow(mouseY - projected.y, 2)\n                );\n                if (distance < minDistance) {\n                  minDistance = distance;\n                  nearestPoint = point;\n                  nearestGenreIdx = idx;\n                }\n              });\n              \n              // 增加距离阈值，确保tooltip能显示\n              if (nearestPoint && minDistance < 100) {\n                // 从JSON获取曲目数量\n                let trackCount = 0;\n                if (genreData && genreData[monthIdx]) {\n                  const chunk = genreData[monthIdx];\n                  const genre = allGenres[nearestGenreIdx];\n                  if (chunk.genre_distribution && chunk.genre_distribution[genre] !== undefined) {\n                    trackCount = chunk.genre_distribution[genre];\n                  }\n                } else {\n                  trackCount = Math.round(nearestPoint.value);\n                }\n                \n                tooltip.transition().duration(150).style(\"opacity\", 0.95);\n                tooltip\n                  .html(`<b>${allGenres[nearestGenreIdx]}</b><br/>${month}<br/>分值: ${nearestPoint.value.toFixed(2)}<br/>曲目数量: ${trackCount}`)\n                  .style(\"left\", `${event.pageX + 12}px`)\n                  .style(\"top\", `${event.pageY - 18}px`);\n              }\n            })\n            .on(\"mouseout\", function() {\n              tooltip.transition().duration(200).style(\"opacity\", 0);\n            });\n        }\n\n        // 创建折线（确保在最上层显示，使用深色使其更明显）\n        const linePath = lineGenerator(lineData);\n        if (linePath && !linePath.includes('NaN')) {\n          const lineElement = g.append(\"path\")\n            .attr(\"class\", `line-path line-${monthIdx}`)\n            .attr(\"d\", linePath)\n            .attr(\"fill\", \"none\")\n            .attr(\"stroke\", darkerLineColor)\n            .attr(\"stroke-width\", 3.0)\n            .attr(\"opacity\", 1)\n            .datum({ lineData: lineData, month: month, monthIdx: monthIdx }) // 存储数据\n            .style(\"cursor\", \"pointer\");\n          \n          // 为折线图添加鼠标事件\n          lineElement\n            .on(\"mousemove\", function(event) {\n              // 获取鼠标在SVG中的坐标\n              const [mouseX, mouseY] = d3.pointer(event, g.node());\n              \n              // 找到最近的数据点\n              let minDistance = Infinity;\n              let nearestPoint = null;\n              let nearestGenreIdx = -1;\n              \n              lineData.forEach((point, idx) => {\n                const projected = isometricProjection(point.x, point.y, point.z);\n                const distance = Math.sqrt(\n                  Math.pow(mouseX - projected.x, 2) + \n                  Math.pow(mouseY - projected.y, 2)\n                );\n                if (distance < minDistance) {\n                  minDistance = distance;\n                  nearestPoint = point;\n                  nearestGenreIdx = idx;\n                }\n              });\n              \n              // 增加距离阈值，确保tooltip能显示\n              if (nearestPoint && minDistance < 100) { // 100像素范围内显示tooltip\n                // 从JSON获取曲目数量\n                let trackCount = 0;\n                if (genreData && genreData[monthIdx]) {\n                  const chunk = genreData[monthIdx];\n                  const genre = allGenres[nearestGenreIdx];\n                  if (chunk.genre_distribution && chunk.genre_distribution[genre] !== undefined) {\n                    trackCount = chunk.genre_distribution[genre];\n                  }\n                } else {\n                  trackCount = Math.round(nearestPoint.value);\n                }\n                \n                tooltip.transition().duration(150).style(\"opacity\", 0.95);\n                tooltip\n                  .html(`<b>${allGenres[nearestGenreIdx]}</b><br/>${month}<br/>分值: ${nearestPoint.value.toFixed(2)}<br/>曲目数量: ${trackCount}`)\n                  .style(\"left\", `${event.pageX + 12}px`)\n                  .style(\"top\", `${event.pageY - 18}px`);\n              }\n            })\n            .on(\"mouseout\", function() {\n              tooltip.transition().duration(200).style(\"opacity\", 0);\n            });\n          \n          // ========== 添加最高点标记 ==========\n          // 找到最高点（z值最大的点）\n          let maxZ = -Infinity;\n          let maxPoint = null;\n          lineData.forEach(point => {\n            if (point.z > maxZ) {\n              maxZ = point.z;\n              maxPoint = point;\n            }\n          });\n          \n          if (maxPoint) {\n            const maxProjected = isometricProjection(maxPoint.x, maxPoint.y, maxPoint.z);\n            \n            // 绘制外圈（白色，更大）\n            g.append(\"circle\")\n              .attr(\"class\", `max-point-outer max-point-outer-${monthIdx}`)\n              .attr(\"cx\", maxProjected.x)\n              .attr(\"cy\", maxProjected.y)\n              .attr(\"r\", 6)\n              .attr(\"fill\", \"#ffffff\")\n              .attr(\"stroke\", darkerLineColor)\n              .attr(\"stroke-width\", 2)\n              .attr(\"opacity\", 1)\n              .style(\"pointer-events\", \"none\"); // 允许鼠标事件穿透到折线\n            \n            // 绘制内圈（折线颜色，更小）\n            g.append(\"circle\")\n              .attr(\"class\", `max-point-inner max-point-inner-${monthIdx}`)\n              .attr(\"cx\", maxProjected.x)\n              .attr(\"cy\", maxProjected.y)\n              .attr(\"r\", 3.5)\n              .attr(\"fill\", darkerLineColor)\n              .attr(\"stroke\", \"none\")\n              .attr(\"opacity\", 1)\n              .style(\"pointer-events\", \"none\"); // 允许鼠标事件穿透到折线\n          }\n          \n          console.log(`✅ 已绘制${month}的折线图，颜色: ${darkerLineColor}, 数据点: ${lineData.length}`);\n        } else {\n          console.warn(`⚠️ ${month}的折线路径生成失败，路径: ${linePath}`);\n        }\n      } else {\n        console.warn(`⚠️ ${month}没有有效的数据点`);\n      }\n    }\n    console.log('🎉 折线趋势图绘制完成！');\n    // ========== 添加坐标轴线（原点与第一个方格左上角对齐） ==========\n    const axisOffset = 8; // 坐标轴往外偏移的距离（增加，更往外）\n    \n    // 辅助函数：绘制带箭头的轴线\n    function drawAxisWithArrow(start, end, color = \"#555\", axisClass = \"\") {\n      const line = g.append(\"line\")\n        .attr(\"class\", `axis-line ${axisClass}`)\n        .attr(\"x1\", start.x)\n        .attr(\"y1\", start.y)\n        .attr(\"x2\", end.x)\n        .attr(\"y2\", end.y)\n        .attr(\"stroke\", color)\n        .attr(\"stroke-width\", 2)\n        .attr(\"opacity\", 0.7);\n      \n      // 计算箭头方向\n      const dx = end.x - start.x;\n      const dy = end.y - start.y;\n      const angle = Math.atan2(dy, dx);\n      const arrowLength = 8;\n      \n      // 绘制箭头\n      const arrowPath = d3.path();\n      arrowPath.moveTo(end.x, end.y);\n      arrowPath.lineTo(\n        end.x - arrowLength * Math.cos(angle - Math.PI / 6),\n        end.y - arrowLength * Math.sin(angle - Math.PI / 6)\n      );\n      arrowPath.lineTo(\n        end.x - arrowLength * Math.cos(angle + Math.PI / 6),\n        end.y - arrowLength * Math.sin(angle + Math.PI / 6)\n      );\n      arrowPath.closePath();\n      \n      g.append(\"path\")\n        .attr(\"class\", `axis-arrow ${axisClass}`)\n        .attr(\"d\", arrowPath.toString())\n        .attr(\"fill\", color)\n        .attr(\"opacity\", 0.7);\n      \n      return { line, start, end };\n    }\n\n    // 坐标原点在 (0, 0, 0)，即第一个方格的左上角\n    let origin = isometricProjection(-axisOffset, -axisOffset, 0);\n    \n    // 赛博深色主题：轴线/箭头用浅色系，避免发灰看不清\n    const AXIS_LINE = \"rgba(50, 167, 255, 0.30)\";\n    const AXIS_TEXT = \"rgba(226, 232, 240, 0.88)\";\n    const AXIS_STROKE = \"rgba(7, 3, 18, 0.72)\";\n\n    // X轴（genres方向）- 从原点沿X轴延伸\n    let xAxisEnd = isometricProjection(totalWidth + axisOffset, -axisOffset, 0);\n    drawAxisWithArrow(origin, xAxisEnd, AXIS_LINE, \"x-axis\");\n\n    // Y轴（months方向）- 从原点沿Y轴延伸\n    let yAxisEnd = isometricProjection(-axisOffset, totalDepth + axisOffset, 0);\n    drawAxisWithArrow(origin, yAxisEnd, AXIS_LINE, \"y-axis\");\n\n    // Z轴（高度方向）- 从原点向上延伸\n    let zAxisEnd = isometricProjection(-axisOffset, -axisOffset, maxHeight + axisOffset);\n    drawAxisWithArrow(origin, zAxisEnd, AXIS_LINE, \"z-axis\");\n\n    // ========== 添加坐标轴标签 ==========\n    const labelOffset = 40; // X轴标签往外偏移的距离（增加，确保在方格外面）\n    \n    // X轴标签（genres）- 在底部前方（y<0的部分）\n    allGenres.forEach((genre, idx) => {\n      const x = idx * cellWidth + cellWidth / 2;\n      const y = -labelOffset; // y<0，在底部前方\n      const projected = isometricProjection(x, y, 0); // 在y<0的位置\n      \n      g.append(\"text\")\n        .attr(\"class\", `axis-label x-label x-label-${idx}`)\n        .attr(\"x\", projected.x)\n        .attr(\"y\", projected.y)\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"fill\", AXIS_TEXT)\n        .attr(\"font-size\", \"11px\")\n        .attr(\"font-weight\", \"500\")\n        .style(\"font-family\", \"system-ui, -apple-system, sans-serif\")\n        .style(\"paint-order\", \"stroke\")\n        .style(\"stroke\", AXIS_STROKE)\n        .style(\"stroke-width\", \"2.2px\")\n        .style(\"stroke-linejoin\", \"round\")\n        .text(genre);\n    });\n\n    // Y轴标签（months）- 在左侧\n    months.forEach((month, idx) => {\n      if (idx % 3 === 0) { // 只显示部分月份，避免太密集\n        const x = 0;\n        const y = idx * cellDepth + cellDepth / 2;\n        const projected = isometricProjection(x - labelOffset, y, 0);\n        \n        g.append(\"text\")\n          .attr(\"class\", `axis-label y-label y-label-${idx}`)\n          .attr(\"x\", projected.x)\n          .attr(\"y\", projected.y)\n          .attr(\"text-anchor\", \"end\")\n          .attr(\"fill\", AXIS_TEXT)\n          .attr(\"font-size\", \"10px\")\n          .style(\"font-family\", \"system-ui, -apple-system, sans-serif\")\n          .style(\"paint-order\", \"stroke\")\n          .style(\"stroke\", AXIS_STROKE)\n          .style(\"stroke-width\", \"2.2px\")\n          .style(\"stroke-linejoin\", \"round\")\n          .text(month);\n      }\n    });\n\n    // Z轴标签（乐曲数量）- 再往上移\n    let zLabelPos = isometricProjection(-10, 0, maxHeight + 25); // 增加Z坐标，让标签更往上\n    g.append(\"text\")\n      .attr(\"class\", \"axis-label z-label\")\n      .attr(\"x\", zLabelPos.x)\n      .attr(\"y\", zLabelPos.y)\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"fill\", AXIS_TEXT)\n      .attr(\"font-size\", \"10px\")\n      .attr(\"font-weight\", \"500\")\n      .style(\"font-family\", \"system-ui, -apple-system, sans-serif\")\n      .style(\"paint-order\", \"stroke\")\n      .style(\"stroke\", AXIS_STROKE)\n      .style(\"stroke-width\", \"2.2px\")\n      .style(\"stroke-linejoin\", \"round\")\n      .text(\"乐曲数量\");\n\n    console.log('🎉 D3伪3D热力图初始化完成！');\n\n    // ========== 更新函数：重新渲染所有元素（用于旋转） ==========\n    function updateProjection() {\n      // 重新计算边界\n      const corners = [\n        isometricProjection(0, 0, 0),\n        isometricProjection(totalWidth, 0, 0),\n        isometricProjection(0, totalDepth, 0),\n        isometricProjection(totalWidth, totalDepth, 0),\n        isometricProjection(0, 0, maxHeight),\n        isometricProjection(totalWidth, 0, maxHeight)\n      ];\n      \n      const minX = d3.min(corners, d => d.x);\n      const maxX = d3.max(corners, d => d.x);\n      const minY = d3.min(corners, d => d.y);\n      const maxY = d3.max(corners, d => d.y);\n      \n      const projectedWidth = maxX - minX;\n      const projectedHeight = maxY - minY;\n      \n      // 更新 viewBox\n      const padding = 50;\n      const viewBoxMinX = minX - padding;\n      const viewBoxMinY = minY - padding;\n      const viewBoxWidth = projectedWidth + padding * 2;\n      const viewBoxHeight = projectedHeight + padding * 2;\n      \n      svg.attr(\"viewBox\", `${viewBoxMinX} ${viewBoxMinY} ${viewBoxWidth} ${viewBoxHeight}`);\n      \n      // 更新所有单元格\n      cellDataArray.forEach(cellData => {\n        const { x, y, zBottom, zTop, monthIdx, genreIdx, baseColor, darkColor, darkerColor } = cellData;\n        \n        // 重新计算8个顶点\n        const bottom1 = isometricProjection(x, y, zBottom);\n        const bottom2 = isometricProjection(x + cellWidth, y, zBottom);\n        const bottom3 = isometricProjection(x + cellWidth, y + cellDepth, zBottom);\n        const bottom4 = isometricProjection(x, y + cellDepth, zBottom);\n        const top1 = isometricProjection(x, y, zTop);\n        const top2 = isometricProjection(x + cellWidth, y, zTop);\n        const top3 = isometricProjection(x + cellWidth, y + cellDepth, zTop);\n        const top4 = isometricProjection(x, y + cellDepth, zTop);\n        \n        // 更新单元格组的所有面\n        const cellGroup = g.select(`.cell-${monthIdx}-${genreIdx}`);\n        if (!cellGroup.empty()) {\n          const paths = cellGroup.selectAll(\"path\");\n          const faces = [\n            [bottom1, bottom2, bottom3, bottom4], // 底面\n            [bottom2, top2, top3, bottom3], // 右侧面\n            [bottom4, bottom3, top3, top4], // 背面\n            [top1, top2, top3, top4] // 顶面\n          ];\n          \n          paths.each(function(d, i) {\n            if (i < faces.length) {\n              const path = d3.path();\n              path.moveTo(faces[i][0].x, faces[i][0].y);\n              for (let j = 1; j < faces[i].length; j++) {\n                path.lineTo(faces[i][j].x, faces[i][j].y);\n              }\n              path.closePath();\n              d3.select(this).attr(\"d\", path.toString());\n            }\n          });\n        }\n      });\n      \n      // 更新所有折线\n      lineDataArray.forEach(({ monthIdx, lineData, darkerLineColor }) => {\n        // 重新生成折线路径（使用与初始化时相同的lineGenerator逻辑）\n        // 注意：需要按照投影后的X坐标排序，确保曲线方向正确\n        const sortedLineData = [...lineData].sort((a, b) => {\n          const projA = isometricProjection(a.x, a.y, a.z);\n          const projB = isometricProjection(b.x, b.y, b.z);\n          return projA.x - projB.x;\n        });\n        \n        const lineGeneratorUpdate = d3.line()\n          .curve(d3.curveMonotoneX)\n          .x((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.x;\n          })\n          .y((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.y;\n          });\n        \n        // 更新折线（使用正确的选择器，class是 \"line-path line-${monthIdx}\"）\n        const lineElement = g.select(`.line-path.line-${monthIdx}`);\n        if (!lineElement.empty()) {\n          const newPath = lineGeneratorUpdate(sortedLineData);\n          if (newPath && !newPath.includes('NaN')) {\n            lineElement.attr(\"d\", newPath);\n          }\n        }\n        \n        // 更新面积填充（重新创建areaGenerator，因为投影函数已更新）\n        // 使用排序后的数据，确保与折线一致\n        const areaGeneratorUpdate = d3.area()\n          .curve(d3.curveMonotoneX)\n          .x((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.x;\n          })\n          .y0((d) => {\n            const projected = isometricProjection(d.x, d.y, cellThickness);\n            return projected.y;\n          })\n          .y1((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.y;\n          });\n        \n        const areaElement = g.select(`.area-${monthIdx}`);\n        if (!areaElement.empty()) {\n          areaElement.attr(\"d\", areaGeneratorUpdate(sortedLineData));\n        }\n        \n        // 更新最高点标记\n        let maxZ = -Infinity;\n        let maxPoint = null;\n        lineData.forEach(point => {\n          if (point.z > maxZ) {\n            maxZ = point.z;\n            maxPoint = point;\n          }\n        });\n        \n        if (maxPoint) {\n          const maxProjected = isometricProjection(maxPoint.x, maxPoint.y, maxPoint.z);\n          g.select(`.max-point-outer-${monthIdx}`)\n            .attr(\"cx\", maxProjected.x)\n            .attr(\"cy\", maxProjected.y);\n          g.select(`.max-point-inner-${monthIdx}`)\n            .attr(\"cx\", maxProjected.x)\n            .attr(\"cy\", maxProjected.y);\n        }\n      });\n      \n      // 更新坐标轴（使用外部定义的axisOffset和labelOffset）\n      \n      // 更新原点\n      origin = isometricProjection(-axisOffset, -axisOffset, 0);\n      \n      // 更新X轴\n      xAxisEnd = isometricProjection(totalWidth + axisOffset, -axisOffset, 0);\n      g.select(\".x-axis.axis-line\")\n        .attr(\"x1\", origin.x)\n        .attr(\"y1\", origin.y)\n        .attr(\"x2\", xAxisEnd.x)\n        .attr(\"y2\", xAxisEnd.y);\n      \n      const xAxisAngle = Math.atan2(xAxisEnd.y - origin.y, xAxisEnd.x - origin.x);\n      const xArrowLength = 8;\n      const xArrowPath = d3.path();\n      xArrowPath.moveTo(xAxisEnd.x, xAxisEnd.y);\n      xArrowPath.lineTo(\n        xAxisEnd.x - xArrowLength * Math.cos(xAxisAngle - Math.PI / 6),\n        xAxisEnd.y - xArrowLength * Math.sin(xAxisAngle - Math.PI / 6)\n      );\n      xArrowPath.lineTo(\n        xAxisEnd.x - xArrowLength * Math.cos(xAxisAngle + Math.PI / 6),\n        xAxisEnd.y - xArrowLength * Math.sin(xAxisAngle + Math.PI / 6)\n      );\n      xArrowPath.closePath();\n      g.select(\".x-axis.axis-arrow\").attr(\"d\", xArrowPath.toString());\n      \n      // 更新Y轴\n      yAxisEnd = isometricProjection(-axisOffset, totalDepth + axisOffset, 0);\n      g.select(\".y-axis.axis-line\")\n        .attr(\"x1\", origin.x)\n        .attr(\"y1\", origin.y)\n        .attr(\"x2\", yAxisEnd.x)\n        .attr(\"y2\", yAxisEnd.y);\n      \n      const yAxisAngle = Math.atan2(yAxisEnd.y - origin.y, yAxisEnd.x - origin.x);\n      const yArrowLength = 8;\n      const yArrowPath = d3.path();\n      yArrowPath.moveTo(yAxisEnd.x, yAxisEnd.y);\n      yArrowPath.lineTo(\n        yAxisEnd.x - yArrowLength * Math.cos(yAxisAngle - Math.PI / 6),\n        yAxisEnd.y - yArrowLength * Math.sin(yAxisAngle - Math.PI / 6)\n      );\n      yArrowPath.lineTo(\n        yAxisEnd.x - yArrowLength * Math.cos(yAxisAngle + Math.PI / 6),\n        yAxisEnd.y - yArrowLength * Math.sin(yAxisAngle + Math.PI / 6)\n      );\n      yArrowPath.closePath();\n      g.select(\".y-axis.axis-arrow\").attr(\"d\", yArrowPath.toString());\n      \n      // 更新Z轴\n      zAxisEnd = isometricProjection(-axisOffset, -axisOffset, maxHeight + axisOffset);\n      g.select(\".z-axis.axis-line\")\n        .attr(\"x1\", origin.x)\n        .attr(\"y1\", origin.y)\n        .attr(\"x2\", zAxisEnd.x)\n        .attr(\"y2\", zAxisEnd.y);\n      \n      const zAxisAngle = Math.atan2(zAxisEnd.y - origin.y, zAxisEnd.x - origin.x);\n      const zArrowLength = 8;\n      const zArrowPath = d3.path();\n      zArrowPath.moveTo(zAxisEnd.x, zAxisEnd.y);\n      zArrowPath.lineTo(\n        zAxisEnd.x - zArrowLength * Math.cos(zAxisAngle - Math.PI / 6),\n        zAxisEnd.y - zArrowLength * Math.sin(zAxisAngle - Math.PI / 6)\n      );\n      zArrowPath.lineTo(\n        zAxisEnd.x - zArrowLength * Math.cos(zAxisAngle + Math.PI / 6),\n        zAxisEnd.y - zArrowLength * Math.sin(zAxisAngle + Math.PI / 6)\n      );\n      zArrowPath.closePath();\n      g.select(\".z-axis.axis-arrow\").attr(\"d\", zArrowPath.toString());\n      \n      // 更新X轴标签\n      allGenres.forEach((genre, idx) => {\n        const x = idx * cellWidth + cellWidth / 2;\n        const y = -labelOffset;\n        const projected = isometricProjection(x, y, 0);\n        g.select(`.x-label-${idx}`)\n          .attr(\"x\", projected.x)\n          .attr(\"y\", projected.y);\n      });\n      \n      // 更新Y轴标签\n      months.forEach((month, idx) => {\n        if (idx % 3 === 0) {\n          const x = 0;\n          const y = idx * cellDepth + cellDepth / 2;\n          const projected = isometricProjection(x - labelOffset, y, 0);\n          g.select(`.y-label-${idx}`)\n            .attr(\"x\", projected.x)\n            .attr(\"y\", projected.y);\n        }\n      });\n      \n      // 更新Z轴标签\n      zLabelPos = isometricProjection(-10, 0, maxHeight + 25);\n      g.select(\".z-label\")\n        .attr(\"x\", zLabelPos.x)\n        .attr(\"y\", zLabelPos.y);\n    }\n\n    // ========== 鼠标拖动旋转事件 ==========\n    svg.on(\"mousedown\", function(event) {\n      isDragging = true;\n      lastMouseX = event.clientX;\n      svg.style(\"cursor\", \"grabbing\");\n      event.preventDefault();\n    });\n\n    svg.on(\"mousemove\", function(event) {\n      if (isDragging) {\n        const deltaX = event.clientX - lastMouseX;\n        rotationAngle += deltaX * 0.01; // 旋转速度\n        \n        // 更新投影\n        updateProjection();\n        \n        lastMouseX = event.clientX;\n        event.preventDefault();\n      }\n    });\n\n    svg.on(\"mouseup\", function() {\n      isDragging = false;\n      svg.style(\"cursor\", \"grab\");\n    });\n\n    svg.on(\"mouseleave\", function() {\n      isDragging = false;\n      svg.style(\"cursor\", \"grab\");\n    });\n\n    // 监听窗口大小变化，SVG的viewBox会自动处理缩放\n    // 不需要手动更新，因为viewBox基于内容尺寸，preserveAspectRatio会自动适应容器\n    let resizeTimer;\n    const handleResize = () => {\n      clearTimeout(resizeTimer);\n      resizeTimer = setTimeout(() => {\n        // viewBox 基于内容尺寸，不需要更新\n        // preserveAspectRatio 会自动处理缩放\n        console.log('📐 容器尺寸变化，SVG自动适应');\n      }, 150);\n    };\n\n    window.addEventListener('resize', handleResize);\n  }\n\n  // 等待容器有尺寸后再加载数据\n  // 简化：如果容器被隐藏，使用默认尺寸继续\n  const waitForContainer = () => {\n    const width = container.offsetWidth || container.clientWidth;\n    const height = container.offsetHeight || container.clientHeight;\n    \n    // 如果容器有尺寸，或者容器被隐藏（使用默认尺寸）\n    if (width > 0 && height > 0) {\n      console.log('✅ 容器已准备好，开始加载数据');\n      loadData();\n    } else if (container.style.display === 'none') {\n      // 如果容器被隐藏，使用默认尺寸继续\n      console.log('⚠️ 容器被隐藏，使用默认尺寸继续');\n      loadData();\n    } else {\n      console.log('⏳ 等待容器尺寸...', width, height);\n      setTimeout(waitForContainer, 100);\n    }\n  };\n  \n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n      setTimeout(waitForContainer, 100);\n    });\n  } else {\n    setTimeout(waitForContainer, 100);\n  }\n})();\nconsole.log('✅ D3伪3D热力图脚本加载完成');\n"]}