{"version":3,"sources":["map-visualization.js"],"names":["width","height","svg","d3","select","tooltip","projection","geoNaturalEarth1","scale","translate","geoPath","color","scaleOrdinal","schemeTableau10","regionCoords","Andalusi","India","Korea","Iran","Turkey","Africa","Europe","China","Japan","locationToContinent","Spain","Portugal","USA","Canada","Brazil","Argentina","getContinent","region","json","then","world","append","selectAll","data","features","join","attr","catch","err","console","error","genres","forEach","cat","_cat$subcategories","subcategories","sub","_sub$genres","g","_g$scraped_info","loc","scraped_info","location","_g$children","_g$scraped_info2","cont","push","name","category","continent","artist","children","year","years","drawMap","arguments","length","undefined","remove","filtered","filter","text","d","origin","_projection","_projection2","_slicedToArray","x1","y1","spread","Math","random","concat","on","event","transition","duration","style","html","pageX","pageY","value"],"mappings":"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","file":"map-visualization.5c62246a.js","sourceRoot":"..\\src","sourcesContent":["// map-visualization.js (替换整个文件)\r\nconst width = 1000, height = 600;\r\nconst svg = d3.select(\"#map\");\r\nconst tooltip = d3.select(\"#map-tooltip\");\r\n\r\nconst projection = d3.geoNaturalEarth1()\r\n  .scale(180)\r\n  .translate([width / 2, height / 2]);\r\n\r\nconst geoPath = d3.geoPath().projection(projection);\r\nconst color = d3.scaleOrdinal(d3.schemeTableau10);\r\n\r\n// 位置到经纬度（可继续补充）\r\nconst regionCoords = {\r\n  Andalusi: [-4.8, 37.9],\r\n  India: [78.96, 20.59],\r\n  Korea: [127.8, 36.5],\r\n  Iran: [53.7, 32.4],\r\n  Turkey: [35, 39],\r\n  \"Middle East\": [44, 33],\r\n  Africa: [20, 0],\r\n  Europe: [10, 50],\r\n  China: [104, 35],\r\n  Japan: [138, 37],\r\n  \"North America\": [-100, 40],\r\n  \"South America\": [-60, -15]\r\n};\r\n\r\n// 地区到洲的映射（筛选使用；可按需增补同义/别名）\r\nconst locationToContinent = {\r\n  Andalusi: \"Europe\",\r\n  Spain: \"Europe\",\r\n  Portugal: \"Europe\",\r\n  Europe: \"Europe\",\r\n\r\n  India: \"Asia\",\r\n  China: \"Asia\",\r\n  Japan: \"Asia\",\r\n  Korea: \"Asia\",\r\n  Iran: \"Asia\",\r\n  Turkey: \"Asia\",\r\n  \"Middle East\": \"Asia\",\r\n\r\n  Africa: \"Africa\",\r\n\r\n  \"North America\": \"North America\",\r\n  USA: \"North America\",\r\n  \"United States\": \"North America\",\r\n  Canada: \"North America\",\r\n\r\n  \"South America\": \"South America\",\r\n  Brazil: \"South America\",\r\n  Argentina: \"South America\"\r\n};\r\n\r\nfunction getContinent(region) {\r\n  return locationToContinent[region] || null;\r\n}\r\n\r\n// 1) 无论如何先把底图画出来\r\nd3.json(\"https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson\")\r\n  .then(world => {\r\n    svg.append(\"g\")\r\n      .selectAll(\"path\")\r\n      .data(world.features)\r\n      .join(\"path\")\r\n      .attr(\"d\", geoPath)\r\n      .attr(\"fill\", \"#e5edf3\")\r\n      .attr(\"stroke\", \"#888\")\r\n      .attr(\"stroke-width\", 0.5);\r\n  })\r\n  .catch(err => {\r\n    console.error(\"加载世界底图失败：\", err);\r\n  });\r\n\r\n// 2) 再加载数据并绘制点和传播线\r\nd3.json(\"music_genres_full_with_scraped_info.json\")\r\n  .then(data => {\r\n    const genres = [];\r\n    data.forEach(cat => {\r\n      cat.subcategories?.forEach(sub => {\r\n        sub.genres?.forEach(g => {\r\n          const loc = g.scraped_info?.location;\r\n          if (loc) {\r\n            const cont = getContinent(loc);\r\n            genres.push({\r\n              name: g.name,\r\n              category: cat.category,\r\n              region: loc,\r\n              continent: cont,\r\n              artist: g.children?.[0]?.name || \"未知\",\r\n              year: g.scraped_info?.years?.[0] || \"不详\"\r\n            });\r\n          }\r\n        });\r\n      });\r\n    });\r\n\r\n    // 主绘制函数\r\n    function drawMap(continent = \"all\") {\r\n      svg.selectAll(\".circle, .route, .empty-tip\").remove();\r\n\r\n      const filtered = genres.filter(g => {\r\n        if (continent === \"all\") return true;\r\n        return g.continent === continent;\r\n      });\r\n\r\n      if (filtered.length === 0) {\r\n        svg.append(\"text\")\r\n          .attr(\"class\", \"empty-tip\")\r\n          .attr(\"x\", width / 2)\r\n          .attr(\"y\", height / 2)\r\n          .attr(\"text-anchor\", \"middle\")\r\n          .attr(\"font-size\", 14)\r\n          .attr(\"fill\", \"#666\")\r\n          .text(\"没有符合筛选条件的流派（可尝试选择“全部”或补充 location→continent 映射）\");\r\n        return;\r\n      }\r\n\r\n      filtered.forEach(d => {\r\n        const origin = regionCoords[d.region];\r\n        if (!origin) return;\r\n\r\n        const [x1, y1] = projection(origin);\r\n        const spread = [\r\n          x1 + (Math.random() - 0.5) * 100,\r\n          y1 + (Math.random() - 0.5) * 60\r\n        ];\r\n\r\n        svg.append(\"path\")\r\n          .attr(\"class\", \"route\")\r\n          .attr(\r\n            \"d\",\r\n            `M${x1},${y1} Q${(x1 + spread[0]) / 2},${(y1 + spread[1]) / 2 - 30} ${spread[0]},${spread[1]}`\r\n          )\r\n          .attr(\"stroke\", color(d.category))\r\n          .attr(\"stroke-width\", 1.5)\r\n          .attr(\"opacity\", 0.6)\r\n          .attr(\"fill\", \"none\");\r\n\r\n        svg.append(\"circle\")\r\n          .attr(\"class\", \"circle\")\r\n          .attr(\"cx\", x1)\r\n          .attr(\"cy\", y1)\r\n          .attr(\"r\", 5)\r\n          .attr(\"fill\", color(d.category))\r\n          .attr(\"stroke\", \"#222\")\r\n          .attr(\"opacity\", 0.85)\r\n          .on(\"mouseover\", (event) => {\r\n            tooltip.transition().duration(150).style(\"opacity\", 1);\r\n            tooltip\r\n              .html(\r\n                `<b>${d.name}</b><br>地域：${d.region}<br>艺术家：${d.artist}<br>年代：${d.year}`\r\n              )\r\n              .style(\"left\", event.pageX + 12 + \"px\")\r\n              .style(\"top\", event.pageY + \"px\");\r\n          })\r\n          .on(\"mouseout\", () => tooltip.transition().duration(200).style(\"opacity\", 0));\r\n      });\r\n    }\r\n\r\n    // 默认显示全部\r\n    drawMap(\"all\");\r\n\r\n    // 洲筛选\r\n    d3.select(\"#continentSelect\").on(\"change\", function () {\r\n      drawMap(this.value);\r\n    });\r\n  })\r\n  .catch(err => {\r\n    console.error(\"加载音乐流派数据失败：\", err);\r\n    // 给出可视化提示\r\n    svg.append(\"text\")\r\n      .attr(\"x\", width / 2)\r\n      .attr(\"y\", height / 2)\r\n      .attr(\"text-anchor\", \"middle\")\r\n      .attr(\"font-size\", 14)\r\n      .attr(\"fill\", \"#666\")\r\n      .text(\"无法加载 music_genres_full_with_scraped_info.json（请通过本地服务器访问）\");\r\n  });\r\n"]}