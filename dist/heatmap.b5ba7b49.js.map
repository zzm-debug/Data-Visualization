{"version":3,"sources":["heatmap.js"],"names":["console","log","container","document","getElementById","error","innerHTML","d3","select","selectAll","remove","genreData","surfaceData","months","allGenres","loadData","json","then","data","length","processData","init3DHeatmap","catch","err","warn","monthIdx","row","genreIdx","push","Math","random","chunk","Array","fill","genre","value","genre_distribution","rotationAngle","PI","isometricProjection","x","y","z","angle","scale","cosR","cos","sinR","sin","rotatedX","rotatedY","isoX","isoY","map","getContainerSize","actualWidth","clientWidth","offsetWidth","actualHeight","clientHeight","offsetHeight","width","height","containerSize","containerWidth","containerHeight","minValue","Infinity","maxValue","i","j","min","max","valueRange","morandiColors","r","g","b","getColor","normalized","color","t","concat","round","tooltip","append","attr","style","svg","isDragging","lastMouseX","cellWidth","cellDepth","maxHeight","numGenres","numMonths","totalWidth","totalDepth","corners","minX","d","maxX","minY","maxY","projectedWidth","projectedHeight","padding","viewBoxMinX","viewBoxMinY","viewBoxWidth","viewBoxHeight","interactiveElements","cellDataArray","lineDataArray","drawFace","svgGroup","points","fillColor","strokeColor","opacity","arguments","undefined","path","moveTo","lineTo","closePath","toString","darkenColor","rgb","factor","match","parseInt","cellThickness","baseColor","darkColor","darkerColor","zBottom","zTop","bottom1","bottom2","bottom3","bottom4","top1","top2","top3","top4","cellGroup","datum","month","topFace","forEach","element","on","event","parentGroup","parentNode","trackCount","transition","duration","html","toFixed","pageX","pageY","includes","brightness","minLineHeight","maxLineHeight","_i3","_allGenres","val","lineHeightRange","maxLineZ","lineGenerator","line","curve","curveMonotoneX","projected","areaGenerator","area","y0","y1","_loop","_monthIdx2","monthY","lineData","normalizedValue","isNaN","genreX","avgValue","reduce","sum","lineColor","darkerLineColor","areaPath","areaElement","_d3$pointer","pointer","node","_d3$pointer2","_slicedToArray","mouseX","mouseY","minDistance","nearestPoint","nearestGenreIdx","point","idx","distance","sqrt","pow","linePath","lineElement","_d3$pointer3","_d3$pointer4","maxZ","maxPoint","maxProjected","axisOffset","drawAxisWithArrow","start","end","axisClass","dx","dy","atan2","arrowLength","arrowPath","origin","AXIS_LINE","AXIS_TEXT","AXIS_STROKE","xAxisEnd","yAxisEnd","zAxisEnd","labelOffset","text","zLabelPos","updateProjection","cellData","empty","paths","faces","each","_ref","sortedLineData","_toConsumableArray","sort","a","projA","projB","lineGeneratorUpdate","newPath","areaGeneratorUpdate","xAxisAngle","xArrowLength","xArrowPath","yAxisAngle","yArrowLength","yArrowPath","zAxisAngle","zArrowLength","zArrowPath","clientX","preventDefault","deltaX","resizeTimer","handleResize","clearTimeout","setTimeout","window","addEventListener","waitForContainer","display","readyState"],"mappings":"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","file":"heatmap.b5ba7b49.js","sourceRoot":"..\\src","sourcesContent":["// ============================================\n// heatmap.js - D3伪3D热力图（等轴测投影）\n// ============================================\n// X轴：风格（genres），Y轴：时间（months），Z轴：乐曲数量\nconsole.log('🎨 D3伪3D热力图脚本开始加载...');\n(() => {\n  // 优先使用 heatmap-3d 容器\n  const container = document.getElementById(\"heatmap-3d\") || document.getElementById(\"heatmap\");\n  if (!container) {\n    console.error('❌ 找不到heatmap容器');\n    return;\n  }\n  \n  container.innerHTML = '';\n  d3.select(\"body\").selectAll(\".heatmap-tooltip\").remove();\n\n  let genreData = null;\n  let surfaceData = null;\n\n  const months = [\n    '2023-12', '2024-01', '2024-02', '2024-03', '2024-04', '2024-05', '2024-06',\n    '2024-07', '2024-08', '2024-09', '2024-10', '2024-11', '2024-12',\n    '2025-01', '2025-02', '2025-03', '2025-04', '2025-05', '2025-06',\n    '2025-07', '2025-08', '2025-09', '2025-10', '2025-11', '2025-12'\n  ];\n\n  const allGenres = [\"ACG\", \"classical\", \"electronic\", \"folk\", \"jazz\", \"pop\", \"rap\", \"rock\"];\n\n  function loadData() {\n    console.log('✅ 开始加载JSON数据');\n    d3.json(\"/assets/歌单_2314343014_genre分布统计_归类后.json\")\n      .then(data => {\n        console.log('✅ JSON数据加载成功，共', data.length, '条记录');\n        genreData = data;\n        processData();\n        init3DHeatmap();\n      })\n      .catch(err => {\n        console.error(\"❌ 加载JSON数据失败:\", err);\n        console.log(\"使用默认数据初始化\");\n        processData();\n        init3DHeatmap();\n      });\n  }\n\n  function processData() {\n    surfaceData = [];\n    \n    if (!genreData || genreData.length === 0) {\n      console.warn('genreData为空，使用默认数据');\n      for (let monthIdx = 0; monthIdx < 25; monthIdx++) {\n        const row = [];\n        for (let genreIdx = 0; genreIdx < allGenres.length; genreIdx++) {\n          row.push(Math.random() * 50 + 20);\n        }\n        surfaceData.push(row);\n      }\n      return;\n    }\n\n    for (let monthIdx = 0; monthIdx < 25; monthIdx++) {\n      const chunk = genreData[monthIdx];\n      if (!chunk) {\n        surfaceData.push(Array(allGenres.length).fill(0));\n        continue;\n      }\n      const row = [];\n      for (let genreIdx = 0; genreIdx < allGenres.length; genreIdx++) {\n        const genre = allGenres[genreIdx];\n        const value = chunk.genre_distribution && chunk.genre_distribution[genre] ? chunk.genre_distribution[genre] : 0;\n        row.push(value);\n      }\n      surfaceData.push(row);\n    }\n    \n    console.log('✅ 数据处理完成');\n  }\n\n  // 旋转角度（全局变量，支持鼠标拖动旋转）\n  let rotationAngle = Math.PI / 6; // 默认30度\n\n  // 等轴测投影函数（支持旋转）\n  function isometricProjection(x, y, z) {\n    // 等轴测投影：x轴向右，y轴向前（深度），z轴向上\n    // 支持水平旋转（绕Z轴）\n    const angle = Math.PI / 6; // 基础等轴测角度30度\n    const scale = 1.2; // 稍微放大一点，让3D效果更明显\n    \n    // 应用水平旋转\n    const cosR = Math.cos(rotationAngle);\n    const sinR = Math.sin(rotationAngle);\n    const rotatedX = x * cosR - y * sinR;\n    const rotatedY = x * sinR + y * cosR;\n    \n    // 等轴测投影\n    const isoX = (rotatedX - rotatedY) * Math.cos(angle) * scale;\n    const isoY = (rotatedX + rotatedY) * Math.sin(angle) * scale - z * scale;\n    return { x: isoX, y: isoY };\n  }\n\n  function init3DHeatmap() {\n    if (!surfaceData || surfaceData.length === 0) {\n      console.warn('surfaceData为空，创建默认数据');\n      surfaceData = Array(25).fill(null).map(() => Array(allGenres.length).fill(10));\n    }\n\n    // 获取容器尺寸的函数 - 使用实际容器尺寸\n    const getContainerSize = () => {\n      // 获取实际容器尺寸，如果为0则使用默认值\n      const actualWidth = container.clientWidth || container.offsetWidth || 1600;\n      const actualHeight = container.clientHeight || container.offsetHeight || 800;\n      return {\n        width: actualWidth > 0 ? actualWidth : 1600,\n        height: actualHeight > 0 ? actualHeight : 800\n      };\n    };\n\n    let containerSize = getContainerSize();\n    // 使用实际容器尺寸，不强制最小值\n    let containerWidth = containerSize.width;\n    let containerHeight = containerSize.height;\n\n    // 计算数据范围\n    let minValue = Infinity;\n    let maxValue = 0;\n    for (let i = 0; i < surfaceData.length; i++) {\n      for (let j = 0; j < surfaceData[i].length; j++) {\n        minValue = Math.min(minValue, surfaceData[i][j]);\n        maxValue = Math.max(maxValue, surfaceData[i][j]);\n      }\n    }\n    if (maxValue === 0) maxValue = 1;\n    const valueRange = maxValue - minValue || 1;\n\n    // Morandi颜色方案\n    const morandiColors = [\n      {r: 110, g: 134, b: 166}, // #6E86A6\n      {r: 201, g: 214, b: 229}, // #C9D6E5\n      {r: 247, g: 244, b: 236}, // #F7F4EC\n      {r: 241, g: 197, b: 183}, // #F1C5B7\n      {r: 201, g: 122, b: 110}  // #C97A6E\n    ];\n\n    function getColor(value) {\n      const normalized = (value - minValue) / valueRange;\n      let color;\n      if (normalized < 0.25) {\n        const t = normalized * 4;\n        color = {\n          r: morandiColors[0].r + (morandiColors[1].r - morandiColors[0].r) * t,\n          g: morandiColors[0].g + (morandiColors[1].g - morandiColors[0].g) * t,\n          b: morandiColors[0].b + (morandiColors[1].b - morandiColors[0].b) * t\n        };\n      } else if (normalized < 0.5) {\n        const t = (normalized - 0.25) * 4;\n        color = {\n          r: morandiColors[1].r + (morandiColors[2].r - morandiColors[1].r) * t,\n          g: morandiColors[1].g + (morandiColors[2].g - morandiColors[1].g) * t,\n          b: morandiColors[1].b + (morandiColors[2].b - morandiColors[1].b) * t\n        };\n      } else if (normalized < 0.75) {\n        const t = (normalized - 0.5) * 4;\n        color = {\n          r: morandiColors[2].r + (morandiColors[3].r - morandiColors[2].r) * t,\n          g: morandiColors[2].g + (morandiColors[3].g - morandiColors[2].g) * t,\n          b: morandiColors[2].b + (morandiColors[3].b - morandiColors[2].b) * t\n        };\n      } else {\n        const t = (normalized - 0.75) * 4;\n        color = {\n          r: morandiColors[3].r + (morandiColors[4].r - morandiColors[3].r) * t,\n          g: morandiColors[3].g + (morandiColors[4].g - morandiColors[3].g) * t,\n          b: morandiColors[3].b + (morandiColors[4].b - morandiColors[3].b) * t\n        };\n      }\n      return `rgb(${Math.round(color.r)}, ${Math.round(color.g)}, ${Math.round(color.b)})`;\n    }\n\n    // 创建tooltip\n    const tooltip = d3.select(\"body\").append(\"div\")\n      .attr(\"class\", \"heatmap-tooltip\")\n      .style(\"position\", \"absolute\")\n      .style(\"pointer-events\", \"none\")\n      .style(\"opacity\", 0)\n      .style(\"padding\", \"10px 12px\")\n      .style(\"border-radius\", \"12px\")\n      .style(\"background\", \"rgba(30,41,59,0.92)\")\n      .style(\"color\", \"#fff\")\n      .style(\"font\", '13px/1.35 system-ui,-apple-system,\"Segoe UI\",\"Microsoft YaHei\",sans-serif')\n      .style(\"box-shadow\", \"0 10px 24px rgba(0,0,0,0.16)\")\n      .style(\"z-index\", 1000);\n\n    // 创建SVG，先不设置viewBox，等计算完内容尺寸后再设置\n    const svg = d3.select(container)\n      .append(\"svg\")\n      .attr(\"width\", \"100%\")\n      .attr(\"height\", \"100%\")\n      .style(\"cursor\", \"grab\");\n    \n    // 鼠标拖动旋转相关变量\n    let isDragging = false;\n    let lastMouseX = 0;\n\n    // 3D空间参数（放大）\n    const cellWidth = 50;  // 每个单元格的宽度（X轴：genre方向）\n    const cellDepth = 25;  // 每个单元格的深度（Y轴：month方向）\n    const maxHeight = 120;  // 最大高度（Z轴）\n    const numGenres = allGenres.length;\n    const numMonths = months.length;\n\n    // 计算3D空间的边界\n    const totalWidth = numGenres * cellWidth;\n    const totalDepth = numMonths * cellDepth;\n\n    // 计算投影后的边界，用于居中\n    const corners = [\n      isometricProjection(0, 0, 0),\n      isometricProjection(totalWidth, 0, 0),\n      isometricProjection(0, totalDepth, 0),\n      isometricProjection(totalWidth, totalDepth, 0),\n      isometricProjection(0, 0, maxHeight),\n      isometricProjection(totalWidth, 0, maxHeight)\n    ];\n\n    const minX = d3.min(corners, d => d.x);\n    const maxX = d3.max(corners, d => d.x);\n    const minY = d3.min(corners, d => d.y);\n    const maxY = d3.max(corners, d => d.y);\n\n    const projectedWidth = maxX - minX;\n    const projectedHeight = maxY - minY;\n\n    // 添加边距，确保内容不会被裁剪\n    const padding = 50;\n    const viewBoxMinX = minX - padding;\n    const viewBoxMinY = minY - padding;\n    const viewBoxWidth = projectedWidth + padding * 2;\n    const viewBoxHeight = projectedHeight + padding * 2;\n    \n    // 使用内容尺寸作为 viewBox，让 SVG 自动缩放适应容器\n    // preserveAspectRatio=\"xMidYMid meet\" 会自动居中内容\n    svg.attr(\"viewBox\", `${viewBoxMinX} ${viewBoxMinY} ${viewBoxWidth} ${viewBoxHeight}`)\n       .attr(\"preserveAspectRatio\", \"xMidYMid meet\");\n\n    // 不需要 transform，内容使用原始坐标\n    // viewBox 已经包含了所有内容，preserveAspectRatio 会自动居中\n    const g = svg.append(\"g\");\n\n    // 存储所有交互元素\n    const interactiveElements = [];\n    \n    // 存储所有单元格数据，用于旋转时重新渲染\n    const cellDataArray = [];\n    // 存储所有折线数据\n    const lineDataArray = [];\n\n    // 辅助函数：绘制立方体的一个面\n    function drawFace(svgGroup, points, fillColor, strokeColor, opacity = 1) {\n      const path = d3.path();\n      path.moveTo(points[0].x, points[0].y);\n      for (let i = 1; i < points.length; i++) {\n        path.lineTo(points[i].x, points[i].y);\n      }\n      path.closePath();\n      \n      return svgGroup.append(\"path\")\n        .attr(\"d\", path.toString())\n        .attr(\"fill\", fillColor)\n        .attr(\"stroke\", strokeColor)\n        .attr(\"stroke-width\", 0.5)\n        .attr(\"opacity\", opacity);\n    }\n\n    // 辅助函数：使颜色变暗（用于侧面）\n    function darkenColor(rgb, factor) {\n      const match = rgb.match(/\\d+/g);\n      if (!match) return rgb;\n      const r = Math.max(0, Math.round(parseInt(match[0]) * factor));\n      const g = Math.max(0, Math.round(parseInt(match[1]) * factor));\n      const b = Math.max(0, Math.round(parseInt(match[2]) * factor));\n      return `rgb(${r}, ${g}, ${b})`;\n    }\n\n    // ========== 第一步：绘制3D热力图（带厚度的立方体） ==========\n    const cellThickness = 6; // 每个单元格的厚度（Z轴高度），参考图看起来约6像素\n    \n    for (let genreIdx = 0; genreIdx < numGenres; genreIdx++) {\n      for (let monthIdx = 0; monthIdx < numMonths; monthIdx++) {\n        const value = surfaceData[monthIdx][genreIdx];\n        const baseColor = getColor(value);\n        const darkColor = darkenColor(baseColor, 0.85); // 侧面颜色（稍微暗一点，不要太深）\n        const darkerColor = darkenColor(baseColor, 0.75); // 背面颜色（稍微更暗一点）\n\n        // 3D坐标（X=genre, Y=month, Z=0为底部，Z=thickness为顶部）\n        const x = genreIdx * cellWidth;\n        const y = monthIdx * cellDepth;\n        const zBottom = 0;\n        const zTop = cellThickness;\n\n        // 计算立方体的8个顶点\n        // 底部四个角\n        const bottom1 = isometricProjection(x, y, zBottom);\n        const bottom2 = isometricProjection(x + cellWidth, y, zBottom);\n        const bottom3 = isometricProjection(x + cellWidth, y + cellDepth, zBottom);\n        const bottom4 = isometricProjection(x, y + cellDepth, zBottom);\n        \n        // 顶部四个角\n        const top1 = isometricProjection(x, y, zTop);\n        const top2 = isometricProjection(x + cellWidth, y, zTop);\n        const top3 = isometricProjection(x + cellWidth, y + cellDepth, zTop);\n        const top4 = isometricProjection(x, y + cellDepth, zTop);\n\n        // 创建单元格组\n        const cellGroup = g.append(\"g\")\n          .attr(\"class\", `cell-group cell-${monthIdx}-${genreIdx}`)\n          .datum({\n            month: months[monthIdx],\n            genre: allGenres[genreIdx],\n            value: value,\n            monthIdx: monthIdx,\n            genreIdx: genreIdx,\n            x: x,\n            y: y,\n            z: zBottom\n          })\n          .style(\"cursor\", \"pointer\");\n        \n        // 存储单元格数据\n        cellDataArray.push({\n          monthIdx,\n          genreIdx,\n          x,\n          y,\n          zBottom,\n          zTop,\n          value,\n          baseColor,\n          darkColor,\n          darkerColor,\n          cellGroup\n        });\n\n        // 绘制立方体的各个面（从后往前，确保正确的遮挡）\n        // 1. 底面\n        drawFace(cellGroup, [bottom1, bottom2, bottom3, bottom4], baseColor, \"rgba(255,255,255,0.3)\", 0.9);\n        \n        // 2. 右侧面\n        drawFace(cellGroup, [bottom2, top2, top3, bottom3], darkColor, \"rgba(255,255,255,0.2)\", 0.9);\n        \n        // 3. 背面\n        drawFace(cellGroup, [bottom4, bottom3, top3, top4], darkerColor, \"rgba(255,255,255,0.2)\", 0.85);\n        \n        // 4. 顶面（最后绘制，确保在最上层）\n        const topFace = drawFace(cellGroup, [top1, top2, top3, top4], baseColor, \"rgba(255,255,255,0.4)\", 1);\n        \n        // 将顶面添加到交互元素（用于tooltip）\n        interactiveElements.push(topFace);\n      }\n    }\n\n\n    // ========== 添加交互事件 ==========\n    interactiveElements.forEach(element => {\n      element\n        .on(\"mouseover\", function(event, d) {\n          // 高亮整个立方体组（找到父组）\n          const parentGroup = d3.select(this.parentNode);\n          parentGroup.selectAll(\"path\")\n            .attr(\"opacity\", 1)\n            .attr(\"stroke-width\", 1.5);\n          \n          // 从JSON文件的genre_distribution获取曲目数量\n          let trackCount = 0;\n          if (genreData && genreData[d.monthIdx]) {\n            const chunk = genreData[d.monthIdx];\n            const genre = allGenres[d.genreIdx];\n            if (chunk.genre_distribution && chunk.genre_distribution[genre] !== undefined) {\n              trackCount = chunk.genre_distribution[genre];\n            }\n          } else {\n            // 如果genreData未加载，使用d.value作为后备\n            trackCount = Math.round(d.value);\n          }\n\n          tooltip.transition().duration(150).style(\"opacity\", 0.95);\n          tooltip\n            .html(`<b>${d.genre}</b><br/>${d.month}<br/>分值: ${d.value.toFixed(2)}<br/>曲目数量: ${trackCount}`)\n            .style(\"left\", `${event.pageX + 12}px`)\n            .style(\"top\", `${event.pageY - 18}px`);\n        })\n        .on(\"mouseout\", function() {\n          // 恢复整个立方体组的原始样式\n          const parentGroup = d3.select(this.parentNode);\n          parentGroup.selectAll(\"path\")\n            .attr(\"opacity\", function() {\n              // 根据面的类型恢复不同的透明度\n              const fill = d3.select(this).attr(\"fill\");\n              if (fill && fill.includes(\"rgb\")) {\n                const match = fill.match(/\\d+/g);\n                if (match) {\n                  const r = parseInt(match[0]);\n                  const g = parseInt(match[1]);\n                  const b = parseInt(match[2]);\n                  // 根据亮度判断是顶面、侧面还是底面\n                  const brightness = (r + g + b) / 3;\n                  if (brightness > 200) return 1; // 顶面\n                  if (brightness > 150) return 0.85; // 侧面\n                  return 0.8; // 背面/底面\n                }\n              }\n              return 0.9;\n            })\n            .attr(\"stroke-width\", 0.5);\n          tooltip.transition().duration(200).style(\"opacity\", 0);\n        });\n    });\n\n    // ========== 添加折线趋势图（每个月份一条，沿X轴延伸，Z轴表示高度） ==========\n    // 计算折线高度的范围\n    let minLineHeight = Infinity;\n    let maxLineHeight = 0;\n    if (genreData && genreData.length > 0) {\n      for (let i = 0; i < genreData.length; i++) {\n        const chunk = genreData[i];\n        if (chunk && chunk.genre_distribution) {\n          for (let genre of allGenres) {\n            const val = chunk.genre_distribution[genre] || 0;\n            minLineHeight = Math.min(minLineHeight, val);\n            maxLineHeight = Math.max(maxLineHeight, val);\n          }\n        }\n      }\n    }\n    \n    // 如果genreData为空，使用surfaceData的数据\n    if (!genreData || genreData.length === 0 || minLineHeight === Infinity) {\n      minLineHeight = Infinity;\n      maxLineHeight = 0;\n      for (let i = 0; i < surfaceData.length; i++) {\n        for (let j = 0; j < surfaceData[i].length; j++) {\n          const val = surfaceData[i][j] || 0;\n          minLineHeight = Math.min(minLineHeight, val);\n          maxLineHeight = Math.max(maxLineHeight, val);\n        }\n      }\n    }\n    \n    // 确保有有效的数据范围\n    if (minLineHeight === Infinity) minLineHeight = 0;\n    if (maxLineHeight === 0) maxLineHeight = 1;\n    const lineHeightRange = maxLineHeight - minLineHeight || 1;\n    const maxLineZ = maxHeight * 1.2; // 折线最大高度，降低高度\n    \n    console.log('📊 折线图数据范围:', { minLineHeight, maxLineHeight, lineHeightRange, maxLineZ });\n\n    // D3的平滑曲线生成器（沿X轴延伸，所以用curveMonotoneX）\n    const lineGenerator = d3.line()\n      .curve(d3.curveMonotoneX) // 平滑曲线，沿X轴\n      .x((d) => {\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.x;\n      })\n      .y((d) => {\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.y;\n      });\n\n    // D3的面积生成器（用于填充）\n    const areaGenerator = d3.area()\n      .curve(d3.curveMonotoneX) // 沿X轴\n      .x((d) => {\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.x;\n      })\n      .y0((d) => {\n        // 底部（热力图顶部）\n        const projected = isometricProjection(d.x, d.y, cellThickness);\n        return projected.y;\n      })\n      .y1((d) => {\n        // 顶部（折线高度）\n        const projected = isometricProjection(d.x, d.y, d.z);\n        return projected.y;\n      });\n\n    // 为每个月份绘制折线（沿X轴：风格方向）\n    for (let monthIdx = 0; monthIdx < numMonths; monthIdx++) {\n      const month = months[monthIdx];\n      const monthY = monthIdx * cellDepth + cellDepth / 2; // 月份的中心Y坐标\n      \n      // 生成折线的数据点（沿X轴：从genre 0到genre 7）\n      const lineData = [];\n      for (let genreIdx = 0; genreIdx < numGenres; genreIdx++) {\n        let value = 0;\n        if (genreData && genreData[monthIdx] && genreData[monthIdx].genre_distribution) {\n          const genre = allGenres[genreIdx];\n          value = genreData[monthIdx].genre_distribution[genre] || 0;\n        } else if (surfaceData && surfaceData[monthIdx]) {\n          // 如果genreData为空，使用surfaceData\n          value = surfaceData[monthIdx][genreIdx] || 0;\n        }\n        \n        // 归一化高度，确保不会出现NaN\n        const normalizedValue = lineHeightRange > 0 ? (value - minLineHeight) / lineHeightRange : 0;\n        const z = cellThickness + (isNaN(normalizedValue) ? 0 : normalizedValue) * maxLineZ; // 从热力图顶部开始\n        \n        const genreX = genreIdx * cellWidth + cellWidth / 2; // genre的中心X坐标\n        \n        // 验证坐标不是NaN\n        if (!isNaN(genreX) && !isNaN(monthY) && !isNaN(z)) {\n          lineData.push({\n            x: genreX,\n            y: monthY,\n            z: z,\n            value: value,\n            monthIdx: monthIdx,\n            genreIdx: genreIdx\n          });\n        }\n      }\n\n      // 获取该月份的平均颜色（使用热力图的颜色方案，但加深颜色使其更明显）\n      const avgValue = lineData.reduce((sum, d) => sum + d.value, 0) / lineData.length;\n      let lineColor = getColor(avgValue);\n      // 加深颜色，使折线更明显\n      const darkerLineColor = darkenColor(lineColor, 0.6);\n      \n      // 存储折线数据（用于旋转时更新）\n      if (lineData.length > 0) {\n        lineDataArray.push({\n          monthIdx,\n          month,\n          lineData: [...lineData], // 复制数组\n          darkerLineColor,\n          lineColor\n        });\n      }\n      \n      // 只有当有有效数据点时才绘制\n      if (lineData.length > 0) {\n        // 创建面积填充（半透明）\n        const areaPath = areaGenerator(lineData);\n        if (areaPath && !areaPath.includes('NaN')) {\n          const areaElement = g.append(\"path\")\n            .attr(\"class\", `area-path area-${monthIdx}`)\n            .attr(\"d\", areaPath)\n            .attr(\"fill\", darkerLineColor)\n            .attr(\"fill-opacity\", 0.4)\n            .attr(\"stroke\", \"none\")\n            .datum({ lineData: lineData, month: month, monthIdx: monthIdx }) // 存储数据\n            .style(\"cursor\", \"pointer\");\n          \n          // 为面积填充也添加鼠标事件（确保tooltip能显示）\n          areaElement\n            .on(\"mousemove\", function(event) {\n              // 获取鼠标在SVG中的坐标\n              const [mouseX, mouseY] = d3.pointer(event, g.node());\n              \n              // 找到最近的数据点\n              let minDistance = Infinity;\n              let nearestPoint = null;\n              let nearestGenreIdx = -1;\n              \n              lineData.forEach((point, idx) => {\n                const projected = isometricProjection(point.x, point.y, point.z);\n                const distance = Math.sqrt(\n                  Math.pow(mouseX - projected.x, 2) + \n                  Math.pow(mouseY - projected.y, 2)\n                );\n                if (distance < minDistance) {\n                  minDistance = distance;\n                  nearestPoint = point;\n                  nearestGenreIdx = idx;\n                }\n              });\n              \n              // 增加距离阈值，确保tooltip能显示\n              if (nearestPoint && minDistance < 100) {\n                // 从JSON获取曲目数量\n                let trackCount = 0;\n                if (genreData && genreData[monthIdx]) {\n                  const chunk = genreData[monthIdx];\n                  const genre = allGenres[nearestGenreIdx];\n                  if (chunk.genre_distribution && chunk.genre_distribution[genre] !== undefined) {\n                    trackCount = chunk.genre_distribution[genre];\n                  }\n                } else {\n                  trackCount = Math.round(nearestPoint.value);\n                }\n                \n                tooltip.transition().duration(150).style(\"opacity\", 0.95);\n                tooltip\n                  .html(`<b>${allGenres[nearestGenreIdx]}</b><br/>${month}<br/>分值: ${nearestPoint.value.toFixed(2)}<br/>曲目数量: ${trackCount}`)\n                  .style(\"left\", `${event.pageX + 12}px`)\n                  .style(\"top\", `${event.pageY - 18}px`);\n              }\n            })\n            .on(\"mouseout\", function() {\n              tooltip.transition().duration(200).style(\"opacity\", 0);\n            });\n        }\n\n        // 创建折线（确保在最上层显示，使用深色使其更明显）\n        const linePath = lineGenerator(lineData);\n        if (linePath && !linePath.includes('NaN')) {\n          const lineElement = g.append(\"path\")\n            .attr(\"class\", `line-path line-${monthIdx}`)\n            .attr(\"d\", linePath)\n            .attr(\"fill\", \"none\")\n            .attr(\"stroke\", darkerLineColor)\n            .attr(\"stroke-width\", 3.5)\n            .attr(\"opacity\", 1)\n            .datum({ lineData: lineData, month: month, monthIdx: monthIdx }) // 存储数据\n            .style(\"cursor\", \"pointer\");\n          \n          // 为折线图添加鼠标事件\n          lineElement\n            .on(\"mousemove\", function(event) {\n              // 获取鼠标在SVG中的坐标\n              const [mouseX, mouseY] = d3.pointer(event, g.node());\n              \n              // 找到最近的数据点\n              let minDistance = Infinity;\n              let nearestPoint = null;\n              let nearestGenreIdx = -1;\n              \n              lineData.forEach((point, idx) => {\n                const projected = isometricProjection(point.x, point.y, point.z);\n                const distance = Math.sqrt(\n                  Math.pow(mouseX - projected.x, 2) + \n                  Math.pow(mouseY - projected.y, 2)\n                );\n                if (distance < minDistance) {\n                  minDistance = distance;\n                  nearestPoint = point;\n                  nearestGenreIdx = idx;\n                }\n              });\n              \n              // 增加距离阈值，确保tooltip能显示\n              if (nearestPoint && minDistance < 100) { // 100像素范围内显示tooltip\n                // 从JSON获取曲目数量\n                let trackCount = 0;\n                if (genreData && genreData[monthIdx]) {\n                  const chunk = genreData[monthIdx];\n                  const genre = allGenres[nearestGenreIdx];\n                  if (chunk.genre_distribution && chunk.genre_distribution[genre] !== undefined) {\n                    trackCount = chunk.genre_distribution[genre];\n                  }\n                } else {\n                  trackCount = Math.round(nearestPoint.value);\n                }\n                \n                tooltip.transition().duration(150).style(\"opacity\", 0.95);\n                tooltip\n                  .html(`<b>${allGenres[nearestGenreIdx]}</b><br/>${month}<br/>分值: ${nearestPoint.value.toFixed(2)}<br/>曲目数量: ${trackCount}`)\n                  .style(\"left\", `${event.pageX + 12}px`)\n                  .style(\"top\", `${event.pageY - 18}px`);\n              }\n            })\n            .on(\"mouseout\", function() {\n              tooltip.transition().duration(200).style(\"opacity\", 0);\n            });\n          \n          // ========== 添加最高点标记 ==========\n          // 找到最高点（z值最大的点）\n          let maxZ = -Infinity;\n          let maxPoint = null;\n          lineData.forEach(point => {\n            if (point.z > maxZ) {\n              maxZ = point.z;\n              maxPoint = point;\n            }\n          });\n          \n          if (maxPoint) {\n            const maxProjected = isometricProjection(maxPoint.x, maxPoint.y, maxPoint.z);\n            \n            // 绘制外圈（白色，更大）\n            g.append(\"circle\")\n              .attr(\"class\", `max-point-outer max-point-outer-${monthIdx}`)\n              .attr(\"cx\", maxProjected.x)\n              .attr(\"cy\", maxProjected.y)\n              .attr(\"r\", 6)\n              .attr(\"fill\", \"#ffffff\")\n              .attr(\"stroke\", darkerLineColor)\n              .attr(\"stroke-width\", 2)\n              .attr(\"opacity\", 1)\n              .style(\"pointer-events\", \"none\"); // 允许鼠标事件穿透到折线\n            \n            // 绘制内圈（折线颜色，更小）\n            g.append(\"circle\")\n              .attr(\"class\", `max-point-inner max-point-inner-${monthIdx}`)\n              .attr(\"cx\", maxProjected.x)\n              .attr(\"cy\", maxProjected.y)\n              .attr(\"r\", 3.5)\n              .attr(\"fill\", darkerLineColor)\n              .attr(\"stroke\", \"none\")\n              .attr(\"opacity\", 1)\n              .style(\"pointer-events\", \"none\"); // 允许鼠标事件穿透到折线\n          }\n          \n          console.log(`✅ 已绘制${month}的折线图，颜色: ${darkerLineColor}, 数据点: ${lineData.length}`);\n        } else {\n          console.warn(`⚠️ ${month}的折线路径生成失败，路径: ${linePath}`);\n        }\n      } else {\n        console.warn(`⚠️ ${month}没有有效的数据点`);\n      }\n    }\n    console.log('🎉 折线趋势图绘制完成！');\n    // ========== 添加坐标轴线（原点与第一个方格左上角对齐） ==========\n    const axisOffset = 8; // 坐标轴往外偏移的距离（增加，更往外）\n    \n    // 辅助函数：绘制带箭头的轴线\n    function drawAxisWithArrow(start, end, color = \"#555\", axisClass = \"\") {\n      const line = g.append(\"line\")\n        .attr(\"class\", `axis-line ${axisClass}`)\n        .attr(\"x1\", start.x)\n        .attr(\"y1\", start.y)\n        .attr(\"x2\", end.x)\n        .attr(\"y2\", end.y)\n        .attr(\"stroke\", color)\n        .attr(\"stroke-width\", 2)\n        .attr(\"opacity\", 0.7);\n      \n      // 计算箭头方向\n      const dx = end.x - start.x;\n      const dy = end.y - start.y;\n      const angle = Math.atan2(dy, dx);\n      const arrowLength = 8;\n      \n      // 绘制箭头\n      const arrowPath = d3.path();\n      arrowPath.moveTo(end.x, end.y);\n      arrowPath.lineTo(\n        end.x - arrowLength * Math.cos(angle - Math.PI / 6),\n        end.y - arrowLength * Math.sin(angle - Math.PI / 6)\n      );\n      arrowPath.lineTo(\n        end.x - arrowLength * Math.cos(angle + Math.PI / 6),\n        end.y - arrowLength * Math.sin(angle + Math.PI / 6)\n      );\n      arrowPath.closePath();\n      \n      g.append(\"path\")\n        .attr(\"class\", `axis-arrow ${axisClass}`)\n        .attr(\"d\", arrowPath.toString())\n        .attr(\"fill\", color)\n        .attr(\"opacity\", 0.7);\n      \n      return { line, start, end };\n    }\n\n    // 坐标原点在 (0, 0, 0)，即第一个方格的左上角\n    let origin = isometricProjection(-axisOffset, -axisOffset, 0);\n    \n    // 赛博深色主题：轴线/箭头用浅色系，避免发灰看不清\n    const AXIS_LINE = \"rgba(50, 167, 255, 0.30)\";\n    const AXIS_TEXT = \"rgba(226, 232, 240, 0.88)\";\n    const AXIS_STROKE = \"rgba(7, 3, 18, 0.72)\";\n\n    // X轴（genres方向）- 从原点沿X轴延伸\n    let xAxisEnd = isometricProjection(totalWidth + axisOffset, -axisOffset, 0);\n    drawAxisWithArrow(origin, xAxisEnd, AXIS_LINE, \"x-axis\");\n\n    // Y轴（months方向）- 从原点沿Y轴延伸\n    let yAxisEnd = isometricProjection(-axisOffset, totalDepth + axisOffset, 0);\n    drawAxisWithArrow(origin, yAxisEnd, AXIS_LINE, \"y-axis\");\n\n    // Z轴（高度方向）- 从原点向上延伸\n    let zAxisEnd = isometricProjection(-axisOffset, -axisOffset, maxHeight + axisOffset);\n    drawAxisWithArrow(origin, zAxisEnd, AXIS_LINE, \"z-axis\");\n\n    // ========== 添加坐标轴标签 ==========\n    const labelOffset = 40; // X轴标签往外偏移的距离（增加，确保在方格外面）\n    \n    // X轴标签（genres）- 在底部前方（y<0的部分）\n    allGenres.forEach((genre, idx) => {\n      const x = idx * cellWidth + cellWidth / 2;\n      const y = -labelOffset; // y<0，在底部前方\n      const projected = isometricProjection(x, y, 0); // 在y<0的位置\n      \n      g.append(\"text\")\n        .attr(\"class\", `axis-label x-label x-label-${idx}`)\n        .attr(\"x\", projected.x)\n        .attr(\"y\", projected.y)\n        .attr(\"text-anchor\", \"middle\")\n        .attr(\"fill\", AXIS_TEXT)\n        .attr(\"font-size\", \"11px\")\n        .attr(\"font-weight\", \"500\")\n        .style(\"font-family\", \"system-ui, -apple-system, sans-serif\")\n        .style(\"paint-order\", \"stroke\")\n        .style(\"stroke\", AXIS_STROKE)\n        .style(\"stroke-width\", \"2.2px\")\n        .style(\"stroke-linejoin\", \"round\")\n        .text(genre);\n    });\n\n    // Y轴标签（months）- 在左侧\n    months.forEach((month, idx) => {\n      if (idx % 3 === 0) { // 只显示部分月份，避免太密集\n        const x = 0;\n        const y = idx * cellDepth + cellDepth / 2;\n        const projected = isometricProjection(x - labelOffset, y, 0);\n        \n        g.append(\"text\")\n          .attr(\"class\", `axis-label y-label y-label-${idx}`)\n          .attr(\"x\", projected.x)\n          .attr(\"y\", projected.y)\n          .attr(\"text-anchor\", \"end\")\n          .attr(\"fill\", AXIS_TEXT)\n          .attr(\"font-size\", \"10px\")\n          .style(\"font-family\", \"system-ui, -apple-system, sans-serif\")\n          .style(\"paint-order\", \"stroke\")\n          .style(\"stroke\", AXIS_STROKE)\n          .style(\"stroke-width\", \"2.2px\")\n          .style(\"stroke-linejoin\", \"round\")\n          .text(month);\n      }\n    });\n\n    // Z轴标签（乐曲数量）- 再往上移\n    let zLabelPos = isometricProjection(-10, 0, maxHeight + 25); // 增加Z坐标，让标签更往上\n    g.append(\"text\")\n      .attr(\"class\", \"axis-label z-label\")\n      .attr(\"x\", zLabelPos.x)\n      .attr(\"y\", zLabelPos.y)\n      .attr(\"text-anchor\", \"middle\")\n      .attr(\"fill\", AXIS_TEXT)\n      .attr(\"font-size\", \"10px\")\n      .attr(\"font-weight\", \"500\")\n      .style(\"font-family\", \"system-ui, -apple-system, sans-serif\")\n      .style(\"paint-order\", \"stroke\")\n      .style(\"stroke\", AXIS_STROKE)\n      .style(\"stroke-width\", \"2.2px\")\n      .style(\"stroke-linejoin\", \"round\")\n      .text(\"乐曲数量\");\n\n    console.log('🎉 D3伪3D热力图初始化完成！');\n\n    // ========== 更新函数：重新渲染所有元素（用于旋转） ==========\n    function updateProjection() {\n      // 重新计算边界\n      const corners = [\n        isometricProjection(0, 0, 0),\n        isometricProjection(totalWidth, 0, 0),\n        isometricProjection(0, totalDepth, 0),\n        isometricProjection(totalWidth, totalDepth, 0),\n        isometricProjection(0, 0, maxHeight),\n        isometricProjection(totalWidth, 0, maxHeight)\n      ];\n      \n      const minX = d3.min(corners, d => d.x);\n      const maxX = d3.max(corners, d => d.x);\n      const minY = d3.min(corners, d => d.y);\n      const maxY = d3.max(corners, d => d.y);\n      \n      const projectedWidth = maxX - minX;\n      const projectedHeight = maxY - minY;\n      \n      // 更新 viewBox\n      const padding = 50;\n      const viewBoxMinX = minX - padding;\n      const viewBoxMinY = minY - padding;\n      const viewBoxWidth = projectedWidth + padding * 2;\n      const viewBoxHeight = projectedHeight + padding * 2;\n      \n      svg.attr(\"viewBox\", `${viewBoxMinX} ${viewBoxMinY} ${viewBoxWidth} ${viewBoxHeight}`);\n      \n      // 更新所有单元格\n      cellDataArray.forEach(cellData => {\n        const { x, y, zBottom, zTop, monthIdx, genreIdx, baseColor, darkColor, darkerColor } = cellData;\n        \n        // 重新计算8个顶点\n        const bottom1 = isometricProjection(x, y, zBottom);\n        const bottom2 = isometricProjection(x + cellWidth, y, zBottom);\n        const bottom3 = isometricProjection(x + cellWidth, y + cellDepth, zBottom);\n        const bottom4 = isometricProjection(x, y + cellDepth, zBottom);\n        const top1 = isometricProjection(x, y, zTop);\n        const top2 = isometricProjection(x + cellWidth, y, zTop);\n        const top3 = isometricProjection(x + cellWidth, y + cellDepth, zTop);\n        const top4 = isometricProjection(x, y + cellDepth, zTop);\n        \n        // 更新单元格组的所有面\n        const cellGroup = g.select(`.cell-${monthIdx}-${genreIdx}`);\n        if (!cellGroup.empty()) {\n          const paths = cellGroup.selectAll(\"path\");\n          const faces = [\n            [bottom1, bottom2, bottom3, bottom4], // 底面\n            [bottom2, top2, top3, bottom3], // 右侧面\n            [bottom4, bottom3, top3, top4], // 背面\n            [top1, top2, top3, top4] // 顶面\n          ];\n          \n          paths.each(function(d, i) {\n            if (i < faces.length) {\n              const path = d3.path();\n              path.moveTo(faces[i][0].x, faces[i][0].y);\n              for (let j = 1; j < faces[i].length; j++) {\n                path.lineTo(faces[i][j].x, faces[i][j].y);\n              }\n              path.closePath();\n              d3.select(this).attr(\"d\", path.toString());\n            }\n          });\n        }\n      });\n      \n      // 更新所有折线\n      lineDataArray.forEach(({ monthIdx, lineData, darkerLineColor }) => {\n        // 重新生成折线路径（使用与初始化时相同的lineGenerator逻辑）\n        // 注意：需要按照投影后的X坐标排序，确保曲线方向正确\n        const sortedLineData = [...lineData].sort((a, b) => {\n          const projA = isometricProjection(a.x, a.y, a.z);\n          const projB = isometricProjection(b.x, b.y, b.z);\n          return projA.x - projB.x;\n        });\n        \n        const lineGeneratorUpdate = d3.line()\n          .curve(d3.curveMonotoneX)\n          .x((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.x;\n          })\n          .y((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.y;\n          });\n        \n        // 更新折线（使用正确的选择器，class是 \"line-path line-${monthIdx}\"）\n        const lineElement = g.select(`.line-path.line-${monthIdx}`);\n        if (!lineElement.empty()) {\n          const newPath = lineGeneratorUpdate(sortedLineData);\n          if (newPath && !newPath.includes('NaN')) {\n            lineElement.attr(\"d\", newPath);\n          }\n        }\n        \n        // 更新面积填充（重新创建areaGenerator，因为投影函数已更新）\n        // 使用排序后的数据，确保与折线一致\n        const areaGeneratorUpdate = d3.area()\n          .curve(d3.curveMonotoneX)\n          .x((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.x;\n          })\n          .y0((d) => {\n            const projected = isometricProjection(d.x, d.y, cellThickness);\n            return projected.y;\n          })\n          .y1((d) => {\n            const projected = isometricProjection(d.x, d.y, d.z);\n            return projected.y;\n          });\n        \n        const areaElement = g.select(`.area-${monthIdx}`);\n        if (!areaElement.empty()) {\n          areaElement.attr(\"d\", areaGeneratorUpdate(sortedLineData));\n        }\n        \n        // 更新最高点标记\n        let maxZ = -Infinity;\n        let maxPoint = null;\n        lineData.forEach(point => {\n          if (point.z > maxZ) {\n            maxZ = point.z;\n            maxPoint = point;\n          }\n        });\n        \n        if (maxPoint) {\n          const maxProjected = isometricProjection(maxPoint.x, maxPoint.y, maxPoint.z);\n          g.select(`.max-point-outer-${monthIdx}`)\n            .attr(\"cx\", maxProjected.x)\n            .attr(\"cy\", maxProjected.y);\n          g.select(`.max-point-inner-${monthIdx}`)\n            .attr(\"cx\", maxProjected.x)\n            .attr(\"cy\", maxProjected.y);\n        }\n      });\n      \n      // 更新坐标轴（使用外部定义的axisOffset和labelOffset）\n      \n      // 更新原点\n      origin = isometricProjection(-axisOffset, -axisOffset, 0);\n      \n      // 更新X轴\n      xAxisEnd = isometricProjection(totalWidth + axisOffset, -axisOffset, 0);\n      g.select(\".x-axis.axis-line\")\n        .attr(\"x1\", origin.x)\n        .attr(\"y1\", origin.y)\n        .attr(\"x2\", xAxisEnd.x)\n        .attr(\"y2\", xAxisEnd.y);\n      \n      const xAxisAngle = Math.atan2(xAxisEnd.y - origin.y, xAxisEnd.x - origin.x);\n      const xArrowLength = 8;\n      const xArrowPath = d3.path();\n      xArrowPath.moveTo(xAxisEnd.x, xAxisEnd.y);\n      xArrowPath.lineTo(\n        xAxisEnd.x - xArrowLength * Math.cos(xAxisAngle - Math.PI / 6),\n        xAxisEnd.y - xArrowLength * Math.sin(xAxisAngle - Math.PI / 6)\n      );\n      xArrowPath.lineTo(\n        xAxisEnd.x - xArrowLength * Math.cos(xAxisAngle + Math.PI / 6),\n        xAxisEnd.y - xArrowLength * Math.sin(xAxisAngle + Math.PI / 6)\n      );\n      xArrowPath.closePath();\n      g.select(\".x-axis.axis-arrow\").attr(\"d\", xArrowPath.toString());\n      \n      // 更新Y轴\n      yAxisEnd = isometricProjection(-axisOffset, totalDepth + axisOffset, 0);\n      g.select(\".y-axis.axis-line\")\n        .attr(\"x1\", origin.x)\n        .attr(\"y1\", origin.y)\n        .attr(\"x2\", yAxisEnd.x)\n        .attr(\"y2\", yAxisEnd.y);\n      \n      const yAxisAngle = Math.atan2(yAxisEnd.y - origin.y, yAxisEnd.x - origin.x);\n      const yArrowLength = 8;\n      const yArrowPath = d3.path();\n      yArrowPath.moveTo(yAxisEnd.x, yAxisEnd.y);\n      yArrowPath.lineTo(\n        yAxisEnd.x - yArrowLength * Math.cos(yAxisAngle - Math.PI / 6),\n        yAxisEnd.y - yArrowLength * Math.sin(yAxisAngle - Math.PI / 6)\n      );\n      yArrowPath.lineTo(\n        yAxisEnd.x - yArrowLength * Math.cos(yAxisAngle + Math.PI / 6),\n        yAxisEnd.y - yArrowLength * Math.sin(yAxisAngle + Math.PI / 6)\n      );\n      yArrowPath.closePath();\n      g.select(\".y-axis.axis-arrow\").attr(\"d\", yArrowPath.toString());\n      \n      // 更新Z轴\n      zAxisEnd = isometricProjection(-axisOffset, -axisOffset, maxHeight + axisOffset);\n      g.select(\".z-axis.axis-line\")\n        .attr(\"x1\", origin.x)\n        .attr(\"y1\", origin.y)\n        .attr(\"x2\", zAxisEnd.x)\n        .attr(\"y2\", zAxisEnd.y);\n      \n      const zAxisAngle = Math.atan2(zAxisEnd.y - origin.y, zAxisEnd.x - origin.x);\n      const zArrowLength = 8;\n      const zArrowPath = d3.path();\n      zArrowPath.moveTo(zAxisEnd.x, zAxisEnd.y);\n      zArrowPath.lineTo(\n        zAxisEnd.x - zArrowLength * Math.cos(zAxisAngle - Math.PI / 6),\n        zAxisEnd.y - zArrowLength * Math.sin(zAxisAngle - Math.PI / 6)\n      );\n      zArrowPath.lineTo(\n        zAxisEnd.x - zArrowLength * Math.cos(zAxisAngle + Math.PI / 6),\n        zAxisEnd.y - zArrowLength * Math.sin(zAxisAngle + Math.PI / 6)\n      );\n      zArrowPath.closePath();\n      g.select(\".z-axis.axis-arrow\").attr(\"d\", zArrowPath.toString());\n      \n      // 更新X轴标签\n      allGenres.forEach((genre, idx) => {\n        const x = idx * cellWidth + cellWidth / 2;\n        const y = -labelOffset;\n        const projected = isometricProjection(x, y, 0);\n        g.select(`.x-label-${idx}`)\n          .attr(\"x\", projected.x)\n          .attr(\"y\", projected.y);\n      });\n      \n      // 更新Y轴标签\n      months.forEach((month, idx) => {\n        if (idx % 3 === 0) {\n          const x = 0;\n          const y = idx * cellDepth + cellDepth / 2;\n          const projected = isometricProjection(x - labelOffset, y, 0);\n          g.select(`.y-label-${idx}`)\n            .attr(\"x\", projected.x)\n            .attr(\"y\", projected.y);\n        }\n      });\n      \n      // 更新Z轴标签\n      zLabelPos = isometricProjection(-10, 0, maxHeight + 25);\n      g.select(\".z-label\")\n        .attr(\"x\", zLabelPos.x)\n        .attr(\"y\", zLabelPos.y);\n    }\n\n    // ========== 鼠标拖动旋转事件 ==========\n    svg.on(\"mousedown\", function(event) {\n      isDragging = true;\n      lastMouseX = event.clientX;\n      svg.style(\"cursor\", \"grabbing\");\n      event.preventDefault();\n    });\n\n    svg.on(\"mousemove\", function(event) {\n      if (isDragging) {\n        const deltaX = event.clientX - lastMouseX;\n        rotationAngle += deltaX * 0.01; // 旋转速度\n        \n        // 更新投影\n        updateProjection();\n        \n        lastMouseX = event.clientX;\n        event.preventDefault();\n      }\n    });\n\n    svg.on(\"mouseup\", function() {\n      isDragging = false;\n      svg.style(\"cursor\", \"grab\");\n    });\n\n    svg.on(\"mouseleave\", function() {\n      isDragging = false;\n      svg.style(\"cursor\", \"grab\");\n    });\n\n    // 监听窗口大小变化，SVG的viewBox会自动处理缩放\n    // 不需要手动更新，因为viewBox基于内容尺寸，preserveAspectRatio会自动适应容器\n    let resizeTimer;\n    const handleResize = () => {\n      clearTimeout(resizeTimer);\n      resizeTimer = setTimeout(() => {\n        // viewBox 基于内容尺寸，不需要更新\n        // preserveAspectRatio 会自动处理缩放\n        console.log('📐 容器尺寸变化，SVG自动适应');\n      }, 150);\n    };\n\n    window.addEventListener('resize', handleResize);\n  }\n\n  // 等待容器有尺寸后再加载数据\n  // 简化：如果容器被隐藏，使用默认尺寸继续\n  const waitForContainer = () => {\n    const width = container.offsetWidth || container.clientWidth;\n    const height = container.offsetHeight || container.clientHeight;\n    \n    // 如果容器有尺寸，或者容器被隐藏（使用默认尺寸）\n    if (width > 0 && height > 0) {\n      console.log('✅ 容器已准备好，开始加载数据');\n      loadData();\n    } else if (container.style.display === 'none') {\n      // 如果容器被隐藏，使用默认尺寸继续\n      console.log('⚠️ 容器被隐藏，使用默认尺寸继续');\n      loadData();\n    } else {\n      console.log('⏳ 等待容器尺寸...', width, height);\n      setTimeout(waitForContainer, 100);\n    }\n  };\n  \n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', () => {\n      setTimeout(waitForContainer, 100);\n    });\n  } else {\n    setTimeout(waitForContainer, 100);\n  }\n})();\nconsole.log('✅ D3伪3D热力图脚本加载完成');\n"]}