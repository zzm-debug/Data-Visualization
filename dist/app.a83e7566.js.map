{"version":3,"sources":["app.js"],"names":["data","BG","palette","Folk","Pop","Rock","Rap","Electronic","Classical","Jazz","ACG","svgSel","d3","select","svgNode","node","tooltip","empty","append","attr","style","clamp","v","a","b","Math","max","min","formatBig","n","format","pct","x","concat","toFixed","render","selectAll","remove","container","closest","parentElement","cw","clientWidth","ch","clientHeight","width","floor","height","margin","top","right","bottom","left","innerW","innerH","g","genres","Object","keys","colorOf","k","playsExtent","extent","total_plays","commentsExtent","total_comments","xMin","xMax","xScale","scaleLog","domain","range","nice","yScale","scaleLinear","rScale","scaleSqrt","rates","map","maxRate","apply","_toConsumableArray","xGrid","axisBottom","tickSize","tickFormat","yGrid","axisLeft","call","xAxis","ticks","yAxis","gx","gy","nodes","genre","s","r","rate","progress","id","y","active","layer","bubbles","d","enter","ringGap","ringWidth","ringBase","ringProg","updateRings","each","rr","c","PI","filled","ringRotate","on","event","html","pageX","pageY","simulation","forceSimulation","force","forceX","strength","forceY","forceCollide","alpha","alphaDecay","forEach","bound","text","note","legend","legendItem","i","find","op","filter","transition","duration","window","addEventListener","passive","setTimeout","alphaTarget","t","rerender","clearTimeout"],"mappings":"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","file":"app.a83e7566.js","sourceRoot":"..\\src","sourcesContent":["// app.js — 柔和气泡 + 互动率环（进度）+ 字更大 + 图更大\n(() => {\n  const data = {\n    \"Folk\": { \"total_plays\": 44580532, \"total_comments\": 112595, \"song_count\": 50 },\n    \"Pop\": { \"total_plays\": 3393742080, \"total_comments\": 12806829, \"song_count\": 50 },\n    \"Rock\": { \"total_plays\": 186807824, \"total_comments\": 5122030, \"song_count\": 50 },\n    \"Rap\": { \"total_plays\": 519658432, \"total_comments\": 267719, \"song_count\": 50 },\n    \"Electronic\": { \"total_plays\": 405760640, \"total_comments\": 185764, \"song_count\": 50 },\n    \"Classical\": { \"total_plays\": 74785024, \"total_comments\": 383731, \"song_count\": 50 },\n    \"Jazz\": { \"total_plays\": 28298645, \"total_comments\": 98685, \"song_count\": 50 },\n    \"ACG\": { \"total_plays\": 89843048, \"total_comments\": 95537, \"song_count\": 50 }\n  };\n\n  // 图表背景：保持透明（背景由独立视觉层 + 面板承载）\n  const BG = \"transparent\";\n\n  // 轻盈莫兰迪（你后续想再调我也可以继续帮你微调）\n  const palette = {\n    Folk: \"#6F8697\",\n    Pop: \"#B79AD6\",\n    Rock: \"#88A68D\",\n    Rap: \"#D79AA8\",\n    Electronic: \"#9AA9D6\",\n    Classical: \"#C8A98C\",\n    Jazz: \"#D8B49B\",\n    ACG: \"#9AA3AF\"\n  };\n\n  const svgSel = d3.select(\"#bubble-svg\");\n  const svgNode = svgSel.node();\n  if (!svgNode) return;\n\n  // tooltip（复用避免重复）\n  let tooltip = d3.select(\"body\").select(\".bubble-tooltip\");\n  if (tooltip.empty()) {\n    tooltip = d3.select(\"body\").append(\"div\")\n      .attr(\"class\", \"bubble-tooltip\")\n      .style(\"position\", \"absolute\")\n      .style(\"pointer-events\", \"none\")\n      .style(\"padding\", \"12px 14px\")\n      .style(\"border-radius\", \"12px\")\n      .style(\"background\", \"rgba(30, 41, 59, 0.90)\")\n      .style(\"color\", \"#fff\")\n      .style(\"font\", \"13px/1.4 system-ui, -apple-system, Segoe UI, Microsoft YaHei, sans-serif\")\n      .style(\"opacity\", 0)\n      .style(\"backdrop-filter\", \"blur(6px)\");\n  }\n\n  function clamp(v, a, b) { return Math.max(a, Math.min(b, v)); }\n  function formatBig(n) { return d3.format(\",\")(n); }\n  function pct(x) { return `${(x * 100).toFixed(2)}%`; }\n\n  function render() {\n    svgSel.selectAll(\"*\").remove();\n\n    const container = svgNode.closest(\".panel-body\") || svgNode.parentElement;\n    const cw = container?.clientWidth || 1100;\n    const ch = container?.clientHeight || 720;\n\n    // ✅ 图更大：上限更高\n    const width = Math.max(1100, Math.min(1700, Math.floor(cw * 1.25)));\n    const height = Math.max(720, Math.min(1100, Math.floor(ch * 1.18)));\n\n    // ✅ 字更大后，给轴/图例更多空间\n    const margin = { top: 72, right: 260, bottom: 110, left: 120 };\n    const innerW = Math.max(300, width - margin.left - margin.right);\n    const innerH = Math.max(260, height - margin.top - margin.bottom);\n\n    svgSel\n      .attr(\"width\", \"100%\")\n      .attr(\"height\", \"100%\")\n      .attr(\"viewBox\", `0 0 ${width} ${height}`)\n      .attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n      .style(\"background\", BG);\n\n    const g = svgSel.append(\"g\");\n\n    const genres = Object.keys(data);\n    const colorOf = (k) => palette[k] || \"#94A3B8\";\n\n    const playsExtent = d3.extent(genres, k => data[k].total_plays);\n    const commentsExtent = d3.extent(genres, k => data[k].total_comments);\n\n    const xMin = Math.max(1, (playsExtent[0] || 1) * 0.75);\n    const xMax = (playsExtent[1] || 1) * 1.25;\n\n    const xScale = d3.scaleLog()\n      .domain([xMin, xMax])\n      .range([margin.left, width - margin.right])\n      .nice();\n\n    const yScale = d3.scaleLinear()\n      .domain([0, (commentsExtent[1] || 0) * 1.12])\n      .range([height - margin.bottom, margin.top])\n      .nice();\n\n    // ✅ 气泡半径：用评论数（更有区分度）\n    // 你如果想“差异更明显”，把 range 的上限再加大即可\n    const rScale = d3.scaleSqrt()\n      .domain([Math.max(1, commentsExtent[0] || 1), Math.max(2, commentsExtent[1] || 2)])\n      .range([18, Math.max(78, Math.floor(Math.min(innerW, innerH) * 0.16))]);\n\n    // ✅ 互动率：comments/plays -> 相对进度\n    const rates = genres.map(k => (data[k].total_comments || 0) / Math.max(1, data[k].total_plays || 1));\n    const maxRate = Math.max(...rates, 1e-9);\n\n    // 网格线（更淡，更干净）\n    const xGrid = d3.axisBottom(xScale).tickSize(-innerH).tickFormat(\"\");\n    const yGrid = d3.axisLeft(yScale).tickSize(-innerW).tickFormat(\"\");\n\n    g.append(\"g\")\n      .attr(\"class\", \"grid x-grid\")\n      .attr(\"transform\", `translate(0,${height - margin.bottom})`)\n      .call(xGrid);\n\n    g.append(\"g\")\n      .attr(\"class\", \"grid y-grid\")\n      .attr(\"transform\", `translate(${margin.left},0)`)\n      .call(yGrid);\n\n    // 深色赛博背景下：网格线不能太“深灰/低透明”，否则新窗口里几乎看不见\n    svgSel.selectAll(\".grid line\")\n      .attr(\"stroke\", \"rgba(50, 167, 255, 0.14)\")\n      .attr(\"stroke-width\", 1.2);\n\n    svgSel.selectAll(\".grid path\").attr(\"stroke\", \"none\");\n\n    // 坐标轴（字号更大）\n    const xAxis = d3.axisBottom(xScale).ticks(10, \"~s\");\n    const yAxis = d3.axisLeft(yScale).ticks(6).tickFormat(d3.format(\".2s\"));\n\n    const gx = g.append(\"g\")\n      .attr(\"transform\", `translate(0,${height - margin.bottom})`)\n      .attr(\"class\", \"x-axis\")\n      .call(xAxis);\n\n    const gy = g.append(\"g\")\n      .attr(\"transform\", `translate(${margin.left},0)`)\n      .attr(\"class\", \"y-axis\")\n      .call(yAxis);\n\n    // 深色赛博背景下：轴文字需要更高对比度\n    g.selectAll(\".x-axis text, .y-axis text\")\n      .style(\"font-size\", \"15px\")\n      .style(\"fill\", \"rgba(226, 232, 240, 0.88)\")\n      .style(\"paint-order\", \"stroke\")\n      .style(\"stroke\", \"rgba(7, 3, 18, 0.72)\")\n      .style(\"stroke-width\", \"2.2px\")\n      .style(\"stroke-linejoin\", \"round\");\n\n    g.selectAll(\".x-axis path, .y-axis path, .x-axis line, .y-axis line\")\n      .attr(\"stroke\", \"rgba(50, 167, 255, 0.28)\");\n\n    // 节点\n    const nodes = genres.map(genre => {\n      const s = data[genre];\n      const r = rScale(s.total_comments);\n      const rate = (s.total_comments || 0) / Math.max(1, s.total_plays || 1);\n      const progress = clamp(rate / maxRate, 0, 1);\n\n      return {\n        id: genre,\n        total_plays: s.total_plays,\n        total_comments: s.total_comments,\n        x: xScale(s.total_plays),\n        y: yScale(s.total_comments),\n        r,\n        rate,\n        progress,\n        active: true\n      };\n    });\n\n    const layer = g.append(\"g\").attr(\"class\", \"bubble-layer\");\n\n    // ✅ 只保留“柔和气泡”本体（你不喜欢的内外环全部删除）\n    const bubbles = layer.selectAll(\".bubble\")\n      .data(nodes, d => d.id)\n      .enter().append(\"circle\")\n      .attr(\"class\", \"bubble\")\n      .attr(\"r\", d => d.r)\n      .attr(\"fill\", d => colorOf(d.id))\n      .attr(\"fill-opacity\", 0.28)                // 轻盈一点\n      .attr(\"stroke\", \"rgba(255,255,255,0.95)\")  // 干净的描边\n      .attr(\"stroke-width\", 2);\n\n    // ✅ 互动率环（保留）：底环 + 进度环\n    const ringGap = 10;     // 离气泡更远一点，看起来更优雅\n    const ringWidth = 7;    // 更清晰\n\n    const ringBase = layer.selectAll(\".ring-base\")\n      .data(nodes, d => d.id)\n      .enter().append(\"circle\")\n      .attr(\"class\", \"ring-base\")\n      .attr(\"fill\", \"none\")\n      .attr(\"r\", d => d.r + ringGap)\n      .attr(\"stroke\", \"rgba(30,41,59,0.10)\")\n      .attr(\"stroke-width\", ringWidth);\n\n    const ringProg = layer.selectAll(\".ring-prog\")\n      .data(nodes, d => d.id)\n      .enter().append(\"circle\")\n      .attr(\"class\", \"ring-prog\")\n      .attr(\"fill\", \"none\")\n      .attr(\"r\", d => d.r + ringGap)\n      .attr(\"stroke\", d => colorOf(d.id))\n      .attr(\"stroke-opacity\", 0.78)\n      .attr(\"stroke-linecap\", \"round\")\n      .attr(\"stroke-width\", ringWidth);\n\n    function updateRings() {\n      ringProg.each(function (d) {\n        const rr = d.r + ringGap;\n        const c = 2 * Math.PI * rr;\n        const filled = c * d.progress;\n\n        d3.select(this)\n          .attr(\"stroke-dasharray\", `${filled} ${c}`)\n          .attr(\"stroke-dashoffset\", 0);\n      });\n    }\n\n    // 让进度从顶部开始（旋转 -90°）\n    function ringRotate(d) {\n      return `rotate(-90 ${d.x} ${d.y})`;\n    }\n\n    // 交互（绑定到气泡和环都行，这里绑定气泡）\n    bubbles\n      .on(\"mouseenter\", (event, d) => {\n        tooltip\n          .style(\"opacity\", 1)\n          .html(`\n            <div style=\"font-weight:800;margin-bottom:6px;letter-spacing:.3px\">${d.id}</div>\n            <div style=\"opacity:.92\">Plays：${formatBig(d.total_plays)}</div>\n            <div style=\"opacity:.92\">Comments：${formatBig(d.total_comments)}</div>\n            <div style=\"opacity:.92;margin-top:6px\">互动率：${pct(d.rate)}</div>\n            <div style=\"opacity:.70;margin-top:6px\">气泡=评论数｜外环=互动率（相对进度）</div>\n          `);\n      })\n      .on(\"mousemove\", (event) => {\n        tooltip\n          .style(\"left\", (event.pageX + 14) + \"px\")\n          .style(\"top\", (event.pageY + 14) + \"px\");\n      })\n      .on(\"mouseleave\", () => tooltip.style(\"opacity\", 0));\n\n    // 力导向（考虑环的碰撞）\n    const simulation = d3.forceSimulation(nodes)\n      .force(\"x\", d3.forceX(d => xScale(d.total_plays)).strength(1))\n      .force(\"y\", d3.forceY(d => yScale(d.total_comments)).strength(1))\n      .force(\"collide\", d3.forceCollide(d => d.r + ringGap + ringWidth + 6))\n      .alpha(1)\n      .alphaDecay(0.05)\n      .on(\"tick\", () => {\n        nodes.forEach(d => {\n          const bound = d.r + ringGap + ringWidth + 3;\n          d.x = clamp(d.x, margin.left + bound, width - margin.right - bound);\n          d.y = clamp(d.y, margin.top + bound, height - margin.bottom - bound);\n        });\n\n        bubbles.attr(\"cx\", d => d.x).attr(\"cy\", d => d.y);\n        ringBase.attr(\"cx\", d => d.x).attr(\"cy\", d => d.y);\n        ringProg\n          .attr(\"cx\", d => d.x).attr(\"cy\", d => d.y)\n          .attr(\"transform\", d => ringRotate(d));\n\n        updateRings();\n      });\n\n    // ✅ 轴标题更大\n    svgSel.append(\"text\")\n      .attr(\"x\", margin.left + innerW / 2)\n      .attr(\"y\", height - 42)\n      .attr(\"text-anchor\", \"middle\")\n      .style(\"font\", \"16px/1 system-ui, -apple-system, Segoe UI, Microsoft YaHei, sans-serif\")\n      .style(\"fill\", \"rgba(226, 232, 240, 0.88)\")\n      .style(\"paint-order\", \"stroke\")\n      .style(\"stroke\", \"rgba(7, 3, 18, 0.72)\")\n      .style(\"stroke-width\", \"2.2px\")\n      .style(\"stroke-linejoin\", \"round\")\n      .text(\"Total Plays (log)\");\n\n    svgSel.append(\"text\")\n      .attr(\"transform\", \"rotate(-90)\")\n      .attr(\"x\", -(margin.top + innerH / 2))\n      .attr(\"y\", 34)\n      .attr(\"text-anchor\", \"middle\")\n      .style(\"font\", \"16px/1 system-ui, -apple-system, Segoe UI, Microsoft YaHei, sans-serif\")\n      .style(\"fill\", \"rgba(226, 232, 240, 0.88)\")\n      .style(\"paint-order\", \"stroke\")\n      .style(\"stroke\", \"rgba(7, 3, 18, 0.72)\")\n      .style(\"stroke-width\", \"2.2px\")\n      .style(\"stroke-linejoin\", \"round\")\n      .text(\"Total Comments\");\n\n    // ✅ 注释：右上角加一个“说明”小标签（设计感更强）\n    const note = svgSel.append(\"g\")\n      .attr(\"transform\", `translate(${margin.left + 10}, ${margin.top - 36})`);\n\n    note.append(\"rect\")\n      .attr(\"width\", 320)\n      .attr(\"height\", 28)\n      .attr(\"rx\", 10)\n      .attr(\"fill\", \"rgba(18, 8, 42, 0.86)\")\n      .attr(\"stroke\", \"rgba(50, 167, 255, 0.28)\");\n\n    note.append(\"text\")\n      .attr(\"x\", 14)\n      .attr(\"y\", 19)\n      .style(\"font\", \"14px system-ui, -apple-system, Segoe UI, Microsoft YaHei, sans-serif\")\n      .style(\"fill\", \"rgba(226, 232, 240, 0.86)\")\n      .text(\"气泡=评论数  ｜  外环=互动率（相对进度）\");\n\n    // ✅ 图例：更大更清晰（不漏）\n    const legend = svgSel.append(\"g\").attr(\"class\", \"legend-group\");\n\n    const legendItem = legend.selectAll(\".legend\")\n      .data(genres)\n      .enter().append(\"g\")\n      .attr(\"class\", \"legend\")\n      .attr(\"transform\", (d, i) => `translate(${width - margin.right + 20}, ${margin.top + i * 32})`)\n      .style(\"cursor\", \"pointer\")\n      .on(\"click\", (event, genre) => {\n        const node = nodes.find(n => n.id === genre);\n        node.active = !node.active;\n\n        const op = node.active ? 1 : 0.12;\n\n        bubbles.filter(d => d.id === genre).transition().duration(220).attr(\"opacity\", op);\n        ringBase.filter(d => d.id === genre).transition().duration(220).attr(\"opacity\", op);\n        ringProg.filter(d => d.id === genre).transition().duration(220).attr(\"opacity\", op);\n\n        legendItem.filter(d => d === genre).selectAll(\"text, rect\")\n          .transition().duration(180)\n          .style(\"opacity\", node.active ? 1 : 0.35);\n      });\n\n    legendItem.append(\"rect\")\n      .attr(\"width\", 16)\n      .attr(\"height\", 16)\n      .attr(\"rx\", 5)\n      .attr(\"ry\", 5)\n      .attr(\"y\", -12)\n      .style(\"fill\", d => colorOf(d))\n      .style(\"opacity\", 0.75);\n\n    legendItem.append(\"text\")\n      .attr(\"x\", 26)\n      .attr(\"y\", 2)\n      .text(d => d)\n      .style(\"font-size\", \"16px\")\n      .style(\"fill\", \"rgba(226, 232, 240, 0.86)\")\n      .style(\"paint-order\", \"stroke\")\n      .style(\"stroke\", \"rgba(7, 3, 18, 0.72)\")\n      .style(\"stroke-width\", \"2.0px\")\n      .style(\"stroke-linejoin\", \"round\")\n      .style(\"font-family\", \"system-ui, -apple-system, Segoe UI, Microsoft YaHei, sans-serif\");\n\n    // 初始放置\n    bubbles.attr(\"cx\", d => d.x).attr(\"cy\", d => d.y);\n    ringBase.attr(\"cx\", d => d.x).attr(\"cy\", d => d.y);\n    ringProg.attr(\"cx\", d => d.x).attr(\"cy\", d => d.y).attr(\"transform\", d => ringRotate(d));\n    updateRings();\n\n    window.addEventListener(\"scroll\", () => tooltip.style(\"opacity\", 0), { passive: true });\n    setTimeout(() => simulation.alphaTarget(0), 2800);\n  }\n\n  // resize 防抖\n  let t = null;\n  function rerender() {\n    clearTimeout(t);\n    t = setTimeout(render, 90);\n  }\n\n  render();\n  window.addEventListener(\"resize\", rerender);\n})();\n"]}